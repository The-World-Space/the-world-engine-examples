(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();const e=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],i=Math.PI/180,s=180/Math.PI;function h(t,e,i){return Math.max(e,Math.min(i,t))}function r(t,e,i){return(1-i)*t+i*e}const n="srgb",o="srgb-linear";function a(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function l(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const c={[n]:{[o]:a},[o]:{[n]:l}},d={legacyMode:!0,get workingColorSpace(){return o},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(c[e]&&void 0!==c[e][i]){const s=c[e][i];return t.r=s(t.r),t.g=s(t.g),t.b=s(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},u={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},m={r:0,g:0,b:0},g={h:0,s:0,l:0},p={h:0,s:0,l:0};function f(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function y(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class w{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,d.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s="srgb-linear"){return this.r=t,this.g=e,this.b=i,d.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s="srgb-linear"){if(t=(t%(r=1)+r)%r,e=h(e,0,1),i=h(i,0,1),0===e)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,h=2*i-s;this.r=f(h,s,t+1/3),this.g=f(h,s,t),this.b=f(h,s,t-1/3)}var r;return d.toWorkingColorSpace(this,s),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const h=s[1],r=s[2];switch(h){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,d.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,d.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const s=parseFloat(t[1])/360,h=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return i(t[4]),this.setHSL(s,h,r,e)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=s[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,d.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,d.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=u[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=a(t.r),this.g=a(t.g),this.b=a(t.b),this}copyLinearToSRGB(t){return this.r=l(t.r),this.g=l(t.g),this.b=l(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return d.fromWorkingColorSpace(y(this,m),t),h(255*m.r,0,255)<<16^h(255*m.g,0,255)<<8^h(255*m.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){d.fromWorkingColorSpace(y(this,m),e);const i=m.r,s=m.g,h=m.b,r=Math.max(i,s,h),n=Math.min(i,s,h);let o,a;const l=(n+r)/2;if(n===r)o=0,a=0;else{const t=r-n;switch(a=l<=.5?t/(r+n):t/(2-r-n),r){case i:o=(s-h)/t+(s<h?6:0);break;case s:o=(h-i)/t+2;break;case h:o=(i-s)/t+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getRGB(t,e="srgb-linear"){return d.fromWorkingColorSpace(y(this,m),e),t.r=m.r,t.g=m.g,t.b=m.b,t}getStyle(t="srgb"){return d.fromWorkingColorSpace(y(this,m),t),t!==n?`color(${t} ${m.r} ${m.g} ${m.b})`:`rgb(${255*m.r|0},${255*m.g|0},${255*m.b|0})`}offsetHSL(t,e,i){return this.getHSL(g),g.h+=t,g.s+=e,g.l+=i,this.setHSL(g.h,g.s,g.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(g),t.getHSL(p);const i=r(g.h,p.h,e),s=r(g.s,p.s,e),h=r(g.l,p.l,e);return this.setHSL(i,s,h),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}w.NAMES=u;class C{}class v extends C{static get instance(){return v._instance}}v._instance=new v;class x extends C{constructor(t){super(),this.Et=t}get seconds(){return this.Et}}class b extends C{constructor(t){super(),this.Ot=t}get predicate(){return this.Ot}}class M extends C{constructor(t){super(),this.Ot=t}get predicate(){return this.Ot}}class _{constructor(t){this.h=t,this.Wt=[],this.Ft=0}addCoroutine(t){this.Wt.push(t),this.Ft+=1}removeCoroutine(t){const e=this.Wt.indexOf(t);e>=0&&(this.Wt[e]=null,this.Ft-=1)}tryCompact(){if(_._needToCompactCount<=this.Wt.length-this.Ft){let t=0;for(let e=0;e<this.Wt.length;e++){const i=this.Wt[e];null!==i&&(this.Wt[t]=i,t+=1)}this.Wt.length=this.Ft}}updateAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Pt(i):(t[e]=null,this.Ft-=1))}}Pt(t){const e=t.currentYieldInstruction;e instanceof x?(t.elapsedTime+=this.h.deltaTime,t.elapsedTime>=e.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):e instanceof b?e.predicate()&&t.fatchNextInstruction():e instanceof M?e.predicate()||t.fatchNextInstruction():null===e&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.Ct(i):(t[e]=null,this.Ft-=1))}}Ct(t){t.currentYieldInstruction instanceof v&&t.fatchNextInstruction()}}_._needToCompactCount=16;class E{constructor(t){this.next=null,this.prev=null,this.value=t}}class O{constructor(){this.st=!1,this.it=null,this.et=null,this.lt=0}get length(){return this.lt}add(t){const e=new E(t);null===this.it?(this.it=e,this.et=e):(this.et.next=e,e.prev=this.et,this.et=e),this.lt++}ht(t){null!==t.prev?t.prev.next=t.next:this.it=t.next,null!==t.next?t.next.prev=t.prev:this.et=t.prev,this.lt--}remove(t){let e=this.it;for(;null!==e;){if(e.value===t)return void this.ht(e);e=e.next}}removeAll(){this.it=null,this.et=null,this.lt=0,this.st=!0}forEach(t){this.st=!1;let e=this.it;for(;null!==e;)if(t(e.value),this.st){if(null===this.it)return;e=this.it,this.st=!1}else e=e.next}}class S{constructor(){this.nt=new O}addListener(t){this.nt.add(t)}removeListener(t){this.nt.remove(t)}removeAllListeners(){this.nt.removeAll()}invoke(...t){this.nt.forEach((e=>{e(...t)}))}get length(){return this.nt.length}}class D{constructor(t){this.Ks=new S,this.ks=new S,this.Hs=new S,this.Is=new S,this.Xs=new S,this.Ys=new S,this.zs=new S,this.Gs=new S,this.Js=!1,this.Zs=null,this.$s=null,this.ue=null,this.le=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.we.set(e,!0),this.Ks.invoke(t)},this.ve=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.we.set(e,!1),this.ks.invoke(t)},this.me=t=>{this.Hs.invoke(t)},this.de=t=>{this.$s=t,this.Is.invoke(t)},this.pe=t=>{this.$s=null,this.Xs.invoke(t)},this.Ee=t=>{this.ue=t,this.Ys.invoke(t)},this.ge=t=>{this.ue=null,this.zs.invoke(t)},this.ye=t=>{this.$s=t,this.Gs.invoke(t)},this.Ce=t=>{this.Zs=()=>{this.Ke("mouseenter",t.touches[0]),this.Ke("mousedown",t.touches[0])}},this.be=t=>{this.Js&&(this.Js=!1,this.Ke("mouseup",t.changedTouches[0]),this.Ke("mouseleave",t.changedTouches[0]))},this.Pe=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.Ke("mousemove",t.touches[0]),this.Js=!0},this.ke=t=>{this.Js&&(this.Js=!1,this.Ke("mouseleave",t.changedTouches[0]))},this.we=new Map,this.F=!1,this.He=t}get map(){return this.we}dispose(){this.stopHandleEvents(),this.F=!0}startHandleEvents(){if(this.F)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this.le),window.addEventListener("keyup",this.ve),window.addEventListener("wheel",this.me),this.He.addEventListener("mousedown",this.de),this.He.addEventListener("mouseup",this.pe),this.He.addEventListener("mouseenter",this.Ee),this.He.addEventListener("mouseleave",this.ge),this.He.addEventListener("mousemove",this.ye),this.He.addEventListener("touchstart",this.Ce),this.He.addEventListener("touchend",this.be),this.He.addEventListener("touchmove",this.Pe),this.He.addEventListener("touchcancel",this.ke)}stopHandleEvents(){this.$s&&this.pe(this.$s),this.ue&&this.ge(this.ue),this.we.clear(),window.removeEventListener("keydown",this.le),window.removeEventListener("keyup",this.ve),window.removeEventListener("wheel",this.me),this.He.removeEventListener("mousedown",this.de),this.He.removeEventListener("mouseup",this.pe),this.He.removeEventListener("mouseenter",this.Ee),this.He.removeEventListener("mouseleave",this.ge),this.He.removeEventListener("mousemove",this.ye),this.He.removeEventListener("touchstart",this.Ce),this.He.removeEventListener("touchend",this.be),this.He.removeEventListener("touchmove",this.Pe),this.He.removeEventListener("touchcancel",this.ke)}Ke(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onKeyDown(){return this.Ks}get onKeyUp(){return this.ks}get onWheel(){return this.Hs}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}}var T,k=(T=function(t,e){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},T(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new A("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function j(t,e){return function(i){function s(s){void 0===s&&(s=e);var h=i.call(this,s)||this;return h.name=t,h}return k(s,i),s}(Error)}j("TestError","test error");var z,A=j("TypeError","type error"),R=j("RunTimeError","access out of bounds"),W=j("InternalError","internal error"),P=j("NullValueError","you can not set null value here"),I=(j("ContainerInitError","container init failed"),function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}()),F=function(){function t(){this.length=0}return t.prototype.size=function(){return this.length},t.prototype.empty=function(){return 0===this.length},t}();function H(t,e,i){if(t<e||t>i)throw new R}I((function(){return null!==z&&z.apply(this,arguments)||this}),z=F);const L=function(){function t(t,e){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=t,this.value=e}return t.prototype.rotateLeft=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild,h=s.leftChild,r=s.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=s:t.rightChild===this&&(t.rightChild=s)),s.parent=t,s.brother=e,s.leftChild=this,s.rightChild=r,e&&(e.brother=s),this.parent=s,this.brother=r,this.leftChild=i,this.rightChild=h,r&&(r.parent=s,r.brother=this),i&&(i.parent=this,i.brother=h),h&&(h.parent=this,h.brother=i),s},t.prototype.rotateRight=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild,h=i.leftChild,r=i.rightChild;return t&&void 0!==t.key&&(t.leftChild===this?t.leftChild=i:t.rightChild===this&&(t.rightChild=i)),i.parent=t,i.brother=e,i.leftChild=h,i.rightChild=this,e&&(e.brother=i),h&&(h.parent=i,h.brother=this),this.parent=i,this.brother=h,this.leftChild=r,this.rightChild=s,r&&(r.parent=this,r.brother=s),s&&(s.parent=this,s.brother=r),i},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new W("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}();var Y=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();const N=function(t){function e(e){void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0});var i=t.call(this)||this;return i.root=new L,i.header=new L,i.findSubTreeMinNode=function(t){return t.leftChild?i.findSubTreeMinNode(t.leftChild):t},i.findSubTreeMaxNode=function(t){return t.rightChild?i.findSubTreeMaxNode(t.rightChild):t},i._lowerBound=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(t.key,e);if(0===s)return t;if(s<0)return i._lowerBound(t.rightChild,e);var h=i._lowerBound(t.leftChild,e);return void 0===h?t:h}},i._upperBound=function(t,e){if(t&&void 0!==t.key){if(i.cmp(t.key,e)<=0)return i._upperBound(t.rightChild,e);var s=i._upperBound(t.leftChild,e);return void 0===s?t:s}},i._reverseLowerBound=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(t.key,e);if(0===s)return t;if(s>0)return i._reverseLowerBound(t.leftChild,e);var h=i._reverseLowerBound(t.rightChild,e);return void 0===h?t:h}},i._reverseUpperBound=function(t,e){if(t&&void 0!==t.key){if(i.cmp(t.key,e)>=0)return i._reverseUpperBound(t.leftChild,e);var s=i._reverseUpperBound(t.rightChild,e);return void 0===s?t:s}},i.inOrderTraversal=function(t,e){return!(!t||void 0===t.key)&&(!!i.inOrderTraversal(t.leftChild,e)||!!e(t)||i.inOrderTraversal(t.rightChild,e))},i.findInsertPos=function(t,e){if(!t||void 0===t.key)throw new W;var s=i.cmp(e,t.key);return s<0?t.leftChild?i.findInsertPos(t.leftChild,e):(t.leftChild=new L,t.leftChild.parent=t,t.leftChild.brother=t.rightChild,t.rightChild&&(t.rightChild.brother=t.leftChild),t.leftChild):s>0?t.rightChild?i.findInsertPos(t.rightChild,e):(t.rightChild=new L,t.rightChild.parent=t,t.rightChild.brother=t.leftChild,t.leftChild&&(t.leftChild.brother=t.rightChild),t.rightChild):t},i.findElementNode=function(t,e){if(t&&void 0!==t.key){var s=i.cmp(e,t.key);return s<0?i.findElementNode(t.leftChild,e):s>0?i.findElementNode(t.rightChild,e):t}},i.root.color=L.TreeNodeColorType.black,i.header.parent=i.root,i.root.parent=i.header,i.cmp=e,i}return Y(e,t),e.prototype.eraseNodeSelfBalance=function(t){var e=t.parent;if(!e||e===this.header){if(t===this.root)return;throw new W}if(t.color!==L.TreeNodeColorType.red){var i=t.brother;if(!i)throw new W;if(t===e.leftChild)if(i.color===L.TreeNodeColorType.red){i.color=L.TreeNodeColorType.black,e.color=L.TreeNodeColorType.red;var s=e.rotateLeft();this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)}else i.color===L.TreeNodeColorType.black&&(i.rightChild&&i.rightChild.color===L.TreeNodeColorType.red?(i.color=e.color,e.color=L.TreeNodeColorType.black,i.rightChild&&(i.rightChild.color=L.TreeNodeColorType.black),s=e.rotateLeft(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),t.color=L.TreeNodeColorType.black):i.rightChild&&i.rightChild.color!==L.TreeNodeColorType.black||!i.leftChild||i.leftChild.color!==L.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==L.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==L.TreeNodeColorType.black||(i.color=L.TreeNodeColorType.red,this.eraseNodeSelfBalance(e)):(i.color=L.TreeNodeColorType.red,i.leftChild&&(i.leftChild.color=L.TreeNodeColorType.black),s=i.rotateRight(),this.root===i&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)));else t===e.rightChild&&(i.color===L.TreeNodeColorType.red?(i.color=L.TreeNodeColorType.black,e.color=L.TreeNodeColorType.red,s=e.rotateRight(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t)):i.color===L.TreeNodeColorType.black&&(i.leftChild&&i.leftChild.color===L.TreeNodeColorType.red?(i.color=e.color,e.color=L.TreeNodeColorType.black,i.leftChild&&(i.leftChild.color=L.TreeNodeColorType.black),s=e.rotateRight(),this.root===e&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),t.color=L.TreeNodeColorType.black):i.leftChild&&i.leftChild.color!==L.TreeNodeColorType.black||!i.rightChild||i.rightChild.color!==L.TreeNodeColorType.red?i.leftChild&&i.leftChild.color!==L.TreeNodeColorType.black||i.rightChild&&i.rightChild.color!==L.TreeNodeColorType.black||(i.color=L.TreeNodeColorType.red,this.eraseNodeSelfBalance(e)):(i.color=L.TreeNodeColorType.red,i.rightChild&&(i.rightChild.color=L.TreeNodeColorType.black),s=i.rotateLeft(),this.root===i&&(this.root=s,this.header.parent=this.root,this.root.parent=this.header),this.eraseNodeSelfBalance(t))))}else t.color=L.TreeNodeColorType.black},e.prototype.eraseNode=function(t){for(var e,i,s,h,r,n,o=t;o.leftChild||o.rightChild;){if(o.rightChild){o=this.findSubTreeMinNode(o.rightChild);var a=t.key;t.key=o.key,o.key=a;var l=t.value;t.value=o.value,o.value=l,t=o}o.leftChild&&(o=this.findSubTreeMaxNode(o.leftChild),a=t.key,t.key=o.key,o.key=a,l=t.value,t.value=o.value,o.value=l,t=o)}if(void 0===o.key)throw new W;this.header.leftChild&&void 0!==this.header.leftChild.key&&0===this.cmp(this.header.leftChild.key,o.key)&&(this.header.leftChild!==this.root?this.header.leftChild=null===(e=this.header.leftChild)||void 0===e?void 0:e.parent:(null===(i=this.header.leftChild)||void 0===i?void 0:i.rightChild)?this.header.leftChild=null===(s=this.header.leftChild)||void 0===s?void 0:s.rightChild:this.header.leftChild=void 0),this.header.rightChild&&void 0!==this.header.rightChild.key&&0===this.cmp(this.header.rightChild.key,o.key)&&(this.header.rightChild!==this.root?this.header.rightChild=null===(h=this.header.rightChild)||void 0===h?void 0:h.parent:(null===(r=this.header.rightChild)||void 0===r?void 0:r.leftChild)?this.header.rightChild=null===(n=this.header.rightChild)||void 0===n?void 0:n.leftChild:this.header.rightChild=void 0),this.eraseNodeSelfBalance(o),o&&o.remove(),--this.length,this.root.color=L.TreeNodeColorType.black},e.prototype.insertNodeSelfBalance=function(t){var e=t.parent;if(!e||e===this.header){if(t===this.root)return;throw new W}if(e.color!==L.TreeNodeColorType.black&&e.color===L.TreeNodeColorType.red){var i=e.brother,s=e.parent;if(!s)throw new W;if(i&&i.color===L.TreeNodeColorType.red)i.color=e.color=L.TreeNodeColorType.black,s.color=L.TreeNodeColorType.red,this.insertNodeSelfBalance(s);else if(!i||i.color===L.TreeNodeColorType.black)if(e===s.leftChild)if(t===e.leftChild){e.color=L.TreeNodeColorType.black,s.color=L.TreeNodeColorType.red;var h=s.rotateRight();s===this.root&&(this.root=h,this.header.parent=this.root,this.root.parent=this.header)}else t===e.rightChild&&(h=e.rotateLeft(),e===this.root&&(this.root=h,this.header.parent=this.root,this.root.parent=this.header),this.insertNodeSelfBalance(e));else e===s.rightChild&&(t===e.leftChild?(h=e.rotateRight(),e===this.root&&(this.root=h,this.header.parent=this.root,this.root.parent=this.header),this.insertNodeSelfBalance(e)):t===e.rightChild&&(e.color=L.TreeNodeColorType.black,s.color=L.TreeNodeColorType.red,h=s.rotateLeft(),s===this.root&&(this.root=h,this.header.parent=this.root,this.root.parent=this.header)))}},e.prototype.clear=function(){this.length=0,this.root.key=this.root.value=void 0,this.root.leftChild=this.root.rightChild=this.root.brother=void 0,this.header.leftChild=this.header.rightChild=void 0},e.prototype.eraseElementByPos=function(t){var e=this;H(t,0,this.length-1);var i=0;this.inOrderTraversal(this.root,(function(s){return t===i?(e.eraseNode(s),!0):(++i,!1)}))},e.prototype.eraseElementByKey=function(t){if(!this.empty()){var e=this.findElementNode(this.root,t);void 0!==e&&void 0!==e.key&&0===this.cmp(e.key,t)&&this.eraseNode(e)}},e.prototype.getHeight=function(){if(this.empty())return 0;var t=function(e){return e?Math.max(t(e.leftChild),t(e.rightChild))+1:1};return t(this.root)},e}(F);var B=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();const X=function(t){function e(e,i,s){var h=t.call(this,e,s)||this;return h.header=i,h}return B(e,t),e.prototype._pre=function(){var t,e=this.node;if(e.color===L.TreeNodeColorType.red&&(null===(t=e.parent)||void 0===t?void 0:t.parent)===e)e=e.rightChild;else if(e.leftChild)for(e=e.leftChild;e.rightChild;)e=null==e?void 0:e.rightChild;else{for(var i=null==e?void 0:e.parent;(null==i?void 0:i.leftChild)===e;)i=null==(e=i)?void 0:e.parent;e=i}return e},e.prototype._next=function(){var t=this.node;if(null==t?void 0:t.rightChild)for(t=t.rightChild;t.leftChild;)t=null==t?void 0:t.leftChild;else{for(var e=null==t?void 0:t.parent;(null==e?void 0:e.rightChild)===t;)e=null==(t=e)?void 0:t.parent;t.rightChild!==e&&(t=e)}return t},e.prototype.pre=function(){if("reverse"===this.iteratorType){if(this.node===this.header.rightChild)throw new R("Tree iterator access denied!");this.node=this._next()}else{if(this.node===this.header.leftChild)throw new R("Tree iterator access denied!");this.node=this._pre()}return this},e.prototype.next=function(){if("reverse"===this.iteratorType){if(this.node===this.header)throw new R("Tree iterator access denied!");this.node=this._pre()}else{if(this.node===this.header)throw new R("Tree iterator access denied!");this.node=this._next()}return this},e.prototype.equals=function(t){if(t.constructor.name!==this.constructor.name)throw new TypeError("obj's constructor is not ".concat(this.constructor.name,"!"));if(this.iteratorType!==t.iteratorType)throw new TypeError("iterator type error!");return this.node===t.node},e}((function(t,e){this.node=t,this.iteratorType=e}));var G=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),q=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},U=function(t){function e(e,i,s){return void 0===s&&(s="normal"),t.call(this,e,i,s)||this}return G(e,t),Object.defineProperty(e.prototype,"pointer",{get:function(){if(void 0===this.node.key)throw new R("OrderedSet iterator access denied!");return this.node.key},enumerable:!1,configurable:!0}),e}(X);const V=function(t){function e(e,i){void 0===e&&(e=[]);var s=t.call(this,i)||this;return s.iterationFunc=function(t){return function(t,e){var i,s,h,r,n={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(h=2&r[0]?s.return:r[0]?s.throw||((h=s.return)&&h.call(s),0):s.next)&&!(h=h.call(s,r[1])).done)return h;switch(s=0,h&&(r=[2&r[0],h.value]),r[0]){case 0:case 1:h=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,s=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!((h=(h=n.trys).length>0&&h[h.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!h||r[1]>h[0]&&r[1]<h[3])){n.label=r[1];break}if(6===r[0]&&n.label<h[1]){n.label=h[1],h=r;break}if(h&&n.label<h[2]){n.label=h[2],n.ops.push(r);break}h[2]&&n.ops.pop(),n.trys.pop();continue}r=e.call(t,n)}catch(t){r=[6,t],s=0}finally{i=h=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}(this,(function(e){switch(e.label){case 0:return t&&void 0!==t.key?[5,q(this.iterationFunc(t.leftChild))]:[2];case 1:return e.sent(),[4,t.key];case 2:return e.sent(),[5,q(this.iterationFunc(t.rightChild))];case 3:return e.sent(),[2]}}))},e.forEach((function(t){return s.insert(t)})),s.iterationFunc=s.iterationFunc.bind(s),s}return G(e,t),e.prototype.begin=function(){return new U(this.header.leftChild||this.header,this.header)},e.prototype.end=function(){return new U(this.header,this.header)},e.prototype.rBegin=function(){return new U(this.header.rightChild||this.header,this.header,"reverse")},e.prototype.rEnd=function(){return new U(this.header,this.header,"reverse")},e.prototype.front=function(){var t;return null===(t=this.header.leftChild)||void 0===t?void 0:t.key},e.prototype.back=function(){var t;return null===(t=this.header.rightChild)||void 0===t?void 0:t.key},e.prototype.forEach=function(t){var e,i,s=0;try{for(var h=q(this),r=h.next();!r.done;r=h.next())t(r.value,s++)}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}},e.prototype.getElementByPos=function(t){var e,i;H(t,0,this.length-1);var s=0;try{for(var h=q(this),r=h.next();!r.done;r=h.next()){var n=r.value;if(s===t)return n;++s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}},e.prototype.eraseElementByIterator=function(t){var e=t.node;return t=t.next(),this.eraseNode(e),t},e.prototype.insert=function(t){if(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.includes(void 0)||t.includes(null))throw new P}(t),this.empty())return++this.length,this.root.key=t,this.root.color=L.TreeNodeColorType.black,this.header.leftChild=this.root,void(this.header.rightChild=this.root);var e=this.findInsertPos(this.root,t);void 0!==e.key&&0===this.cmp(e.key,t)||(++this.length,e.key=t,(void 0===this.header.leftChild||void 0===this.header.leftChild.key||this.cmp(this.header.leftChild.key,t)>0)&&(this.header.leftChild=e),(void 0===this.header.rightChild||void 0===this.header.rightChild.key||this.cmp(this.header.rightChild.key,t)<0)&&(this.header.rightChild=e),this.insertNodeSelfBalance(e),this.root.color=L.TreeNodeColorType.black)},e.prototype.find=function(t){var e=this.findElementNode(this.root,t);return void 0!==e&&void 0!==e.key?new U(e,this.header):this.end()},e.prototype.lowerBound=function(t){var e=this._lowerBound(this.root,t);return void 0===e?this.end():new U(e,this.header)},e.prototype.upperBound=function(t){var e=this._upperBound(this.root,t);return void 0===e?this.end():new U(e,this.header)},e.prototype.reverseLowerBound=function(t){var e=this._reverseLowerBound(this.root,t);return void 0===e?this.end():new U(e,this.header)},e.prototype.reverseUpperBound=function(t){var e=this._reverseUpperBound(this.root,t);return void 0===e?this.end():new U(e,this.header)},e.prototype.union=function(t){var e=this;t.forEach((function(t){return e.insert(t)}))},e.prototype[Symbol.iterator]=function(){return this.iterationFunc(this.root)},e}(N);class ${constructor(t){this.rt=null,this.dt=new V(void 0,t),this.ut=new V(void 0,t),this.ft=new V(void 0,t),this.ot=new V(void 0,t)}get size(){return this.dt.size()}insert(t){t.isRemoved=!1,null!==this.rt?this.ut.insert(t):this.dt.insert(t)}delete(t){null!==this.rt?(t.isRemoved=!0,this.ot.insert(t)):this.dt.eraseElementByKey(t)}clear(){this.dt.clear(),this.ut.clear(),this.ot.clear()}forEach(t){this.rt=this.dt,this.rt.forEach((e=>{e.isRemoved||t(e)}));do{this.rt=this.ct(),this.rt.forEach((e=>{e.isRemoved||t(e)}))}while(0<this.ut.size()||0<this.ot.size());this.rt=null}ct(){this.rt=null,this.ot.forEach((t=>this.delete(t))),this.ut.forEach((t=>this.insert(t)));const t=this.ut;return this.ut=this.ft,this.ft=t,this.ut.clear(),this.ot.clear(),t}}class Q{constructor(t,e,i,s){this.isRemoved=!1,this.Dt=i,this.St=t.generateEventId(),this.kt=s,this.At=e}static createAwakeEvent(t,e){return new Q(t,e,0,0)}static createStartEvent(t,e,i){return new Q(t,e,2,i)}static createUpdateEvent(t,e,i){return new Q(t,e,3,i)}static createOnEnableEvent(t,e,i){return new Q(t,e,1,i)}static createOnDisableEvent(t,e,i){return new Q(t,e,1,i)}static createOnDestroyEvent(t,e,i){return new Q(t,e,4,i)}static createOnCollisionEnter2DEvent(t,e,i){return new Q(t,e,1,i)}static createOnCollisionStay2DEvent(t,e,i){return new Q(t,e,1,i)}static createOnCollisionExit2DEvent(t,e,i){return new Q(t,e,1,i)}static createOnTriggerEnter2DEvent(t,e,i){return new Q(t,e,1,i)}static createOnTriggerStay2DEvent(t,e,i){return new Q(t,e,1,i)}static createOnTriggerExit2DEvent(t,e,i){return new Q(t,e,1,i)}get invoke(){return this.At}static comparator(t,e){return t.Dt===e.Dt?t.kt===e.kt?t.St-e.St:t.kt-e.kt:t.Dt-e.Dt}}function Z(t){return void 0!==t.onWorldMatrixUpdated}class K{constructor(){this.ti=new Set,this.ii=new $(Q.comparator),this.ei=new $(Q.comparator),this.ni=new $(Q.comparator),this.oi=new $(Q.comparator),this.ri=new $(Q.comparator),this.si=new $(Q.comparator)}registerComponent(t){Z(t)&&this.ti.add(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.insert(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.insert(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.insert(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.insert(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.insert(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.insert(e.onTriggerExit2D)}unregisterComponent(t){Z(t)&&this.ti.delete(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.delete(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.delete(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.delete(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.delete(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.delete(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.delete(e.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this.ti)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){0!==this.ii.size&&this.ii.forEach((e=>e.invoke(t)))}invokeOnCollisionStay2D(t){0!==this.ei.size&&this.ei.forEach((e=>e.invoke(t)))}invokeOnCollisionExit2D(t){0!==this.ni.size&&this.ni.forEach((e=>e.invoke(t)))}invokeOnTriggerEnter2D(t){0!==this.oi.size&&this.oi.forEach((e=>e.invoke(t)))}invokeOnTriggerStay2D(t){0!==this.ri.size&&this.ri.forEach((e=>e.invoke(t)))}invokeOnTriggerExit2D(t){0!==this.si.size&&this.si.forEach((e=>e.invoke(t)))}}class J{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,h,r,n){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const d=h[r+0],u=h[r+1],m=h[r+2],g=h[r+3];if(0===n)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===n)return t[e+0]=d,t[e+1]=u,t[e+2]=m,void(t[e+3]=g);if(c!==g||o!==d||a!==u||l!==m){let t=1-n;const e=o*d+a*u+l*m+c*g,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const h=Math.sqrt(s),r=Math.atan2(h,e*i);t=Math.sin(t*r)/h,n=Math.sin(n*r)/h}const h=n*i;if(o=o*t+d*h,a=a*t+u*h,l=l*t+m*h,c=c*t+g*h,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,h,r){const n=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=h[r],d=h[r+1],u=h[r+2],m=h[r+3];return t[e]=n*m+l*c+o*u-a*d,t[e+1]=o*m+l*d+a*c-n*u,t[e+2]=a*m+l*u+n*d-o*c,t[e+3]=l*m-n*c-o*d-a*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,h=t._z,r=t._order,n=Math.cos,o=Math.sin,a=n(i/2),l=n(s/2),c=n(h/2),d=o(i/2),u=o(s/2),m=o(h/2);switch(r){case"XYZ":this._x=d*l*c+a*u*m,this._y=a*u*c-d*l*m,this._z=a*l*m+d*u*c,this._w=a*l*c-d*u*m;break;case"YXZ":this._x=d*l*c+a*u*m,this._y=a*u*c-d*l*m,this._z=a*l*m-d*u*c,this._w=a*l*c+d*u*m;break;case"ZXY":this._x=d*l*c-a*u*m,this._y=a*u*c+d*l*m,this._z=a*l*m+d*u*c,this._w=a*l*c-d*u*m;break;case"ZYX":this._x=d*l*c-a*u*m,this._y=a*u*c+d*l*m,this._z=a*l*m-d*u*c,this._w=a*l*c+d*u*m;break;case"YZX":this._x=d*l*c+a*u*m,this._y=a*u*c+d*l*m,this._z=a*l*m-d*u*c,this._w=a*l*c-d*u*m;break;case"XZY":this._x=d*l*c-a*u*m,this._y=a*u*c-d*l*m,this._z=a*l*m+d*u*c,this._w=a*l*c+d*u*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],h=e[8],r=e[1],n=e[5],o=e[9],a=e[2],l=e[6],c=e[10],d=i+n+c;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(l-o)*t,this._y=(h-a)*t,this._z=(r-s)*t}else if(i>n&&i>c){const t=2*Math.sqrt(1+i-n-c);this._w=(l-o)/t,this._x=.25*t,this._y=(s+r)/t,this._z=(h+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-i-c);this._w=(h-a)/t,this._x=(s+r)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-n);this._w=(r-s)/t,this._x=(h+a)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(h(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,h=t._z,r=t._w,n=e._x,o=e._y,a=e._z,l=e._w;return this._x=i*l+r*n+s*a-h*o,this._y=s*l+r*o+h*n-i*a,this._z=h*l+r*a+i*o-s*n,this._w=r*l-i*n-s*o-h*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,h=this._z,r=this._w;let n=r*t._w+i*t._x+s*t._y+h*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=r,this._x=i,this._y=s,this._z=h,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*h+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-e)*l)/a,d=Math.sin(e*l)/a;return this._w=r*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=h*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(h),i*Math.cos(h),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class tt{constructor(t=0,e=0,i=0){tt.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(it.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(it.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,h=t.elements;return this.x=h[0]*e+h[3]*i+h[6]*s,this.y=h[1]*e+h[4]*i+h[7]*s,this.z=h[2]*e+h[5]*i+h[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,h=t.elements,r=1/(h[3]*e+h[7]*i+h[11]*s+h[15]);return this.x=(h[0]*e+h[4]*i+h[8]*s+h[12])*r,this.y=(h[1]*e+h[5]*i+h[9]*s+h[13])*r,this.z=(h[2]*e+h[6]*i+h[10]*s+h[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,h=t.x,r=t.y,n=t.z,o=t.w,a=o*e+r*s-n*i,l=o*i+n*e-h*s,c=o*s+h*i-r*e,d=-h*e-r*i-n*s;return this.x=a*o+d*-h+l*-n-c*-r,this.y=l*o+d*-r+c*-h-a*-n,this.z=c*o+d*-n+a*-r-l*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,h=t.elements;return this.x=h[0]*e+h[4]*i+h[8]*s,this.y=h[1]*e+h[5]*i+h[9]*s,this.z=h[2]*e+h[6]*i+h[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,h=t.z,r=e.x,n=e.y,o=e.z;return this.x=s*o-h*n,this.y=h*r-i*o,this.z=i*n-s*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return et.copy(this).projectOnVector(t),this.sub(et)}reflect(t){return this.sub(et.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(h(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const et=new tt,it=new J;class st{constructor(){st.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,h,r,n,o,a,l,c,d,u,m,g,p){const f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=s,f[1]=h,f[5]=r,f[9]=n,f[13]=o,f[2]=a,f[6]=l,f[10]=c,f[14]=d,f[3]=u,f[7]=m,f[11]=g,f[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new st).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/ht.setFromMatrixColumn(t,0).length(),h=1/ht.setFromMatrixColumn(t,1).length(),r=1/ht.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*h,e[5]=i[5]*h,e[6]=i[6]*h,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,s=t.y,h=t.z,r=Math.cos(i),n=Math.sin(i),o=Math.cos(s),a=Math.sin(s),l=Math.cos(h),c=Math.sin(h);if("XYZ"===t.order){const t=r*l,i=r*c,s=n*l,h=n*c;e[0]=o*l,e[4]=-o*c,e[8]=a,e[1]=i+s*a,e[5]=t-h*a,e[9]=-n*o,e[2]=h-t*a,e[6]=s+i*a,e[10]=r*o}else if("YXZ"===t.order){const t=o*l,i=o*c,s=a*l,h=a*c;e[0]=t+h*n,e[4]=s*n-i,e[8]=r*a,e[1]=r*c,e[5]=r*l,e[9]=-n,e[2]=i*n-s,e[6]=h+t*n,e[10]=r*o}else if("ZXY"===t.order){const t=o*l,i=o*c,s=a*l,h=a*c;e[0]=t-h*n,e[4]=-r*c,e[8]=s+i*n,e[1]=i+s*n,e[5]=r*l,e[9]=h-t*n,e[2]=-r*a,e[6]=n,e[10]=r*o}else if("ZYX"===t.order){const t=r*l,i=r*c,s=n*l,h=n*c;e[0]=o*l,e[4]=s*a-i,e[8]=t*a+h,e[1]=o*c,e[5]=h*a+t,e[9]=i*a-s,e[2]=-a,e[6]=n*o,e[10]=r*o}else if("YZX"===t.order){const t=r*o,i=r*a,s=n*o,h=n*a;e[0]=o*l,e[4]=h-t*c,e[8]=s*c+i,e[1]=c,e[5]=r*l,e[9]=-n*l,e[2]=-a*l,e[6]=i*c+s,e[10]=t-h*c}else if("XZY"===t.order){const t=r*o,i=r*a,s=n*o,h=n*a;e[0]=o*l,e[4]=-c,e[8]=a*l,e[1]=t*c+h,e[5]=r*l,e[9]=i*c-s,e[2]=s*c-i,e[6]=n*l,e[10]=h*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(nt,t,ot)}lookAt(t,e,i){const s=this.elements;return ct.subVectors(t,e),0===ct.lengthSq()&&(ct.z=1),ct.normalize(),at.crossVectors(i,ct),0===at.lengthSq()&&(1===Math.abs(i.z)?ct.x+=1e-4:ct.z+=1e-4,ct.normalize(),at.crossVectors(i,ct)),at.normalize(),lt.crossVectors(ct,at),s[0]=at.x,s[4]=lt.x,s[8]=ct.x,s[1]=at.y,s[5]=lt.y,s[9]=ct.y,s[2]=at.z,s[6]=lt.z,s[10]=ct.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,h=this.elements,r=i[0],n=i[4],o=i[8],a=i[12],l=i[1],c=i[5],d=i[9],u=i[13],m=i[2],g=i[6],p=i[10],f=i[14],y=i[3],w=i[7],C=i[11],v=i[15],x=s[0],b=s[4],M=s[8],_=s[12],E=s[1],O=s[5],S=s[9],D=s[13],T=s[2],k=s[6],j=s[10],z=s[14],A=s[3],R=s[7],W=s[11],P=s[15];return h[0]=r*x+n*E+o*T+a*A,h[4]=r*b+n*O+o*k+a*R,h[8]=r*M+n*S+o*j+a*W,h[12]=r*_+n*D+o*z+a*P,h[1]=l*x+c*E+d*T+u*A,h[5]=l*b+c*O+d*k+u*R,h[9]=l*M+c*S+d*j+u*W,h[13]=l*_+c*D+d*z+u*P,h[2]=m*x+g*E+p*T+f*A,h[6]=m*b+g*O+p*k+f*R,h[10]=m*M+g*S+p*j+f*W,h[14]=m*_+g*D+p*z+f*P,h[3]=y*x+w*E+C*T+v*A,h[7]=y*b+w*O+C*k+v*R,h[11]=y*M+w*S+C*j+v*W,h[15]=y*_+w*D+C*z+v*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],h=t[12],r=t[1],n=t[5],o=t[9],a=t[13],l=t[2],c=t[6],d=t[10],u=t[14];return t[3]*(+h*o*c-s*a*c-h*n*d+i*a*d+s*n*u-i*o*u)+t[7]*(+e*o*u-e*a*d+h*r*d-s*r*u+s*a*l-h*o*l)+t[11]*(+e*a*c-e*n*u-h*r*c+i*r*u+h*n*l-i*a*l)+t[15]*(-s*n*l-e*o*c+e*n*d+s*r*c-i*r*d+i*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=t[9],d=t[10],u=t[11],m=t[12],g=t[13],p=t[14],f=t[15],y=c*p*a-g*d*a+g*o*u-n*p*u-c*o*f+n*d*f,w=m*d*a-l*p*a-m*o*u+r*p*u+l*o*f-r*d*f,C=l*g*a-m*c*a+m*n*u-r*g*u-l*n*f+r*c*f,v=m*c*o-l*g*o-m*n*d+r*g*d+l*n*p-r*c*p,x=e*y+i*w+s*C+h*v;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/x;return t[0]=y*b,t[1]=(g*d*h-c*p*h-g*s*u+i*p*u+c*s*f-i*d*f)*b,t[2]=(n*p*h-g*o*h+g*s*a-i*p*a-n*s*f+i*o*f)*b,t[3]=(c*o*h-n*d*h-c*s*a+i*d*a+n*s*u-i*o*u)*b,t[4]=w*b,t[5]=(l*p*h-m*d*h+m*s*u-e*p*u-l*s*f+e*d*f)*b,t[6]=(m*o*h-r*p*h-m*s*a+e*p*a+r*s*f-e*o*f)*b,t[7]=(r*d*h-l*o*h+l*s*a-e*d*a-r*s*u+e*o*u)*b,t[8]=C*b,t[9]=(m*c*h-l*g*h-m*i*u+e*g*u+l*i*f-e*c*f)*b,t[10]=(r*g*h-m*n*h+m*i*a-e*g*a-r*i*f+e*n*f)*b,t[11]=(l*n*h-r*c*h-l*i*a+e*c*a+r*i*u-e*n*u)*b,t[12]=v*b,t[13]=(l*g*s-m*c*s+m*i*d-e*g*d-l*i*p+e*c*p)*b,t[14]=(m*n*s-r*g*s-m*i*o+e*g*o+r*i*p-e*n*p)*b,t[15]=(r*c*s-l*n*s+l*i*o-e*c*o-r*i*d+e*n*d)*b,this}scale(t){const e=this.elements,i=t.x,s=t.y,h=t.z;return e[0]*=i,e[4]*=s,e[8]*=h,e[1]*=i,e[5]*=s,e[9]*=h,e[2]*=i,e[6]*=s,e[10]*=h,e[3]*=i,e[7]*=s,e[11]*=h,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),h=1-i,r=t.x,n=t.y,o=t.z,a=h*r,l=h*n;return this.set(a*r+i,a*n-s*o,a*o+s*n,0,a*n+s*o,l*n+i,l*o-s*r,0,a*o-s*n,l*o+s*r,h*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,h,r){return this.set(1,i,h,0,t,1,r,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,h=e._x,r=e._y,n=e._z,o=e._w,a=h+h,l=r+r,c=n+n,d=h*a,u=h*l,m=h*c,g=r*l,p=r*c,f=n*c,y=o*a,w=o*l,C=o*c,v=i.x,x=i.y,b=i.z;return s[0]=(1-(g+f))*v,s[1]=(u+C)*v,s[2]=(m-w)*v,s[3]=0,s[4]=(u-C)*x,s[5]=(1-(d+f))*x,s[6]=(p+y)*x,s[7]=0,s[8]=(m+w)*b,s[9]=(p-y)*b,s[10]=(1-(d+g))*b,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let h=ht.set(s[0],s[1],s[2]).length();const r=ht.set(s[4],s[5],s[6]).length(),n=ht.set(s[8],s[9],s[10]).length();this.determinant()<0&&(h=-h),t.x=s[12],t.y=s[13],t.z=s[14],rt.copy(this);const o=1/h,a=1/r,l=1/n;return rt.elements[0]*=o,rt.elements[1]*=o,rt.elements[2]*=o,rt.elements[4]*=a,rt.elements[5]*=a,rt.elements[6]*=a,rt.elements[8]*=l,rt.elements[9]*=l,rt.elements[10]*=l,e.setFromRotationMatrix(rt),i.x=h,i.y=r,i.z=n,this}makePerspective(t,e,i,s,h,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const n=this.elements,o=2*h/(e-t),a=2*h/(i-s),l=(e+t)/(e-t),c=(i+s)/(i-s),d=-(r+h)/(r-h),u=-2*r*h/(r-h);return n[0]=o,n[4]=0,n[8]=l,n[12]=0,n[1]=0,n[5]=a,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=d,n[14]=u,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,e,i,s,h,r){const n=this.elements,o=1/(e-t),a=1/(i-s),l=1/(r-h),c=(e+t)*o,d=(i+s)*a,u=(r+h)*l;return n[0]=2*o,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2*a,n[9]=0,n[13]=-d,n[2]=0,n[6]=0,n[10]=-2*l,n[14]=-u,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const ht=new tt,rt=new st,nt=new tt(0,0,0),ot=new tt(1,1,1),at=new tt,lt=new tt,ct=new tt,dt=new st,ut=new J;class mt{constructor(t=0,e=0,i=0,s=mt.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],n=s[4],o=s[8],a=s[1],l=s[5],c=s[9],d=s[2],u=s[6],m=s[10];switch(e){case"XYZ":this._y=Math.asin(h(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-n,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-h(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(h(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-n,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-h(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,m),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-n,l));break;case"YZX":this._z=Math.asin(h(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-h(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return dt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(dt,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ut.setFromEuler(this),this.setFromQuaternion(ut,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}mt.DefaultOrder="XYZ",mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class gt{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class pt{constructor(){pt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,h,r,n,o,a){const l=this.elements;return l[0]=t,l[1]=s,l[2]=n,l[3]=e,l[4]=h,l[5]=o,l[6]=i,l[7]=r,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,h=this.elements,r=i[0],n=i[3],o=i[6],a=i[1],l=i[4],c=i[7],d=i[2],u=i[5],m=i[8],g=s[0],p=s[3],f=s[6],y=s[1],w=s[4],C=s[7],v=s[2],x=s[5],b=s[8];return h[0]=r*g+n*y+o*v,h[3]=r*p+n*w+o*x,h[6]=r*f+n*C+o*b,h[1]=a*g+l*y+c*v,h[4]=a*p+l*w+c*x,h[7]=a*f+l*C+c*b,h[2]=d*g+u*y+m*v,h[5]=d*p+u*w+m*x,h[8]=d*f+u*C+m*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8];return e*r*l-e*n*a-i*h*l+i*n*o+s*h*a-s*r*o}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=l*r-n*a,d=n*o-l*h,u=a*h-r*o,m=e*c+i*d+s*u;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return t[0]=c*g,t[1]=(s*a-l*i)*g,t[2]=(n*i-s*r)*g,t[3]=d*g,t[4]=(l*e-s*o)*g,t[5]=(s*h-n*e)*g,t[6]=u*g,t[7]=(i*o-a*e)*g,t[8]=(r*e-i*h)*g,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,h,r,n){const o=Math.cos(h),a=Math.sin(h);return this.set(i*o,i*a,-i*(o*r+a*n)+r+t,-s*a,s*o,-s*(-a*r+o*n)+n+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,h=s[0],r=s[3],n=s[6],o=s[1],a=s[4],l=s[7];return s[0]=e*h+i*o,s[3]=e*r+i*a,s[6]=e*n+i*l,s[1]=-i*h+e*o,s[4]=-i*r+e*a,s[7]=-i*n+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let ft=0;const yt=new tt,wt=new J,Ct=new st,vt=new tt,xt=new tt,bt=new tt,Mt=new J,_t=new tt(1,0,0),Et=new tt(0,1,0),Ot=new tt(0,0,1),St={type:"added"},Dt={type:"removed"};class Tt extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t);t.target=null}}}{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ft++}),this.uuid=function(){const t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,h=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&s|128]+e[s>>8&255]+"-"+e[s>>16&255]+e[s>>24&255]+e[255&h]+e[h>>8&255]+e[h>>16&255]+e[h>>24&255]).toLowerCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tt.DefaultUp.clone();const t=new tt,i=new mt,s=new J,h=new tt(1,1,1);i._onChange((function(){s.setFromEuler(i,!1)})),s._onChange((function(){i.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:h},modelViewMatrix:{value:new st},normalMatrix:{value:new pt}}),this.matrix=new st,this.matrixWorld=new st,this.matrixAutoUpdate=Tt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new gt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.multiply(wt),this}rotateOnWorldAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.premultiply(wt),this}rotateX(t){return this.rotateOnAxis(_t,t)}rotateY(t){return this.rotateOnAxis(Et,t)}rotateZ(t){return this.rotateOnAxis(Ot,t)}translateOnAxis(t,e){return yt.copy(t).applyQuaternion(this.quaternion),this.position.add(yt.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(_t,t)}translateY(t){return this.translateOnAxis(Et,t)}translateZ(t){return this.translateOnAxis(Ot,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Ct.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?vt.copy(t):vt.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),xt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ct.lookAt(xt,vt,this.up):Ct.lookAt(vt,xt,this.up),this.quaternion.setFromRotationMatrix(Ct),s&&(Ct.extractRotation(s.matrixWorld),wt.setFromRotationMatrix(Ct),this.quaternion.premultiply(wt.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(St)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Dt)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Dt)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ct.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ct.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ct),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xt,t,bt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xt,Mt,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function h(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=h(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];h(t.shapes,s)}else h(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(h(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(h(t.materials,this.material[i]));s.material=e}else s.material=h(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(h(t.animations,i))}}if(e){const e=r(t.geometries),s=r(t.materials),h=r(t.textures),n=r(t.images),o=r(t.shapes),a=r(t.skeletons),l=r(t.animations),c=r(t.nodes);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),h.length>0&&(i.textures=h),n.length>0&&(i.images=n),o.length>0&&(i.shapes=o),a.length>0&&(i.skeletons=a),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=s,i;function r(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Tt.DefaultUp=new tt(0,1,0),Tt.DefaultMatrixAutoUpdate=!0;class kt extends Tt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}class jt{constructor(t=0,e=0,i=0,s=jt.DefaultOrder){this.isEuler=!0,this.th=t,this.sh=e,this.hh=i,this.ih=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _order(){return this.rh(),this.ih}set _order(t){this.ih=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get order(){return this.rh(),this.ih}set order(t){this.eh(),this.ih=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,s&&(this.ih=s),this._onChangeCallback(),this}clone(){return this.rh(),new mt(this.th,this.sh,this.hh,this.ih)}copy(t){return this.eh(),this.th=t._x,this.sh=t._y,this.hh=t._z,this.ih=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i=!0){this.rh();const s=t.elements,r=s[0],n=s[4],o=s[8],a=s[1],l=s[5],c=s[9],d=s[2],u=s[6],m=s[10];switch(e||(e=this.ih),this.eh(),e){case"XYZ":this.sh=Math.asin(h(o,-1,1)),Math.abs(o)<.9999999?(this.th=Math.atan2(-c,m),this.hh=Math.atan2(-n,r)):(this.th=Math.atan2(u,l),this.hh=0);break;case"YXZ":this.th=Math.asin(-h(c,-1,1)),Math.abs(c)<.9999999?(this.sh=Math.atan2(o,m),this.hh=Math.atan2(a,l)):(this.sh=Math.atan2(-d,r),this.hh=0);break;case"ZXY":this.th=Math.asin(h(u,-1,1)),Math.abs(u)<.9999999?(this.sh=Math.atan2(-d,m),this.hh=Math.atan2(-n,l)):(this.sh=0,this.hh=Math.atan2(a,r));break;case"ZYX":this.sh=Math.asin(-h(d,-1,1)),Math.abs(d)<.9999999?(this.th=Math.atan2(u,m),this.hh=Math.atan2(a,r)):(this.th=0,this.hh=Math.atan2(-n,l));break;case"YZX":this.hh=Math.asin(h(a,-1,1)),Math.abs(a)<.9999999?(this.th=Math.atan2(-c,l),this.sh=Math.atan2(-d,r)):(this.th=0,this.sh=Math.atan2(o,m));break;case"XZY":this.hh=Math.asin(-h(n,-1,1)),Math.abs(n)<.9999999?(this.th=Math.atan2(u,l),this.sh=Math.atan2(o,r)):(this.th=Math.atan2(-c,m),this.sh=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this.ih=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return zt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(zt,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e)}reorder(t){return At.setFromEuler(this),this.setFromQuaternion(At,t)}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._order===this.ih}fromArray(t){return this.th===t[0]&&this.sh===t[1]&&this.hh===t[2]&&this.ih===t[3]||(this.eh(),this.th=t[0],this.sh=t[1],this.hh=t[2],void 0!==t[3]&&(this.ih=t[3]),this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.ih,t}_onChange(t){return this._onChangeCallback=t,this}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.ih}}jt.DefaultOrder="XYZ",jt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const zt=new st,At=new J;class Rt{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,h,r,n){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const d=h[r+0],u=h[r+1],m=h[r+2],g=h[r+3];if(0===n)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===n)return t[e+0]=d,t[e+1]=u,t[e+2]=m,void(t[e+3]=g);if(c!==g||o!==d||a!==u||l!==m){let t=1-n;const e=o*d+a*u+l*m+c*g,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const h=Math.sqrt(s),r=Math.atan2(h,e*i);t=Math.sin(t*r)/h,n=Math.sin(n*r)/h}const h=n*i;if(o=o*t+d*h,a=a*t+u*h,l=l*t+m*h,c=c*t+g*h,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,h,r){const n=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=h[r],d=h[r+1],u=h[r+2],m=h[r+3];return t[e]=n*m+l*c+o*u-a*d,t[e+1]=o*m+l*d+a*c-n*u,t[e+2]=a*m+l*u+n*d-o*c,t[e+3]=l*m-n*c-o*d-a*u,t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _w(){return this.rh(),this.hi}set _w(t){this.hi=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get w(){return this.rh(),this.hi}set w(t){this.eh(),this.hi=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback(),this}clone(){return this.rh(),new J(this.th,this.sh,this.hh,this.hi)}copy(t){return this.eh(),this.th=t.x,this.sh=t.y,this.hh=t.z,this.hi=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,h=t._z,r=t._order,n=Math.cos,o=Math.sin,a=n(i/2),l=n(s/2),c=n(h/2),d=o(i/2),u=o(s/2),m=o(h/2);switch(this.eh(),r){case"XYZ":this.th=d*l*c+a*u*m,this.sh=a*u*c-d*l*m,this.hh=a*l*m+d*u*c,this.hi=a*l*c-d*u*m;break;case"YXZ":this.th=d*l*c+a*u*m,this.sh=a*u*c-d*l*m,this.hh=a*l*m-d*u*c,this.hi=a*l*c+d*u*m;break;case"ZXY":this.th=d*l*c-a*u*m,this.sh=a*u*c+d*l*m,this.hh=a*l*m+d*u*c,this.hi=a*l*c-d*u*m;break;case"ZYX":this.th=d*l*c-a*u*m,this.sh=a*u*c+d*l*m,this.hh=a*l*m-d*u*c,this.hi=a*l*c+d*u*m;break;case"YZX":this.th=d*l*c+a*u*m,this.sh=a*u*c+d*l*m,this.hh=a*l*m-d*u*c,this.hi=a*l*c-d*u*m;break;case"XZY":this.th=d*l*c-a*u*m,this.sh=a*u*c-d*l*m,this.hh=a*l*m+d*u*c,this.hi=a*l*c+d*u*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this.eh(),this.th=t.x*s,this.sh=t.y*s,this.hh=t.z*s,this.hi=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],h=e[8],r=e[1],n=e[5],o=e[9],a=e[2],l=e[6],c=e[10],d=i+n+c;if(this.eh(),d>0){const t=.5/Math.sqrt(d+1);this.hi=.25/t,this.th=(l-o)*t,this.sh=(h-a)*t,this.hh=(r-s)*t}else if(i>n&&i>c){const t=2*Math.sqrt(1+i-n-c);this.hi=(l-o)/t,this.th=.25*t,this.sh=(s+r)/t,this.hh=(h+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-i-c);this.hi=(h-a)/t,this.th=(s+r)/t,this.sh=.25*t,this.hh=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-n);this.hi=(r-s)/t,this.th=(h+a)/t,this.sh=(o+l)/t,this.hh=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return this.eh(),i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this.th=-t.y,this.sh=t.x,this.hh=0,this.hi=i):(this.th=0,this.sh=-t.z,this.hh=t.y,this.hi=i)):(this.th=t.y*e.z-t.z*e.y,this.sh=t.z*e.x-t.x*e.z,this.hh=t.x*e.y-t.y*e.x,this.hi=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(h(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this.rh(),this.eh(),this.th*=-1,this.sh*=-1,this.hh*=-1,this._onChangeCallback(),this}dot(t){return this.rh(),this.th*t._x+this.sh*t._y+this.hh*t._z+this.hi*t._w}lengthSq(){return this.rh(),this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi}length(){return this.rh(),Math.sqrt(this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi)}normalize(){let t=this.length();return 0===t?(this.eh(),this.th=0,this.sh=0,this.hh=0,this.hi=1):(t=1/t,this.rh(),this.eh(),this.th=this.th*t,this.sh=this.sh*t,this.hh=this.hh*t,this.hi=this.hi*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,h=t._z,r=t._w,n=e._x,o=e._y,a=e._z,l=e._w;return this.eh(),this.th=i*l+r*n+s*a-h*o,this.sh=s*l+r*o+h*n-i*a,this.hh=h*l+r*a+i*o-s*n,this.hi=r*l-i*n-s*o-h*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);this.rh();const i=this.th,s=this.sh,h=this.hh,r=this.hi;let n=r*t._w+i*t._x+s*t._y+h*t._z;if(this.eh(),n<0?(this.hi=-t._w,this.th=-t._x,this.sh=-t._y,this.hh=-t._z,n=-n):this.copy(t),n>=1)return this.hi=r,this.th=i,this.sh=s,this.hh=h,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-e;return this.hi=t*r+e*this.hi,this.th=t*i+e*this.th,this.sh=t*s+e*this.sh,this.hh=t*h+e*this.hh,this.normalize(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-e)*l)/a,d=Math.sin(e*l)/a;return this.hi=r*c+this.hi*d,this.th=i*c+this.th*d,this.sh=s*c+this.sh*d,this.hh=h*c+this.hh*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(h),i*Math.cos(h),e*Math.sin(s))}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._w===this.hi}fromArray(t,e=0){return this.th===t[e]&&this.sh===t[e+1]&&this.hh===t[e+2]&&this.hi===t[e+3]||(this.eh(),this.th=t[e],this.sh=t[e+1],this.hh=t[e+2],this.hi=t[e+3],this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.hi,t}fromBufferAttribute(t,e){return this.th=t.getX(e),this.sh=t.getY(e),this.hh=t.getZ(e),this.hi=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}multiplyVector3(t){throw new Error("deprecated")}inverse(){throw new Error("deprecated")}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.hi}}class Wt{constructor(t=0,e=0,i=0){this.isVector3=!0,this.nh=t,this.ah=e,this.oh=i,this.eh=()=>{},this.rh=()=>{}}onBeforeChange(t){this.eh=t}onBeforeGetComponent(t){this.rh=t}get x(){return this.rh(),this.nh}set x(t){this.eh(),this.nh=t}get y(){return this.rh(),this.ah}set y(t){this.eh(),this.ah=t}get z(){return this.rh(),this.oh}set z(t){this.eh(),this.oh=t}set(t,e,i){return void 0===i&&(this.rh(),i=this.oh),this.eh(),this.nh=t,this.ah=e,this.oh=i,this}setScalar(t){return this.eh(),this.nh=t,this.ah=t,this.oh=t,this}setX(t){return this.eh(),this.nh=t,this}setY(t){return this.eh(),this.ah=t,this}setZ(t){return this.eh(),this.oh=t,this}setComponent(t,e){switch(t){case 0:this.eh(),this.nh=e;break;case 1:this.eh(),this.ah=e;break;case 2:this.eh(),this.oh=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this.rh(),t){case 0:return this.nh;case 1:return this.ah;case 2:return this.oh;default:throw new Error("index is out of range: "+t)}}clone(){return this.rh(),new tt(this.nh,this.ah,this.oh)}copy(t){return this.eh(),this.nh=t.x,this.ah=t.y,this.oh=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh+=t.x,this.ah+=t.y,this.oh+=t.z),this)}addScalar(t){return 0===t||(this.rh(),this.eh(),this.nh+=t,this.ah+=t,this.oh+=t),this}addVectors(t,e){return this.eh(),this.nh=t.x+e.x,this.ah=t.y+e.y,this.oh=t.z+e.z,this}addScaledVector(t,e){return this.rh(),this.eh(),this.nh+=t.x*e,this.ah+=t.y*e,this.oh+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh-=t.x,this.ah-=t.y,this.oh-=t.z),this)}subScalar(t){return 0===t||(this.rh(),this.eh(),this.nh-=t,this.ah-=t,this.oh-=t),this}subVectors(t,e){return this.eh(),this.nh=t.x-e.x,this.ah=t.y-e.y,this.oh=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh*=t.x,this.ah*=t.y,this.oh*=t.z),this)}multiplyScalar(t){return 1===t||(this.rh(),this.eh(),this.nh*=t,this.ah*=t,this.oh*=t),this}multiplyVectors(t,e){return this.eh(),this.nh=t.x*e.x,this.ah=t.y*e.y,this.oh=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(It.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(It.setFromAxisAngle(t,e))}applyMatrix3(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,h=t.elements;return this.eh(),this.nh=h[0]*e+h[3]*i+h[6]*s,this.ah=h[1]*e+h[4]*i+h[7]*s,this.oh=h[2]*e+h[5]*i+h[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,h=t.elements,r=1/(h[3]*e+h[7]*i+h[11]*s+h[15]);return this.eh(),this.nh=(h[0]*e+h[4]*i+h[8]*s+h[12])*r,this.ah=(h[1]*e+h[5]*i+h[9]*s+h[13])*r,this.oh=(h[2]*e+h[6]*i+h[10]*s+h[14])*r,this}applyQuaternion(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,h=t.x,r=t.y,n=t.z,o=t.w,a=o*e+r*s-n*i,l=o*i+n*e-h*s,c=o*s+h*i-r*e,d=-h*e-r*i-n*s;return this.eh(),this.nh=a*o+d*-h+l*-n-c*-r,this.ah=l*o+d*-r+c*-h-a*-n,this.oh=c*o+d*-n+a*-r-l*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,h=t.elements;return this.eh(),this.nh=h[0]*e+h[4]*i+h[8]*s,this.ah=h[1]*e+h[5]*i+h[9]*s,this.oh=h[2]*e+h[6]*i+h[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh/=t.x,this.ah/=t.y,this.oh/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.rh(),this.eh(),this.nh=Math.min(this.nh,t.x),this.ah=Math.min(this.ah,t.y),this.oh=Math.min(this.oh,t.z),this}max(t){return this.rh(),this.eh(),this.nh=Math.max(this.nh,t.x),this.ah=Math.max(this.ah,t.y),this.oh=Math.max(this.oh,t.z),this}clamp(t,e){return this.rh(),this.eh(),this.nh=Math.max(t.x,Math.min(e.x,this.nh)),this.ah=Math.max(t.y,Math.min(e.y,this.ah)),this.oh=Math.max(t.z,Math.min(e.z,this.oh)),this}clampScalar(t,e){return this.rh(),this.eh(),this.nh=Math.max(t,Math.min(e,this.nh)),this.ah=Math.max(t,Math.min(e,this.ah)),this.oh=Math.max(t,Math.min(e,this.oh)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.rh(),this.eh(),this.nh=Math.floor(this.nh),this.ah=Math.floor(this.ah),this.oh=Math.floor(this.oh),this}ceil(){return this.rh(),this.eh(),this.nh=Math.ceil(this.nh),this.ah=Math.ceil(this.ah),this.oh=Math.ceil(this.oh),this}round(){return this.rh(),this.eh(),this.nh=Math.round(this.nh),this.ah=Math.round(this.ah),this.oh=Math.round(this.oh),this}roundToZero(){return this.rh(),this.eh(),this.nh=this.nh<0?Math.ceil(this.nh):Math.floor(this.nh),this.ah=this.ah<0?Math.ceil(this.ah):Math.floor(this.ah),this.oh=this.oh<0?Math.ceil(this.oh):Math.floor(this.oh),this}negate(){return this.rh(),this.eh(),this.nh=-this.nh,this.ah=-this.ah,this.oh=-this.oh,this}dot(t){return this.rh(),this.nh*t.x+this.ah*t.y+this.oh*t.z}lengthSq(){return this.rh(),this.nh*this.nh+this.ah*this.ah+this.oh*this.oh}length(){return this.rh(),Math.sqrt(this.nh*this.nh+this.ah*this.ah+this.oh*this.oh)}manhattanLength(){return this.rh(),Math.abs(this.nh)+Math.abs(this.ah)+Math.abs(this.oh)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.rh(),this.eh(),this.nh+=(t.x-this.nh)*e,this.ah+=(t.y-this.ah)*e,this.oh+=(t.z-this.oh)*e,this}lerpVectors(t,e,i){return this.eh(),this.nh=t.x+(e.x-t.x)*i,this.ah=t.y+(e.y-t.y)*i,this.oh=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,h=t.z,r=e.x,n=e.y,o=e.z;return this.eh(),this.nh=s*o-h*n,this.ah=h*r-i*o,this.oh=i*n-s*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Pt.copy(this).projectOnVector(t),this.sub(Pt)}reflect(t){return this.sub(Pt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(h(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this.rh();const e=this.nh-t.x,i=this.ah-t.y,s=this.oh-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return this.rh(),Math.abs(this.nh-t.x)+Math.abs(this.ah-t.y)+Math.abs(this.oh-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.eh(),this.nh=s*Math.sin(i),this.ah=Math.cos(e)*t,this.oh=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.eh(),this.nh=t*Math.sin(e),this.ah=i,this.oh=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.eh(),this.nh=e[12],this.ah=e[13],this.oh=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.eh(),this.nh=e,this.ah=i,this.oh=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this.rh(),t.x===this.nh&&t.y===this.ah&&t.z===this.oh}fromArray(t,e=0){return this.nh===t[e]&&this.ah===t[e+1]&&this.oh===t[e+2]||(this.eh(),this.nh=t[e],this.ah=t[e+1],this.oh=t[e+2]),this}toArray(t=[],e=0){return this.rh(),t[e]=this.nh,t[e+1]=this.ah,t[e+2]=this.oh,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.eh(),this.nh=t.getX(e),this.ah=t.getY(e),this.oh=t.getZ(e),this}random(){return this.eh(),this.nh=Math.random(),this.ah=Math.random(),this.oh=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this.eh(),this.nh=i*Math.cos(e),this.ah=i*Math.sin(e),this.oh=t,this}*[Symbol.iterator](){this.rh(),yield this.nh,this.rh(),yield this.ah,this.rh(),yield this.oh}lengthManhattan(){throw new Error("deprecated")}distanceToManhattan(t){throw new Error("deprecated")}}const Pt=new Wt,It=new J;class Ft{constructor(t,e,i){this.ts=!1,this.ss=!1,this.es=!1,this.rs=!1,this.hs=!1,this.ns=this.os.bind(this),this.ls=this.fs.bind(this),this.cs=this.us.bind(this),this.ds=this.ps.bind(this),this.vs=this.bs.bind(this),this.Ts=this._s.bind(this),this.Os=this.gs.bind(this),this.Rs=this.xs.bind(this),this.ws=!1,this.isRegisteredToProcessor=!1,this.D=e,this.Ws=i,this.Ms=new Ft._transformObject3D,this.Ms.matrixAutoUpdate=!0,this.Ms.userData=this,e.scene.unsafeGetThreeScene().add(this.Ms),Object.defineProperties(this.Ms,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this.ns,h=this.ls,r=new Wt;r.onBeforeGetComponent(s),r.onBeforeChange(h),this.Ms.position=r;const n=new jt;n.onBeforeGetComponent(s),n.onBeforeChange(h),n._onChange(this.cs),this.Ms.rotation=n;const o=new Rt;o.onBeforeGetComponent(s),o.onBeforeChange(h),o._onChange(this.ds),this.Ms.quaternion=o;const a=new Wt(1,1,1);a.onBeforeGetComponent(s),a.onBeforeChange(h),this.Ms.scale=a,this._t=t;const l=this.vs,c=this.Ts,d=new Wt;d.onBeforeGetComponent(l),d.onBeforeChange(c),this.Cs=d;const u=new jt;u.onBeforeGetComponent(l),u.onBeforeChange(c),u._onChange(this.Os),this.ys=u;const m=new Rt;m.onBeforeGetComponent(l),m.onBeforeChange(c),m._onChange(this.Rs),this.Fs=m;const g=new Wt(1,1,1);g.onBeforeGetComponent(l),g.onBeforeChange(c),this.Vs=g,this.As()}os(){this.ws||this.Ls()}fs(){this.ws||(this.Ls(),this.Ps(),this.hs=!1,this.ss=!0,this.As(),this.Ss(),this.js())}us(){this.ws||this.Ms.quaternion.setFromEuler(this.Ms.rotation,!1)}ps(){this.ws||this.Ms.rotation.setFromQuaternion(this.Ms.quaternion,void 0,!1)}bs(){this.ws||this.Ds()}_s(){this.ws||(this.Ds(),this.Ps(),this.rs=!1,this.hs=!0,this.ss=!0,this.As(),this.Es(),this.js())}gs(){this.ws||this.Fs.setFromEuler(this.ys,!1)}xs(){this.ws||this.ys.setFromQuaternion(this.Fs,void 0,!1)}Ss(){this.rs=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.Ss()}}Es(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.Ss()}}As(){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Us()}Us(){this.es=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.Us()}}js(){this.ts=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.js()}}Ls(){if(this.hs){if(this.ss){this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=Ft._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld);this.ss=!1}this.ws=!0,this.Ms.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this.ws=!1,this.hs=!1}}Ds(){this.rs&&(this.Qs(),this.ws=!0,this.Ms.matrixWorld.decompose(this.Cs,this.Fs,this.Vs),this.ys.setFromQuaternion(this.Fs,void 0,!1),this.ws=!1,this.rs=!1)}Qs(){if(!this.es)return;const t=this.Ms.matrix;if(this.ss)if(this.hs)this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1;else{this.ss&&(this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1,this.ss=!1);const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}else{const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}Ns(){if(!this.ss)return;const t=this.Ms.matrix;if(this.es)if(this.rs)this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1;else{this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=Ft._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}else{const t=this.parent;if(t){t.Qs();const e=Ft._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}this.ss=!1}Bs(){this.Ls();const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.Bs()}}Ps(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&(i.userData.Ls(),i.userData.Ps())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this._t.exists&&this.qs()}qs(){this.Qs();const t=this.Ms.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof Ft&&i.userData.qs()}return!0}foreachChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];s.userData instanceof Ft&&t(s.userData)}}iterateChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.userData instanceof Ft&&!t(s.userData))break}}get parent(){return this.Ms.parent instanceof kt?null:this.Ms.parent.userData}set parent(t){this.setParent(t)}setParent(t,e=!0){if(t){const i=this.parent;this.Bs(),this.As(),this.Ss(),e&&t.getWorldToLocalMatrix(this.Ms.matrix).multiply(this.Ms.matrixWorld),this.Ms.removeFromParent(),t.Ms.add(this.Ms),this.Ws(i,t)}else{const t=this.parent;this.Bs(),this.As(),this.Ss(),e&&this.Ms.matrix.copy(this.Ms.matrixWorld),this.Ms.removeFromParent(),this.D.scene.unsafeGetThreeScene().add(this.Ms),this.Ws(t,null)}}get children(){return this.Ms.children.filter((t=>t.userData instanceof Ft)).map((t=>t.userData))}get gameObject(){return this._t}getForward(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[8],e[9],e[10]):new tt(e[8],e[9],e[10])}setForward(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=Ft._vector3Buffer.copy(t).normalize();e[8]=i.x,e[9]=i.y,e[10]=i.z}getRight(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[0],e[1],e[2]):new tt(e[0],e[1],e[2])}setRight(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=Ft._vector3Buffer.copy(t).normalize();e[0]=i.x,e[1]=i.y,e[2]=i.z}getUp(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[4],e[5],e[6]):new tt(e[4],e[5],e[6])}setUp(t){this.D.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=Ft._vector3Buffer.copy(t).normalize();e[4]=i.x,e[5]=i.y,e[6]=i.z}get localPosition(){return this.Ms.position}get localEulerAngles(){return this.Ms.rotation}get localRotation(){return this.Ms.quaternion}get localScale(){return this.Ms.scale}get position(){return this.Cs}get eulerAngles(){return this.ys}get rotation(){return this.Fs}get lossyScale(){return this.Vs}get hasChanged(){return this.ts}set hasChanged(t){this.ts=t}getWorldToLocalMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld).invert():this.Ms.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld):this.Ms.matrixWorld.clone()}transformPoint(t){return this.Qs(),this.Ms.localToWorld(t)}inverseTransformPoint(t){return this.Qs(),this.Ms.worldToLocal(t)}transformDirection(t){const e=Ft._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1);return t.transformDirection(e)}inverseTransformDirection(t){const e=Ft._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(e)}transformVector(t){return t.transformDirection(this.Ms.matrixWorld)}inverseTransformVector(t){return t.transformDirection(Ft._matrix4Buffer.copy(this.Ms.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const e=this.parent;return!!e&&e.isChildOf(t)}lookAt(t){const e=this.parent;Ft._vector3Buffer.setFromMatrixPosition(this.Ms.matrixWorld);const i=Ft._matrix4Buffer.lookAt(Ft._vector3Buffer,t,this.Ms.up);if(this.Ms.quaternion.setFromRotationMatrix(i),e){i.extractRotation(e.Ms.matrixWorld);const t=Ft._quaternionBuffer.setFromRotationMatrix(i);this.Ms.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,e){this.Ms.setRotationFromAxisAngle(t,e)}setRotationFromEuler(t){this.Ms.setRotationFromEuler(t)}setRotationFromMatrix(t){this.Ms.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this.Ms.setRotationFromQuaternion(t)}rotateOnAxis(t,e){return this.Ms.rotateOnAxis(t,e),this}rotateOnWorldAxis(t,e){return this.Ms.rotateOnWorldAxis(t,e),this}rotateX(t){return this.Ms.rotateX(t),this}rotateY(t){return this.Ms.rotateY(t),this}rotateZ(t){return this.Ms.rotateZ(t),this}translateOnAxis(t,e){return this.Ms.translateOnAxis(t,e),this}translateX(t){return this.Ms.translateX(t),this}translateY(t){return this.Ms.translateY(t),this}translateZ(t){return this.Ms.translateZ(t),this}unsafeGetObject3D(){return this.Ms}enqueueRenderAttachedObject3D(t){this.D.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this.D.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)Ft.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)Ft.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}toJSON(){return{}}}Ft._transformObject3D=class extends Tt{updateMatrix(){this.userData.Ns()}updateMatrixWorld(t){this.userData.Qs()}updateWorldMatrix(t,e){if(this.userData.Qs(),e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}},Ft._matrix4Buffer=new st,Ft._vector3Buffer=new tt,Ft._quaternionBuffer=new J;class Ht{constructor(t,e){this.$t=!1,this.D=t,this.yt=t.instantiater.generateId(),this.Nt=!0,this.Qt=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new K,this.Vt=new Ft(this,t,this.Xt.bind(this)),this.Vt.unsafeGetObject3D().name=e}addChildFromBuilder(t){this.Zt();const e=t.build(this.transform);return t.processEvent(),e}Xt(t,e){if(e&&this.D!==e.gameObject.D)throw new Error("can't change parent to another engine instance");const i=this.transform.gameObject;e?i.Qt&&i.te(e.gameObject.Nt):i.te(i.Qt)}addComponent(t){this.Zt();const e=new t(this);if(e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const i=e.requiredComponents;for(let e=0;e<i.length;e++){const s=i[e];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(e),this.gameObjectEventContainer.registerComponent(e),this.Nt&&e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate(),this.D.sceneProcessor.tryStartProcessSyncedEvent()),e}getComponent(t){this.Zt();const e=this.components;for(let i=0;i<e.length;i++){const s=e[i];if(s instanceof t)return s}return null}getComponents(t){if(this.Zt(),!t)return this.components.slice();const e=this.components,i=[];for(let s=0;s<e.length;s++){const h=e[s];h instanceof t&&i.push(h)}return i}getComponentInChildren(t){this.Zt();const e=this.getComponent(t);if(e)return e;let i=null;return this.Vt.iterateChild((e=>{const s=e.gameObject.getComponentInChildren(t);return!s||(i=s,!1)})),i}getComponentsInChildren(t){if(this.Zt(),t){const e=this.getComponents(t);return this.Vt.foreachChild((i=>{const s=i.gameObject.getComponentsInChildren(t);e.push(...s)})),e}{const t=this.getComponents();return this.Vt.foreachChild((e=>{t.push(...e.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,e){this.Zt();const i=this.components;if(e)for(let s=0;s<i.length;s++){const h=i[s];h instanceof e&&t(h)}else for(let e=0;e<i.length;e++)t(i[e])}foreachComponentInChildren(t,e){this.Zt(),e?(this.foreachComponent(t,e),this.Vt.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t,e)}))):(this.foreachComponent(t),this.Vt.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t)})))}destroy(){Ht.destroyRecursively(this),this.D.sceneProcessor.tryStartProcessSyncedEvent(),this.D.sceneProcessor.addRemoveGameObject(this)}static destroyRecursively(t){t.$t||(t.$t=!0,t.ie(),t.Vt.children.forEach((t=>{t instanceof Ft&&Ht.destroyRecursively(t.gameObject)})))}ie(){const t=this.components;for(let e=0;e<t.length;e++){const i=t[e];i._engine_internal_destroyed||(i.enabled&&this.Nt&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterStart(),i._engine_internal_componentEventContainer.tryUnregisterUpdate()),i.stopAllCoroutines(),i._engine_internal_componentEventContainer.tryRegisterOnDestroy(),i._engine_internal_destroyed=!0)}}removeFromParent(){this.Vt.unsafeGetObject3D().removeFromParent()}removeComponent(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this.D}get activeInHierarchy(){return this.Nt}set activeInHierarchy(t){if(this.Nt!==t){if(this.Nt=t,this._initialized){const t=this.components;if(this.Nt)for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterUpdate(),i.stopAllCoroutines())}}this.Vt.foreachChild((t=>{const e=t.gameObject;this.Nt?e.activeInHierarchy=e.Qt:e.activeInHierarchy=!1}))}}te(t){this.Nt!==t&&(this.activeInHierarchy=t,this._initialized&&this.D.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this.Qt}set activeSelf(t){this.Zt(),this.Qt!==t&&(this.Qt=t,this.Vt.parent instanceof Ft?this.Vt.parent.gameObject.Nt?this.te(this.Qt):this.te(!1):this.te(this.Qt))}get transform(){return this.Vt}get name(){return this.Vt.unsafeGetObject3D().name}set name(t){this.Zt(),this.Vt.unsafeGetObject3D().name=t}get instanceId(){return this.yt}get initialized(){return this._initialized}get exists(){return!this.$t}Zt(){if(this.$t)throw new Error("GameObject "+this.name+" is destroyed")}}class Lt{constructor(t,e,i,s,h){this.se=!1,this._t=new Ht(t,e);const r=this._t.transform;i&&r.localPosition.copy(i),s&&r.localRotation.copy(s),h&&r.localScale.copy(h),this.X=[],this.ne=[]}active(t){return this._t.activeSelf=t,this}getGameObject(t){return t.ref=this._t,this}getComponent(t,e){return e.ref=this._t.getComponent(t),this}getComponents(t,e){return t.ref=e?this._t.getComponents(e):this._t.getComponents(),this}getComponentInChildren(t,e){return e.ref=this._t.getComponentInChildren(t),this}getComponentsInChildren(t,e){return t.ref=e?this._t.getComponentsInChildren(e):this._t.getComponentsInChildren(),this}withComponent(t,e){const i=new t(this._t);return i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this._t.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this._t.name}`),this):(this._t.components.push(i),this._t.gameObjectEventContainer.registerComponent(i),e&&this.ne.push((()=>e(i))),this)}withChild(t){return this.X.push(t),this}oe(t){let e=!1;const i=t.components;for(let s=0;s<i.length;s++){const h=i[s],r=h.requiredComponents;for(let i=0;i<r.length;i++){const s=r[i];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${h.constructor.name} on GameObject ${t.name}`),t.removeComponent(h),e=!0)}}e&&this.oe(t)}build(t){if(this.se)throw new Error("GameObjectBuilder is already built");return this.se=!0,this.re(t),this.he(),this.ce(),this._t}re(t){this._t.transform.setParent(t,!1);const e=this.X;for(let t=0;t<e.length;t++)e[t].re(this._t.transform)}he(){this.oe(this._t);const t=this.X;for(let e=0;e<t.length;e++)t[e].he()}ce(){const t=this.ne;for(let e=0;e<t.length;e++)t[e]();const e=this.X;for(let t=0;t<e.length;t++)e[t].ce();this._t._initialized=!0}processEvent(){Lt.processEventByGroup([this],this._t.engine.sceneProcessor)}static processEventByGroup(t,e){const i=[];for(let e=0;e<t.length;e++)i.push(...t[e]._t.getComponentsInChildren());for(let t=0;t<i.length;t++){const e=i[t];e.gameObject.activeInHierarchy&&e.enabled&&e._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<i.length;t++){const e=i[t];e._engine_internal_destroyed||e.gameObject.activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}e.tryStartProcessSyncedEvent()}}class Yt{constructor(t){this.B=0,this._=0,this.D=t}generateId(){const t=this.B;return this.B+=1,t}generateEventId(){const t=this._;return this._+=1,t}buildGameObject(t,e,i,s){return new Lt(this.D,t,e,i,s)}buildPrefab(t,e,i,s,h){return new e(this.D,t,i,s,h)}}class Nt{constructor(t,e,i,s,h,r,n,o,a,l){this.t=t,this.i=e,this.h=i,this.o=s,this.u=h,this.g=r,this.p=n,this.m=o,this.l=a,this.I=l,this.P=new D(l),this.H=new Yt(this)}applyGameSetting(t){this.l.applyPhysicsSettings(t.physics)}dispose(){this.P.dispose()}get scene(){return this.t}get cameraContainer(){return this.i}get screen(){return this.u}get input(){return this.P}get time(){return this.h}get physics(){return this.l}get gameState(){return this.o}get instantiater(){return this.H}get domElement(){return this.I}get sceneProcessor(){return this.g}get coroutineProcessor(){return this.p}get transformMatrixProcessor(){return this.m}get physics2DProcessor(){return this.l}}class Bt{constructor(t){this.k=t}get kind(){return this.k}set kind(t){this.k=t}}var Xt,Gt;(Gt=Xt||(Xt={}))[Gt.WaitingForStart=0]="WaitingForStart",Gt[Gt.Initializing=1]="Initializing",Gt[Gt.Running=2]="Running",Gt[Gt.Stopped=3]="Stopped",Gt[Gt.Finalizing=4]="Finalizing",Gt[Gt.Finalized=5]="Finalized";class qt{constructor(){this.fe=new kt,this.fe.matrixAutoUpdate=!1,this.fe.autoUpdate=!1}addChildFromBuilder(t){const e=t.build(null);return t.processEvent(),e}foreachChild(t){const e=this.fe.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];s.userData instanceof Ft&&t(s.userData)}}iterateChild(t){const e=this.fe.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.userData instanceof Ft&&!t(s.userData))break}}get children(){return this.fe.children.filter((t=>t.userData instanceof Ft)).map((t=>t.userData))}unsafeGetThreeScene(){return this.fe}}class Ut{constructor(t=0,e=0){Ut.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),h=this.x-t.x,r=this.y-t.y;return this.x=h*i-r*s+t.x,this.y=h*s+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vt{constructor(){this.wi=null,this.yi=8,this.Pi=3,this.mi=!0,this.Ei=null,this.pi=null,this.Si=new Map,this.Ti=null,this.Ii=null,this.reuseCollisionCallbacks=!0,this.xi=null,this.Ni=null}applyPhysicsSettings(t){var e;if(!t.loader)return;this.Ti=t.loader,this.pi=new this.Ti.World(new this.Ti.Vec2(0,-9.81));const i=class extends this.Ti.ContactListener{constructor(t){super(),this.Bi=t,this.Oi=new this.Bi.Ti.Collision2DPool,this.Li=new this.Bi.Ti.TriggerEventPool,this.Mi=new this.Bi.Ti.CollisionEventPool}BeginContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(0,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(0,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(0,e,i,s)}}EndContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Li.insert(2,e,i);else if(this.Bi.reuseCollisionCallbacks){const s=this.Oi.getInstance();s.setData(t),this.Mi.insert(2,e,i,s,this.Oi)}else{const s=new this.Bi.Ti.Collision2D;s.setData(t),this.Mi.insert(2,e,i,s)}}PreSolve(t,e){const i=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(i.isTrigger||s.isTrigger)this.Li.insert(1,i,s);else if(this.Bi.reuseCollisionCallbacks){const e=this.Oi.getInstance();e.setData(t),this.Mi.insert(1,i,s,e,this.Oi)}else{const e=new this.Bi.Ti.Collision2D;e.setData(t),this.Mi.insert(1,i,s,e)}}onTriggerInvoke(){this.Li.invoke()}onCollisionInvoke(){this.Mi.invoke()}},s=new i(this);this.Ii=s,this.pi.SetContactListener(s),t.gravity&&(null===(e=this.pi)||void 0===e||e.SetGravity(t.gravity)),t.defaultMaterial&&(this.wi=t.defaultMaterial.clone()),t.velocityIterations&&(this.yi=t.velocityIterations),t.positionIterations&&(this.Pi=t.positionIterations),t.queriesHitTriggers&&(this.mi=t.queriesHitTriggers),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix?this.Ei=new this.Ti.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix):this.Ei=new this.Ti.CollisionLayerMaskConverter({default:{default:!0}}),this.xi=new this.Ti.RayCastOneCallback(this),this.Ni=new this.Ti.RayCastFilterCallback}update(t){if(this.pi){{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform,s=i.position,h=i.eulerAngles,r=e.GetPosition(),n=e.GetAngle();s.x===r.x&&s.y===r.y||(e.SetPosition(s),e.SetAwake(!0)),h.z!==n&&(e.SetAngle(h.z),e.SetAwake(!0))}}this.pi.Step(t,this.yi,this.Pi);{let t=this.pi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform;i.position.x=e.GetPosition().x,i.position.y=e.GetPosition().y,i.eulerAngles.z=e.GetAngle()}}this.Ii.onTriggerInvoke(),this.Ii.onCollisionInvoke()}}addRigidBody(t,e,i){if(!this.pi)throw new Error("Physics2D is not loaded.");let s=this.Si.get(t);if(s){const t=s.addRigidBody(e),h=t.body;return h.SetType(i.type),h.SetPosition(i.position),h.SetAngle(i.angle),h.SetLinearVelocity(i.linearVelocity),h.SetAngularVelocity(i.angularVelocity),h.SetLinearDamping(i.linearDamping),h.SetAngularDamping(i.angularDamping),h.SetSleepingAllowed(i.allowSleep),h.SetAwake(i.awake),h.SetFixedRotation(i.fixedRotation),h.SetBullet(i.bullet),h.SetEnabled(i.enabled),h.SetUserData(i.userData),h.SetGravityScale(i.gravityScale),t}return s=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(i),(()=>this.Si.delete(t))),this.Si.set(t,s),s.addRigidBody(e)}removeRigidBody(t){const e=this.Si.get(t);if(!e)throw new Error("PhysicsObject2D not found");e.removeRigidBody()}Ri(t){const e=new this.Ti.BodyDef;return e.type=this.Ti.BodyType.b2_kinematicBody,e.position.x=t.transform.position.x,e.position.y=t.transform.position.y,e.angle=t.transform.eulerAngles.z,e}addCollider(t,e){if(!this.pi)throw new Error("Physics2D is not loaded.");let i=this.Si.get(t);return i||(i=new this.Ti.PhysicsObject2D(t,this.pi.CreateBody(this.Ri(t)),(()=>this.Si.delete(t)))),this.Si.set(t,i),i.addCollider(e)}removeCollider(t,e,i){const s=this.Si.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(e,i)}get physicsLoader(){return this.Ti}get gravity(){if(!this.pi)throw new Error("Physics2D is not loaded.");const t=this.pi.GetGravity();return new Ut(t.x,t.y)}set gravity(t){if(!this.pi)throw new Error("Physics2D is not loaded.");this.pi.SetGravity(new this.Ti.Vec2(t.x,t.y))}get defaultMaterial(){return this.wi}get velocityIterations(){return this.yi}set velocityIterations(t){this.yi=t}get positionIterations(){return this.Pi}set positionIterations(t){this.Pi=t}get maxLinearCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxLinearCorrection}get maxAngularCorrection(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxAngularCorrection}get maxTranslationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxTranslation}get maxRotationSpeed(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.maxRotation}get baumgarteScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.baumgarte}get baumgarteTimeOfImpactScale(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.toiBaumgarte}get timeToSleep(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.timeToSleep}get linearSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.linearSleepTolerance}get angularSleepTolerance(){if(!this.Ti)throw new Error("Physics2D is not loaded.");return this.Ti.angularSleepTolerance}get queriesHitTriggers(){return this.mi}set queriesHitTriggers(t){this.mi=t}get collisionLayerMask(){return this.Ei}raycastOne(t,e,i,s=Number.POSITIVE_INFINITY,h=4294967295,r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");i||(i=new this.Ti.RaycastHit2D);const o=Vt._raycastEndPoint.copy(e).multiplyScalar(s===Number.POSITIVE_INFINITY?1e7:s).add(t);return this.xi.setRaycastData(i,t,h,r,n),this.pi.RayCast(this.xi,t,o),this.xi.hit?i:null}raycast(t,e,i,s,h=Number.POSITIVE_INFINITY){if(!this.pi)throw new Error("Physics2D is not loaded.");const r=Vt._raycastEndPoint.copy(e).multiplyScalar(h===Number.POSITIVE_INFINITY?1e7:h).add(t);return this.Ni.setRaycastData(s,t,i),this.pi.RayCast(this.Ni,t,r),this.Ni.hitCount}}Vt._raycastEndPoint=new Ut;class $t{constructor(t){this.nr=null,this.ar=new Map,this.ur=new V(void 0,((t,e)=>t.info.priority===e.info.priority?t.camera.instanceId-e.camera.instanceId:t.info.priority-e.info.priority)),this.dr=t}get camera(){var t,e;return null!==(e=null===(t=this.nr)||void 0===t?void 0:t.camera)&&void 0!==e?e:null}get currentCameraPriority(){var t,e;return null!==(e=null===(t=this.nr)||void 0===t?void 0:t.info.priority)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}addCamera(t,e){this.ar.set(t,e),this.ur.insert({camera:t,info:e}),this.lr()}removeCamera(t){const e=this.ar.get(t);e&&(this.ur.eraseElementByKey({camera:t,info:e}),this.ar.delete(t),this.lr())}changeCameraPriority(t,e){const i=this.ar.get(t);i&&(this.ur.eraseElementByKey({camera:t,info:i}),i.priority=e,this.ur.insert({camera:t,info:i}),this.lr())}changeCameraBackgroundColor(t,e){var i;const s=this.ar.get(t);s&&(s.backgroundColor=e,(null===(i=this.nr)||void 0===i?void 0:i.camera)===t&&this.dr(e))}lr(){if(0===this.ur.size())return void(this.nr=null);const t=this.ur.front();t?(this.nr=t,this.dr(this.nr.info.backgroundColor)):this.nr=null}}class Qt{constructor(t,e){this._e=t,this.ze=e,this.Ne=new S}get width(){return this._e}get height(){return this.ze}get onResize(){return this.Ne}resize(t,e){this._e=t,this.ze=e,this.Ne.invoke(t,e)}}const Zt=new tt,Kt=new J,Jt=new tt,te=new st,ee=new st;class ie{constructor(){this._e=0,this.ze=0,this.Te=0,this.We=0,this.Ze={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this.Ae=document.createElement("div"),this.Ae.style.transformStyle="preserve-3d",this.Ae.style.pointerEvents="none",this.domElement.appendChild(this.Ae)}getSize(){return{width:this._e,height:this.ze}}render(t,e,i){const s=i.projectionMatrix.elements[5]*this.We;let h,r;this.Ze.camera.fov!==s&&(this.domElement.style.perspective=i.isPerspectiveCamera?s+"px":"",this.Ze.camera.fov=s),!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.isOrthographicCamera?(h=-(i.right+i.left)/2,r=(i.top+i.bottom)/2):(h=1,r=1);const n=(i.isOrthographicCamera?"scale("+s+")translate("+this.Be(h)+"px,"+this.Be(r)+"px)"+this.Ge(i.matrixWorldInverse):"translateZ("+s+"px)"+this.Ge(i.matrixWorldInverse))+"translate("+this.Te+"px,"+this.We+"px)";this.Ze.camera.style!==n&&(this.Ae.style.transform=n,this.Ze.camera.style=n);for(const s of t)this.Je(s,e,i)}setSize(t,e){this._e=t,this.ze=e,this.Te=this._e/2,this.We=this.ze/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.Ae.style.width=t+"px",this.Ae.style.height=e+"px"}Be(t){return Math.abs(t)<1e-10?0:t}Ge(t){const e=t.elements,i=this.Be;return"matrix3d("+i(e[0])+","+i(-e[1])+","+i(e[2])+","+i(e[3])+","+i(e[4])+","+i(-e[5])+","+i(e[6])+","+i(e[7])+","+i(e[8])+","+i(-e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(-e[13])+","+i(e[14])+","+i(e[15])+")"}Le(t){const e=t.elements,i=this.Be;return"translate(-50%,-50%)matrix3d("+i(e[0])+","+i(e[1])+","+i(e[2])+","+i(e[3])+","+i(-e[4])+","+i(-e[5])+","+i(-e[6])+","+i(-e[7])+","+i(e[8])+","+i(e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(e[13])+","+i(e[14])+","+i(e[15])+")"}Je(t,e,i){if(t.isCSS3DObject){let s;t.onBeforeRender(this,e,i),t.isCSS3DSprite?(te.copy(i.matrixWorldInverse),te.transpose(),0!==t.rotation2D&&te.multiply(ee.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(Zt,Kt,Jt),te.setPosition(Zt),te.scale(Jt),te.elements[3]=0,te.elements[7]=0,te.elements[11]=0,te.elements[15]=1,s=this.Le(te)):s=this.Le(t.matrixWorld);const h=t.element;h.style.transform=s,h.style.display=t.visible?"":"none",h.parentNode!==this.Ae&&this.Ae.appendChild(h),t.onAfterRender(this,e,i)}}}class se{constructor(){this.Ue=[],this.Xe=new Set,this.Ye=new Set}$e(){const t=this.Xe;this.Xe=this.Ye,this.Ye=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this.Ue.push(t))}enqueueRenderObject(t){this.Ye.add(t)}dequeueRenderObject(t){this.Ye.delete(t)}flush(){this.Xe.clear()}update(){const t=this.Ue;for(let e=0;e<t.length;e++){const i=t[e];i.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),i.isRegisteredToProcessor=!1}return this.Ue.length=0,this.$e(),this.Xe}}class he{constructor(){this.N=new $(Q.comparator),this.q=new $(Q.comparator),this.J=!1,this.L=[],this.U=[]}addEventToNonSyncedCollection(t){this.N.insert(t)}removeEventFromNonSyncedCollection(t){this.N.delete(t)}addEventToSyncedCollection(t){this.q.insert(t)}startProcessNonSyncedEvent(){this.N.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this.J||(this.J=!0,this.q.forEach((t=>t.invoke())),this.q.clear(),this.J=!1)}addRemoveGameObject(t){this.L.push(t)}addRemoveComponent(t){this.U.push(t)}processRemoveObject(){const t=this.U;for(let e=0;e<t.length;e++)t[e].gameObject.removeComponent(t[e]);const e=this.L;for(let t=0;t<e.length;t++)e[t].removeFromParent()}}class re{constructor(){this.tm=1/3,this.im=0,this.h=0,this.sm=0,this.hm=0,this.rm=0,this.am=1}start(){this.im=performance.now()}update(){const t=performance.now();let e=(t-this.im)/1e3;this.tm<e&&(e=this.tm),this.rm=e,this.sm+=e,this.hm=e*this.am,this.h+=this.hm,this.im=t}get time(){return this.h}get unscaledTime(){return this.sm}get deltaTime(){return this.hm}get unscaledDeltaTime(){return this.rm}get timeScale(){return this.am}set timeScale(t){this.am=t}get maximumDeltaTime(){return this.tm}set maximumDeltaTime(t){this.tm=t}}class ne{constructor(t){this.g=t,this.X=[]}withChild(t){return this.X.push(t),this}build(){for(let t=0;t<this.X.length;t++)this.X[t].build(null);Lt.processEventByGroup(this.X,this.g)}}class oe{constructor(t){this.tt=t}static createDefaultObject(){return{}}loader(t){return this.tt.loader=t,this}gravity(t){return this.tt.gravity=t,this}defaultMaterial(t){return this.tt.defaultMaterial=t,this}velocityIterations(t){return this.tt.velocityIterations=t,this}positionIterations(t){return this.tt.positionIterations=t,this}queriesHitTriggers(t){return this.tt.queriesHitTriggers=t,this}reuseCollisionCallbacks(t){return this.tt.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){return this.tt.collisionLayerMaskMatrix=t,this}}class ae{constructor(t){this.ee=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this.ee.useCss3DRenderer=t,this}webGLRenderer(t){return this.ee.webGLRenderer=t,this}}class le{constructor(t){this.Y=t,this.Z=new ae(this.Y.render),this.$=new oe(this.Y.physics)}static createDefaultObject(){return{render:ae.createDefaultObject(),physics:oe.createDefaultObject()}}get render(){return this.Z}get physics(){return this.$}make(){return this.Y}}class ce{constructor(t=null){this.ref=t}}class de{constructor(t,e,i){this.gt=t,this.vt=0,this.xt=e,this.It=null,this.Tt=!1,this.Yt=i}get component(){return this.gt}get elapsedTime(){return this.vt}set elapsedTime(t){this.vt=t}get currentYieldInstruction(){return this.It}get currentYieldInstructionExist(){return this.Tt}fatchNextInstruction(){var t;const e=this.xt.next();return e.done?(this.It=null,this.Tt=!1,null===(t=this.Yt)||void 0===t||t.call(this),this.Yt=null,null):(this.It=e.value,this.Tt=!0,this.It)}}class ue{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class me{constructor(t){this.Ut=null,this.Rt=null,this.qt=null,this.zt=null,this.Bt=null,this.Gt=null,this.Ht=null,this.Jt=null,this.Kt=null,this.Lt=null,this.gt=t,this.g=t.engine.sceneProcessor,this.H=t.engine.instantiater,this.Mt=new ue,function(t){return void 0!==t.awake}(t)&&(this.Ut=Q.createAwakeEvent(this.H,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this.Rt=Q.createOnDestroyEvent(this.H,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this.qt=Q.createOnCollisionEnter2DEvent(this.H,(e=>t.onCollisionEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this.zt=Q.createOnCollisionStay2DEvent(this.H,(e=>t.onCollisionStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this.Bt=Q.createOnCollisionExit2DEvent(this.H,(e=>t.onCollisionExit2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this.Gt=Q.createOnTriggerEnter2DEvent(this.H,(e=>t.onTriggerEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this.Ht=Q.createOnTriggerStay2DEvent(this.H,(e=>t.onTriggerStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this.Jt=Q.createOnTriggerExit2DEvent(this.H,(e=>t.onTriggerExit2D(e)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this.Kt=Q.createStartEvent(this.H,(()=>{this.Mt.startCalled=!0,t.start(),this.Mt.startRegistered&&this.g.removeEventFromNonSyncedCollection(this.Kt)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this.Lt=Q.createUpdateEvent(this.H,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this.Mt.awakeCalled||(this.Mt.awakeCalled=!0,null===(t=this.Ut)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(this.gt._engine_internal_destroyed)return;if(this.Mt.enabled)return;if(this.Mt.enabled=!0,!function(t){return void 0!==t.onEnable}(this.gt))return;const t=Q.createOnEnableEvent(this.H,this.gt.onEnable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(this.gt._engine_internal_destroyed)return;if(!this.Mt.enabled)return;if(this.Mt.enabled=!1,!function(t){return void 0!==t.onDisable}(this.gt))return;const t=Q.createOnDisableEvent(this.H,this.gt.onDisable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this.Rt&&this.g.addEventToSyncedCollection(this.Rt)}tryRegisterStart(){this.Kt&&(this.gt._engine_internal_destroyed||this.Mt.startCalled||this.Mt.startRegistered||(this.Mt.startRegistered=!0,this.g.addEventToNonSyncedCollection(this.Kt)))}tryUnregisterStart(){this.Kt&&this.Mt.startRegistered&&!this.Mt.startCalled&&(this.Mt.startRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Kt))}tryRegisterUpdate(){this.Lt&&(this.gt._engine_internal_destroyed||this.Mt.updateRegistered||(this.Mt.updateRegistered=!0,this.g.addEventToNonSyncedCollection(this.Lt)))}tryUnregisterUpdate(){this.Lt&&this.Mt.updateRegistered&&(this.Mt.updateRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Lt))}get onCollisionEnter2D(){return this.qt}get onCollisionStay2D(){return this.zt}get onCollisionExit2D(){return this.Bt}get onTriggerEnter2D(){return this.Gt}get onTriggerStay2D(){return this.Ht}get onTriggerExit2D(){return this.Jt}}class ge{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._runningCoroutines=[],this._engine_internal_destroyed=!1,this._enabled=!0,this._gameObject=t,this._instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=null}engine_internal_constructAfterProcess(){this._engine_internal_componentEventContainer=new me(this),Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCoroutine(t){this.checkComponentIsExist();const e=new de(this,t,(()=>{const t=this._runningCoroutines.indexOf(e);t>=0&&this._runningCoroutines.splice(t,1)}));return this._runningCoroutines.push(e),e.fatchNextInstruction(),this.engine.coroutineProcessor.addCoroutine(e),e}stopAllCoroutines(){this.checkComponentIsExist(),this._runningCoroutines.forEach((t=>{this.stopCoroutine(t)})),this._runningCoroutines.length=0}stopCoroutine(t){if(this.checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const e=this._runningCoroutines.indexOf(t);e>=0&&this._runningCoroutines.splice(e,1)}get enabled(){return this._enabled}set enabled(t){this.checkComponentIsExist(),this._enabled!==t&&(this._enabled=t,this._gameObject.initialized&&this._gameObject.activeInHierarchy&&(this._enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._gameObject}get transform(){return this._gameObject.transform}get engine(){return this._gameObject.engine}get instanceId(){return this._instanceId}get initialized(){return this._gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class pe{}pe.defaultSpriteSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA8SURBVDhP7dEhCgAxDADB+/k9Lh8rDCtq6yo6JrAhKt9s/k2JEjceNGlPiRI3HjRpT4kS7w81SpQ4PJhZxl3jEH3ZDWcAAAAASUVORK5CYII=";class fe extends Tt{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof fe&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}new tt,new J,new tt,new st,new st;class ye{constructor(t=0,e=0,i=0,s=1){1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Wi=t,this.$i=e,this.Xi=i,this.Yi=s}set(t,e,i,s=1){return 1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.Wi=t,this.$i=e,this.Xi=i,this.Yi=s,this}copy(t){return this.Wi=t.r,this.$i=t.g,this.Xi=t.b,this.Yi=t.a,this}clone(){return new ye(this.Wi,this.$i,this.Xi,this.Yi)}get r(){return this.Wi}set r(t){1<t?t=1:0>t&&(t=0),this.Wi=t}get g(){return this.$i}set g(t){1<t?t=1:0>t&&(t=0),this.$i=t}get b(){return this.Xi}set b(t){1<t?t=1:0>t&&(t=0),this.Xi=t}get a(){return this.Yi}set a(t){1<t?t=1:0>t&&(t=0),this.Yi=t}toString(){return"rgb("+255*this.Wi+", "+255*this.$i+", "+255*this.Xi+")"}toStringWithAlpha(){return"rgba("+255*this.Wi+", "+255*this.$i+", "+255*this.Xi+", "+this.Yi+")"}toHex(){return"#"+((Math.round(255*this.Wi)<<16)+(Math.round(255*this.$i)<<8)+(Math.round(255*this.Xi)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this.Wi)<<16)+(Math.round(255*this.$i)<<8)+(Math.round(255*this.Xi)<<0)).toString(16).padStart(6,"0")+Math.round(255*this.Yi).toString(16).padStart(2,"0")}toArray(){return[this.Wi,this.$i,this.Xi,this.Yi]}static fromHex(t){const e=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new ye(e,i,s)}static fromArray(t){return new ye(t[0],t[1],t[2],t[3])}static fromString(t){const e=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return e?new ye(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])):ye.fromHex(t)}hueRotate(t=0,e){t=t/180*Math.PI;const i=Math.sin(t),s=Math.cos(t);this.multiplyMatrix((null!=e?e:new pt).set(.213+.787*s-.213*i,.715-.715*s-.715*i,.072-.072*s+.928*i,.213-.213*s+.143*i,.715+.285*s+.14*i,.072-.072*s-.283*i,.213-.213*s-.787*i,.715-.715*s+.715*i,.072+.928*s+.072*i))}grayscale(t=1,e){this.multiplyMatrix((null!=e?e:new pt).set(.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)))}sepia(t=1,e){this.multiplyMatrix((null!=e?e:new pt).set(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)))}saturate(t=1,e){this.multiplyMatrix((null!=e?e:new pt).set(.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t))}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}invert(t=1){let e=t+this.Wi*(1-2*t),i=t+this.$i*(1-2*t),s=t+this.Xi*(1-2*t);1<e?e=1:e<0&&(e=0),1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),this.Wi=e,this.$i=i,this.Xi=s}multiplyMatrix(t){const e=t.elements;let i=this.Wi*e[0]+this.$i*e[1]+this.Xi*e[2],s=this.Wi*e[3]+this.$i*e[4]+this.Xi*e[5],h=this.Wi*e[6]+this.$i*e[7]+this.Xi*e[8];return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<h?h=1:h<0&&(h=0),this.Wi=i,this.$i=s,this.Xi=h,this}linear(t=1,e=0){let i=this.Wi*t+e,s=this.$i*t+e,h=this.Xi*t+e;return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<h?h=1:h<0&&(h=0),this.Wi=i,this.$i=s,this.Xi=h,this}hsl(){const t=this.Wi,e=this.$i,i=this.Xi,s=Math.max(t,e,i),h=Math.min(t,e,i);let r,n;const o=(s+h)/2;if(s===h)r=n=0;else{const a=s-h;switch(n=o>.5?a/(2-s-h):a/(s+h),s){case t:r=(e-i)/a+(e<i?6:0);break;case e:r=(i-t)/a+2;break;case i:r=(t-e)/a+4;break;default:throw new Error("Unreachable")}r/=6}return{h:r,s:n,l:o}}}class we{constructor(t=0,e=0,i=0,s=new ye,h=null){this.tc=t,this.sc=e,this.dl=i,this.hc=(new ye).copy(s),this.vl=h}get onChange(){return this.vl}set onChange(t){this.vl=t}get offsetX(){return this.tc}set offsetX(t){var e;this.tc=t,null===(e=this.vl)||void 0===e||e.call(this)}get offsetY(){return this.sc}set offsetY(t){var e;this.sc=t,null===(e=this.vl)||void 0===e||e.call(this)}get blur(){return this.dl}set blur(t){var e;this.dl=t,null===(e=this.vl)||void 0===e||e.call(this)}get color(){return this.hc}set color(t){var e;this.hc.copy(t),null===(e=this.vl)||void 0===e||e.call(this)}copy(t){var e;this.tc=t.offsetX,this.sc=t.offsetY,this.dl=t.blur,this.hc.copy(t.color),null===(e=this.vl)||void 0===e||e.call(this)}clone(){return new we(this.tc,this.sc,this.dl,this.hc.clone())}toString(){return"drop-shadow("+this.tc+"px "+this.sc+"px "+this.dl+"px "+this.hc.toString()+")"}}class Ce{constructor(t=null){this.dl=0,this.ud=1,this.ld=1,this.vd=null,this.fd=0,this.gd=0,this.pd=0,this.wd=1,this.Sd=0,this.vl=t}copy(t){var e;this.dl=t.dl,this.ud=t.ud,this.ld=t.ld,!this.vd&&t.vd?(this.vd=new we(void 0,void 0,void 0,void 0,this.vl),this.vd.copy(t.vd)):this.vd&&t.vd&&this.vd.copy(t.vd),this.fd=t.fd,this.gd=t.gd,this.pd=t.pd,this.wd=t.wd,this.Sd=t.Sd,null===(e=this.vl)||void 0===e||e.call(this)}clone(){const t=new Ce;return t.copy(this),t}get blur(){return this.dl}set blur(t){var e;this.dl=t,null===(e=this.vl)||void 0===e||e.call(this)}get brightness(){return this.ud}set brightness(t){var e;this.ud=t,null===(e=this.vl)||void 0===e||e.call(this)}get contrast(){return this.ld}set contrast(t){var e;this.ld=t,null===(e=this.vl)||void 0===e||e.call(this)}get dropShadow(){return this.vd}set dropShadow(t){t?(this.vd||(this.vd=new we(void 0,void 0,void 0,void 0,this.vl)),this.vd.copy(t)):this.vd&&(this.vd.onChange=null,this.vd=null)}get grayscale(){return this.fd}set grayscale(t){var e;this.fd=t,null===(e=this.vl)||void 0===e||e.call(this)}get hueRotate(){return this.gd}set hueRotate(t){var e;this.gd=t,null===(e=this.vl)||void 0===e||e.call(this)}get invert(){return this.pd}set invert(t){var e;this.pd=t,null===(e=this.vl)||void 0===e||e.call(this)}get saturate(){return this.wd}set saturate(t){var e;this.wd=t,null===(e=this.vl)||void 0===e||e.call(this)}get sepia(){return this.Sd}set sepia(t){var e;this.Sd=t,null===(e=this.vl)||void 0===e||e.call(this)}toString(){let t="";return 0!==this.dl&&(t+="blur("+this.dl+"px) "),1!==this.ud&&(t+="brightness("+this.ud+") "),1!==this.ld&&(t+="contrast("+this.ld+") "),0!==this.fd&&(t+="grayscale("+this.fd+") "),0!==this.gd&&(t+="hue-rotate("+this.gd+"deg) "),0!==this.pd&&(t+="invert("+this.pd+") "),1!==this.wd&&(t+="saturate("+this.wd+") "),0!==this.Sd&&(t+="sepia("+this.Sd+") "),this.vd&&(t+=this.vd.toString()),t}}class ve extends ge{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this.da=new Ut,this.dn=.1,this.un=!0,this.fn=()=>{this.htmlElement&&(this.htmlElement.style.filter=this.Ui.toString())},this.Ui=new Ce(this.fn),this.Cl=!1}start(){this.Cl=!0,this.renderInitialize()}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onWorldMatrixUpdated(){this.css3DObject&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){const e=this.htmlElement;if(!e)throw new Error("htmlElement is null");let i=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new fe(e),i=!0):this.css3DObject?this.css3DObject.element=e:(this.css3DObject=new fe(e),i=!0),i&&(e.style.pointerEvents=this.pointerEvents?"auto":"none",e.style.filter=this.Ui.toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this.da}set centerOffset(t){this.da.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this.dn}set viewScale(t){this.dn=t,this.updateViewScale(!0)}get pointerEvents(){return this.un}set pointerEvents(t){this.un=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get filter(){return this.Ui}get readyToDraw(){return this.Cl}get htmlElementEventHandler(){return this.htmlElement}}var xe,be;(be=xe||(xe={})).Auto="auto",be.CrispEdges="crisp-edges",be.Pixelated="pixelated";class Me extends ve{constructor(){super(...arguments),this.Ga=0,this.Ha=0,this.Xa=!1,this.Ya=!1,this.$a=1,this.gn=xe.Pixelated,this.Ca=null}renderInitialize(){this.Ca?this.Ca():this.asyncSetImageFromPath(pe.defaultSpriteSrc)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this.Ga*this.centerOffset.x,this.Ha*this.centerOffset.y,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement;i.style.width=this.Ga/this.viewScale+"px",i.style.height=this.Ha/this.viewScale+"px";const s=this.Xa?-1:1,h=this.Ya?-1:1;this.css3DObject.scale.set(e*s,e*h,e),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get image(){return this.htmlElement}asyncSetImageFromPath(t,e){var i;if(!this.readyToDraw)return void(this.Ca=()=>this.asyncSetImageFromPath(t,e));const s=null!==(i=this.htmlElement)&&void 0!==i?i:new Image;s.src=t;const h=t=>{this.exists&&(s.removeEventListener("load",h),this.setImage(s),null==e||e())};s.addEventListener("load",h)}setImage(t){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);if(this.htmlElement=t,!this.readyToDraw)return void(this.Ca=()=>this.setImage(t));t.alt=this.gameObject.name+"_sprite",t.style.imageRendering=this.gn,0===this.Ga&&(this.Ga=.1*t.naturalWidth),0===this.Ha&&(this.Ha=.1*t.naturalHeight),t.style.width=this.Ga/this.viewScale+"px",t.style.height=this.Ha/this.viewScale+"px",t.style.opacity=this.$a.toString();const e=this.initializeBaseComponents(!1);Ft.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get imageWidth(){return this.Ga}set imageWidth(t){this.Ga=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.Ha}set imageHeight(t){this.Ha=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Xa}set imageFlipX(t){this.Xa=t,this.css3DObject&&(this.Xa?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imageFlipY(){return this.Ya}set imageFlipY(t){this.Ya=t,this.css3DObject&&(this.Ya?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get opacity(){return this.$a}set opacity(t){this.$a=t,this.htmlElement&&(this.htmlElement.style.opacity=this.$a.toString())}get imageRenderingMode(){return this.gn}set imageRenderingMode(t){this.gn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.gn)}}class _e{constructor(t,e=1,i=1){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.nc=t,this.Sa=i,this.pa=e}get htmlImageElement(){return this.nc}get columnCount(){return this.pa}get rowCount(){return this.Sa}}class Ee extends ve{constructor(){super(...arguments),this.pa=10,this.Sa=10,this.Kr=1,this.Jr=1,this.Lr=16,this.Qr=16,this.cn=null,this.gn=xe.Pixelated,this.Hr=[]}renderInitialize(){this.cc(),this.Hr.forEach((t=>t())),this.Hr=[]}updateCenterOffset(t){if(!this.css3DObject)return;const e=this.pa*this.Kr,i=this.Sa*this.Jr;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement,s=this.pa*this.Kr,h=this.Sa*this.Jr;i.style.width=s/e+"px",i.style.height=h/e+"px",this.css3DObject.scale.set(e,e,e),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}cc(){const t=this.pa*this.Kr,e=this.Sa*this.Jr,i=this.pa*this.Lr,s=this.Sa*this.Qr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=i,this.htmlElement.height=s,this.htmlElement.style.imageRendering=this.gn,this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=e/this.viewScale+"px";const h=this.initializeBaseComponents(!1);Ft.updateRawObject3DWorldMatrixRecursively(h),this.transform.enqueueRenderAttachedObject3D(h)}drawTile(t,e,i,s){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTile(t,e,i,s)));const h=this.htmlElement.getContext("2d"),r=this.cn[i];if(1===r.rowCount&&1===r.columnCount)h.drawImage(r.htmlImageElement,0,0,this.Lr,this.Qr,t*this.Lr,e*this.Qr,this.Lr,this.Qr);else{if(void 0===s)throw new Error("Atlas index is required.");{const i=Math.floor(s/r.columnCount),n=s%r.columnCount,o=r.htmlImageElement.width/r.columnCount,a=r.htmlImageElement.height/r.rowCount;h.drawImage(r.htmlImageElement,n*o,i*a,o,a,t*this.Lr,e*this.Qr,this.Lr,this.Qr)}}}drawTileFromTwoDimensionalArray(t,e,i){if(!this.readyToDraw)return void this.Hr.push((()=>this.drawTileFromTwoDimensionalArray(t,e,i)));const s=this.htmlElement.getContext("2d");for(let h=0;h<t.length;h++){const r=t[h];for(let t=0;t<r.length;t++){const n=r[t];if(null===n)continue;const o=this.cn[n.i];if(1===o.rowCount&&1===o.columnCount)s.drawImage(o.htmlImageElement,0,0,this.Lr,this.Qr,t*this.Lr+e*this.Lr,h*this.Qr+i*this.Qr,this.Lr,this.Qr);else{if(void 0===n.a)throw new Error("Atlas index is required.");{const r=n.a%o.columnCount,a=Math.floor(n.a/o.columnCount),l=o.htmlImageElement.width/o.columnCount,c=o.htmlImageElement.height/o.rowCount;s.drawImage(o.htmlImageElement,r*l,a*c,l,c,t*this.Lr+e*this.Lr,h*this.Qr+i*this.Qr,this.Lr,this.Qr)}}}}}clearTile(t,e){this.readyToDraw?this.htmlElement.getContext("2d").clearRect(t*this.Lr,e*this.Qr,this.Lr,this.Qr):this.Hr.push((()=>this.clearTile(t,e)))}set imageSources(t){if(this.readyToDraw){this.cn=t;for(let e=0;e<t.length;e++)if(!t[e].htmlImageElement.complete)throw new Error(`Image ${t[e].htmlImageElement.src} is not loaded.`)}else this.Hr.push((()=>this.imageSources=t))}get columnCount(){return this.pa}set columnCount(t){if(this.pa=t,this.htmlElement){const t=this.pa*this.Kr,e=this.pa*this.Lr;this.htmlElement.width=e,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Sa}set rowCount(t){if(this.Sa=t,this.htmlElement){const t=this.Sa*this.Jr,e=this.Sa*this.Qr;this.htmlElement.height=e,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Kr}set gridCellWidth(t){if(this.Kr=t,this.htmlElement){const t=this.pa*this.Kr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Jr}set gridCellHeight(t){if(this.Jr=t,this.htmlElement){const t=this.Sa*this.Jr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Lr}set tileResolutionX(t){if(this.Lr=t,this.htmlElement){const t=this.pa*this.Lr;this.htmlElement.width=t}}get tileResolutionY(){return this.Qr}set tileResolutionY(t){if(this.Qr=t,this.htmlElement){const t=this.Sa*this.Qr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Kr/2,e=this.rowCount%2==1?0:this.Jr/2;return new Ut(this.transform.position.x+t,this.transform.position.y+e)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Kr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Jr/2)}get imageRenderingMode(){return this.gn}set imageRenderingMode(t){this.gn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.gn)}}class Oe extends ge{constructor(){super(...arguments),this.Xr=new Map,this.Yr=16,this.Kr=1,this.Jr=1,this.Lr=16,this.Qr=16,this.Zr=1.001,this.cn=null,this.un=!0,this.dn=.1,this.gn=xe.Pixelated,this.fn=()=>{this.Xr.forEach(((t,e)=>{t.filter.copy(this.Ui)}))},this.Ui=new Ce(this.fn),this.Hr=[],this.Wr=!1}start(){this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[]}pn(){this.Xr.forEach(((t,e)=>{const i=this.mn(e)*this.Yr*this.Kr,s=this.Cn(e)*this.Yr*this.Jr;t.gameObject.transform.localPosition.set(i,s,0)}))}mn(t){return parseInt(t.substring(0,t.indexOf("_")))}Cn(t){return parseInt(t.substring(t.indexOf("_")+1))}_n(t,e){return`${t}_${e}`}Rn(t,e,i,s){const h=i-t*this.Yr+this.Yr/2,r=s-e*this.Yr+this.Yr/2;return new Ut(h,r)}Mn(t,e){const i=this._n(t,e);let s=this.Xr.get(i);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+e,new tt(t*this.Yr*this.Kr,e*this.Yr*this.Jr,0),void 0,(new tt).setScalar(this.Zr)).withComponent(Ee,(t=>{s=t,this.cn&&(t.imageSources=this.cn),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Jr,t.tileResolutionX=this.Lr,t.tileResolutionY=this.Qr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.un,t.viewScale=this.dn,t.filter.copy(this.Ui)}))),this.Xr.set(i,s)),s}wn(t,e){const i=this._n(t,e),s=this.Xr.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this.Wr)return void this.Hr.push((()=>{this.drawTile(t,e,i,s)}));const h=Math.floor((t+this.Yr/2)/this.Yr),r=Math.floor((e+this.Yr/2)/this.Yr),n=this.Mn(h,r),o=this.Rn(h,r,t,e),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;n.drawTile(o.x+a,this.Yr-o.y-1+l,i,s)}drawTileFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)null!==t[s][h]&&this.drawTile(h+e,t.length-s+i-1,t[s][h].i,t[s][h].a);else this.Hr.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this.Wr)return void this.Hr.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this.Yr/2)/this.Yr),s=Math.floor((e+this.Yr/2)/this.Yr),h=this.wn(i,s);if(null===h)return;const r=this.Rn(i,s,t,e),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Yr-r.y-1+o)}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.Wr?(this.cn=t,this.Xr.forEach(((e,i)=>{e.imageSources=t}))):this.Hr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.un}set pointerEvents(t){this.un=t,this.Xr.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Jr}set gridCellHeight(t){this.Jr!==t&&(this.Jr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.gridCellHeight=this.Jr})))}get tileResolutionX(){return this.Lr}set tileResolutionX(t){this.Lr!==t&&(this.Lr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionX=this.Lr})))}get tileResolutionY(){return this.Qr}set tileResolutionY(t){this.Qr!==t&&(this.Qr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionY=this.Qr})))}get tilemapScale(){return this.Zr}set tilemapScale(t){this.Zr!==t&&(this.Zr=t,this.Xr.forEach(((t,e)=>{t.gameObject.transform.localScale.setScalar(this.Zr)})))}get gridCenter(){const t=this.Yr%2==1?0:this.Kr/2,e=this.Yr%2==1?0:this.Jr/2;return new Ut(this.transform.localPosition.x+t,this.transform.localPosition.y+e)}get gridCenterX(){const t=this.Yr%2==1?0:this.Kr/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this.Yr%2==1?0:this.Jr/2;return this.transform.localPosition.y+t}get viewScale(){return this.dn}set viewScale(t){this.dn=t,this.Xr.forEach(((t,e)=>{t.viewScale=this.dn}))}get filter(){return this.Ui}get imageRenderingMode(){return this.gn}set imageRenderingMode(t){this.gn=t,this.Xr.forEach(((e,i)=>{e.imageRenderingMode=t}))}}class Se extends ge{constructor(){super(...arguments),this.$r=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.Sr=[],this.Hr=[],this.Wr=!1}start(){this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[]}addEvent(t,e,i){this.Wr?(this.$r.set(`${t}_${e}`,i),this.Rr&&this.yr(t*this.gridCellWidth,e*this.gridCellHeight)):this.Hr.push((()=>{this.addEvent(t,e,i)}))}addEventsFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)null!==t[s][h]&&this.addEvent(h+e,t.length-(s+i),t[s][h]);else this.Hr.push((()=>{this.addEventsFromTwoDimensionalArray(t,e,i)}))}Gr(){this.$r.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.yr(i*this.gridCellWidth,s*this.gridCellHeight)}))}Nr(){this.Sr.forEach((t=>{t.destroy()})),this.Sr=[]}yr(t,e){const i={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new tt(t,e,1e4)).withComponent(Me,(t=>{t.opacity=.5,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(i)),this.Sr.push(i.ref)}tryInvokeEvent(t,e,i,s,h){const r=this.transform.position;t-=r.x,e-=r.y;const n=Math.floor(t/this.gridCellWidth),o=Math.floor((t+i)/this.gridCellWidth),a=Math.floor(e/this.gridCellHeight),l=Math.floor((e+s)/this.gridCellHeight);let c=!1;for(let t=a;t<=l;t++)for(let e=n;e<=o;e++)this.$r.has(`${e}_${t}`)&&(this.$r.get(`${e}_${t}`)(e,t,h),c=!0);return c}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showEvents(){return this.Rr}set showEvents(t){this.Rr=t,this.Rr?this.Gr():this.Nr()}get gridCenter(){const t=this.transform.position;return new Ut(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}class De{constructor(t,e,i){this.xn=new Ut(t.x,t.y),this.Sn=new Ut(e.x,e.y),this.Tn=i}get gridPosition(){return this.xn}get position(){return this.Sn}get button(){return this.Tn}}class Te extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Vn=null,this.Wn=null,this.Ih=1,this.Th=1,this.Lh=new Ut,this.dn=.1,this.Kn=64,this.On=64,this.Is=new S,this.Xs=new S,this.Ys=new S,this.zs=new S,this.Gs=new S,this.Zs=null,this.Js=!1,this.Wr=!1,this.Fn=new tt,this.Un=t=>{const e=this.Xn(t.offsetX,t.offsetY,t.button);this.Is.invoke(e)},this.Yn=t=>{const e=this.Xn(t.offsetX,t.offsetY,t.button);this.Xs.invoke(e)},this.kn=t=>{const e=this.Xn(t.offsetX,t.offsetY,t.button);this.Ys.invoke(e)},this.qn=t=>{const e=this.Xn(t.offsetX,t.offsetY,t.button);this.zs.invoke(e)},this.zn=t=>{const e=this.Xn(t.offsetX,t.offsetY,t.button);this.Gs.invoke(e)},this.An=t=>{this.Zs=()=>{this.Ke("mouseenter",t.touches[0]),this.Ke("mousedown",t.touches[0])}},this.Bn=t=>{this.Js&&(this.Js=!1,this.Ke("mouseup",t.changedTouches[0]),this.Ke("mouseleave",t.changedTouches[0]))},this.Jn=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.Ke("mousemove",t.touches[0]),this.Js=!0},this.Nn=t=>{this.Js&&(this.Js=!1,this.Ke("mouseleave",t.changedTouches[0]))}}start(){this.Wn=document.createElement("div"),this.Vn=new fe(this.Wn),this.Vn.scale.setScalar(this.dn),this.Wn.style.width=this.Kn/this.dn+"px",this.Wn.style.height=this.On/this.dn+"px",this.Wn.addEventListener("mousedown",this.Un),this.Wn.addEventListener("mouseup",this.Yn),this.Wn.addEventListener("mouseenter",this.kn),this.Wn.addEventListener("mouseleave",this.qn),this.Wn.addEventListener("mousemove",this.zn),this.Wn.addEventListener("touchstart",this.An),this.Wn.addEventListener("touchend",this.Bn),this.Wn.addEventListener("touchmove",this.Jn),this.Wn.addEventListener("touchcancel",this.Nn),this.transform.unsafeGetObject3D().add(this.Vn),Ft.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn),this.Wr=!0}update(){let t;this.Fn.copy(this.engine.cameraContainer.camera.transform.position),t=this.transform.parent?this.transform.parent.inverseTransformPoint(this.Fn):this.Fn,this.Vn.position.x=t.x,this.Vn.position.y=t.y,Ft.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn)}onDestroy(){this.Wr&&(this.Wn&&(this.Wn.removeEventListener("mousedown",this.Un),this.Wn.removeEventListener("mouseup",this.Yn),this.Wn.removeEventListener("mouseenter",this.kn),this.Wn.removeEventListener("mouseleave",this.qn),this.Wn.removeEventListener("mousemove",this.zn),this.Wn.removeEventListener("touchstart",this.An),this.Wn.removeEventListener("touchend",this.Bn),this.Wn.removeEventListener("touchmove",this.Jn),this.Wn.removeEventListener("touchcancel",this.Nn)),this.Vn&&this.transform.unsafeGetObject3D().remove(this.Vn))}onWorldMatrixUpdated(){this.Vn&&(Ft.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn))}Xn(t,e,i){t*=this.dn,e*=this.dn;const s=this.transform.position,h=this.Vn.position.x+s.x-this.Kn/2+t-this.Lh.x,r=this.Vn.position.y+s.y-this.On/2+(this.On-e)-this.Lh.y,n=Math.floor((h+.5*this.Ih)/this.Ih),o=Math.floor((r+.5*this.Th)/this.Th);return new De(new Ut(n,o),new Ut(h,r),i)}Ke(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}get gridCenter(){return this.Lh}set gridCenter(t){this.Lh.copy(t)}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}setGridInfoFromCollideMap(t){this.Ih=t.gridCellWidth,this.Th=t.gridCellHeight,this.Lh.set(t.gridCenterX,t.gridCenterY)}get inputWidth(){return this.Kn}set inputWidth(t){this.Kn=t,this.Wn&&(this.Wn.style.width=this.Kn/this.dn+"px")}get inputHeight(){return this.On}set inputHeight(t){this.On=t,this.Wn&&(this.Wn.style.height=this.On/this.dn+"px")}get viewScale(){return this.dn}set viewScale(t){this.dn=t,this.Wn&&(this.Wn.style.width=this.Kn/this.dn+"px",this.Wn.style.height=this.On/this.dn+"px"),this.Vn&&(this.Vn.scale.setScalar(this.dn),Ft.updateRawObject3DWorldMatrixRecursively(this.Vn),this.transform.enqueueRenderAttachedObject3D(this.Vn))}}class ke extends ve{constructor(){super(...arguments),this.tu=1,this.su=1,this.iu=!1,this.Ca=null}renderInitialize(){var t;null===(t=this.Ca)||void 0===t||t.call(this),this.htmlElement||(this.element=null)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tu,i=this.su;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tu/this.viewScale+"px",this.css3DObject.element.style.height=this.su/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get element(){return this.htmlElement}set element(t){const e=this.htmlElement=null!=t?t:document.createElement("div");this.readyToDraw?this.hu(e):this.Ca=()=>this.hu(e)}hu(t){this.iu?(t.style.width="auto",t.style.height="auto"):(t.style.width=this.tu/this.viewScale+"px",t.style.height=this.su/this.viewScale+"px");const e=this.initializeBaseComponents(!0);Ft.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get elementWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.tu}set elementWidth(t){this.iu||(this.tu=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get elementHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight*this.viewScale;return this.htmlElement.style.display=t,e}return 0}return this.su}set elementHeight(t){this.iu||(this.su=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tu/this.viewScale+"px",this.htmlElement.style.height=this.su/this.viewScale+"px"))}}class je extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Te],this.vn=null,this.Pn=0,this.En=null,this.Dn=null,this.Is=new S,this.Xs=new S,this.Gs=new S,this.bn=!1,this.Wr=!1,this.Gn=t=>{this.En.activeSelf=!0,this.Hn(t)},this.In=t=>{this.bn&&this.Ln(t),this.En.activeSelf=!1},this.yn=t=>{var e;this.bn=!0,this.jn(t);const i=null===(e=this.Dn)||void 0===e?void 0:e.element;i&&(i.style.backgroundColor="#DDDDDD"),this.Is.invoke(t)},this.Ln=t=>{var e;this.bn=!1,this.jn(t);const i=null===(e=this.Dn)||void 0===e?void 0:e.element;i&&(i.style.backgroundColor="white"),this.Xs.invoke(t)},this.Hn=t=>{this.jn(t),this.Gs.invoke(t)}}start(){this.vn=this.gameObject.getComponent(Te),this.vn.onPointerEnter.addListener(this.Gn),this.vn.onPointerLeave.addListener(this.In),this.vn.onPointerDown.addListener(this.yn),this.vn.onPointerUp.addListener(this.Ln),this.vn.onPointerMove.addListener(this.Hn);const t=new ce,e=new ce;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("pointer",new tt(0,0,this.Pn)).active(!1).withComponent(ke,(t=>{t.pointerEvents=!1;const e=document.createElement("div");e.style.backgroundColor="white",e.style.opacity="0.3",t.element=e})).getComponent(ke,e).getGameObject(t)),this.En=t.ref,this.Dn=e.ref,this.Wr=!0}onDestroy(){this.Wr&&this.vn&&(this.vn.onPointerEnter.removeListener(this.Gn),this.vn.onPointerLeave.removeListener(this.In),this.vn.onPointerDown.removeListener(this.yn),this.vn.onPointerUp.removeListener(this.Ln),this.vn.onPointerMove.removeListener(this.Hn))}jn(t){const e=this.vn.gridCellWidth,i=this.vn.gridCellHeight,s=this.vn.gridCenter,h=t.gridPosition.x*e+s.x,r=t.gridPosition.y*i+s.y;this.En.transform.localPosition.set(h,r,this.Pn)}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerMove(){return this.Gs}get pointerZoffset(){return this.Pn}set pointerZoffset(t){this.Pn=t}}class ze extends ge{}class Ae extends ze{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.rl=-100}update(){this.transform.localPosition.z=this.engine.cameraContainer.camera.transform.position.z+this.rl}get offset(){return this.rl}set offset(t){this.rl=t}}class Re{static loadImageFromPath(t){return console.log(`Loading image from ${t}`),new Promise(((e,i)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=()=>{i(new Error(`Failed to load image "${t}".`))},s.src=t,s.complete&&e(s)}))}static loadImagesFromPath(t){return Promise.all(t.map((t=>Re.loadImageFromPath(t))))}static loadImage(t){return new Promise(((e,i)=>{t.onload=()=>{e(t)},t.onerror=()=>{i(new Error("Failed to load image."))},t.complete&&e(t)}))}static loadImages(t){return Promise.all(t.map((t=>Re.loadImage(t))))}}const We=t.p+"assets/Overworld_Tileset.png";class Pe{constructor(t,e,i,s,h){this._instantiater=t.instantiater,this._gameObjectBuilder=new Lt(t,e,i,s,h)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}class Ie extends Tt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new st,this.projectionMatrix=new st,this.projectionMatrixInverse=new st}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Fe extends Ie{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*s*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*i*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*s*Math.atan(Math.tan(.5*i*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,h,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=h,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*i*this.fov)/this.zoom,s=2*e,h=this.aspect*s,r=-.5*h;const n=this.view;if(null!==this.view&&this.view.enabled){const t=n.fullWidth,i=n.fullHeight;r+=n.offsetX*h/t,e-=n.offsetY*s/i,h*=n.width/t,s*=n.height/i}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+h,e,e-s,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class He extends Ie{constructor(t=-1,e=1,i=1,s=-1,h=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=h,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,h,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=h,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let h=i-t,r=i+t,n=s+e,o=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=t*this.view.offsetX,r=h+t*this.view.width,n-=e*this.view.offsetY,o=n-e*this.view.height}this.projectionMatrix.makeOrthographic(h,r,n,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class Le{constructor(t,e){this.Dt=t,this.Cr=(new ye).copy(e)}get priority(){return this.Dt}set priority(t){this.Dt=t}get backgroundColor(){return this.Cr}set backgroundColor(t){this.Cr.copy(t)}}var Ye,Ne,Be;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(Ye||(Ye={}));class Xe extends ge{constructor(){super(...arguments),this.mh=null,this.Ta=Ye.Orthographic,this.va=75,this.ya=5,this.wa=.1,this.Pa=1e3,this.Dt=0,this.Oa=new ye(1,1,1,0),this._a=(t,e)=>{const i=t/e;if(this.mh instanceof Fe)this.mh.aspect=i,this.mh.updateProjectionMatrix();else if(this.mh instanceof He){const t=this.ya;this.mh.left=-t*i,this.mh.right=t*i,this.mh.top=t,this.mh.bottom=-t,this.mh.updateProjectionMatrix()}}}onEnable(){this.engine.screen.onResize.addListener(this._a),this.ba()}onWorldMatrixUpdated(){this.mh&&(Ft.updateRawObject3DWorldMatrixRecursively(this.mh),this.mh.matrixWorldInverse.copy(this.mh.matrixWorld).invert())}ba(){const t=this.engine.screen.width/this.engine.screen.height;if(this.Ta===Ye.Perspective)this.mh?this.mh instanceof Fe?(this.mh.aspect=t,this.mh.fov=this.va,this.mh.near=this.wa,this.mh.far=this.Pa,this.mh.updateProjectionMatrix()):(this.mh.removeFromParent(),this.mh=this.xa(),this.transform.unsafeGetObject3D().add(this.mh)):(this.mh=this.xa(),this.transform.unsafeGetObject3D().add(this.mh));else{if(this.Ta!==Ye.Orthographic)throw new Error("Camera type not supported");if(this.mh)if(this.mh instanceof He){const e=this.ya;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.near=this.wa,this.mh.far=this.Pa,this.mh.updateProjectionMatrix()}else this.mh.removeFromParent(),this.mh=this.Ia(),this.transform.unsafeGetObject3D().add(this.mh);else this.mh=this.Ia(),this.transform.unsafeGetObject3D().add(this.mh)}Ft.updateRawObject3DWorldMatrixRecursively(this.mh),this.engine.cameraContainer.addCamera(this,new Le(this.Dt,this.Oa))}xa(){const t=this.engine.screen.width/this.engine.screen.height;return new Fe(this.va,t,this.wa,this.Pa)}Ia(){const t=this.engine.screen.width/this.engine.screen.height,e=this.ya;return new He(-e*t,e*t,e,-e,this.wa,this.Pa)}onDisable(){this.engine.screen.onResize.removeListener(this._a),this.mh&&this.engine.cameraContainer.removeCamera(this)}onDestroy(){var t;null===(t=this.mh)||void 0===t||t.removeFromParent()}get cameraType(){return this.Ta}set cameraType(t){this.Ta!==t&&(this.Ta=t,this.mh&&this.ba())}get fov(){return this.va}set fov(t){this.va!==t&&(this.va=t,this.mh instanceof Fe&&(this.mh.fov=t,this.mh.updateProjectionMatrix()))}get viewSize(){return this.ya}set viewSize(t){if(this.ya!==t&&(this.ya=t,this.mh instanceof He)){const t=this.engine.screen.width/this.engine.screen.height,e=this.ya;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.updateProjectionMatrix()}}get near(){return this.wa}set near(t){this.wa!==t&&(this.wa=t,this.mh instanceof Fe&&(this.mh.near=t,this.mh.updateProjectionMatrix()))}get far(){return this.Pa}set far(t){this.Pa!==t&&(this.Pa=t,this.mh instanceof Fe&&(this.mh.far=t,this.mh.updateProjectionMatrix()))}get priority(){return this.Dt}set priority(t){this.Dt=t,this.mh&&this.engine.cameraContainer.changeCameraPriority(this,t)}get backgroundColor(){return this.Oa}set backgroundColor(t){this.Oa.copy(t),this.mh&&this.engine.cameraContainer.changeCameraBackgroundColor(this,t)}get threeCamera(){return this.mh}}class Ge extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Xe],this.mh=null,this.fh=!1,this.ph=1,this.Vh=new Ut,this.wh=1,this.zh=10,this.xh=5,this.Sh=5,this.bh=new tt,this.dh=t=>{" "===t.key&&(this.Sh=this.xh,this._h(),this.transform.localPosition.copy(this.bh))},this.Bh=t=>{this.Sh+=.01*t.deltaY,this.Sh<this.wh?this.Sh=this.wh:this.Sh>this.zh&&(this.Sh=this.zh),this._h()},this.Pr=t=>{this.Vh.set(t.clientX/this.engine.screen.width,t.clientY/this.engine.screen.height),t.button===this.ph&&(this.fh=!0)},this.Eh=t=>{t.button===this.ph&&(this.fh=!1)},this.Mh=t=>{if(!this.fh)return;const e=t.clientX/this.engine.screen.width,i=t.clientY/this.engine.screen.height,s=e-this.Vh.x,h=i-this.Vh.y,r=this.engine.screen.width/this.engine.screen.height;this.transform.localPosition.x-=s*this.mh.viewSize*2*r,this.transform.localPosition.y+=h*this.mh.viewSize*2,this.Vh.set(e,i)},this.jh=t=>{this.fh=!1}}awake(){this.mh=this.gameObject.getComponent(Xe),this.xh=this.mh.viewSize,this.bh.copy(this.transform.localPosition),this.Sh=this.xh,this.mh.viewSize=this.Sh}onEnable(){const t=this.engine.input;t.onKeyDown.addListener(this.dh),t.onWheel.addListener(this.Bh),t.onPointerDown.addListener(this.Pr),t.onPointerUp.addListener(this.Eh),t.onPointerMove.addListener(this.Mh),t.onPointerLeave.addListener(this.jh)}onDisable(){const t=this.engine.input;t.onKeyDown.removeListener(this.dh),t.onWheel.removeListener(this.Bh),t.onPointerDown.removeListener(this.Pr),t.onPointerUp.removeListener(this.Eh),t.onPointerMove.removeListener(this.Mh),t.onPointerLeave.removeListener(this.jh)}_h(){this.mh&&(this.mh.viewSize=this.Sh)}get minViewSize(){return this.wh}set minViewSize(t){this.wh=t,this.Sh<this.wh&&(this.Sh=this.wh,this._h())}get maxViewSize(){return this.zh}set maxViewSize(t){this.zh=t,this.Sh>this.zh&&(this.Sh=this.zh,this._h())}get mouseMoveButton(){return this.ph}set mouseMoveButton(t){this.ph=t}}class qe extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Xe],this.Zn=null,this.sd=null,this.Ih=1,this.Th=1,this.hd=18,this.rd=10,this.nd=.2,this.od=0,this.dd=new tt(NaN,NaN,NaN)}awake(){const t=new ce;this.sd=this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("grid-renderer",void 0,void 0,new tt(this.nd,this.nd,this.nd)).active(!1).withComponent(ke,(t=>{const e=document.createElement("div");e.style.backgroundImage="                        repeating-linear-gradient(#999 0 1px, transparent 1px 100%),                        repeating-linear-gradient(90deg, #999 0 1px, transparent 1px 100%)",e.style.backgroundSize=this.Ih/this.nd/.1+"px "+this.Th/this.nd/.1+"px",t.elementWidth=this.hd/this.nd,t.elementHeight=this.rd/this.nd,t.pointerEvents=!1,t.element=e,t.viewScale=.1})).getComponent(ke,t)),this.Zn=t.ref}onEnable(){this.sd.exists&&(this.sd.activeSelf=!0)}onDisable(){this.sd.exists&&(this.sd.activeSelf=!1)}update(){const t=this.transform.position,e=1/this.nd/.1,i=this.hd*e/2,s=this.rd*e/2,h=this.Ih*e,r=this.Th*e,n=i%h,o=s%r;if(!t.equals(this.dd)){const i=this.sd.transform.position;i.copy(t),i.z+=this.od,this.Zn.element.style.backgroundPosition=-t.x*e+n+h/2-.5+"px "+(t.y*e+o+r/2-.5)+"px"}}onDestroy(){var t;null===(t=this.sd)||void 0===t||t.destroy()}ad(){const t=this.Zn;t&&(t.element.style.backgroundSize=this.Ih/this.nd/.1+"px "+this.Th/this.nd/.1+"px")}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t,this.ad()}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t,this.ad()}get renderWidth(){return this.hd}set renderWidth(t){this.hd=t,this.Zn&&(this.Zn.elementWidth=this.hd/this.nd)}get renderHeight(){return this.rd}set renderHeight(t){this.rd=t,this.Zn&&(this.Zn.elementHeight=this.rd/this.nd)}get lineWidth(){return.1*this.nd}set lineWidth(t){this.nd=t/.1;const e=this.Zn;e&&(this.ad(),e.elementWidth=this.hd/this.nd,e.elementHeight=this.rd/this.nd,e.gameObject.transform.localScale.setScalar(this.nd))}get zOffset(){return this.od}set zOffset(t){this.od=t}}class Ue extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Xe],this.Or=null,this.Ur=new Ut,this.jr=20,this.qr=1,this.zr=!1,this.Br=!1,this.Er=.1,this.Fr=new tt}start(){if(this.Or){const t=this.Fr.copy(this.Or.transform.position);t.z+=this.jr,this.transform.position.copy(t)}}update(){const t=this.Fr.copy(this.Or.transform.position);t.z+=this.jr,t.x+=this.Ur.x,t.y+=this.Ur.y;const e=this.transform;this.Br?e.position.lerp(t,.1):e.position.copy(t),this.zr&&(e.localPosition.x=Math.round(e.localPosition.x/this.qr)*this.qr,e.localPosition.y=Math.round(e.localPosition.y/this.qr)*this.qr)}setTrackTarget(t){this.Or=t}get targetOffset(){return this.Ur}set targetOffset(t){this.Ur.copy(t)}get cameraDistanceOffset(){return this.jr}set cameraDistanceOffset(t){this.jr=t}get pixelPerfectUnit(){return this.qr}set pixelPerfectUnit(t){this.qr=t}get pixelPerfect(){return this.zr}set pixelPerfect(t){this.zr=t}get lerpTrack(){return this.Br}set lerpTrack(t){this.Br=t}get lerpAlpha(){return this.Er}set lerpAlpha(t){this.Er=t}}class Ve extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[ke],this._dialogUi=null,this._transitionCoroutine=null,this._textAnimationCoroutine=null,this._isShowing=!1,this._maxWidth=10,this._initializeFunction=null,this.onScreenResize=()=>{if(this._dialogUi){const t=this.engine.screen,e=t.width/t.height;this.startCoroutine(this.getViewSize((t=>{const i=2*t;this._dialogUi.elementWidth=Math.min(this._maxWidth,i*e-1)})))}}}awake(){var t;this._dialogUi=this.gameObject.getComponent(ke),this._dialogUi.htmlElementEventHandler.onmousedown=()=>{this.hideUi()},this.onScreenResize(),null===(t=this._initializeFunction)||void 0===t||t.call(this)}onEnable(){this.engine.screen.onResize.addListener(this.onScreenResize)}onDisable(){this.engine.screen.onResize.removeListener(this.onScreenResize)}showMessage(t){this._dialogUi?(this.showUi(),this._textAnimationCoroutine&&this.stopCoroutine(this._textAnimationCoroutine),this._textAnimationCoroutine=this.startCoroutine(this.showTextAnimation(t,.7))):this._initializeFunction=()=>this.showMessage(t)}*showTextAnimation(t,e){let i=0;for(;i<e;)this._dialogUi.element.firstChild.textContent=t.substring(0,Math.floor(i/e*t.length)),yield null,i+=this.engine.time.deltaTime;this._dialogUi.element.firstChild.textContent=t}showUi(){this._isShowing||(this._isShowing=!0,this._transitionCoroutine&&this.stopCoroutine(this._transitionCoroutine),this.startCoroutine(this.getViewSize((t=>{this._transitionCoroutine=this.startCoroutine(this.moveUiAnim(1.5-t))}))))}hideUi(){this._isShowing&&(this._isShowing=!1,this._transitionCoroutine&&this.stopCoroutine(this._transitionCoroutine),this.startCoroutine(this.getViewSize((t=>{this._transitionCoroutine=this.startCoroutine(this.moveUiAnim(-t-1.5))}))))}*getViewSize(t){yield new b((()=>null!==this.engine.cameraContainer.camera)),t(this.engine.cameraContainer.camera.viewSize)}*moveUiAnim(t){let e=0;for(;e<1;)this.transform.localPosition.y=(4,i=e,r(this.transform.localPosition.y,t,1-Math.exp(-4*i))),yield null,e+=this.engine.time.deltaTime;var i;this.transform.localPosition.y=t}}class $e extends Pe{constructor(){super(...arguments),this._target=new ce,this._dialogController=new ce}withTarget(t){return this._target=t,this}getDialogController(t){return this._dialogController=t,this}make(){return this.gameObjectBuilder.withComponent(Xe,(t=>{t.cameraType=Ye.Orthographic})).withComponent(Ge,(t=>{t.mouseMoveButton=0})).withComponent(qe,(t=>{t.renderWidth=50,t.renderHeight=50,t.zOffset=-1,t.enabled=!1})).withComponent(Ue,(t=>{t.setTrackTarget(this._target.ref)})).withChild(this.instantiater.buildGameObject("game-ui",new tt(0,-7,2)).withComponent(ke,(t=>{const e=document.createElement("div");e.style.border="2px solid black",e.style.backgroundColor="rgba(0, 0, 0, 0.5)",e.style.fontFamily="'Press Start 2P', cursive",e.style.fontSize="3px",e.style.color="white",e.style.padding="3px",e.style.boxSizing="border-box",e.textContent="";const i=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.appendChild(i);const s=document.createElement("style");s.textContent="\n                        @keyframes blink {\n                            50% { opacity: 0; }\n                        }\n                    ",e.appendChild(s);const h=document.createElement("div");h.style.fontSize="4px",h.style.color="white",h.style.position="absolute",h.style.bottom="2px",h.style.right="3px",h.textContent="",h.style.animation="blink 1s step-end infinite",e.appendChild(h),t.elementWidth=10,t.elementHeight=2.5,t.element=e})).withComponent(Ve).getComponent(Ve,this._dialogController))}}!function(t){t[t.ObjectFit=0]="ObjectFit",t[t.ClipPath=1]="ClipPath"}(Ne||(Ne={}));class Qe extends ve{constructor(){super(...arguments),this.Aa=Ne.ObjectFit,this.Ga=0,this.Ha=0,this.Xa=!1,this.Ya=!1,this.$a=1,this.gn=xe.Pixelated,this.pa=1,this.Sa=1,this.ka=0,this.qa=0,this.Ba=0,this.Ca=null}renderInitialize(){this.Ca?this.Ca():this.asyncSetImageFromPath(pe.defaultSpriteSrc,1,1)}updateCenterOffset(t){if(this.css3DObject)if(this.Aa===Ne.ObjectFit)this.css3DObject.position.set(this.Ga*this.centerOffset.x,this.Ha*this.centerOffset.y,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject));else{const e=this.ka%this.pa,i=Math.floor(this.ka/this.pa),s=this.Xa?-(this.Ga*this.pa/2-this.Ga/2)+e*this.Ga:this.Ga*this.pa/2-this.Ga/2-e*this.Ga,h=this.Ya?this.Ha*this.Sa/2-this.Ha/2-i*this.Ha:-(this.Ha*this.Sa/2-this.Ha/2)+i*this.Ha;this.css3DObject.position.set(this.Ga*this.centerOffset.x+s,this.Ha*this.centerOffset.y+h,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}updateViewScale(t){if(this.css3DObject)if(this.Aa===Ne.ObjectFit){const e=this.viewScale,i=this.Xa?-1:1,s=this.Ya?-1:1;this.css3DObject.scale.set(this.Ga/this.qa*e*i,this.Ha/this.Ba*e*s,1),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}else{const e=this.viewScale,i=this.htmlElement;i.style.width=this.Ga*this.pa/e+"px",i.style.height=this.Ha*this.Sa/e+"px";const s=this.Xa?-1:1,h=this.Ya?-1:1;this.css3DObject.scale.set(e*s,e*h,e),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}Ja(){if(this.htmlElement)if(this.Aa===Ne.ObjectFit){const t=-this.ka%this.pa*this.qa,e=-Math.floor(this.ka/this.pa)*this.Ba;this.htmlElement.style.objectPosition=t+"px "+e+"px"}else{const t=Math.floor(this.ka/this.pa),e=this.pa-this.ka%this.pa-1;this.htmlElement.style.clipPath="inset("+100/this.Sa*t+"% "+100/this.pa*e+"% "+(100-(100/this.Sa*t+100/this.Sa))+"% "+(100-(100/this.pa*e+100/this.pa))+"%)"}}get image(){return this.htmlElement}asyncSetImageFromPath(t,e,i,s){var h;if(!this.readyToDraw)return void(this.Ca=()=>this.asyncSetImageFromPath(t,e,i,s));const r=null!==(h=this.htmlElement)&&void 0!==h?h:new Image;r.src=t;const n=t=>{this.exists&&(r.removeEventListener("load",n),this.setImage(r,e,i),null==s||s())};r.addEventListener("load",n)}setImage(t,e,i){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.pa=e,this.Sa=i,this.htmlElement=t,t.alt=this.gameObject.name+"_sprite_atlas",t.style.imageRendering=this.gn,t.style.opacity=this.$a.toString(),this.Aa===Ne.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit, for supressing this warning set viewScale to 1."),this.qa=t.naturalWidth/this.pa,this.Ba=t.naturalHeight/this.Sa,0===this.Ga&&(this.Ga=.1*this.qa),0===this.Ha&&(this.Ha=.1*this.Ba),t.style.width=this.qa+"px",t.style.height=this.Ba+"px",t.style.objectFit="none"):(0===this.Ga&&(this.Ga=t.naturalWidth/this.pa*.1),0===this.Ha&&(this.Ha=t.naturalHeight/this.Sa*.1),t.style.width=this.Ga*this.pa/this.viewScale+"px",t.style.height=this.Ha*this.Sa/this.viewScale+"px");const s=this.initializeBaseComponents(!1);this.Ja(),Ft.updateRawObject3DWorldMatrixRecursively(s),this.transform.enqueueRenderAttachedObject3D(s)}get renderMode(){return this.Aa}set renderMode(t){if(this.Aa!==t&&(this.Aa=t,this.htmlElement)){const t=this.htmlElement;this.Aa===Ne.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit"),t.style.clipPath="",this.qa=t.naturalWidth/this.pa,this.Ba=t.naturalHeight/this.Sa,0===this.Ga&&(this.Ga=this.qa),0===this.Ha&&(this.Ha=this.Ba),t.style.width=this.qa+"px",t.style.height=this.Ba+"px",t.style.objectFit="none"):(t.style.objectFit="",t.style.objectPosition="",0===this.Ga&&(this.Ga=t.naturalWidth/this.pa),0===this.Ha&&(this.Ha=t.naturalHeight/this.Sa),t.style.width=this.Ga*this.pa/this.viewScale+"px",t.style.height=this.Ha*this.Sa/this.viewScale+"px"),this.updateViewScale(!1),this.updateCenterOffset(!1),this.Ja(),Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)}}get imageIndex(){return this.ka}set imageIndex(t){this.ka=t,this.Ja(),this.Aa===Ne.ClipPath&&this.updateCenterOffset(!0)}get columnCount(){return this.pa}get rowCount(){return this.Sa}get imageWidth(){return this.Ga}set imageWidth(t){this.Ga=t,this.Aa===Ne.ObjectFit?this.css3DObject&&(this.css3DObject.scale.x=this.Ga/this.qa*this.viewScale,this.css3DObject.scale.x*=this.Xa?-1:1):this.htmlElement&&(this.htmlElement.style.width=t*this.pa/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.Ha}set imageHeight(t){this.Ha=t,this.Aa===Ne.ObjectFit?this.css3DObject&&(this.css3DObject.scale.y=this.Ha/this.Ba*this.viewScale,this.css3DObject.scale.y*=this.Ya?-1:1):this.htmlElement&&(this.htmlElement.style.height=t*this.Sa/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Xa}set imageFlipX(t){this.Xa=t,this.css3DObject&&(this.Xa?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),this.Aa===Ne.ObjectFit?(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.Ja(),this.updateCenterOffset(!0)))}get imageFlipY(){return this.Ya}set imageFlipY(t){this.Ya=t,this.css3DObject&&(this.Ya?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),this.Aa===Ne.ObjectFit?(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.Ja(),this.updateCenterOffset(!0)))}get opacity(){return this.$a}set opacity(t){this.$a=t,this.htmlElement&&(this.htmlElement.style.opacity=this.$a.toString())}get imageRenderingMode(){return this.gn}set imageRenderingMode(t){this.gn=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.gn)}}class Ze extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Qe],this.nl=null,this.ia={},this.sa=null,this.ea=null,this.na=0,this.ra=!1,this.ha=2,this.oa=0,this.aa=null}awake(){this.nl=this.gameObject.getComponent(Qe),null!==this.aa&&(this.playAnimation(this.aa),this.aa=null)}update(){null!==this.nl&&this.ra&&(this.oa+=this.engine.time.deltaTime,this.oa>=this.ha&&(this.oa=0,this.na++,this.na>=this.ea.length&&(this.na=0),this.nl.imageIndex=this.ea[this.na]))}playAnimation(t){null!==this.nl?this.sa!==t&&(this.sa=t,this.ea=this.ia[t],this.na=0,this.nl.imageIndex=this.ia[t][0],this.ra=!0):this.aa=t}stopAnimation(){this.ra=!1,this.aa=null}addAnimation(t,e){0!==e.length?this.ia[t]=e:console.warn(`Animation "${t}" has no frames.`)}get frameDuration(){return this.ha}set frameDuration(t){this.ha=t}}class Ke{constructor(t,e){this.nh=t,this.ah=e,this.Zi=0,this.uh=0,this.lh=0,this.gh=null,this.Ch=!0}calculateFCost(){this.lh=this.Zi+this.uh}equals(t){return this.nh===t.nh&&this.ah===t.ah}get x(){return this.nh}get y(){return this.ah}get gCost(){return this.Zi}set gCost(t){this.Zi=t}get hCost(){return this.uh}set hCost(t){this.uh=t}get fCost(){return this.lh}set fCost(t){this.lh=t}get isWalkable(){return this.Ch}set isWalkable(t){this.Ch=t}get previousNode(){return this.gh}set previousNode(t){this.gh=t}}class Je{constructor(t,e=.5,i=.5,s=1e3){var h;this.mr=null!==(h=null==t?void 0:t.slice())&&void 0!==h?h:[],this.tn=e,this.en=i,this.nn=s}addCollideMap(t){this.mr.push(t)}findPath(t,e){const i=new Ke(t.x,t.y),s=new Ke(e.x,e.y);if(this.on(i.x,i.y))return null;if(this.on(s.x,s.y))return null;const h=[],r=[];i.gCost=0,i.hCost=this.rn(i,s),i.calculateFCost(),h.push(i);let n=0;for(;h.length>0&&n<this.nn;){n++;const t=this.sn(h);if(t.equals(s))return this.hn(t);h.splice(h.indexOf(t),1),r.push(t);const e=this.ln(t);for(let i=0;i<e.length;i++){const n=e[i];if(void 0!==r.find((t=>t.equals(n))))continue;if(n.gCost=Number.MAX_VALUE,n.calculateFCost(),n.previousNode=null,this.on(n.x,n.y)){r.push(n);continue}const o=t.gCost+this.rn(t,n);o<n.gCost&&(n.previousNode=t,n.gCost=o,n.hCost=this.rn(n,s),n.calculateFCost(),void 0===h.find((t=>t.equals(n)))&&h.push(n))}}return null}ln(t){const e=[];return e.push(new Ke(t.x,t.y-1)),e.push(new Ke(t.x+1,t.y)),e.push(new Ke(t.x,t.y+1)),e.push(new Ke(t.x-1,t.y)),e}hn(t){const e=[];let i=t;for(;i.previousNode;)e.push(new Ut(i.x,i.y)),i=i.previousNode;return e.push(new Ut(i.x,i.y)),e.reverse()}rn(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}sn(t){let e=t[0];for(let i=1;i<t.length;i++)t[i].fCost<e.fCost&&(e=t[i]);return e}on(t,e){const i=this.mr;for(let s=0;s<i.length;s++){const h=i[s];if(h.checkCollision(t*h.gridCellWidth+h.gridCenterX,e*h.gridCellHeight+h.gridCenterY,this.tn,this.en))return!0}return!1}}!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(Be||(Be={}));class ti extends ge{constructor(){super(...arguments),this.Do=Be.Down,this.xo=!1}get direction(){return this.Do}set direction(t){this.Do=t}get isMoving(){return this.xo}set isMoving(t){this.xo=t}}class ei extends ti{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Ph=8,this.Th=1,this.Ih=1,this.mr=[],this.Gh=.5,this.Lh=new Ut,this.Rh=new Ut,this.Uh=new Ut,this.Hh=new Ut,this.Kh=new S,this.Oh=new S,this.cr=null,this.gr=null,this.Wh=!1,this.Fh=null,this.qh=0,this.Jh=null,this.Nh=new Ut,this.Qh=!0,this.Xh=new Ut,this.Yh=-1,this.Zh=new Ut,this.$h=.3,this.Pr=t=>{if(0!==t.button)return;this.Wh=!1;const e=this.engine.time.unscaledTime;e-this.Yh<this.$h?this.Zh.equals(t.gridPosition)&&(this.Dr(t),this.Yh=-1):(this.Yh=e,this.Zh.copy(t.gridPosition))}}start(){this.gr=new Je(this.mr,this.Ih*this.Gh,this.Th*this.Gh);const t=this.transform,e=t.position;e.x=this.Lh.x+this.Hh.x*this.Ih,e.y=this.Lh.y+this.Hh.y*this.Th,this.Rh.set(t.localPosition.x,t.localPosition.y);const i=t.parent;i&&this.Nh.set(i.position.x,i.position.y)}update(){var t;null===(t=this.Jh)||void 0===t||t.call(this),this.Qh&&this.Mr(),this.Ar(),this.Vr()}Mr(){if(this.isMoving)return void this.Tr();const t=this.engine.input.map;if(t.get("w")||t.get("ArrowUp")){if(this.direction=Be.Up,this.on(this.Rh.x,this.Rh.y+this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y+this.Th),this.Ir(),this.isMoving=!0}else if(t.get("s")||t.get("ArrowDown")){if(this.direction=Be.Down,this.on(this.Rh.x,this.Rh.y-this.Th))return;this.Uh.set(this.Rh.x,this.Rh.y-this.Th),this.Ir(),this.isMoving=!0}else if(t.get("a")||t.get("ArrowLeft")){if(this.direction=Be.Left,this.on(this.Rh.x-this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x-this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}else if(t.get("d")||t.get("ArrowRight")){if(this.direction=Be.Right,this.on(this.Rh.x+this.Ih,this.Rh.y))return;this.Uh.set(this.Rh.x+this.Ih,this.Rh.y),this.Ir(),this.isMoving=!0}}br(t){const e=this.engine.input.map;return e.get("w")||e.get("ArrowUp")?(this.direction=Be.Up,!this.on(t.x,t.y+this.Th)&&(this.Uh.set(t.x,t.y+this.Th),this.Ir(),!0)):e.get("s")||e.get("ArrowDown")?(this.direction=Be.Down,!this.on(t.x,t.y-this.Th)&&(this.Uh.set(t.x,t.y-this.Th),this.Ir(),!0)):e.get("a")||e.get("ArrowLeft")?(this.direction=Be.Left,!this.on(t.x-this.Ih,t.y)&&(this.Uh.set(t.x-this.Ih,t.y),this.Ir(),!0)):!(!e.get("d")&&!e.get("ArrowRight")||(this.direction=Be.Right,this.on(t.x+this.Ih,t.y)||(this.Uh.set(t.x+this.Ih,t.y),this.Ir(),0)))}Ir(){this.Kh.invoke(Math.floor(this.Uh.x/this.Ih),Math.floor(this.Uh.y/this.Th))}kr(){this.Oh.invoke(Math.floor(this.Rh.x/this.Ih),Math.floor(this.Rh.y/this.Th))}Tr(){const t=this.engine.input.map;(t.get("w")||t.get("ArrowUp")||t.get("s")||t.get("ArrowDown")||t.get("a")||t.get("ArrowLeft")||t.get("d")||t.get("ArrowRight"))&&(this.Wh=!1)}Ar(){if(!this.Wh)return;const t=this.transform,e=this.Xh.set(t.localPosition.x,t.localPosition.y),i=this.Fh[this.qh];if(i.distanceTo(e)<this.Ph*this.engine.time.deltaTime){if(this.qh++,this.qh>=this.Fh.length)return void(this.Wh=!1);this.kr()}if(this.on(i.x,i.y))return void(this.Wh=!1);if(this.Uh.equals(this.Fh[this.qh]))return;this.Uh.copy(this.Fh[this.qh]),this.Ir();const s=this.Fh[this.qh-1].x,h=this.Fh[this.qh-1].y,r=this.Fh[this.qh].x,n=this.Fh[this.qh].y;h<n?this.direction=Be.Up:h>n?this.direction=Be.Down:s<r?this.direction=Be.Right:s>r&&(this.direction=Be.Left),this.isMoving=!0}Vr(){if(!this.isMoving)return;const t=this.transform,e=new Ut(t.localPosition.x,t.localPosition.y);let i=e.distanceTo(this.Uh);if(i<this.Ph*this.engine.time.deltaTime&&this.br(this.Uh)&&(i=e.distanceTo(this.Uh),this.kr()),i>.01){const s=this.Xh.copy(this.Uh).sub(e).normalize();s.multiplyScalar(Math.min(this.Ph*this.engine.time.deltaTime,i)),t.localPosition.x+=s.x,t.localPosition.y+=s.y}else this.isMoving=!1,this.Rh.copy(this.Uh),t.localPosition.x=this.Rh.x,t.localPosition.y=this.Rh.y,this.kr()}on(t,e){t+=this.Nh.x,e+=this.Nh.y;for(let i=0;i<this.mr.length;i++)if(this.mr[i].checkCollision(t,e,this.Gh,this.Gh))return!0;return!1}Dr(t){if(this.Wh)return this.Wh=!1,void(this.Jh=()=>{this.tryStartPathfind(t.gridPosition)});this.Jh=()=>{this.tryStartPathfind(t.gridPosition)}}tryStartPathfind(t){return!(this.Wh||(this.Jh=null,this.Fh=this.gr.findPath(this.positionInGrid,t),!this.Fh||this.Fh.length<=1||(this.Fh.forEach((t=>{t.x=t.x*this.Ih+this.Lh.x,t.y=t.y*this.Th+this.Lh.y})),this.qh=1,this.isMoving=!0,this.Wh=!0,0)))}cancelPathfind(){this.Wh=!1}get onMoveToTarget(){return this.Kh}get onMovedToTarget(){return this.Oh}teleport(t){this.isMoving=!1,this.Wh=!1,this.Uh.copy(t),this.Rh.copy(t),this.transform.localPosition.x=this.Rh.x,this.transform.localPosition.y=this.Rh.y,this.Ir(),this.kr()}get speed(){return this.Ph}set speed(t){this.Ph=t}get gridCenter(){return this.Lh}set gridCenter(t){this.Lh.copy(t)}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}set initPosition(t){this.Hh.copy(t)}set gridPointer(t){this.cr&&this.cr.onPointerDown.removeListener(this.Pr),this.cr=t,this.cr&&this.cr.onPointerDown.addListener(this.Pr)}get gridPointer(){return this.cr}addCollideMap(t){var e;this.mr.push(t),null===(e=this.gr)||void 0===e||e.addCollideMap(t)}setGridInfoFromCollideMap(t){this.Ih=t.gridCellWidth,this.Th=t.gridCellHeight,this.Lh.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new Ut(Math.floor(this.transform.localPosition.x/this.Ih),Math.floor(this.transform.localPosition.y/this.Th))}get receiveKeyboardInput(){return this.Qh}set receiveKeyboardInput(t){this.Qh=t}}class ii extends ge{constructor(){super(...arguments),this._disallowMultipleComponent=!0,this._requiredComponents=[ti,Ze],this.Dh=null,this.Ah=null,this.kh=Be.Down,this.yh=!1}awake(){this.Dh=this.gameObject.getComponent(ti),this.Ah=this.gameObject.getComponent(Ze)}update(){const t=this.Dh.direction,e=this.Dh.isMoving;e?t===Be.Up?this.yh===e&&this.kh===t||(this.Ah.playAnimation("up_walk"),this.yh=e,this.kh=t):t===Be.Down?this.yh===e&&this.kh===t||(this.Ah.playAnimation("down_walk"),this.yh=e,this.kh=t):t===Be.Left?this.yh===e&&this.kh===t||(this.Ah.playAnimation("left_walk"),this.yh=e,this.kh=t):t===Be.Right&&(this.yh===e&&this.kh===t||(this.Ah.playAnimation("right_walk"),this.yh=e,this.kh=t)):t===Be.Up?this.yh===e&&this.kh===t||(this.Ah.playAnimation("up_idle"),this.yh=e,this.kh=t):t===Be.Down?this.yh===e&&this.kh===t||(this.Ah.playAnimation("down_idle"),this.yh=e,this.kh=t):t===Be.Left?this.yh===e&&this.kh===t||(this.Ah.playAnimation("left_idle"),this.yh=e,this.kh=t):t===Be.Right&&(this.yh===e&&this.kh===t||(this.Ah.playAnimation("right_idle"),this.yh=e,this.kh=t))}}class si extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[ei],this.Gh=.5,this.eo=null,this.so=[],this.ho=(t,e)=>{const i=this.eo.gridCenter,s=this.eo.gridCellWidth,h=this.eo.gridCellHeight,r=i.x+t*s,n=i.y+e*h;this.so.forEach((t=>{t.tryInvokeEvent(r,n,this.Gh,this.Gh,this.gameObject)}))}}awake(){this.eo=this.gameObject.getComponent(ei),this.eo.onMoveToTarget.addListener(this.ho)}onDestroy(){this.eo.onMoveToTarget.removeListener(this.ho)}addGridEventMap(t){this.so.push(t)}}class hi extends ze{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.rl=0,this.Za=!0}start(){this.update(),this.Za&&this.destroy()}update(){const t=this.transform.position;t.z=-t.y+this.rl}get offset(){return this.rl}set offset(t){this.rl=t}get runOnce(){return this.Za}set runOnce(t){this.Za=t}}const ri=t.p+"assets/char_spritesheet.png";class ni extends ge{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[ti],this._collideSize=.5,this._tileWidth=1,this._tileHeight=1,this._gridEventMaps=[],this._directionable=null,this.onKeyDown=t=>{if("e"!==t.key.toLowerCase())return;const e=this.gameObject.transform.position;let i,s;switch(this._directionable.direction){case Be.Up:i=0,s=this._tileHeight;break;case Be.Down:i=0,s=-this._tileHeight;break;case Be.Left:i=-this._tileWidth,s=0;break;case Be.Right:i=this._tileWidth,s=0}for(let t=0;t<this._gridEventMaps.length;t++)this._gridEventMaps[t].tryInvokeEvent(e.x+i,e.y+s,this._collideSize,this._collideSize,this.gameObject)}}awake(){this._directionable=this.gameObject.getComponent(ti)}onEnable(){this.engine.input.onKeyDown.addListener(this.onKeyDown)}onDisable(){this.engine.input.onKeyDown.removeListener(this.onKeyDown)}addGridEventMap(t){this._gridEventMaps.push(t)}}class oi extends Pe{constructor(){super(...arguments),this._collideMaps=[],this._gridPointer=new ce,this._gridPosition=new ce,this._gridEventMap=new ce}withCollideMap(t){return this._collideMaps.push(t),this}withGridPointer(t){return this._gridPointer=t,this}withGridPosition(t){return this._gridPosition=t,this}withGridEventMap(t){return this._gridEventMap=t,this}make(){return this.gameObjectBuilder.withComponent(Qe,(t=>{t.asyncSetImageFromPath(ri,26,23),t.imageWidth=1,t.imageHeight=1,t.viewScale=1,t.filter.brightness=1.2})).withComponent(Ze,(t=>{t.addAnimation("down_walk",[27,28,29,30,31,32]),t.addAnimation("left_walk",[53,54,55,56,57,58]),t.addAnimation("right_walk",[79,80,81,82,83,84]),t.addAnimation("up_walk",[105,106,107,108,109,110]),t.addAnimation("down_idle",[34,35,36,37,38,39]),t.addAnimation("left_idle",[60,61,62,63,64,65]),t.addAnimation("right_idle",[86,87,88,89,90,91]),t.addAnimation("up_idle",[112,113,114,115,116,117]),t.addAnimation("down_hit",[41,42,43]),t.addAnimation("left_hit",[67,68,69]),t.addAnimation("right_hit",[93,94,95]),t.addAnimation("up_hit",[119,120,121]),t.addAnimation("down_push",[45,46,47,48,49,50]),t.addAnimation("left_push",[71,72,73,74,75,76]),t.addAnimation("right_push",[97,98,99,100,101,102]),t.addAnimation("up_push",[123,124,125,126,127,128]),t.addAnimation("down_climb",[157,158,159,160,161,162]),t.addAnimation("up_climb",[183,184,185,186,187,188]),t.addAnimation("down_shield_hit",[168,169,170,171,172]),t.addAnimation("left_shield_hit",[194,195,196,197,198]),t.addAnimation("right_shield_hit",[220,221,222,223,224]),t.addAnimation("up_shield_hit",[246,247,248,249,250]),t.addAnimation("down_shield",[174]),t.addAnimation("left_shield",[200]),t.addAnimation("right_shield",[226]),t.addAnimation("up_shield",[252]),t.addAnimation("death_all_air",[235,236,237,238,239,240,241,242,243,244]),t.addAnimation("falling_all_air",[287,288,289,290,291,292]),t.frameDuration=.1,t.playAnimation("down_idle")})).withComponent(ei,(t=>{t.speed=4;for(const e of this._collideMaps)e.ref&&t.addCollideMap(e.ref);t.gridPointer=this._gridPointer.ref,this._gridPosition.ref&&(t.initPosition=this._gridPosition.ref)})).withComponent(ii).withComponent(si,(t=>{this._gridEventMap.ref&&t.addGridEventMap(this._gridEventMap.ref)})).withComponent(ni,(t=>{this._gridEventMap.ref&&t.addGridEventMap(this._gridEventMap.ref)})).withComponent(hi,(t=>{t.runOnce=!1,t.offset=.5}))}}class ai extends Pe{constructor(){super(...arguments),this._planeSize=null}withPlaneSize(t){return this._planeSize=t,this}make(){return this.gameObjectBuilder.withComponent(Ae,(t=>{t.offset=-100})).withComponent(Oe,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,Re.loadImageFromPath(We).then((e=>{var i,s;if(!t.exists)return;t.imageSources=[new _e(e,18,13)];const h={i:0,a:24},r=null!==(s=null===(i=this._planeSize)||void 0===i?void 0:i.ref)&&void 0!==s?s:51,n=[];for(let t=0;t<r;t++){n[t]=[];for(let e=0;e<r;e++)n[t][e]=h}const o=Math.floor(r/2);t.drawTileFromTwoDimensionalArray(n,-o,-o)}))}))}}class li extends ge{constructor(){super(...arguments),this.$n=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.lo=!1,this.ao=new Map,this.an=!1,this.Hr=[],this.Wr=!1}start(){this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[]}onEnable(){this.Rr&&!this.lo&&(this.fo(),this.lo=!0),this.an=!0}onDisable(){this.do(),this.lo=!1,this.an=!1}addCollider(t,e){this.Wr?this.$n.has(`${t}_${e}`)||(this.$n.set(`${t}_${e}`,!0),this.Rr&&this.yr(t*this.gridCellWidth,e*this.gridCellHeight)):this.Hr.push((()=>{this.addCollider(t,e)}))}addColliderFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)1===t[s][h]&&this.addCollider(h+e,t.length-(s+i));else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,e,i)}))}removeCollider(t,e){this.Wr?(this.$n.delete(`${t}_${e}`),this.Rr&&this.uo(t*this.gridCellWidth,e*this.gridCellHeight)):this.Hr.push((()=>{this.removeCollider(t,e)}))}removeAllColliders(){this.$n.clear(),this.do()}fo(){this.$n.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.yr(i*this.gridCellWidth,s*this.gridCellHeight)}))}do(){this.ao.forEach((t=>{t.destroy()})),this.ao.clear()}yr(t,e){const i=new ce;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new tt(t,e,41e4)).withComponent(Me,(t=>{t.opacity=.5,t.pointerEvents=!1,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(i)),this.ao.set(`${t}_${e}`,i.ref)}uo(t,e){const i=this.ao.get(`${t}_${e}`);i&&(i.destroy(),this.ao.delete(`${t}_${e}`))}checkCollision(t,e,i,s){if(!this.an)return!1;const h=this.transform.position;t-=h.x,e-=h.y;const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+i)/this.gridCellWidth),o=Math.floor(e/this.gridCellHeight),a=Math.floor((e+s)/this.gridCellHeight);for(let t=o;t<=a;t++)for(let e=r;e<=n;e++)if(this.$n.get(`${e}_${t}`))return!0;return!1}getCollidersToArray(){const t=[];return this.$n.forEach(((e,i)=>{const[s,h]=i.split("_").map(Number);t.push(new Ut(s,h))})),t}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showCollider(){return this.Rr}set showCollider(t){this.Rr!==t&&(this.Rr=t,this.Rr&&!this.lo?(this.fo(),this.lo=!0):(this.do(),this.lo=!1))}get gridCenter(){const t=this.transform.position;return new Ut(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}class ci extends ge{constructor(){super(...arguments),this.$n=new Map,this.Ih=1,this.Th=1,this.Rr=!1,this.lo=!1,this.ao=new Map,this.an=!1,this.Hr=[],this.Wr=!1}start(){this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[]}onEnable(){this.Rr&&!this.lo&&(this.fo(),this.lo=!0),this.an=!0}onDisable(){this.do(),this.lo=!1,this.an=!1}addCollider(t,e){if(!this.Wr)return void this.Hr.push((()=>{this.addCollider(t,e)}));const i=this.$n.get(`${t}_${e}`);this.$n.set(`${t}_${e}`,void 0===i?1:i+1),this.Rr&&this.yr(t*this.gridCellWidth,e*this.gridCellHeight)}addColliderFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)1===t[s][h]&&this.addCollider(h+e,t.length-(s+i));else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,e,i)}))}removeCollider(t,e){const i=this.$n.get(`${t}_${e}`);void 0!==i&&(1===i?this.$n.delete(`${t}_${e}`):this.$n.set(`${t}_${e}`,i-1),this.Rr&&this.uo(t*this.gridCellWidth,e*this.gridCellHeight))}fo(){this.$n.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.yr(i*this.gridCellWidth,s*this.gridCellHeight)}))}do(){this.ao.forEach((t=>{t.destroy()})),this.ao.clear()}yr(t,e){const i=new ce;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new tt(t,e,41e4)).withComponent(Me,(t=>{t.opacity=.5,t.pointerEvents=!1,t.imageWidth=this.gridCellWidth,t.imageHeight=this.gridCellHeight})).getGameObject(i)),this.ao.set(`${t}_${e}`,i.ref)}uo(t,e){const i=this.ao.get(`${t}_${e}`);i&&(i.destroy(),this.ao.delete(`${t}_${e}`))}checkCollision(t,e,i,s){if(!this.an)return!1;const h=this.transform.position;t-=h.x,e-=h.y;const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+i)/this.gridCellWidth),o=Math.floor(e/this.gridCellHeight),a=Math.floor((e+s)/this.gridCellHeight);for(let t=o;t<=a;t++)for(let e=r;e<=n;e++){const i=this.$n.get(`${e}_${t}`);if(void 0!==i&&i>0)return!0}return!1}get gridCellWidth(){return this.Ih}set gridCellWidth(t){this.Ih=t}get gridCellHeight(){return this.Th}set gridCellHeight(t){this.Th=t}get showCollider(){return this.Rr}set showCollider(t){this.Rr!==t&&(this.Rr=t,this.Rr&&!this.lo?(this.fo(),this.lo=!0):(this.do(),this.lo=!1))}get gridCenter(){const t=this.transform.position;return new Ut(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}class di extends Pe{constructor(){super(...arguments),this._collideMap=new ce,this._objectCollideMap=new ce}getCollideMap(t){return this._collideMap=t,this}getObjectCollideMap(t){return this._objectCollideMap=t,this}make(){return this.gameObjectBuilder.withComponent(li,(t=>{t.showCollider=!1;for(let e=-13;e<=13;e++)t.addCollider(13,e),t.addCollider(e,13),t.addCollider(-13,e),t.addCollider(e,-13)})).withComponent(ci,(t=>{t.showCollider=!1})).getComponent(li,this._collideMap).getComponent(ci,this._objectCollideMap)}}class ui extends Ee{constructor(){super(...arguments),this.$n=new Map,this.an=!1}onEnable(){super.onEnable(),this.an=!0}onDisable(){super.onDisable(),this.an=!1}drawTile(t,e,i,s){super.drawTile(t,e,i,s);const h=Math.ceil(t-this.columnCount/2),r=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this.$n.set(`${h}_${r}`,!0)}drawTileFromTwoDimensionalArray(t,e,i){super.drawTileFromTwoDimensionalArray(t,e,i);for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)if(null!==t[s][h]){const t=Math.ceil(this.transform.localPosition.x/this.gridCellWidth+(h+e)-this.columnCount/2),r=Math.ceil(this.transform.localPosition.y/this.gridCellHeight+(this.rowCount-(s+i))-this.rowCount/2)-1;this.$n.set(`${t}_${r}`,!0)}}clearTile(t,e){super.clearTile(t,e);const i=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this.$n.delete(`${i}_${s}`)}addCollider(t,e){const i=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this.$n.set(`${i}_${s}`,!0)}checkCollision(t,e,i,s){if(!this.an)return!1;const h=this.transform.position;t-=h.x,e-=h.y,this.columnCount%2==0&&(t-=this.gridCellWidth),this.rowCount%2==0&&(e-=this.gridCellHeight),this.rowCount%2==0&&(e+=this.gridCellHeight/2),this.columnCount%2==0&&(t+=this.gridCellWidth/2);const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+i)/this.gridCellWidth),o=Math.floor(e/this.gridCellHeight),a=Math.floor((e+s)/this.gridCellHeight);for(let t=o;t<=a;t++)for(let e=r;e<=n;e++)if(!0===this.$n.get(`${e}_${t}`))return!0;return!1}}class mi extends ge{constructor(){super(...arguments),this.Xr=new Map,this.Yr=16,this.Kr=1,this.Jr=1,this.Lr=16,this.Qr=16,this.Zr=1.001,this.cn=null,this.un=!0,this.an=!1,this.dn=.1,this.gn=xe.Pixelated,this.fn=()=>{this.Xr.forEach(((t,e)=>{t.filter.copy(this.Ui)}))},this.Ui=new Ce(this.fn),this.Hr=[],this.Wr=!1}start(){this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[]}onEnable(){this.an=!0}onDisable(){this.an=!1}pn(){this.Xr.forEach(((t,e)=>{const i=this.mn(e)*this.Yr*this.Kr,s=this.Cn(e)*this.Yr*this.Jr;t.gameObject.transform.localPosition.set(i,s,0)}))}mn(t){return parseInt(t.substring(0,t.indexOf("_")))}Cn(t){return parseInt(t.substring(t.indexOf("_")+1))}_n(t,e){return`${t}_${e}`}Rn(t,e,i,s){const h=i-t*this.Yr+this.Yr/2,r=s-e*this.Yr+this.Yr/2;return new Ut(h,r)}Mn(t,e){const i=this._n(t,e);let s=this.Xr.get(i);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject(`css_tilemap_renderer_${t}_${e}`,new tt(t*this.Yr*this.Kr,e*this.Yr*this.Jr,0),void 0,(new tt).setScalar(this.Zr)).withComponent(ui,(t=>{s=t,this.cn&&(t.imageSources=this.cn),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Jr,t.tileResolutionX=this.Lr,t.tileResolutionY=this.Qr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.un,t.viewScale=this.dn,t.filter.copy(this.Ui)}))),this.Xr.set(i,s)),s}wn(t,e){const i=this._n(t,e),s=this.Xr.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this.Wr)return void this.Hr.push((()=>{this.drawTile(t,e,i,s)}));const h=Math.floor((t+this.Yr/2)/this.Yr),r=Math.floor((e+this.Yr/2)/this.Yr),n=this.Mn(h,r),o=this.Rn(h,r,t,e),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;n.drawTile(o.x+a,this.Yr-o.y-1+l,i,s)}drawTileFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)null!==t[s][h]&&this.drawTile(h+e,t.length-s+i-1,t[s][h].i,t[s][h].a);else this.Hr.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this.Wr)return void this.Hr.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this.Yr/2)/this.Yr),s=Math.floor((e+this.Yr/2)/this.Yr),h=this.wn(i,s);if(null===h)return;const r=this.Rn(i,s,t,e),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Yr-r.y-1+o)}addCollider(t,e){if(!this.Wr)return void this.Hr.push((()=>{this.addCollider(t,e)}));const i=Math.floor((t+this.Yr/2)/this.Yr),s=Math.floor((e+this.Yr/2)/this.Yr),h=this.Mn(i,s),r=this.Rn(i,s,t,e),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.addCollider(r.x+n,this.Yr-r.y-1+o)}checkCollision(t,e,i,s){if(!this.an)return!1;const h=this.transform.position,r=Math.floor(((t-h.x)/this.Kr+this.Yr/2)/this.Yr),n=Math.floor(((e-h.y)/this.Jr+this.Yr/2)/this.Yr),o=this._n(r,n),a=this.Xr.get(o);return void 0!==a&&a.checkCollision(t,e,i,s)}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.Wr?this.cn=t:this.Hr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.un}set pointerEvents(t){this.un=t,this.Xr.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Jr}set gridCellHeight(t){this.Jr!==t&&(this.Jr=t,this.pn(),this.Xr.forEach(((t,e)=>{t.gridCellHeight=this.Jr})))}get tileResolutionX(){return this.Lr}set tileResolutionX(t){this.Lr!==t&&(this.Lr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionX=this.Lr})))}get tileResolutionY(){return this.Qr}set tileResolutionY(t){this.Qr!==t&&(this.Qr=t,this.Xr.forEach(((t,e)=>{t.tileResolutionY=this.Qr})))}get tilemapScale(){return this.Zr}set tilemapScale(t){this.Zr!==t&&(this.Zr=t,this.Xr.forEach(((t,e)=>{t.gameObject.transform.localScale.setScalar(this.Zr)})))}get gridCenter(){const t=this.transform.position,e=this.Yr%2==1?0:this.Kr/2,i=this.Yr%2==1?0:this.Jr/2;return new Ut(t.x+e,t.y+i)}get gridCenterX(){const t=this.transform.position,e=this.Yr%2==1?0:this.Kr/2;return t.x+e}get gridCenterY(){const t=this.transform.position,e=this.Yr%2==1?0:this.Jr/2;return t.y+e}get viewScale(){return this.dn}set viewScale(t){this.dn=t,this.Xr.forEach(((t,e)=>{t.viewScale=this.dn}))}get filter(){return this.Ui}get imageRenderingMode(){return this.gn}set imageRenderingMode(t){this.gn=t,this.Xr.forEach(((e,i)=>{e.imageRenderingMode=t}))}}class gi{static map(t,e){const i=[];for(let s=0;s<t.length;++s){const h=[],r=t[s];for(let t=0;t<r.length;++t){const i=r[t];h.push(e[i](t,s))}i.push(h)}return i}}class pi extends Pe{constructor(){super(...arguments),this._collideTilemap=new ce}getCollideTilemap(t){return this._collideTilemap=t,this}make(){return this.gameObjectBuilder.withComponent(Ae,(t=>{t.offset=-98})).withComponent(mi,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,Re.loadImageFromPath(We).then((e=>{if(!t.exists)return;function i(t){return{i:0,a:t}}t.imageSources=[new _e(e,18,13)];const s={o:()=>i(93),O:()=>i(94),"#":()=>i(61),"@":()=>i(75),$:()=>i(76),"*":()=>i(58),"^":()=>i(59)," ":()=>null};t.drawTileFromTwoDimensionalArray(gi.map(["              ","   $          ","    #         ","              ","              "],s),-3,4),t.drawTileFromTwoDimensionalArray(gi.map(["             ","          o  ","         @   ","     #       ","             ","             ","O            "],s),-7,-8)}))})).withComponent(Oe,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,Re.loadImageFromPath(We).then((e=>{if(!t.exists)return;function i(t){return{i:0,a:t}}t.imageSources=[new _e(e,18,13)];const s={:()=>i(47),:()=>i(46),:()=>i(11),:()=>i(29),:()=>i(44),:()=>i(45),:()=>i(62),:()=>i(63),:()=>i(8),:()=>i(26),:()=>i(9),:()=>i(27),:()=>i(28),:()=>i(10),:()=>null};t.drawTileFromTwoDimensionalArray(gi.map(["","","",""],s),-3,4),t.drawTileFromTwoDimensionalArray(gi.map(["","","",""],s),-8,-1),t.drawTileFromTwoDimensionalArray(gi.map(["","","","","",""],s),-5,-8),t.drawTileFromTwoDimensionalArray(gi.map(["","","","","",""],s),-5,-15);const h={"^":()=>i(56),"%":()=>i(57),"*":()=>i(72),"&":()=>i(73),"!":()=>i(90),"~":()=>i(91),o:()=>i(74),O:()=>i(92)," ":()=>null};t.drawTileFromTwoDimensionalArray(gi.map(["     ^","","^ %  ~*"],h),3,4),t.drawTileFromTwoDimensionalArray(gi.map(["O%    ^"," ^","","^  %"],h),1,-1),t.drawTileFromTwoDimensionalArray(gi.map(["%     ^"," ","      *~","    % !~","     !**","o   !**~"],h),-2,-8)}))})).getComponent(mi,this._collideTilemap)}}const fi={i:0,a:4},yi={i:0,a:5},wi={i:0,a:7},Ci={i:0,a:22},vi={i:0,a:25},xi={i:0,a:40},bi={i:0,a:41},Mi={i:0,a:43};class _i{static make(t,e,i,s){const h=Array(e);for(let i=0;i<e;i++){h[i]=Array(t);for(let e=0;e<t;e++)h[i][e]=null}h[0][0]=fi;for(let e=1;e<t-1;e++)h[0][e]=yi;h[0][t-1]=wi;for(let i=1;i<e-1;i++)h[i][0]=Ci,h[i][t-1]=vi;h[e-1][0]=xi;for(let i=1;i<t-1;i++)h[e-1][i]=bi;return h[e-1][t-1]=Mi,null!==i&&(h[0][i]=null),null!==s&&(h[e-1][s]=null),h}static computeEntryPosition(t,e,i,s,h){return{top:null!==e?new Ut(s+e,h+t-1):null,bottom:null!==i?new Ut(s+i,h):null}}}class Ei extends Pe{constructor(){super(...arguments),this._collideTilemap=new ce}getCollideTilemap(t){return this._collideTilemap=t,this}make(){return this.gameObjectBuilder.withComponent(Ae,(t=>{t.offset=-99})).withComponent(mi,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,Re.loadImageFromPath(We).then((e=>{if(t.exists){t.imageSources=[new _e(e,18,13)];for(const e of Ei._islandList)t.drawTileFromTwoDimensionalArray(_i.make(e.width,e.height,e.topEntry,e.bottomEntry),e.x,e.y)}}))})).withComponent(Oe,(t=>{t.chunkSize=15,t.filter.brightness=1.5,t.tileResolutionX=16,t.tileResolutionY=16,Re.loadImageFromPath(We).then((e=>{if(t.exists){t.imageSources=[new _e(e,18,13)];for(const e of Ei._islandList){const i=_i.computeEntryPosition(e.height,e.topEntry,e.bottomEntry,e.x,e.y);i.top&&t.drawTile(i.top.x,i.top.y,0,6),i.bottom&&t.drawTile(i.bottom.x,i.bottom.y,0,42)}}}))})).getComponent(mi,this._collideTilemap)}}Ei._islandList=[{width:16,height:6,topEntry:1,bottomEntry:2,x:-4,y:3},{width:15,height:8,topEntry:8,bottomEntry:3,x:-8,y:-9}];class Oi extends ge{constructor(){super(...arguments),this.$n=new Map,this.co=!1,this.po=!1,this.ao=new Map,this.mo=null,this._o=!1,this.Hr=[],this.Wr=!1}start(){if(this.Wr=!0,this.Hr.forEach((t=>t())),this.Hr=[],!this.mo)throw new Error("GridCollider: gridObjectCollideMap must be set")}onEnable(){this.co&&!this.po&&(this.fo(),this.po=!0),this.Co()}onDisable(){this.co&&(this.do(),this.po=!1),this._o&&this.Mo()}onDestroy(){this.do(),this.Mo()}addCollider(t,e){this.Wr?this.$n.has(`${t}_${e}`)||(this.$n.set(`${t}_${e}`,!0),this.co&&this.yr(t,e),this.gridObjectCollideMap&&this.bo(t,e)):this.Hr.push((()=>{this.addCollider(t,e)}))}addColliderFromTwoDimensionalArray(t,e,i){if(this.Wr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)1===t[s][h]&&this.addCollider(h+e,t.length-s-1+i);else this.Hr.push((()=>{this.addColliderFromTwoDimensionalArray(t,e,i)}))}removeCollider(t,e){this.Wr?(this.$n.delete(`${t}_${e}`),this.co&&this.uo(t,e),this.gridObjectCollideMap&&this.vo(t,e)):this.Hr.push((()=>{this.removeCollider(t,e)}))}fo(){this.$n.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.yr(i,s)}))}do(){this.ao.forEach((t=>{t.destroy()})),this.ao.clear()}yr(t,e){if(!this.mo)return;const i=this.mo.gridCellWidth,s=this.mo.gridCellHeight,h=t*i,r=e*s,n={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debug-image",new tt(h,r,41e4)).withComponent(Me,(t=>{t.opacity=.5,t.imageWidth=i,t.imageHeight=s})).getGameObject(n)),this.ao.set(`${t}_${e}`,n.ref)}uo(t,e){const i=this.ao.get(`${t}_${e}`);i&&(i.destroy(),this.ao.delete(`${t}_${e}`))}bo(t,e){if(!this.mo)return;const i=this.transform.position,s=this.mo.gridCellWidth,h=this.mo.gridCellHeight,r=this.mo.gridCenter,n=Math.floor(t+(i.x+r.x)/s),o=Math.floor(e+(i.y+r.y)/h);this.mo.addCollider(n,o)}Co(){if(!this.mo)return;const t=this.transform.position,e=this.mo.gridCellWidth,i=this.mo.gridCellHeight,s=this.mo.gridCenter;this.$n.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),a=Math.floor(n+t.x/e+s.x),l=Math.floor(o+t.y/i+s.y);this.mo.addCollider(a,l)}))}vo(t,e){if(!this.mo)return;const i=this.transform.position,s=this.mo.gridCellWidth,h=this.mo.gridCellHeight,r=this.mo.gridCenter,n=Math.floor(t+(i.x+r.x)/s),o=Math.floor(e+(i.y+r.y)/h);this.mo.removeCollider(n,o)}Mo(){if(!this.mo)return;const t=this.transform.position,e=this.mo.gridCellWidth,i=this.mo.gridCellHeight,s=this.mo.gridCenter;this.$n.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),a=Math.floor(n+(t.x+s.x)/e),l=Math.floor(o+(t.y+s.y)/i);this.mo.removeCollider(a,l)}))}get gridObjectCollideMap(){return this.mo}set gridObjectCollideMap(t){this._o&&this.Mo(),this.mo=t,this.Co(),this._o=!0,this.mo&&this.co&&(this.do(),this.fo())}get showCollideSpot(){return this.co}set showCollideSpot(t){this.co!==t&&(this.co=t,this.co&&!this.po?(this.fo(),this.po=!0):(this.do(),this.po=!1))}}class Si extends Pe{constructor(){super(...arguments),this._objectCollideMap=new ce}withObjectCollideMap(t){return this._objectCollideMap=t,this}make(){return this.gameObjectBuilder.withComponent(hi).withComponent(Qe,(t=>{t.viewScale=1,this.rendererInitializer(t)})).withComponent(Oi,(t=>{this._objectCollideMap.ref&&(t.gridObjectCollideMap=this._objectCollideMap.ref),this.colliderInitializer(t)}))}}class Di extends Si{rendererInitializer(t){t.asyncSetImageFromPath("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAQCAYAAACBSfjBAAACRklEQVRYhe2WwWoTURRAz0xSYiNCFyWrIBREHdAsfNUgQkLTbiwSP6C1Ej+hH+LeLgwUXdiVi+LOFFchmCkli44bJWp0MUixBtIUMo6rFyfJZDKZhKRY7yaPcM899933ZhL4H33jcCtrTxY8Y/Gv7CNwTGsAY/GOWuRwK2uPo8Yo/CRCdfvyLDUepBd5eKPswy/vOkAALZsayy36uvtkaEZ6tWwqsFeyQQ/Ab27fATqbABBC2EIIX4Xl5rVsivr3H/awfLc7CN9dI4hfXiIvPuwGP3r2jXL271oIYW9uPMC0YgC2ruuKl9yNX19r38RA/LT9/fieQkIIO3M5xKXZC9ROLeKREAD1kybzV26yUzjAqwEv/tf8Hcr7xcD8tP1uvOIE5frhtYsA1E4tAOKREPWTJoUvVlvU3cQk+GN1Br3anJrfjQ9LePHWXa5rGrGQycfSnrN2u/nNjfuYVowPhgGOq+zkAfTX21yNR9p80TjCVCPIx8CL9/KnUyto9wb76+VXrvz62uOB/mH7V5M5rT35Fy+fd0hlHKszJG4sYlqxjpxkTrP78UXjCL3aRK82MdUIy0urPTle/Kj+bn5uITOU32//SjKn2a1KFIBwokGrEuV2WuH35wjp1AoAtVqNncJBR45cA3Tz8tN5YuX9om9+2v5heLWUN5RwotEuFk40eP/OZm4hg2nFeLq9y6efsx1CmV/KG4ob36pEXU/MLz9t/zB8z6+RvJHLS6u83XvTM/FS3vD8C3DeeNdizveCMwbJzyP/B2dywkbQ/oNoAAAAAElFTkSuQmCC",5,1),t.imageWidth=1,t.imageHeight=1}colliderInitializer(t){t.addColliderFromTwoDimensionalArray([[1]],0,0)}make(){return super.make().withComponent(Ze,(t=>{t.addAnimation("anim",[0,1,2,3,4]),t.frameDuration=.1,t.playAnimation("anim")}))}}class Ti extends Si{rendererInitializer(t){t.asyncSetImageFromPath(We,3,2.6),t.imageIndex=2,t.imageWidth=6,t.imageHeight=5,t.centerOffset=new Ut(0,.45),t.filter.brightness=1.5}colliderInitializer(t){t.addColliderFromTwoDimensionalArray([[1,1,1,1],[1,1,1,1,1]],-2,1)}}class ki extends Si{rendererInitializer(t){t.asyncSetImageFromPath(We,1,1),t.imageIndex=0,t.imageWidth=5,t.imageHeight=4,t.centerOffset=new Ut(0,.453),t.filter.brightness=1.5}colliderInitializer(t){t.addColliderFromTwoDimensionalArray([[1,1,1,1,1],[1,1,1,1,1]],-2,1)}}class ji extends Si{rendererInitializer(t){t.asyncSetImageFromPath(We,9,13/3),t.imageIndex=28.5,t.imageWidth=2,t.imageHeight=3,t.centerOffset=new Ut(0,.3),t.filter.brightness=1.5}colliderInitializer(t){t.addColliderFromTwoDimensionalArray([[1]],0,1)}}class zi extends Si{rendererInitializer(t){t.asyncSetImageFromPath(We,9,13/3),t.imageIndex=29.5,t.imageWidth=2,t.imageHeight=3,t.centerOffset=new Ut(0,.3),t.filter.brightness=1.5}colliderInitializer(t){t.addColliderFromTwoDimensionalArray([[1]],0,1)}}class Ai extends Pe{constructor(){super(...arguments),this._objectCollideMap=new ce}withObjectCollideMap(t){return this._objectCollideMap=t,this}make(){const t=this.instantiater;return this.gameObjectBuilder.withChild(t.buildPrefab("tree1",ji,new tt(0,2,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("tree1",ji,new tt(-5,2,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("tree1",ji,new tt(-7,3,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("tree2",zi,new tt(2,-1,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("tree2",zi,new tt(9,7,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("tree2",zi,new tt(10,6,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("house1",Ti,new tt(5,6,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("house2",ki,new tt(-5,-5,0)).withObjectCollideMap(this._objectCollideMap).make()).withChild(t.buildPrefab("campfire",Di,new tt(4,1,0)).withObjectCollideMap(this._objectCollideMap).make())}}var Ri,Wi;!function(t){t.Left="left",t.Center="center",t.Right="right"}(Ri||(Ri={})),function(t){t.Normal="normal",t.Bold="bold"}(Wi||(Wi={}));class Pi extends ve{constructor(){super(...arguments),this.tf=2,this.if=1,this.iu=!1,this.sf=8,this.hf=Wi.Normal,this.ef="Arial",this.rf=Ri.Left,this.nf=new ye(1,1,1,1),this.ff=null,this.Ca=null}renderInitialize(){var t;null===(t=this.Ca)||void 0===t||t.call(this),this.htmlElement||(this.text=Pi._defaultText)}updateCenterOffset(t){if(!this.css3DObject)return;let e,i;if(this.iu)if(this.css3DObject.element.parentElement){const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="",e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t}else{const t=this.css3DObject.element.style.display;this.css3DObject.element.style.display="";const s=this.css3DObject.element.style.transform;this.css3DObject.element.style.transform="translateX(1000000px)",document.body.appendChild(this.css3DObject.element),e=this.css3DObject.element.offsetWidth*this.viewScale,i=this.css3DObject.element.offsetHeight*this.viewScale,this.css3DObject.element.style.display=t,this.css3DObject.element.style.transform=s,document.body.removeChild(this.css3DObject.element)}else e=this.tf,i=this.if;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.iu?(this.css3DObject.scale.set(e,e,e),this.updateCenterOffset(!1)):(this.css3DObject.element.style.width=this.tf/this.viewScale+"px",this.css3DObject.element.style.height=this.if/this.viewScale+"px",this.css3DObject.scale.set(e,e,e)),t&&(Ft.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get text(){return this.ff}set text(t){this.ff=t,this.readyToDraw?this.lf(t):this.Ca=()=>this.lf(t)}lf(t){this.htmlElement||(this.htmlElement=document.createElement("div")),this.htmlElement.textContent=null!=t?t:"",this.iu?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tf+"px",this.htmlElement.style.height=this.if+"px"),this.htmlElement.style.fontSize=this.sf+"px",this.htmlElement.style.fontWeight=this.hf,this.htmlElement.style.fontFamily=this.ef,this.htmlElement.style.textAlign=this.rf,this.htmlElement.style.color=this.nf.toHex(),this.htmlElement.style.opacity=this.nf.a.toString();const e=this.initializeBaseComponents(!1);Ft.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get textWidth(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetWidth;return this.htmlElement.style.display=t,e}return 0}return this.tf}set textWidth(t){this.iu||(this.tf=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get textHeight(){if(this.iu){if(this.htmlElement){const t=this.htmlElement.style.display;this.htmlElement.style.display="";const e=this.htmlElement.offsetHeight;return this.htmlElement.style.display=t,e}return 0}return this.if}set textHeight(t){this.iu||(this.if=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0))}get autoSize(){return this.iu}set autoSize(t){this.iu=t,this.htmlElement&&(t?(this.htmlElement.style.width="auto",this.htmlElement.style.height="auto"):(this.htmlElement.style.width=this.tf/this.viewScale+"px",this.htmlElement.style.height=this.if/this.viewScale+"px"))}get fontSize(){return this.sf}set fontSize(t){this.sf=t,this.htmlElement&&(this.htmlElement.style.fontSize=t+"px")}get fontWeight(){return this.hf}set fontWeight(t){this.hf=t,this.htmlElement&&(this.htmlElement.style.fontWeight=t)}get fontFamily(){return this.ef}set fontFamily(t){this.ef=t,this.htmlElement&&(this.htmlElement.style.fontFamily=t)}get textAlign(){return this.rf}set textAlign(t){this.rf=t,this.htmlElement&&(this.htmlElement.style.textAlign=t)}get textColor(){return this.nf}set textColor(t){this.nf.copy(t),this.htmlElement&&(this.htmlElement.style.color=t.toHex(),this.htmlElement.style.opacity=t.a.toString())}}Pi._defaultText="Text";class Ii extends ge{constructor(){super(...arguments),this.column=18,this.row=13}awake(){for(let t=0;t<this.row;t++)for(let e=0;e<this.column;e++)this.spawnText(new Ut(e+.5,this.row-1-t),t*this.column+e)}spawnText(t,e){this.engine.scene.addChildFromBuilder(this.engine.instantiater.buildGameObject("text",new tt(t.x,t.y,10)).withComponent(Pi,(t=>{t.text=e.toString(),t.textColor=new ye(0,0,0),t.viewScale=.05})))}}class Fi extends ge{constructor(){super(...arguments),this.requiredComponents=[ei],this.disallowMultipleComponent=!0,this.saveInterval=1,this.localStorageKey="lastPosition",this._movementController=null}awake(){this._movementController=this.gameObject.getComponent(ei)}start(){this.startCoroutine(this.savePosition())}*savePosition(){for(;;){yield new x(this.saveInterval);const t=this._movementController.positionInGrid,e=t.x,i=t.y;localStorage.setItem(this.localStorageKey,e+","+i)}}static loadPosition(t="lastPosition"){const e=localStorage.getItem(t);if(e){const[t,i]=e.split(",");return new Ut(parseFloat(t),parseFloat(i))}return new Ut(0,0)}}const Hi=new class{constructor(t,e=!0){this.S=null;const i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",t.appendChild(i),t=i,this.G=new qt,this.C=new Qt(t.clientWidth,t.clientHeight),this.K=t,this.i=new $t((t=>{this.T?this.G.unsafeGetThreeScene().background=new w(t.r,t.g,t.b):this.v&&(this.v.domElement.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")")})),this.h=new re,this.o=new Bt(Xt.WaitingForStart),this.g=new he,this.p=new _(this.h),this.m=new se,this.l=new Vt,this.D=new Nt(this.G,this.i,this.h,this.o,this.C,this.g,this.p,this.m,this.l,t),this.O=null,this.F=!1,this.j=e,this.A=this.resizeFramebuffer.bind(this),e&&window.addEventListener("resize",this.A),this.M=this.R.bind(this)}resizeFramebuffer(){const t=this.K.clientWidth,e=this.K.clientHeight;t===this.C.width&&e===this.C.height||(this.C.resize(t,e),this.v&&(this.v.setSize(t,e),this.v.domElement.style.width="100%",this.v.domElement.style.height="100%"),this.T&&(this.T.setSize(t,e),this.T.domElement.style.width="100%",this.T.domElement.style.height="100%"))}run(t,e){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.WaitingForStart)throw new Error("Game is already running.");this.o.kind=Xt.Initializing,this.h.start();const i=new t(this.D,e),s=i.run();if(this.S=i.getGameSettingObject(),this.D.applyGameSetting(this.S),this.S.render.webGLRenderer){const t=this.K;this.T=this.S.render.webGLRenderer,this.T.setSize(t.clientWidth,t.clientHeight),this.T.domElement.style.position="absolute",t.appendChild(this.T.domElement)}if(this.S.render.useCss3DRenderer){const t=this.K;this.v=new ie,this.v.setSize(t.clientWidth,t.clientHeight);const e=this.v.domElement;e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.pointerEvents="none",e.onscroll=t=>{const e=t.target;e.scrollTop=0,e.scrollLeft=0},t.appendChild(e)}if(s.build(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");if(this.o.kind=Xt.Running,this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const h=this.m.update();this.v&&this.v.render(h,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.T&&this.T.render(this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.O=requestAnimationFrame(this.M)}R(){if(this.h.update(),this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.tryCompact(),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const t=this.m.update();this.v&&this.v.render(t,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.T&&this.T.render(this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.O=requestAnimationFrame(this.M)}stop(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.Running)throw new Error("Game is not running.");this.o.kind=Xt.Stopped,this.O&&cancelAnimationFrame(this.O),this.O=null}resume(){if(this.F)throw new Error("Game is disposed.");if(this.o.kind!==Xt.Stopped)throw new Error("Game is not stopped.");this.o.kind=Xt.Running,this.R()}dispose(){if(this.F)return;this.o.kind=Xt.Finalizing,this.O&&cancelAnimationFrame(this.O),this.D.dispose();const t=this.G.children;for(let e=0;e<t.length;e++)t[e].gameObject.destroy();this.j&&window.removeEventListener("resize",this.A),this.v&&this.K.removeChild(this.v.domElement),this.T&&this.K.removeChild(this.T.domElement),this.K.remove(),this.F=!0,this.o.kind=Xt.Finalized}get inputHandler(){return this.D.input}get currentGameState(){return this.o.kind}}(document.body);Hi.run(class extends class{constructor(t,e){this.H=t.instantiater,this.V=e||null,this.W=new ne(t.sceneProcessor),this.S=new le(le.createDefaultObject())}getGameSettingObject(){return Object.freeze(this.S),this.S.make()}get instantiater(){return this.H}get interopObject(){return this.V}get sceneBuilder(){return this.W}get setting(){return this.S}}{run(){const t=this.instantiater,e=new ce,s=new ce,h=new ce,r=new ce,n=new ce,o=new ce,a=new ce,l=new ce;return this.sceneBuilder.withChild(t.buildGameObject("world").withChild(t.buildGameObject("tilemap").withChild(t.buildPrefab("background",ai).make()).withChild(t.buildPrefab("islands",Ei).getCollideTilemap(r).make()).withChild(t.buildPrefab("detail",pi).getCollideTilemap(n).make()).withChild(t.buildGameObject("test").active(!1).withComponent(Oe,(t=>{t.chunkSize=15,t.filter.brightness=1.5,Re.loadImageFromPath(We).then((e=>{if(!t.exists)return;t.imageSources=[new _e(e,18,13)];const i=[];for(let t=0;t<13;t++){i[t]=[];for(let e=0;e<18;e++)i[t][e]={i:0,a:18*t+e}}t.drawTileFromTwoDimensionalArray(i,0,0)}))})).withComponent(Ii,(t=>{t.column=18,t.row=13})))).withChild(t.buildPrefab("collision",di).getCollideMap(s).getObjectCollideMap(h).make()).withChild(t.buildGameObject("event").withComponent(Se,(t=>{t.showEvents=!1,t.addEvent(0,-2,(()=>{l.ref&&l.ref.showMessage("Press E to interact with the object.")})),t.addEvent(-2,-5,(()=>{l.ref&&l.ref.showMessage("john's house")})),t.addEvent(-4,-4,(()=>{l.ref&&l.ref.showMessage("door is locked")})),t.addEvent(2,-4,(()=>{l.ref&&l.ref.showMessage("a stump")})),t.addEvent(4,1,(()=>{l.ref&&l.ref.showMessage("The campfire is warm")})),t.addEvent(1,6,(()=>{l.ref&&l.ref.showMessage("Lorem ipsum dolor sit amet, consectetur adipiscing elit,")})),t.addEvent(4,7,(()=>{l.ref&&l.ref.showMessage("door is locked")}))})).getComponent(Se,o)).withChild(t.buildPrefab("objects",Ai).withObjectCollideMap(h).make())).withChild(t.buildPrefab("player",oi).withCollideMap(s).withCollideMap(h).withCollideMap(r).withCollideMap(n).withGridEventMap(o).withGridPointer(a).withGridPosition(new ce(Fi.loadPosition())).make().withComponent(Fi).getGameObject(e)).withChild(t.buildGameObject("pointer").withComponent(Te).withComponent(je).withComponent(Ae,(t=>{t.offset=0})).getComponent(je,a)).withChild(t.buildPrefab("camera",$e,new tt(0,0,10),(new J).setFromEuler(new mt(-10*i,-10*i,0)).set(0,0,0,1)).withTarget(e).getDialogController(l).make())}}),Hi.inputHandler.startHandleEvents()})();