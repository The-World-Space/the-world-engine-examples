(()=>{"use strict";var t=function(){function t(t,i){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=t,this.value=i}return t.prototype.rotateLeft=function(){var t=this.parent,i=this.brother,e=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var h=s.leftChild,r=s.rightChild;return t&&(t.leftChild===this?t.leftChild=s:t.rightChild===this&&(t.rightChild=s)),s.parent=t,s.brother=i,s.leftChild=this,s.rightChild=r,i&&(i.brother=s),this.parent=s,this.brother=r,this.leftChild=e,this.rightChild=h,r&&(r.parent=s,r.brother=this),e&&(e.parent=this,e.brother=h),h&&(h.parent=this,h.brother=e),s},t.prototype.rotateRight=function(){var t=this.parent,i=this.brother,e=this.leftChild;if(!e)throw new Error("unknown error");var s=this.rightChild,h=e.leftChild,r=e.rightChild;return t&&(t.leftChild===this?t.leftChild=e:t.rightChild===this&&(t.rightChild=e)),e.parent=t,e.brother=i,e.leftChild=h,e.rightChild=this,i&&(i.brother=e),h&&(h.parent=e,h.brother=this),this.parent=e,this.brother=h,this.leftChild=r,this.rightChild=s,r&&(r.parent=this,r.brother=s),s&&(s.parent=this,s.brother=r),e},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}();Object.freeze(t);const i=t;var e=function(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],s=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")};function s(t,s){var h=this;void 0===t&&(t=[]),s=s||function(t,i){return t<i?-1:t>i?1:0};var r=0,n=new i;n.color=i.TreeNodeColorType.black,this.size=function(){return r},this.empty=function(){return 0===r},this.clear=function(){r=0,n.key=void 0,n.leftChild=n.rightChild=n.brother=n.parent=void 0,n.color=i.TreeNodeColorType.black};var o=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.leftChild?o(t.leftChild):t},a=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.rightChild?a(t.rightChild):t};this.front=function(){if(!this.empty())return o(n).key},this.back=function(){if(!this.empty())return a(n).key},this.forEach=function(t){var i,s,h=0;try{for(var r=e(this),n=r.next();!n.done;n=r.next())t(n.value,h++)}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}},this.getElementByPos=function(t){var i,s;if(t<0||t>=this.size())throw new Error("pos must more than 0 and less than set's size");var h=0;try{for(var r=e(this),n=r.next();!n.done;n=r.next()){var o=n.value;if(h===t)return o;++h}}catch(t){i={error:t}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}throw new Error("unknown error")};var l=function(t){var e=t.parent;if(!e){if(t===n)return;throw new Error("unknown error")}if(t.color!==i.TreeNodeColorType.red){var s=t.brother;if(!s)throw new Error("unknown error");if(t===e.leftChild)if(s.color===i.TreeNodeColorType.red){s.color=i.TreeNodeColorType.black,e.color=i.TreeNodeColorType.red;var h=e.rotateLeft();n===e&&(n=h),l(t)}else s.color===i.TreeNodeColorType.black&&(s.rightChild&&s.rightChild.color===i.TreeNodeColorType.red?(s.color=e.color,e.color=i.TreeNodeColorType.black,s.rightChild&&(s.rightChild.color=i.TreeNodeColorType.black),h=e.rotateLeft(),n===e&&(n=h),t.color=i.TreeNodeColorType.black):s.rightChild&&s.rightChild.color!==i.TreeNodeColorType.black||!s.leftChild||s.leftChild.color!==i.TreeNodeColorType.red?s.leftChild&&s.leftChild.color!==i.TreeNodeColorType.black||s.rightChild&&s.rightChild.color!==i.TreeNodeColorType.black||(s.color=i.TreeNodeColorType.red,l(e)):(s.color=i.TreeNodeColorType.red,s.leftChild&&(s.leftChild.color=i.TreeNodeColorType.black),h=s.rotateRight(),n===s&&(n=h),l(t)));else t===e.rightChild&&(s.color===i.TreeNodeColorType.red?(s.color=i.TreeNodeColorType.black,e.color=i.TreeNodeColorType.red,h=e.rotateRight(),n===e&&(n=h),l(t)):s.color===i.TreeNodeColorType.black&&(s.leftChild&&s.leftChild.color===i.TreeNodeColorType.red?(s.color=e.color,e.color=i.TreeNodeColorType.black,s.leftChild&&(s.leftChild.color=i.TreeNodeColorType.black),h=e.rotateRight(),n===e&&(n=h),t.color=i.TreeNodeColorType.black):s.leftChild&&s.leftChild.color!==i.TreeNodeColorType.black||!s.rightChild||s.rightChild.color!==i.TreeNodeColorType.red?s.leftChild&&s.leftChild.color!==i.TreeNodeColorType.black||s.rightChild&&s.rightChild.color!==i.TreeNodeColorType.black||(s.color=i.TreeNodeColorType.red,l(e)):(s.color=i.TreeNodeColorType.red,s.rightChild&&(s.rightChild.color=i.TreeNodeColorType.black),h=s.rotateLeft(),n===s&&(n=h),l(t))))}else t.color=i.TreeNodeColorType.black},c=function(t){for(var e=t;e.leftChild||e.rightChild;){if(e.rightChild){e=o(e.rightChild);var s=t.key;t.key=e.key,e.key=s,t=e}e.leftChild&&(e=a(e.leftChild),s=t.key,t.key=e.key,e.key=s,t=e)}l(e),e&&e.remove(),--r,n.color=i.TreeNodeColorType.black},u=function(t,i){return!(!t||void 0===t.key)&&(!!u(t.leftChild,i)||!!i(t)||u(t.rightChild,i))};this.eraseElementByPos=function(t){if(t<0||t>=r)throw new Error("pos must more than 0 and less than set's size");var i=0;u(n,(function(e){return t===i?(c(e),!0):(++i,!1)}))},this.eraseElementByValue=function(t){if(!this.empty()){var i=g(n,t);void 0!==i&&void 0!==i.key&&0===s(i.key,t)&&c(i)}};var d=function(t,e){if(!t||void 0===t.key)throw new Error("unknown error");var h=s(e,t.key);return h<0?t.leftChild?d(t.leftChild,e):(t.leftChild=new i,t.leftChild.parent=t,t.leftChild.brother=t.rightChild,t.rightChild&&(t.rightChild.brother=t.leftChild),t.leftChild):h>0?t.rightChild?d(t.rightChild,e):(t.rightChild=new i,t.rightChild.parent=t,t.rightChild.brother=t.leftChild,t.leftChild&&(t.leftChild.brother=t.rightChild),t.rightChild):t},m=function(t){var e=t.parent;if(!e){if(t===n)return;throw new Error("unknown error")}if(e.color!==i.TreeNodeColorType.black&&e.color===i.TreeNodeColorType.red){var s=e.brother,h=e.parent;if(!h)throw new Error("unknown error");if(s&&s.color===i.TreeNodeColorType.red)s.color=e.color=i.TreeNodeColorType.black,h.color=i.TreeNodeColorType.red,m(h);else if(!s||s.color===i.TreeNodeColorType.black)if(e===h.leftChild)if(t===e.leftChild){e.color=i.TreeNodeColorType.black,h.color=i.TreeNodeColorType.red;var r=h.rotateRight();h===n&&(n=r)}else t===e.rightChild&&(r=e.rotateLeft(),h===n&&(n=r),m(e));else e===h.rightChild&&(t===e.leftChild?(r=e.rotateRight(),h===n&&(n=r),m(e)):t===e.rightChild&&(e.color=i.TreeNodeColorType.black,h.color=i.TreeNodeColorType.red,r=h.rotateLeft(),h===n&&(n=r)))}};this.insert=function(t){if(null==t)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++r,n.key=t,void(n.color=i.TreeNodeColorType.black);var e=d(n,t);void 0!==e.key&&0===s(e.key,t)||(++r,e.key=t,m(e),n.color=i.TreeNodeColorType.black)};var g=function(t,i){if(t&&void 0!==t.key){var e=s(i,t.key);return e<0?g(t.leftChild,i):e>0?g(t.rightChild,i):t}};this.find=function(t){var i=g(n,t);return void 0!==i&&void 0!==i.key&&0===s(i.key,t)};var p=function(t,i){if(t&&void 0!==t.key){var e=s(t.key,i);if(0===e)return t.key;if(e<0)return p(t.rightChild,i);var h=p(t.leftChild,i);return void 0!==h?h:t.key}};this.lowerBound=function(t){return p(n,t)};var f=function(t,i){if(t&&void 0!==t.key){if(s(t.key,i)<=0)return f(t.rightChild,i);var e=f(t.leftChild,i);return void 0!==e?e:t.key}};this.upperBound=function(t){return f(n,t)};var y=function(t,i){if(t&&void 0!==t.key){var e=s(t.key,i);if(0===e)return t.key;if(e>0)return y(t.leftChild,i);var h=y(t.rightChild,i);return void 0!==h?h:t.key}};this.reverseLowerBound=function(t){return y(n,t)};var w=function(t,i){if(t&&void 0!==t.key){if(s(t.key,i)>=0)return w(t.leftChild,i);var e=w(t.rightChild,i);return void 0!==e?e:t.key}};this.reverseUpperBound=function(t){return w(n,t)},this.union=function(t){var i=this;t.forEach((function(t){return i.insert(t)}))},this.getHeight=function(){if(this.empty())return 0;var t=function(i){return i?Math.max(t(i.leftChild),t(i.rightChild))+1:1};return t(n)};var C=function(t){return function(t,i){var e,s,h,r,n={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(e)throw new TypeError("Generator is already executing.");for(;n;)try{if(e=1,s&&(h=2&r[0]?s.return:r[0]?s.throw||((h=s.return)&&h.call(s),0):s.next)&&!(h=h.call(s,r[1])).done)return h;switch(s=0,h&&(r=[2&r[0],h.value]),r[0]){case 0:case 1:h=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,s=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!((h=(h=n.trys).length>0&&h[h.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!h||r[1]>h[0]&&r[1]<h[3])){n.label=r[1];break}if(6===r[0]&&n.label<h[1]){n.label=h[1],h=r;break}if(h&&n.label<h[2]){n.label=h[2],n.ops.push(r);break}h[2]&&n.ops.pop(),n.trys.pop();continue}r=i.call(t,n)}catch(t){r=[6,t],s=0}finally{e=h=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}(this,(function(i){switch(i.label){case 0:return t&&void 0!==t.key?[5,e(C(t.leftChild))]:[2];case 1:return i.sent(),[4,t.key];case 2:return i.sent(),[5,e(C(t.rightChild))];case 3:return i.sent(),[2]}}))};this[Symbol.iterator]=function(){return C(n)},t.forEach((function(t){return h.insert(t)})),Object.freeze(this)}Object.freeze(s);const h=s;class r{constructor(t){this.nr=null,this.ar=new Map,this.ur=new h(void 0,((t,i)=>t.info.priority===i.info.priority?t.camera.instanceId-i.camera.instanceId:t.info.priority-i.info.priority)),this.lr=t}get camera(){var t,i;return null!==(i=null===(t=this.nr)||void 0===t?void 0:t.camera)&&void 0!==i?i:null}get currentCameraPriority(){var t,i;return null!==(i=null===(t=this.nr)||void 0===t?void 0:t.info.priority)&&void 0!==i?i:Number.MIN_SAFE_INTEGER}addCamera(t,i){this.ar.set(t,i),this.ur.insert({camera:t,info:i}),this.mr()}removeCamera(t){const i=this.ar.get(t);i&&(this.ur.eraseElementByValue({camera:t,info:i}),this.ar.delete(t),this.mr())}changeCameraPriority(t,i){const e=this.ar.get(t);e&&(this.ur.eraseElementByValue({camera:t,info:e}),e.priority=i,this.ur.insert({camera:t,info:e}),this.mr())}changeCameraBackgroundColor(t,i){var e;const s=this.ar.get(t);s&&(s.backgroundColor=i,(null===(e=this.nr)||void 0===e?void 0:e.camera)===t&&this.lr(i))}mr(){if(0===this.ur.size())return void(this.nr=null);const t=this.ur.front();t?(this.nr=t,this.lr(this.nr.info.backgroundColor)):this.nr=null}}class n{constructor(t){this.next=null,this.prev=null,this.value=t}}class o{constructor(){this.st=!1,this.it=null,this.lt=null,this.ht=0}get length(){return this.ht}add(t){const i=new n(t);null===this.it?(this.it=i,this.lt=i):(this.lt.next=i,i.prev=this.lt,this.lt=i),this.ht++}nt(t){null!==t.prev?t.prev.next=t.next:this.it=t.next,null!==t.next?t.next.prev=t.prev:this.lt=t.prev,this.ht--}remove(t){let i=this.it;for(;null!==i;){if(i.value===t)return void this.nt(i);i=i.next}}removeAll(){this.it=null,this.lt=null,this.ht=0,this.st=!0}forEach(t){this.st=!1;let i=this.it;for(;null!==i;){if(t(i.value),this.st)return;i=i.next}}}class a{constructor(){this.rt=new o}addListener(t){this.rt.add(t)}removeListener(t){this.rt.remove(t)}removeAllListeners(){this.rt.removeAll()}invoke(...t){this.rt.forEach((i=>{i(...t)}))}}class l{constructor(t){this.Ks=new a,this.ks=new a,this.Hs=new a,this.Is=new a,this.Xs=new a,this.Ys=new a,this.zs=new a,this.Gs=new a,this.Js=!1,this.Zs=null,this.$s=null,this.ue=null,this.le=t=>{this.we.set(t.key,!0),this.Ks.invoke(t)},this.ve=t=>{this.we.set(t.key,!1),this.ks.invoke(t)},this.me=t=>{this.Hs.invoke(t)},this.de=t=>{this.$s=t,this.Is.invoke(t)},this.pe=t=>{this.$s=null,this.Xs.invoke(t)},this.Ee=t=>{this.ue=t,this.Ys.invoke(t)},this.ge=t=>{this.ue=null,this.zs.invoke(t)},this.ye=t=>{this.$s=t,this.Gs.invoke(t)},this.Ce=t=>{this.Zs=()=>{this.Ke("mouseenter",t.touches[0]),this.Ke("mousedown",t.touches[0])}},this.be=t=>{this.Js&&(this.Js=!1,this.Ke("mouseup",t.changedTouches[0]),this.Ke("mouseleave",t.changedTouches[0]))},this.Pe=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.Ke("mousemove",t.touches[0]),this.Js=!0},this.ke=t=>{this.Js&&(this.Js=!1,this.Ke("mouseleave",t.changedTouches[0]))},this.we=new Map,this.j=!1,this.He=t}get map(){return this.we}dispose(){this.stopHandleEvents(),this.j=!0}startHandleEvents(){if(this.j)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this.le),window.addEventListener("keyup",this.ve),window.addEventListener("wheel",this.me),this.He.addEventListener("mousedown",this.de),this.He.addEventListener("mouseup",this.pe),this.He.addEventListener("mouseenter",this.Ee),this.He.addEventListener("mouseleave",this.ge),this.He.addEventListener("mousemove",this.ye),this.He.addEventListener("touchstart",this.Ce),this.He.addEventListener("touchend",this.be),this.He.addEventListener("touchmove",this.Pe),this.He.addEventListener("touchcancel",this.ke)}stopHandleEvents(){this.$s&&this.pe(this.$s),this.ue&&this.ge(this.ue),this.we.clear(),window.removeEventListener("keydown",this.le),window.removeEventListener("keyup",this.ve),window.removeEventListener("wheel",this.me),this.He.removeEventListener("mousedown",this.de),this.He.removeEventListener("mouseup",this.pe),this.He.removeEventListener("mouseenter",this.Ee),this.He.removeEventListener("mouseleave",this.ge),this.He.removeEventListener("mousemove",this.ye),this.He.removeEventListener("touchstart",this.Ce),this.He.removeEventListener("touchend",this.be),this.He.removeEventListener("touchmove",this.Pe),this.He.removeEventListener("touchcancel",this.ke)}Ke(t,i){const e=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});i.target.dispatchEvent(e)}get onKeyDown(){return this.Ks}get onKeyUp(){return this.ks}get onWheel(){return this.Hs}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}}const c=[];for(let t=0;t<256;t++)c[t]=(t<16?"0":"")+t.toString(16);const u=Math.PI/180,d=180/Math.PI;function m(t,i,e){return Math.max(i,Math.min(e,t))}class g{constructor(t=0,i=0,e=0,s=1){this._x=t,this._y=i,this._z=e,this._w=s}static slerp(t,i,e,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),e.slerpQuaternions(t,i,s)}static slerpFlat(t,i,e,s,h,r,n){let o=e[s+0],a=e[s+1],l=e[s+2],c=e[s+3];const u=h[r+0],d=h[r+1],m=h[r+2],g=h[r+3];if(0===n)return t[i+0]=o,t[i+1]=a,t[i+2]=l,void(t[i+3]=c);if(1===n)return t[i+0]=u,t[i+1]=d,t[i+2]=m,void(t[i+3]=g);if(c!==g||o!==u||a!==d||l!==m){let t=1-n;const i=o*u+a*d+l*m+c*g,e=i>=0?1:-1,s=1-i*i;if(s>Number.EPSILON){const h=Math.sqrt(s),r=Math.atan2(h,i*e);t=Math.sin(t*r)/h,n=Math.sin(n*r)/h}const h=n*e;if(o=o*t+u*h,a=a*t+d*h,l=l*t+m*h,c=c*t+g*h,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[i]=o,t[i+1]=a,t[i+2]=l,t[i+3]=c}static multiplyQuaternionsFlat(t,i,e,s,h,r){const n=e[s],o=e[s+1],a=e[s+2],l=e[s+3],c=h[r],u=h[r+1],d=h[r+2],m=h[r+3];return t[i]=n*m+l*c+o*d-a*u,t[i+1]=o*m+l*u+a*c-n*d,t[i+2]=a*m+l*d+n*u-o*c,t[i+3]=l*m-n*c-o*u-a*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,e,s){return this._x=t,this._y=i,this._z=e,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const e=t._x,s=t._y,h=t._z,r=t._order,n=Math.cos,o=Math.sin,a=n(e/2),l=n(s/2),c=n(h/2),u=o(e/2),d=o(s/2),m=o(h/2);switch(r){case"XYZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"YXZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"ZXY":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"ZYX":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"YZX":this._x=u*l*c+a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c-u*d*m;break;case"XZY":this._x=u*l*c-a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==i&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const e=i/2,s=Math.sin(e);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,e=i[0],s=i[4],h=i[8],r=i[1],n=i[5],o=i[9],a=i[2],l=i[6],c=i[10],u=e+n+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(h-a)*t,this._z=(r-s)*t}else if(e>n&&e>c){const t=2*Math.sqrt(1+e-n-c);this._w=(l-o)/t,this._x=.25*t,this._y=(s+r)/t,this._z=(h+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-e-c);this._w=(h-a)/t,this._x=(s+r)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-e-n);this._w=(r-s)/t,this._x=(h+a)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let e=t.dot(i)+1;return e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=e),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(m(this.dot(t),-1,1)))}rotateTowards(t,i){const e=this.angleTo(t);if(0===e)return this;const s=Math.min(1,i/e);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const e=t._x,s=t._y,h=t._z,r=t._w,n=i._x,o=i._y,a=i._z,l=i._w;return this._x=e*l+r*n+s*a-h*o,this._y=s*l+r*o+h*n-e*a,this._z=h*l+r*a+e*o-s*n,this._w=r*l-e*n-s*o-h*a,this._onChangeCallback(),this}slerp(t,i){if(0===i)return this;if(1===i)return this.copy(t);const e=this._x,s=this._y,h=this._z,r=this._w;let n=r*t._w+e*t._x+s*t._y+h*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=r,this._x=e,this._y=s,this._z=h,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-i;return this._w=t*r+i*this._w,this._x=t*e+i*this._x,this._y=t*s+i*this._y,this._z=t*h+i*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-i)*l)/a,u=Math.sin(i*l)/a;return this._w=r*c+this._w*u,this._x=e*c+this._x*u,this._y=s*c+this._y*u,this._z=h*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,i,e){return this.copy(t).slerp(i,e)}random(){const t=Math.random(),i=Math.sqrt(1-t),e=Math.sqrt(t),s=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(i*Math.cos(s),e*Math.sin(h),e*Math.cos(h),i*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}g.prototype.isQuaternion=!0;class p{constructor(t=0,i=0,e=0){this.x=t,this.y=i,this.z=e}set(t,i,e){return void 0===e&&(e=this.z),this.x=t,this.y=i,this.z=e,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(y.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(y.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,e=this.y,s=this.z,h=t.elements;return this.x=h[0]*i+h[3]*e+h[6]*s,this.y=h[1]*i+h[4]*e+h[7]*s,this.z=h[2]*i+h[5]*e+h[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,e=this.y,s=this.z,h=t.elements,r=1/(h[3]*i+h[7]*e+h[11]*s+h[15]);return this.x=(h[0]*i+h[4]*e+h[8]*s+h[12])*r,this.y=(h[1]*i+h[5]*e+h[9]*s+h[13])*r,this.z=(h[2]*i+h[6]*e+h[10]*s+h[14])*r,this}applyQuaternion(t){const i=this.x,e=this.y,s=this.z,h=t.x,r=t.y,n=t.z,o=t.w,a=o*i+r*s-n*e,l=o*e+n*i-h*s,c=o*s+h*e-r*i,u=-h*i-r*e-n*s;return this.x=a*o+u*-h+l*-n-c*-r,this.y=l*o+u*-r+c*-h-a*-n,this.z=c*o+u*-n+a*-r-l*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,e=this.y,s=this.z,h=t.elements;return this.x=h[0]*i+h[4]*e+h[8]*s,this.y=h[1]*i+h[5]*e+h[9]*s,this.z=h[2]*i+h[6]*e+h[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,e){return this.x=t.x+(i.x-t.x)*e,this.y=t.y+(i.y-t.y)*e,this.z=t.z+(i.z-t.z)*e,this}cross(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}crossVectors(t,i){const e=t.x,s=t.y,h=t.z,r=i.x,n=i.y,o=i.z;return this.x=s*o-h*n,this.y=h*r-e*o,this.z=e*n-s*r,this}projectOnVector(t){const i=t.lengthSq();if(0===i)return this.set(0,0,0);const e=t.dot(this)/i;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return f.copy(this).projectOnVector(t),this.sub(f)}reflect(t){return this.sub(f.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;const e=this.dot(t)/i;return Math.acos(m(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,e=this.y-t.y,s=this.z-t.z;return i*i+e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,e){const s=Math.sin(i)*t;return this.x=s*Math.sin(e),this.y=Math.cos(i)*t,this.z=s*Math.cos(e),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,e){return this.x=t*Math.sin(i),this.y=e,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=s,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,4*i)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,3*i)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i,e){return void 0!==e&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),i=Math.random()*Math.PI*2,e=Math.sqrt(1-t**2);return this.x=e*Math.cos(i),this.y=e*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}p.prototype.isVector3=!0;const f=new p,y=new g;class w{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,i,e,s,h,r,n,o,a,l,c,u,d,m,g,p){const f=this.elements;return f[0]=t,f[4]=i,f[8]=e,f[12]=s,f[1]=h,f[5]=r,f[9]=n,f[13]=o,f[2]=a,f[6]=l,f[10]=c,f[14]=u,f[3]=d,f[7]=m,f[11]=g,f[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new w).fromArray(this.elements)}copy(t){const i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}copyPosition(t){const i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}makeBasis(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,e=t.elements,s=1/C.setFromMatrixColumn(t,0).length(),h=1/C.setFromMatrixColumn(t,1).length(),r=1/C.setFromMatrixColumn(t,2).length();return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=0,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=0,i[8]=e[8]*r,i[9]=e[9]*r,i[10]=e[10]*r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const i=this.elements,e=t.x,s=t.y,h=t.z,r=Math.cos(e),n=Math.sin(e),o=Math.cos(s),a=Math.sin(s),l=Math.cos(h),c=Math.sin(h);if("XYZ"===t.order){const t=r*l,e=r*c,s=n*l,h=n*c;i[0]=o*l,i[4]=-o*c,i[8]=a,i[1]=e+s*a,i[5]=t-h*a,i[9]=-n*o,i[2]=h-t*a,i[6]=s+e*a,i[10]=r*o}else if("YXZ"===t.order){const t=o*l,e=o*c,s=a*l,h=a*c;i[0]=t+h*n,i[4]=s*n-e,i[8]=r*a,i[1]=r*c,i[5]=r*l,i[9]=-n,i[2]=e*n-s,i[6]=h+t*n,i[10]=r*o}else if("ZXY"===t.order){const t=o*l,e=o*c,s=a*l,h=a*c;i[0]=t-h*n,i[4]=-r*c,i[8]=s+e*n,i[1]=e+s*n,i[5]=r*l,i[9]=h-t*n,i[2]=-r*a,i[6]=n,i[10]=r*o}else if("ZYX"===t.order){const t=r*l,e=r*c,s=n*l,h=n*c;i[0]=o*l,i[4]=s*a-e,i[8]=t*a+h,i[1]=o*c,i[5]=h*a+t,i[9]=e*a-s,i[2]=-a,i[6]=n*o,i[10]=r*o}else if("YZX"===t.order){const t=r*o,e=r*a,s=n*o,h=n*a;i[0]=o*l,i[4]=h-t*c,i[8]=s*c+e,i[1]=c,i[5]=r*l,i[9]=-n*l,i[2]=-a*l,i[6]=e*c+s,i[10]=t-h*c}else if("XZY"===t.order){const t=r*o,e=r*a,s=n*o,h=n*a;i[0]=o*l,i[4]=-c,i[8]=a*l,i[1]=t*c+h,i[5]=r*l,i[9]=e*c-s,i[2]=s*c-e,i[6]=n*l,i[10]=h*c+t}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(v,t,b)}lookAt(t,i,e){const s=this.elements;return E.subVectors(t,i),0===E.lengthSq()&&(E.z=1),E.normalize(),M.crossVectors(e,E),0===M.lengthSq()&&(1===Math.abs(e.z)?E.x+=1e-4:E.z+=1e-4,E.normalize(),M.crossVectors(e,E)),M.normalize(),A.crossVectors(E,M),s[0]=M.x,s[4]=A.x,s[8]=E.x,s[1]=M.y,s[5]=A.y,s[9]=E.y,s[2]=M.z,s[6]=A.z,s[10]=E.z,this}multiply(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const e=t.elements,s=i.elements,h=this.elements,r=e[0],n=e[4],o=e[8],a=e[12],l=e[1],c=e[5],u=e[9],d=e[13],m=e[2],g=e[6],p=e[10],f=e[14],y=e[3],w=e[7],C=e[11],x=e[15],v=s[0],b=s[4],M=s[8],A=s[12],E=s[1],O=s[5],_=s[9],D=s[13],j=s[2],S=s[6],k=s[10],z=s[14],T=s[3],R=s[7],I=s[11],P=s[15];return h[0]=r*v+n*E+o*j+a*T,h[4]=r*b+n*O+o*S+a*R,h[8]=r*M+n*_+o*k+a*I,h[12]=r*A+n*D+o*z+a*P,h[1]=l*v+c*E+u*j+d*T,h[5]=l*b+c*O+u*S+d*R,h[9]=l*M+c*_+u*k+d*I,h[13]=l*A+c*D+u*z+d*P,h[2]=m*v+g*E+p*j+f*T,h[6]=m*b+g*O+p*S+f*R,h[10]=m*M+g*_+p*k+f*I,h[14]=m*A+g*D+p*z+f*P,h[3]=y*v+w*E+C*j+x*T,h[7]=y*b+w*O+C*S+x*R,h[11]=y*M+w*_+C*k+x*I,h[15]=y*A+w*D+C*z+x*P,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],e=t[4],s=t[8],h=t[12],r=t[1],n=t[5],o=t[9],a=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+h*o*c-s*a*c-h*n*u+e*a*u+s*n*d-e*o*d)+t[7]*(+i*o*d-i*a*u+h*r*u-s*r*d+s*a*l-h*o*l)+t[11]*(+i*a*c-i*n*d-h*r*c+e*r*d+h*n*l-e*a*l)+t[15]*(-s*n*l-i*o*c+i*n*u+s*r*c-e*r*u+e*o*l)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,e){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=i,s[14]=e),this}invert(){const t=this.elements,i=t[0],e=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=t[9],u=t[10],d=t[11],m=t[12],g=t[13],p=t[14],f=t[15],y=c*p*a-g*u*a+g*o*d-n*p*d-c*o*f+n*u*f,w=m*u*a-l*p*a-m*o*d+r*p*d+l*o*f-r*u*f,C=l*g*a-m*c*a+m*n*d-r*g*d-l*n*f+r*c*f,x=m*c*o-l*g*o-m*n*u+r*g*u+l*n*p-r*c*p,v=i*y+e*w+s*C+h*x;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/v;return t[0]=y*b,t[1]=(g*u*h-c*p*h-g*s*d+e*p*d+c*s*f-e*u*f)*b,t[2]=(n*p*h-g*o*h+g*s*a-e*p*a-n*s*f+e*o*f)*b,t[3]=(c*o*h-n*u*h-c*s*a+e*u*a+n*s*d-e*o*d)*b,t[4]=w*b,t[5]=(l*p*h-m*u*h+m*s*d-i*p*d-l*s*f+i*u*f)*b,t[6]=(m*o*h-r*p*h-m*s*a+i*p*a+r*s*f-i*o*f)*b,t[7]=(r*u*h-l*o*h+l*s*a-i*u*a-r*s*d+i*o*d)*b,t[8]=C*b,t[9]=(m*c*h-l*g*h-m*e*d+i*g*d+l*e*f-i*c*f)*b,t[10]=(r*g*h-m*n*h+m*e*a-i*g*a-r*e*f+i*n*f)*b,t[11]=(l*n*h-r*c*h-l*e*a+i*c*a+r*e*d-i*n*d)*b,t[12]=x*b,t[13]=(l*g*s-m*c*s+m*e*u-i*g*u-l*e*p+i*c*p)*b,t[14]=(m*n*s-r*g*s-m*e*o+i*g*o+r*e*p-i*n*p)*b,t[15]=(r*c*s-l*n*s+l*e*o-i*c*o-r*e*u+i*n*u)*b,this}scale(t){const i=this.elements,e=t.x,s=t.y,h=t.z;return i[0]*=e,i[4]*=s,i[8]*=h,i[1]*=e,i[5]*=s,i[9]*=h,i[2]*=e,i[6]*=s,i[10]*=h,i[3]*=e,i[7]*=s,i[11]*=h,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,s))}makeTranslation(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const e=Math.cos(i),s=Math.sin(i),h=1-e,r=t.x,n=t.y,o=t.z,a=h*r,l=h*n;return this.set(a*r+e,a*n-s*o,a*o+s*n,0,a*n+s*o,l*n+e,l*o-s*r,0,a*o-s*n,l*o+s*r,h*o*o+e,0,0,0,0,1),this}makeScale(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this}makeShear(t,i,e,s,h,r){return this.set(1,e,h,0,t,1,r,0,i,s,1,0,0,0,0,1),this}compose(t,i,e){const s=this.elements,h=i._x,r=i._y,n=i._z,o=i._w,a=h+h,l=r+r,c=n+n,u=h*a,d=h*l,m=h*c,g=r*l,p=r*c,f=n*c,y=o*a,w=o*l,C=o*c,x=e.x,v=e.y,b=e.z;return s[0]=(1-(g+f))*x,s[1]=(d+C)*x,s[2]=(m-w)*x,s[3]=0,s[4]=(d-C)*v,s[5]=(1-(u+f))*v,s[6]=(p+y)*v,s[7]=0,s[8]=(m+w)*b,s[9]=(p-y)*b,s[10]=(1-(u+g))*b,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,i,e){const s=this.elements;let h=C.set(s[0],s[1],s[2]).length();const r=C.set(s[4],s[5],s[6]).length(),n=C.set(s[8],s[9],s[10]).length();this.determinant()<0&&(h=-h),t.x=s[12],t.y=s[13],t.z=s[14],x.copy(this);const o=1/h,a=1/r,l=1/n;return x.elements[0]*=o,x.elements[1]*=o,x.elements[2]*=o,x.elements[4]*=a,x.elements[5]*=a,x.elements[6]*=a,x.elements[8]*=l,x.elements[9]*=l,x.elements[10]*=l,i.setFromRotationMatrix(x),e.x=h,e.y=r,e.z=n,this}makePerspective(t,i,e,s,h,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const n=this.elements,o=2*h/(i-t),a=2*h/(e-s),l=(i+t)/(i-t),c=(e+s)/(e-s),u=-(r+h)/(r-h),d=-2*r*h/(r-h);return n[0]=o,n[4]=0,n[8]=l,n[12]=0,n[1]=0,n[5]=a,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=u,n[14]=d,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,i,e,s,h,r){const n=this.elements,o=1/(i-t),a=1/(e-s),l=1/(r-h),c=(i+t)*o,u=(e+s)*a,d=(r+h)*l;return n[0]=2*o,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2*a,n[9]=0,n[13]=-u,n[2]=0,n[6]=0,n[10]=-2*l,n[14]=-d,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){const i=this.elements,e=t.elements;for(let t=0;t<16;t++)if(i[t]!==e[t])return!1;return!0}fromArray(t,i=0){for(let e=0;e<16;e++)this.elements[e]=t[e+i];return this}toArray(t=[],i=0){const e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t[i+9]=e[9],t[i+10]=e[10],t[i+11]=e[11],t[i+12]=e[12],t[i+13]=e[13],t[i+14]=e[14],t[i+15]=e[15],t}}w.prototype.isMatrix4=!0;const C=new p,x=new w,v=new p(0,0,0),b=new p(1,1,1),M=new p,A=new p,E=new p,O=new w,_=new g;class D{constructor(t=0,i=0,e=0,s=D.DefaultOrder){this._x=t,this._y=i,this._z=e,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,e,s=this._order){return this._x=t,this._y=i,this._z=e,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,e=!0){const s=t.elements,h=s[0],r=s[4],n=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(i){case"XYZ":this._y=Math.asin(m(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-r,h)):(this._x=Math.atan2(u,a),this._z=0);break;case"YXZ":this._x=Math.asin(-m(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(n,d),this._z=Math.atan2(o,a)):(this._y=Math.atan2(-c,h),this._z=0);break;case"ZXY":this._x=Math.asin(m(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,a)):(this._y=0,this._z=Math.atan2(o,h));break;case"ZYX":this._y=Math.asin(-m(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,h)):(this._x=0,this._z=Math.atan2(-r,a));break;case"YZX":this._z=Math.asin(m(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-c,h)):(this._x=0,this._y=Math.atan2(n,d));break;case"XZY":this._z=Math.asin(-m(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,a),this._y=Math.atan2(n,h)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===e&&this._onChangeCallback(),this}setFromQuaternion(t,i,e){return O.makeRotationFromQuaternion(t),this.setFromRotationMatrix(O,i,e)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return _.setFromEuler(this),this.setFromQuaternion(_,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}D.prototype.isEuler=!0,D.DefaultOrder="XYZ",D.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class j{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class S{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,i,e,s,h,r,n,o,a){const l=this.elements;return l[0]=t,l[1]=s,l[2]=n,l[3]=i,l[4]=h,l[5]=o,l[6]=e,l[7]=r,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,e=t.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}extractBasis(t,i,e){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),e.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const e=t.elements,s=i.elements,h=this.elements,r=e[0],n=e[3],o=e[6],a=e[1],l=e[4],c=e[7],u=e[2],d=e[5],m=e[8],g=s[0],p=s[3],f=s[6],y=s[1],w=s[4],C=s[7],x=s[2],v=s[5],b=s[8];return h[0]=r*g+n*y+o*x,h[3]=r*p+n*w+o*v,h[6]=r*f+n*C+o*b,h[1]=a*g+l*y+c*x,h[4]=a*p+l*w+c*v,h[7]=a*f+l*C+c*b,h[2]=u*g+d*y+m*x,h[5]=u*p+d*w+m*v,h[8]=u*f+d*C+m*b,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],e=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8];return i*r*l-i*n*a-e*h*l+e*n*o+s*h*a-s*r*o}invert(){const t=this.elements,i=t[0],e=t[1],s=t[2],h=t[3],r=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=l*r-n*a,u=n*o-l*h,d=a*h-r*o,m=i*c+e*u+s*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return t[0]=c*g,t[1]=(s*a-l*e)*g,t[2]=(n*e-s*r)*g,t[3]=u*g,t[4]=(l*i-s*o)*g,t[5]=(s*h-n*i)*g,t[6]=d*g,t[7]=(e*o-a*i)*g,t[8]=(r*i-e*h)*g,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,e,s,h,r,n){const o=Math.cos(h),a=Math.sin(h);return this.set(e*o,e*a,-e*(o*r+a*n)+r+t,-s*a,s*o,-s*(-a*r+o*n)+n+i,0,0,1),this}scale(t,i){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this}rotate(t){const i=Math.cos(t),e=Math.sin(t),s=this.elements,h=s[0],r=s[3],n=s[6],o=s[1],a=s[4],l=s[7];return s[0]=i*h+e*o,s[3]=i*r+e*a,s[6]=i*n+e*l,s[1]=-e*h+i*o,s[4]=-e*r+i*a,s[7]=-e*n+i*l,this}translate(t,i){const e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this}equals(t){const i=this.elements,e=t.elements;for(let t=0;t<9;t++)if(i[t]!==e[t])return!1;return!0}fromArray(t,i=0){for(let e=0;e<9;e++)this.elements[e]=t[e+i];return this}toArray(t=[],i=0){const e=this.elements;return t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3],t[i+4]=e[4],t[i+5]=e[5],t[i+6]=e[6],t[i+7]=e[7],t[i+8]=e[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}S.prototype.isMatrix3=!0;let k=0;const z=new p,T=new g,R=new w,I=new p,P=new p,F=new p,W=new g,N=new p(1,0,0),Y=new p(0,1,0),X=new p(0,0,1),U={type:"added"},B={type:"removed"};class H extends class{addEventListener(t,i){void 0===this._listeners&&(this._listeners={});const e=this._listeners;void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)}hasEventListener(t,i){if(void 0===this._listeners)return!1;const e=this._listeners;return void 0!==e[t]&&-1!==e[t].indexOf(i)}removeEventListener(t,i){if(void 0===this._listeners)return;const e=this._listeners[t];if(void 0!==e){const t=e.indexOf(i);-1!==t&&e.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const i=this._listeners[t.type];if(void 0!==i){t.target=this;const e=i.slice(0);for(let i=0,s=e.length;i<s;i++)e[i].call(this,t);t.target=null}}}{constructor(){super(),Object.defineProperty(this,"id",{value:k++}),this.uuid=function(){const t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(c[255&t]+c[t>>8&255]+c[t>>16&255]+c[t>>24&255]+"-"+c[255&i]+c[i>>8&255]+"-"+c[i>>16&15|64]+c[i>>24&255]+"-"+c[63&e|128]+c[e>>8&255]+"-"+c[e>>16&255]+c[e>>24&255]+c[255&s]+c[s>>8&255]+c[s>>16&255]+c[s>>24&255]).toLowerCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=H.DefaultUp.clone();const t=new p,i=new D,e=new g,s=new p(1,1,1);i._onChange((function(){e.setFromEuler(i,!1)})),e._onChange((function(){i.setFromQuaternion(e,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:e},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new w},normalMatrix:{value:new S}}),this.matrix=new w,this.matrixWorld=new w,this.matrixAutoUpdate=H.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new j,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return T.setFromAxisAngle(t,i),this.quaternion.multiply(T),this}rotateOnWorldAxis(t,i){return T.setFromAxisAngle(t,i),this.quaternion.premultiply(T),this}rotateX(t){return this.rotateOnAxis(N,t)}rotateY(t){return this.rotateOnAxis(Y,t)}rotateZ(t){return this.rotateOnAxis(X,t)}translateOnAxis(t,i){return z.copy(t).applyQuaternion(this.quaternion),this.position.add(z.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(N,t)}translateY(t){return this.translateOnAxis(Y,t)}translateZ(t){return this.translateOnAxis(X,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(R.copy(this.matrixWorld).invert())}lookAt(t,i,e){t.isVector3?I.copy(t):I.set(t,i,e);const s=this.parent;this.updateWorldMatrix(!0,!1),P.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?R.lookAt(P,I,this.up):R.lookAt(I,P,this.up),this.quaternion.setFromRotationMatrix(R),s&&(R.extractRotation(s.matrixWorld),T.setFromRotationMatrix(R),this.quaternion.premultiply(T.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(U)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(B)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(B)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),R.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),R.multiply(t.parent.matrixWorld)),t.applyMatrix4(R),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let e=0,s=this.children.length;e<s;e++){const s=this.children[e].getObjectByProperty(t,i);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(P,t,F),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(P,W,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let e=0,s=i.length;e<s;e++)i[e].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let e=0,s=i.length;e<s;e++)i[e].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let e=0,s=i.length;e<s;e++)i[e].updateMatrixWorld(t)}updateWorldMatrix(t,i){const e=this.parent;if(!0===t&&null!==e&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const t=this.children;for(let i=0,e=t.length;i<e;i++)t[i].updateWorldMatrix(!1,!0)}}toJSON(t){const i=void 0===t||"string"==typeof t,e={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function h(i,e){return void 0===i[e.uuid]&&(i[e.uuid]=e.toJSON(t)),e.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=h(t.geometries,this.geometry);const i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){const e=i.shapes;if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i];h(t.shapes,s)}else h(t.shapes,e)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(h(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const i=[];for(let e=0,s=this.material.length;e<s;e++)i.push(h(t.materials,this.material[e]));s.material=i}else s.material=h(t.materials,this.material);if(this.children.length>0){s.children=[];for(let i=0;i<this.children.length;i++)s.children.push(this.children[i].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let i=0;i<this.animations.length;i++){const e=this.animations[i];s.animations.push(h(t.animations,e))}}if(i){const i=r(t.geometries),s=r(t.materials),h=r(t.textures),n=r(t.images),o=r(t.shapes),a=r(t.skeletons),l=r(t.animations),c=r(t.nodes);i.length>0&&(e.geometries=i),s.length>0&&(e.materials=s),h.length>0&&(e.textures=h),n.length>0&&(e.images=n),o.length>0&&(e.shapes=o),a.length>0&&(e.skeletons=a),l.length>0&&(e.animations=l),c.length>0&&(e.nodes=c)}return e.object=s,e;function r(t){const i=[];for(const e in t){const s=t[e];delete s.metadata,i.push(s)}return i}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let i=0;i<t.children.length;i++){const e=t.children[i];this.add(e.clone())}return this}}H.DefaultUp=new p(0,1,0),H.DefaultMatrixAutoUpdate=!0,H.prototype.isObject3D=!0;class Q extends H{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return null!==this.fog&&(i.object.fog=this.fog.toJSON()),i}}Q.prototype.isScene=!0;class G{constructor(t=0,i=0,e=0){this.isVector3=!0,this.ai=t,this.ui=i,this.ci=e,this.eh=()=>{},this.rh=()=>{}}onBeforeChange(t){this.eh=t}onBeforeGetComponent(t){this.rh=t}get x(){return this.rh(),this.ai}set x(t){this.ai!==t&&(this.eh(),this.ai=t)}get y(){return this.rh(),this.ui}set y(t){this.ui!==t&&(this.eh(),this.ui=t)}get z(){return this.rh(),this.ci}set z(t){this.ci!==t&&(this.eh(),this.ci=t)}set(t,i,e){return void 0===e&&(this.rh(),e=this.ci),this.ai===t&&this.ui===i&&this.ci===e||(this.eh(),this.ai=t,this.ui=i,this.ci=e),this}setScalar(t){return this.ai===t&&this.ui===t&&this.ci===t||(this.eh(),this.ai=t,this.ui=t,this.ci=t),this}setX(t){return this.ai===t||(this.eh(),this.ai=t),this}setY(t){return this.ui===t||(this.eh(),this.ui=t),this}setZ(t){return this.ci===t||(this.eh(),this.ci=t),this}setComponent(t,i){switch(t){case 0:if(this.ai===i)return this;this.eh(),this.ai=i;break;case 1:if(this.ui===i)return this;this.eh(),this.ui=i;break;case 2:if(this.ci===i)return this;this.eh(),this.ci=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this.rh(),t){case 0:return this.ai;case 1:return this.ui;case 2:return this.ci;default:throw new Error("index is out of range: "+t)}}clone(){return this.rh(),new p(this.ai,this.ui,this.ci)}copy(t){return this.ai===t.x&&this.ui===t.y&&this.ci===t.z||(this.eh(),this.ai=t.x,this.ui=t.y,this.ci=t.z),this}add(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.ai+=t.x,this.ui+=t.y,this.ci+=t.z),this)}addScalar(t){return 0===t||(this.rh(),this.eh(),this.ai+=t,this.ui+=t,this.ci+=t),this}addVectors(t,i){return this.eh(),this.ai=t.x+i.x,this.ui=t.y+i.y,this.ci=t.z+i.z,this}addScaledVector(t,i){return this.rh(),this.eh(),this.ai+=t.x*i,this.ui+=t.y*i,this.ci+=t.z*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.ai-=t.x,this.ui-=t.y,this.ci-=t.z),this)}subScalar(t){return 0===t||(this.rh(),this.eh(),this.ai-=t,this.ui-=t,this.ci-=t),this}subVectors(t,i){return this.eh(),this.ai=t.x-i.x,this.ui=t.y-i.y,this.ci=t.z-i.z,this}multiply(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.ai*=t.x,this.ui*=t.y,this.ci*=t.z),this)}multiplyScalar(t){return 1===t||(this.rh(),this.eh(),this.ai*=t,this.ui*=t,this.ci*=t),this}multiplyVectors(t,i){return this.eh(),this.ai=t.x*i.x,this.ui=t.y*i.y,this.ci=t.z*i.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(V.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(V.setFromAxisAngle(t,i))}applyMatrix3(t){this.rh();const i=this.ai,e=this.ui,s=this.ci,h=t.elements;return this.eh(),this.ai=h[0]*i+h[3]*e+h[6]*s,this.ui=h[1]*i+h[4]*e+h[7]*s,this.ci=h[2]*i+h[5]*e+h[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this.rh();const i=this.ai,e=this.ui,s=this.ci,h=t.elements,r=1/(h[3]*i+h[7]*e+h[11]*s+h[15]);return this.eh(),this.ai=(h[0]*i+h[4]*e+h[8]*s+h[12])*r,this.ui=(h[1]*i+h[5]*e+h[9]*s+h[13])*r,this.ci=(h[2]*i+h[6]*e+h[10]*s+h[14])*r,this}applyQuaternion(t){this.rh();const i=this.ai,e=this.ui,s=this.ci,h=t.x,r=t.y,n=t.z,o=t.w,a=o*i+r*s-n*e,l=o*e+n*i-h*s,c=o*s+h*e-r*i,u=-h*i-r*e-n*s;return this.eh(),this.ai=a*o+u*-h+l*-n-c*-r,this.ui=l*o+u*-r+c*-h-a*-n,this.ci=c*o+u*-n+a*-r-l*-h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this.rh();const i=this.ai,e=this.ui,s=this.ci,h=t.elements;return this.eh(),this.ai=h[0]*i+h[4]*e+h[8]*s,this.ui=h[1]*i+h[5]*e+h[9]*s,this.ci=h[2]*i+h[6]*e+h[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.ai/=t.x,this.ui/=t.y,this.ci/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.rh(),this.eh(),this.ai=Math.min(this.ai,t.x),this.ui=Math.min(this.ui,t.y),this.ci=Math.min(this.ci,t.z),this}max(t){return this.rh(),this.eh(),this.ai=Math.max(this.ai,t.x),this.ui=Math.max(this.ui,t.y),this.ci=Math.max(this.ci,t.z),this}clamp(t,i){return this.rh(),this.eh(),this.ai=Math.max(t.x,Math.min(i.x,this.ai)),this.ui=Math.max(t.y,Math.min(i.y,this.ui)),this.ci=Math.max(t.z,Math.min(i.z,this.ci)),this}clampScalar(t,i){return this.rh(),this.eh(),this.ai=Math.max(t,Math.min(i,this.ai)),this.ui=Math.max(t,Math.min(i,this.ui)),this.ci=Math.max(t,Math.min(i,this.ci)),this}clampLength(t,i){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))}floor(){return this.rh(),this.eh(),this.ai=Math.floor(this.ai),this.ui=Math.floor(this.ui),this.ci=Math.floor(this.ci),this}ceil(){return this.rh(),this.eh(),this.ai=Math.ceil(this.ai),this.ui=Math.ceil(this.ui),this.ci=Math.ceil(this.ci),this}round(){return this.rh(),this.eh(),this.ai=Math.round(this.ai),this.ui=Math.round(this.ui),this.ci=Math.round(this.ci),this}roundToZero(){return this.rh(),this.eh(),this.ai=this.ai<0?Math.ceil(this.ai):Math.floor(this.ai),this.ui=this.ui<0?Math.ceil(this.ui):Math.floor(this.ui),this.ci=this.ci<0?Math.ceil(this.ci):Math.floor(this.ci),this}negate(){return this.rh(),this.eh(),this.ai=-this.ai,this.ui=-this.ui,this.ci=-this.ci,this}dot(t){return this.rh(),this.ai*t.x+this.ui*t.y+this.ci*t.z}lengthSq(){return this.rh(),this.ai*this.ai+this.ui*this.ui+this.ci*this.ci}length(){return this.rh(),Math.sqrt(this.ai*this.ai+this.ui*this.ui+this.ci*this.ci)}manhattanLength(){return this.rh(),Math.abs(this.ai)+Math.abs(this.ui)+Math.abs(this.ci)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.rh(),this.eh(),this.ai+=(t.x-this.ai)*i,this.ui+=(t.y-this.ui)*i,this.ci+=(t.z-this.ci)*i,this}lerpVectors(t,i,e){return this.eh(),this.ai=t.x+(i.x-t.x)*e,this.ui=t.y+(i.y-t.y)*e,this.ci=t.z+(i.z-t.z)*e,this}cross(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}crossVectors(t,i){const e=t.x,s=t.y,h=t.z,r=i.x,n=i.y,o=i.z;return this.eh(),this.ai=s*o-h*n,this.ui=h*r-e*o,this.ci=e*n-s*r,this}projectOnVector(t){const i=t.lengthSq();if(0===i)return this.set(0,0,0);const e=t.dot(this)/i;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return q.copy(this).projectOnVector(t),this.sub(q)}reflect(t){return this.sub(q.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;const e=this.dot(t)/i;return Math.acos(m(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this.rh();const i=this.ai-t.x,e=this.ui-t.y,s=this.ci-t.z;return i*i+e*e+s*s}manhattanDistanceTo(t){return this.rh(),Math.abs(this.ai-t.x)+Math.abs(this.ui-t.y)+Math.abs(this.ci-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,e){const s=Math.sin(i)*t;return this.eh(),this.ai=s*Math.sin(e),this.ui=Math.cos(i)*t,this.ci=s*Math.cos(e),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,e){return this.eh(),this.ai=t*Math.sin(i),this.ui=e,this.ci=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.eh(),this.ai=i[12],this.ui=i[13],this.ci=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.eh(),this.ai=i,this.ui=e,this.ci=s,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,4*i)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,3*i)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this.rh(),t.x===this.ai&&t.y===this.ui&&t.z===this.ci}fromArray(t,i=0){return this.ai===t[i]&&this.ui===t[i+1]&&this.ci===t[i+2]||(this.eh(),this.ai=t[i],this.ui=t[i+1],this.ci=t[i+2]),this}toArray(t=[],i=0){return this.rh(),t[i]=this.ai,t[i+1]=this.ui,t[i+2]=this.ci,t}fromBufferAttribute(t,i,e){return void 0!==e&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.eh(),this.ai=t.getX(i),this.ui=t.getY(i),this.ci=t.getZ(i),this}random(){return this.eh(),this.ai=Math.random(),this.ui=Math.random(),this.ci=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),i=Math.random()*Math.PI*2,e=Math.sqrt(1-Math.pow(t,2));return this.eh(),this.ai=e*Math.cos(i),this.ui=e*Math.sin(i),this.ci=t,this}*[Symbol.iterator](){this.rh(),yield this.ai,this.rh(),yield this.ui,this.rh(),yield this.ci}lengthManhattan(){throw new Error("deprecated")}distanceToManhattan(t){throw new Error("deprecated")}}const q=new G,V=new g;class L{constructor(t=0,i=0,e=0,s=L.DefaultOrder){this.isEuler=!0,this.th=t,this.sh=i,this.hh=e,this.ih=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _order(){return this.rh(),this.ih}set _order(t){this.ih=t}get x(){return this.rh(),this.th}set x(t){this.th!==t&&(this.eh(),this.th=t,this._onChangeCallback())}get y(){return this.rh(),this.sh}set y(t){this.sh!==t&&(this.eh(),this.sh=t,this._onChangeCallback())}get z(){return this.rh(),this.hh}set z(t){this.hh!==t&&(this.eh(),this.hh=t,this._onChangeCallback())}get order(){return this.rh(),this.ih}set order(t){this.ih!==t&&(this.eh(),this.ih=t,this._onChangeCallback())}set(t,i,e,s){return t===this.th&&i===this.sh&&e===this.hh&&s===this.ih||(this.eh(),this.th=t,this.sh=i,this.hh=e,s&&(this.ih=s),this._onChangeCallback()),this}clone(){return this.rh(),new D(this.th,this.sh,this.hh,this.ih)}copy(t){return this.th===t.th&&this.sh===t.sh&&this.hh===t.hh&&this.ih===t.ih||(this.eh(),this.th=t._x,this.sh=t._y,this.hh=t._z,this.ih=t._order,this._onChangeCallback()),this}setFromRotationMatrix(t,i,e=!0){this.rh();const s=t.elements,h=s[0],r=s[4],n=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(i||(i=this.ih),this.eh(),i){case"XYZ":this.sh=Math.asin(m(n,-1,1)),Math.abs(n)<.9999999?(this.th=Math.atan2(-l,d),this.hh=Math.atan2(-r,h)):(this.th=Math.atan2(u,a),this.hh=0);break;case"YXZ":this.th=Math.asin(-m(l,-1,1)),Math.abs(l)<.9999999?(this.sh=Math.atan2(n,d),this.hh=Math.atan2(o,a)):(this.sh=Math.atan2(-c,h),this.hh=0);break;case"ZXY":this.th=Math.asin(m(u,-1,1)),Math.abs(u)<.9999999?(this.sh=Math.atan2(-c,d),this.hh=Math.atan2(-r,a)):(this.sh=0,this.hh=Math.atan2(o,h));break;case"ZYX":this.sh=Math.asin(-m(c,-1,1)),Math.abs(c)<.9999999?(this.th=Math.atan2(u,d),this.hh=Math.atan2(o,h)):(this.th=0,this.hh=Math.atan2(-r,a));break;case"YZX":this.hh=Math.asin(m(o,-1,1)),Math.abs(o)<.9999999?(this.th=Math.atan2(-l,a),this.sh=Math.atan2(-c,h)):(this.th=0,this.sh=Math.atan2(n,d));break;case"XZY":this.hh=Math.asin(-m(r,-1,1)),Math.abs(r)<.9999999?(this.th=Math.atan2(u,a),this.sh=Math.atan2(n,h)):(this.th=Math.atan2(-l,d),this.sh=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this.ih=i,!0===e&&this._onChangeCallback(),this}setFromQuaternion(t,i,e){return Z.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Z,i,e)}setFromVector3(t,i){return this.set(t.x,t.y,t.z,i)}reorder(t){return J.setFromEuler(this),this.setFromQuaternion(J,t)}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._order===this.ih}fromArray(t){return this.th===t[0]&&this.sh===t[1]&&this.hh===t[2]&&this.ih===t[3]||(this.eh(),this.th=t[0],this.sh=t[1],this.hh=t[2],void 0!==t[3]&&(this.ih=t[3]),this._onChangeCallback()),this}toArray(t=[],i=0){return this.rh(),t[i]=this.th,t[i+1]=this.sh,t[i+2]=this.hh,t[i+3]=this.ih,t}_onChange(t){return this._onChangeCallback=t,this}}L.DefaultOrder="XYZ",L.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Z=new w,J=new g;class K{constructor(t=0,i=0,e=0,s=1){this.isQuaternion=!0,this.th=t,this.sh=i,this.hh=e,this.hi=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}static slerp(t,i,e,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),e.slerpQuaternions(t,i,s)}static slerpFlat(t,i,e,s,h,r,n){let o=e[s+0],a=e[s+1],l=e[s+2],c=e[s+3];const u=h[r+0],d=h[r+1],m=h[r+2],g=h[r+3];if(0===n)return t[i+0]=o,t[i+1]=a,t[i+2]=l,void(t[i+3]=c);if(1===n)return t[i+0]=u,t[i+1]=d,t[i+2]=m,void(t[i+3]=g);if(c!==g||o!==u||a!==d||l!==m){let t=1-n;const i=o*u+a*d+l*m+c*g,e=i>=0?1:-1,s=1-i*i;if(s>Number.EPSILON){const h=Math.sqrt(s),r=Math.atan2(h,i*e);t=Math.sin(t*r)/h,n=Math.sin(n*r)/h}const h=n*e;if(o=o*t+u*h,a=a*t+d*h,l=l*t+m*h,c=c*t+g*h,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[i]=o,t[i+1]=a,t[i+2]=l,t[i+3]=c}static multiplyQuaternionsFlat(t,i,e,s,h,r){const n=e[s],o=e[s+1],a=e[s+2],l=e[s+3],c=h[r],u=h[r+1],d=h[r+2],m=h[r+3];return t[i]=n*m+l*c+o*d-a*u,t[i+1]=o*m+l*u+a*c-n*d,t[i+2]=a*m+l*d+n*u-o*c,t[i+3]=l*m-n*c-o*u-a*d,t}get _x(){return this.rh(),this.th}set _x(t){this.th!==t&&(this.th=t)}get _y(){return this.rh(),this.sh}set _y(t){this.sh!==t&&(this.sh=t)}get _z(){return this.rh(),this.hh}set _z(t){this.hh!==t&&(this.hh=t)}get _w(){return this.rh(),this.hi}set _w(t){this.hi!==t&&(this.hi=t)}get x(){return this.rh(),this.th}set x(t){this.th!==t&&(this.eh(),this.th=t,this._onChangeCallback())}get y(){return this.rh(),this.sh}set y(t){this.sh!==t&&(this.eh(),this.sh=t,this._onChangeCallback())}get z(){return this.rh(),this.hh}set z(t){this.hh!==t&&(this.eh(),this.hh=t,this._onChangeCallback())}get w(){return this.rh(),this.hi}set w(t){this.hi!==t&&(this.eh(),this.hi=t,this._onChangeCallback())}set(t,i,e,s){return this.th===t&&this.sh===i&&this.hh===e&&this.hi===s||(this.eh(),this.th=t,this.sh=i,this.hh=e,this.hi=s,this._onChangeCallback()),this}clone(){return this.rh(),new g(this.th,this.sh,this.hh,this.hi)}copy(t){return this.th===t.x&&this.sh===t.y&&this.hh===t.z&&this.hi===t.w||(this.eh(),this.th=t.x,this.sh=t.y,this.hh=t.z,this.hi=t.w,this._onChangeCallback()),this}setFromEuler(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const e=t._x,s=t._y,h=t._z,r=t._order,n=Math.cos,o=Math.sin,a=n(e/2),l=n(s/2),c=n(h/2),u=o(e/2),d=o(s/2),m=o(h/2);switch(this.eh(),r){case"XYZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"YXZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"ZXY":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"ZYX":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"YZX":this.th=u*l*c+a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c-u*d*m;break;case"XZY":this.th=u*l*c-a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==i&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const e=i/2,s=Math.sin(e);return this.eh(),this.th=t.x*s,this.sh=t.y*s,this.hh=t.z*s,this.hi=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,e=i[0],s=i[4],h=i[8],r=i[1],n=i[5],o=i[9],a=i[2],l=i[6],c=i[10],u=e+n+c;if(this.eh(),u>0){const t=.5/Math.sqrt(u+1);this.hi=.25/t,this.th=(l-o)*t,this.sh=(h-a)*t,this.hh=(r-s)*t}else if(e>n&&e>c){const t=2*Math.sqrt(1+e-n-c);this.hi=(l-o)/t,this.th=.25*t,this.sh=(s+r)/t,this.hh=(h+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-e-c);this.hi=(h-a)/t,this.th=(s+r)/t,this.sh=.25*t,this.hh=(o+l)/t}else{const t=2*Math.sqrt(1+c-e-n);this.hi=(r-s)/t,this.th=(h+a)/t,this.sh=(o+l)/t,this.hh=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let e=t.dot(i)+1;return this.eh(),e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this.th=-t.y,this.sh=t.x,this.hh=0,this.hi=e):(this.th=0,this.sh=-t.z,this.hh=t.y,this.hi=e)):(this.th=t.y*i.z-t.z*i.y,this.sh=t.z*i.x-t.x*i.z,this.hh=t.x*i.y-t.y*i.x,this.hi=e),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(m(this.dot(t),-1,1)))}rotateTowards(t,i){const e=this.angleTo(t);if(0===e)return this;const s=Math.min(1,i/e);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this.rh(),this.eh(),this.th*=-1,this.sh*=-1,this.hh*=-1,this._onChangeCallback(),this}dot(t){return this.rh(),this.th*t._x+this.sh*t._y+this.hh*t._z+this.hi*t._w}lengthSq(){return this.rh(),this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi}length(){return this.rh(),Math.sqrt(this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi)}normalize(){let t=this.length();return 0===t?(this.eh(),this.th=0,this.sh=0,this.hh=0,this.hi=1):(t=1/t,this.rh(),this.eh(),this.th=this.th*t,this.sh=this.sh*t,this.hh=this.hh*t,this.hi=this.hi*t),this._onChangeCallback(),this}multiply(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const e=t._x,s=t._y,h=t._z,r=t._w,n=i._x,o=i._y,a=i._z,l=i._w;return this.eh(),this.th=e*l+r*n+s*a-h*o,this.sh=s*l+r*o+h*n-e*a,this.hh=h*l+r*a+e*o-s*n,this.hi=r*l-e*n-s*o-h*a,this._onChangeCallback(),this}slerp(t,i){if(0===i)return this;if(1===i)return this.copy(t);this.rh();const e=this.th,s=this.sh,h=this.hh,r=this.hi;let n=r*t._w+e*t._x+s*t._y+h*t._z;if(this.eh(),n<0?(this.hi=-t._w,this.th=-t._x,this.sh=-t._y,this.hh=-t._z,n=-n):this.copy(t),n>=1)return this.hi=r,this.th=e,this.sh=s,this.hh=h,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-i;return this.hi=t*r+i*this.hi,this.th=t*e+i*this.th,this.sh=t*s+i*this.sh,this.hh=t*h+i*this.hh,this.normalize(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-i)*l)/a,u=Math.sin(i*l)/a;return this.hi=r*c+this.hi*u,this.th=e*c+this.th*u,this.sh=s*c+this.sh*u,this.hh=h*c+this.hh*u,this._onChangeCallback(),this}slerpQuaternions(t,i,e){return this.copy(t).slerp(i,e)}random(){const t=Math.random(),i=Math.sqrt(1-t),e=Math.sqrt(t),s=2*Math.PI*Math.random(),h=2*Math.PI*Math.random();return this.set(i*Math.cos(s),e*Math.sin(h),e*Math.cos(h),i*Math.sin(s))}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._w===this.hi}fromArray(t,i=0){return this.th===t[i]&&this.sh===t[i+1]&&this.hh===t[i+2]&&this.hi===t[i+3]||(this.eh(),this.th=t[i],this.sh=t[i+1],this.hh=t[i+2],this.hi=t[i+3],this._onChangeCallback()),this}toArray(t=[],i=0){return this.rh(),t[i]=this.th,t[i+1]=this.sh,t[i+2]=this.hh,t[i+3]=this.hi,t}fromBufferAttribute(t,i){return this.th=t.getX(i),this.sh=t.getY(i),this.hh=t.getZ(i),this.hi=t.getW(i),this}_onChange(t){return this._onChangeCallback=t,this}multiplyVector3(t){throw new Error("deprecated")}inverse(){throw new Error("deprecated")}}class ${constructor(t,i,e){this.ts=!1,this.ss=!1,this.es=!1,this.rs=!1,this.hs=!1,this.ns=this.os.bind(this),this.ls=this.fs.bind(this),this.cs=this.us.bind(this),this.ds=this.ps.bind(this),this.vs=this.bs.bind(this),this.Ts=this._s.bind(this),this.Os=this.gs.bind(this),this.Rs=this.xs.bind(this),this.ws=!1,this.isRegisteredToProcessor=!1,this.T=i,this.Ws=e,this.Ms=new $.TransformObject3D,this.Ms.matrixAutoUpdate=!0,this.Ms.userData=this,i.scene.unsafeGetThreeScene().add(this.Ms),Object.defineProperties(this.Ms,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this.ns,h=this.ls,r=new G;r.onBeforeGetComponent(s),r.onBeforeChange(h),this.Ms.position=r;const n=new L;n.onBeforeGetComponent(s),n.onBeforeChange(h),n._onChange(this.cs),this.Ms.rotation=n;const o=new K;o.onBeforeGetComponent(s),o.onBeforeChange(h),o._onChange(this.ds),this.Ms.quaternion=o;const a=new G(1,1,1);a.onBeforeGetComponent(s),a.onBeforeChange(h),this.Ms.scale=a,this._t=t;const l=this.vs,c=this.Ts,u=new G;u.onBeforeGetComponent(l),u.onBeforeChange(c),this.Cs=u;const d=new L;d.onBeforeGetComponent(l),d.onBeforeChange(c),d._onChange(this.Os),this.ys=d;const m=new K;m.onBeforeGetComponent(l),m.onBeforeChange(c),m._onChange(this.Rs),this.Fs=m;const g=new G(1,1,1);g.onBeforeGetComponent(l),g.onBeforeChange(c),this.Vs=g,this.As()}os(){this.ws||this.Ls()}fs(){this.ws||(this.Ls(),this.Ps(),this.hs=!1,this.ss=!0,this.As(),this.Ss(),this.js())}us(){this.ws||this.Ms.quaternion.setFromEuler(this.Ms.rotation,!1)}ps(){this.ws||this.Ms.rotation.setFromQuaternion(this.Ms.quaternion,void 0,!1)}bs(){this.ws||this.Ds()}_s(){this.ws||(this.Ds(),this.Ps(),this.rs=!1,this.hs=!0,this.ss=!0,this.As(),this.Es(),this.js())}gs(){this.ws||this.Fs.setFromEuler(this.ys,!1)}xs(){this.ws||this.ys.setFromQuaternion(this.Fs,void 0,!1)}Ss(){this.rs=!0;const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.Ss()}}Es(){const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.Ss()}}As(){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Us()}Us(){this.es=!0;const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.Us()}}js(){this.ts=!0;const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.js()}}Ls(){if(this.hs){if(this.ss){this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const i=$._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,i)}else this.Ms.matrix.copy(this.Ms.matrixWorld);this.ss=!1}this.ws=!0,this.Ms.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this.ws=!1,this.hs=!1}}Ds(){this.rs&&(this.Qs(),this.ws=!0,this.Ms.matrixWorld.decompose(this.Cs,this.Fs,this.Vs),this.ys.setFromQuaternion(this.Fs,void 0,!1),this.ws=!1,this.rs=!1)}Qs(){if(!this.es)return;const t=this.Ms.matrix;if(this.ss)if(this.hs)this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1;else{this.ss&&(this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1,this.ss=!1);const i=this.parent;i?(i.Qs(),this.Ms.matrixWorld.multiplyMatrices(i.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}else{const i=this.parent;i?(i.Qs(),this.Ms.matrixWorld.multiplyMatrices(i.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}Ns(){if(!this.ss)return;const t=this.Ms.matrix;if(this.es)if(this.rs)this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1;else{this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this._t.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const i=$._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,i)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}else{const t=this.parent;if(t){t.Qs();const i=$._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,i)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}this.ss=!1}Bs(){this.Ls();const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.Bs()}}Ps(){const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&(e.userData.Ls(),e.userData.Ps())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this._t.exists&&this.qs()}qs(){this.Qs();const t=this.Ms.children;for(let i=0,e=t.length;i<e;i++){const e=t[i];e.userData instanceof $&&e.userData.qs()}return!0}foreachChild(t){const i=this.Ms.children;for(let e=0,s=i.length;e<s;e++){const s=i[e];s.userData instanceof $&&t(s.userData)}}iterateChild(t){const i=this.Ms.children;for(let e=0,s=i.length;e<s;e++){const s=i[e];if(s.userData instanceof $&&!t(s.userData))break}}get parent(){return this.Ms.parent instanceof Q?null:this.Ms.parent.userData}set parent(t){this.setParent(t)}setParent(t,i=!0){if(t){const e=this.parent;this.Bs(),this.As(),this.Ss(),i&&t.getWorldToLocalMatrix(this.Ms.matrix).multiply(this.Ms.matrixWorld),this.Ms.removeFromParent(),t.Ms.add(this.Ms),this.Ws(e,t)}else{const t=this.parent;this.Bs(),this.As(),this.Ss(),i&&this.Ms.matrix.copy(this.Ms.matrixWorld),this.Ms.removeFromParent(),this.T.scene.unsafeGetThreeScene().add(this.Ms),this.Ws(t,null)}}get children(){return this.Ms.children.filter((t=>t.userData instanceof $)).map((t=>t.userData))}get gameObject(){return this._t}getForward(t){this.Qs();const i=this.Ms.matrixWorld.elements;return t?t.set(i[8],i[9],i[10]):new p(i[8],i[9],i[10])}setForward(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const i=this.Ms.matrixWorld.elements,e=$._vector3Buffer.copy(t).normalize();i[8]=e.x,i[9]=e.y,i[10]=e.z}getRight(t){this.Qs();const i=this.Ms.matrixWorld.elements;return t?t.set(i[0],i[1],i[2]):new p(i[0],i[1],i[2])}setRight(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const i=this.Ms.matrixWorld.elements,e=$._vector3Buffer.copy(t).normalize();i[0]=e.x,i[1]=e.y,i[2]=e.z}getUp(t){this.Qs();const i=this.Ms.matrixWorld.elements;return t?t.set(i[4],i[5],i[6]):new p(i[4],i[5],i[6])}setUp(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const i=this.Ms.matrixWorld.elements,e=$._vector3Buffer.copy(t).normalize();i[4]=e.x,i[5]=e.y,i[6]=e.z}get localPosition(){return this.Ms.position}get localEulerAngles(){return this.Ms.rotation}get localRotation(){return this.Ms.quaternion}get localScale(){return this.Ms.scale}get position(){return this.Cs}get eulerAngles(){return this.ys}get rotation(){return this.Fs}get lossyScale(){return this.Vs}get hasChanged(){return this.ts}set hasChanged(t){this.ts=t}getWorldToLocalMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld).invert():this.Ms.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld):this.Ms.matrixWorld.clone()}transformPoint(t){return this.Qs(),this.Ms.localToWorld(t)}inverseTransformPoint(t){return this.Qs(),this.Ms.worldToLocal(t)}transformDirection(t){const i=$._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1);return t.transformDirection(i)}inverseTransformDirection(t){const i=$._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(i)}transformVector(t){return t.transformDirection(this.Ms.matrixWorld)}inverseTransformVector(t){return t.transformDirection($._matrix4Buffer.copy(this.Ms.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const i=this.parent;return!!i&&i.isChildOf(t)}lookAt(t){const i=this.parent;$._vector3Buffer.setFromMatrixPosition(this.Ms.matrixWorld);const e=$._matrix4Buffer.lookAt($._vector3Buffer,t,this.Ms.up);if(this.Ms.quaternion.setFromRotationMatrix(e),i){e.extractRotation(i.Ms.matrixWorld);const t=$._quaternionBuffer.setFromRotationMatrix(e);this.Ms.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,i){this.Ms.setRotationFromAxisAngle(t,i)}setRotationFromEuler(t){this.Ms.setRotationFromEuler(t)}setRotationFromMatrix(t){this.Ms.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this.Ms.setRotationFromQuaternion(t)}rotateOnAxis(t,i){return this.Ms.rotateOnAxis(t,i),this}rotateOnWorldAxis(t,i){return this.Ms.rotateOnWorldAxis(t,i),this}rotateX(t){return this.Ms.rotateX(t),this}rotateY(t){return this.Ms.rotateY(t),this}rotateZ(t){return this.Ms.rotateZ(t),this}translateOnAxis(t,i){return this.Ms.translateOnAxis(t,i),this}translateX(t){return this.Ms.translateX(t),this}translateY(t){return this.Ms.translateY(t),this}translateZ(t){return this.Ms.translateZ(t),this}unsafeGetObject3D(){return this.Ms}enqueueRenderAttachedObject3D(t){this.T.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this.T.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const i=t.children;for(let t=0,e=i.length;t<e;t++)$.updateRawObject3DWorldMatrixRecursivelyInternal(i[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const i=t.children;for(let t=0,e=i.length;t<e;t++)$.updateRawObject3DWorldMatrixRecursivelyInternal(i[t])}toJSON(){return{}}}$.TransformObject3D=class extends H{updateMatrix(){this.userData.Ns()}updateMatrixWorld(t){this.userData.Qs()}updateWorldMatrix(t,i){if(this.userData.Qs(),i){const t=this.children;for(let i=0,e=t.length;i<e;i++)t[i].updateWorldMatrix(!1,!0)}}},$._matrix4Buffer=new w,$._vector3Buffer=new p,$._quaternionBuffer=new g;class tt{constructor(t,i,e,s){this.isRemoved=!1,this.Dt=e,this.kt=t.generateEventId(),this.At=s,this.Ut=i}static createAwakeEvent(t,i){return new tt(t,i,0,0)}static createStartEvent(t,i,e){return new tt(t,i,2,e)}static createUpdateEvent(t,i,e){return new tt(t,i,3,e)}static createOnEnableEvent(t,i,e){return new tt(t,i,1,e)}static createOnDisableEvent(t,i,e){return new tt(t,i,1,e)}static createOnDestroyEvent(t,i,e){return new tt(t,i,4,e)}static createOnCollisionEnter2DEvent(t,i,e){return new tt(t,i,1,e)}static createOnCollisionStay2DEvent(t,i,e){return new tt(t,i,1,e)}static createOnCollisionExit2DEvent(t,i,e){return new tt(t,i,1,e)}static createOnTriggerEnter2DEvent(t,i,e){return new tt(t,i,1,e)}static createOnTriggerStay2DEvent(t,i,e){return new tt(t,i,1,e)}static createOnTriggerExit2DEvent(t,i,e){return new tt(t,i,1,e)}get invoke(){return this.Ut}static comparator(t,i){return t.Dt===i.Dt?t.At===i.At?t.kt-i.kt:t.At-i.At:t.Dt-i.Dt}}class it{constructor(t){this.ut=null,this.ft=new h(void 0,t),this.dt=new h(void 0,t),this.at=new h(void 0,t),this.ct=new h(void 0,t)}get size(){return this.ft.size()}insert(t){t.isRemoved=!1,null!==this.ut?this.dt.insert(t):this.ft.insert(t)}delete(t){null!==this.ut?(t.isRemoved=!0,this.ct.insert(t)):this.ft.eraseElementByValue(t)}clear(){this.ft.clear(),this.dt.clear(),this.ct.clear()}forEach(t){this.ut=this.ft,this.ut.forEach((i=>{i.isRemoved||t(i)}));do{this.ut=this.St(),this.ut.forEach((i=>{i.isRemoved||t(i)}))}while(0<this.dt.size()||0<this.ct.size());this.ut=null}St(){this.ut=null,this.ct.forEach((t=>this.delete(t))),this.dt.forEach((t=>this.insert(t)));const t=this.dt;return this.dt=this.at,this.at=t,this.dt.clear(),this.ct.clear(),t}}function et(t){return void 0!==t.onWorldMatrixUpdated}class st{constructor(){this.ti=new Set,this.ii=new it(tt.comparator),this.ei=new it(tt.comparator),this.ni=new it(tt.comparator),this.oi=new it(tt.comparator),this.ri=new it(tt.comparator),this.si=new it(tt.comparator)}registerComponent(t){et(t)&&this.ti.add(t);const i=t._engine_internal_componentEventContainer;i.onCollisionEnter2D&&this.ii.insert(i.onCollisionEnter2D),i.onCollisionStay2D&&this.ei.insert(i.onCollisionStay2D),i.onCollisionExit2D&&this.ni.insert(i.onCollisionExit2D),i.onTriggerEnter2D&&this.oi.insert(i.onTriggerEnter2D),i.onTriggerStay2D&&this.ri.insert(i.onTriggerStay2D),i.onTriggerExit2D&&this.si.insert(i.onTriggerExit2D)}unregisterComponent(t){et(t)&&this.ti.delete(t);const i=t._engine_internal_componentEventContainer;i.onCollisionEnter2D&&this.ii.delete(i.onCollisionEnter2D),i.onCollisionStay2D&&this.ei.delete(i.onCollisionStay2D),i.onCollisionExit2D&&this.ni.delete(i.onCollisionExit2D),i.onTriggerEnter2D&&this.oi.delete(i.onTriggerEnter2D),i.onTriggerStay2D&&this.ri.delete(i.onTriggerStay2D),i.onTriggerExit2D&&this.si.delete(i.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this.ti)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){0!==this.ii.size&&this.ii.forEach((i=>i.invoke(t)))}invokeOnCollisionStay2D(t){0!==this.ei.size&&this.ei.forEach((i=>i.invoke(t)))}invokeOnCollisionExit2D(t){0!==this.ni.size&&this.ni.forEach((i=>i.invoke(t)))}invokeOnTriggerEnter2D(t){0!==this.oi.size&&this.oi.forEach((i=>i.invoke(t)))}invokeOnTriggerStay2D(t){0!==this.ri.size&&this.ri.forEach((i=>i.invoke(t)))}invokeOnTriggerExit2D(t){0!==this.si.size&&this.si.forEach((i=>i.invoke(t)))}}class ht{constructor(t,i){this.$t=!1,this.T=t,this.yt=t.instantiater.generateId(),this.Qt=!0,this.Vt=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new st,this.Xt=new $(this,t,this.Zt.bind(this)),this.Xt.unsafeGetObject3D().name=i}addChildFromBuilder(t){this.te();const i=t.build(this.transform);return t.processEvent(),i}Zt(t,i){if(i&&this.T!==i.gameObject.T)throw new Error("can't change parent to another engine instance");const e=this.transform.gameObject;i?e.Vt&&e.ee(i.gameObject.Qt):e.ee(e.Vt)}addComponent(t){this.te();const i=new t(this);if(i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const e=i.requiredComponents;for(let i=0;i<e.length;i++){const s=e[i];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(i),this.gameObjectEventContainer.registerComponent(i),this.Qt&&i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate(),this.T.sceneProcessor.tryStartProcessSyncedEvent()),i}getComponent(t){this.te();const i=this.components;for(let e=0;e<i.length;e++){const s=i[e];if(s instanceof t)return s}return null}getComponents(t){if(this.te(),!t)return this.components.slice();const i=this.components,e=[];for(let s=0;s<i.length;s++){const h=i[s];h instanceof t&&e.push(h)}return e}getComponentInChildren(t){this.te();const i=this.getComponent(t);if(i)return i;let e=null;return this.Xt.iterateChild((i=>{const s=i.gameObject.getComponentInChildren(t);return!s||(e=s,!1)})),e}getComponentsInChildren(t){if(this.te(),t){const i=this.getComponents(t);return this.Xt.foreachChild((e=>{const s=e.gameObject.getComponentsInChildren(t);i.push(...s)})),i}{const t=this.getComponents();return this.Xt.foreachChild((i=>{t.push(...i.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,i){this.te();const e=this.components;if(i)for(let s=0;s<e.length;s++){const h=e[s];h instanceof i&&t(h)}else for(let i=0;i<e.length;i++)t(e[i])}foreachComponentInChildren(t,i){this.te(),i?(this.foreachComponent(t,i),this.Xt.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t,i)}))):(this.foreachComponent(t),this.Xt.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t)})))}destroy(){this.$t||(this.$t=!0,this.ie(),this.T.sceneProcessor.tryStartProcessSyncedEvent(),this.T.sceneProcessor.addRemoveGameObject(this))}ie(){const t=this.components;for(let i=0;i<t.length;i++){const e=t[i];e._engine_internal_destroyed||(e.enabled&&this.Qt&&(e._engine_internal_componentEventContainer.tryRegisterOnDisable(),e._engine_internal_componentEventContainer.tryUnregisterStart(),e._engine_internal_componentEventContainer.tryUnregisterUpdate()),e.stopAllCoroutines(),e._engine_internal_componentEventContainer.tryRegisterOnDestroy(),e._engine_internal_destroyed=!0)}this.Xt.children.forEach((t=>{t instanceof $&&t.gameObject.ie()}))}removeFromParent(){this.Xt.unsafeGetObject3D().removeFromParent()}removeComponent(t){const i=this.components.indexOf(t);i>=0&&this.components.splice(i,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this.T}get activeInHierarchy(){return this.Qt}set activeInHierarchy(t){if(this.Qt!==t){if(this.Qt=t,this._initialized){const t=this.components;if(this.Qt)for(let i=0;i<t.length;i++){const e=t[i];e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let i=0;i<t.length;i++){const e=t[i];e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnDisable(),e._engine_internal_componentEventContainer.tryUnregisterUpdate(),e.stopAllCoroutines())}}this.Xt.foreachChild((t=>{const i=t.gameObject;this.Qt?i.activeInHierarchy=i.Vt:i.activeInHierarchy=!1}))}}ee(t){this.Qt!==t&&(this.activeInHierarchy=t,this._initialized&&this.T.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this.Vt}set activeSelf(t){this.te(),this.Vt!==t&&(this.Vt=t,this.Xt.parent instanceof $?this.Xt.parent.gameObject.Qt?this.ee(this.Vt):this.ee(!1):this.ee(this.Vt))}get transform(){return this.Xt}get name(){return this.Xt.unsafeGetObject3D().name}set name(t){this.te(),this.Xt.unsafeGetObject3D().name=t}get instanceId(){return this.yt}get initialized(){return this._initialized}get exists(){return!this.$t}te(){if(this.$t)throw new Error("GameObject "+this.name+" is destroyed")}}class rt{constructor(t,i,e,s,h){this.se=!1,this._t=new ht(t,i);const r=this._t.transform;e&&r.localPosition.copy(e),s&&r.localRotation.copy(s),h&&r.localScale.copy(h),this.V=[],this.ne=[]}active(t){return this._t.activeSelf=t,this}getGameObject(t){return t.ref=this._t,this}getComponent(t,i){return i.ref=this._t.getComponent(t),this}getComponents(t,i){return t.ref=i?this._t.getComponents(i):this._t.getComponents(),this}getComponentInChildren(t,i){return i.ref=this._t.getComponentInChildren(t),this}getComponentsInChildren(t,i){return t.ref=i?this._t.getComponentsInChildren(i):this._t.getComponentsInChildren(),this}withComponent(t,i){const e=new t(this._t);return e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this._t.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this._t.name}`),this):(this._t.components.push(e),this._t.gameObjectEventContainer.registerComponent(e),i&&this.ne.push((()=>i(e))),this)}withChild(t){return this.V.push(t),this}oe(t){let i=!1;const e=t.components;for(let s=0;s<e.length;s++){const h=e[s],r=h.requiredComponents;for(let e=0;e<r.length;e++){const s=r[e];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${h.constructor.name} on GameObject ${t.name}`),t.removeComponent(h),i=!0)}}i&&this.oe(t)}build(t){if(this.se)throw new Error("GameObjectBuilder is already built");return this.se=!0,this.re(t),this.he(),this.ce(),this._t}re(t){this._t.transform.setParent(t,!1);const i=this.V;for(let t=0;t<i.length;t++)i[t].re(this._t.transform)}he(){this.oe(this._t);const t=this.V;for(let i=0;i<t.length;i++)t[i].he()}ce(){const t=this.ne;for(let i=0;i<t.length;i++)t[i]();const i=this.V;for(let t=0;t<i.length;t++)i[t].ce();this._t._initialized=!0}processEvent(){rt.processEventByGroup([this],this._t.engine.sceneProcessor)}static processEventByGroup(t,i){const e=[];for(let i=0;i<t.length;i++)e.push(...t[i]._t.getComponentsInChildren());for(let t=0;t<e.length;t++){const i=e[t];i.gameObject.activeInHierarchy&&i.enabled&&i._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<e.length;t++){const i=e[t];i._engine_internal_destroyed||i.gameObject.activeInHierarchy&&i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}i.tryStartProcessSyncedEvent()}}class nt{constructor(t){this.B=0,this._=0,this.T=t}generateId(){const t=this.B;return this.B+=1,t}generateEventId(){const t=this._;return this._+=1,t}buildGameObject(t,i,e,s){return new rt(this.T,t,i,e,s)}buildPrefab(t,i,e,s,h){return new i(this.T,t,e,s,h)}}class ot{constructor(t,i,e,s,h,r,n,o,a,c){this.t=t,this.i=i,this.h=e,this.o=s,this.u=h,this.g=r,this.p=n,this.m=o,this.l=a,this.I=new l(c),this.P=new nt(this)}applyGameSetting(t){this.l.applyPhysicsSettings(t.physics)}dispose(){this.I.dispose()}get scene(){return this.t}get cameraContainer(){return this.i}get screen(){return this.u}get input(){return this.I}get time(){return this.h}get physics(){return this.l}get gameState(){return this.o}get instantiater(){return this.P}get sceneProcessor(){return this.g}get coroutineProcessor(){return this.p}get transformMatrixProcessor(){return this.m}get physics2DProcessor(){return this.l}}class at{constructor(t){this.k=t}get kind(){return this.k}set kind(t){this.k=t}}class lt{constructor(){this.fe=new Q,this.fe.matrixAutoUpdate=!1,this.fe.autoUpdate=!1}addChildFromBuilder(t){const i=t.build(null);return t.processEvent(),i}foreachChild(t){const i=this.fe.children;for(let e=0,s=i.length;e<s;e++){const s=i[e];s.userData instanceof $&&t(s.userData)}}iterateChild(t){const i=this.fe.children;for(let e=0,s=i.length;e<s;e++){const s=i[e];if(s.userData instanceof $&&!t(s.userData))break}}get children(){return this.fe.children.filter((t=>t.userData instanceof $)).map((t=>t.userData))}unsafeGetThreeScene(){return this.fe}}class ct{constructor(){this.N=new it(tt.comparator),this.q=new it(tt.comparator),this.H=!1,this.J=[],this.K=[]}addEventToNonSyncedCollection(t){this.N.insert(t)}removeEventFromNonSyncedCollection(t){this.N.delete(t)}addEventToSyncedCollection(t){this.q.insert(t)}startProcessNonSyncedEvent(){this.N.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this.H||(this.H=!0,this.q.forEach((t=>t.invoke())),this.q.clear(),this.H=!1)}addRemoveGameObject(t){this.J.push(t)}addRemoveComponent(t){this.K.push(t)}processRemoveObject(){const t=this.K;for(let i=0;i<t.length;i++)t[i].gameObject.removeComponent(t[i]);const i=this.J;for(let t=0;t<i.length;t++)i[t].removeFromParent()}}class ut{constructor(){this.tm=1/3,this.im=0,this.h=0,this.sm=0,this.hm=0,this.rm=0,this.am=1}start(){this.im=performance.now()}update(){const t=performance.now();let i=(t-this.im)/1e3;this.tm<i&&(i=this.tm),this.rm=i,this.sm+=i,this.hm=i*this.am,this.h+=this.hm,this.im=t}get time(){return this.h}get unscaledTime(){return this.sm}get deltaTime(){return this.hm}get unscaledDeltaTime(){return this.rm}get timeScale(){return this.am}set timeScale(t){this.am=t}get maximumDeltaTime(){return this.tm}set maximumDeltaTime(t){this.tm=t}}class dt{constructor(t,i){this.$i=t,this._e=i,this.Ne=new a}get width(){return this.$i}get height(){return this._e}get onResize(){return this.Ne}resize(t,i){this.$i=t,this._e=i,this.Ne.invoke(t,i)}}class mt{}class gt extends mt{get instance(){return gt._instance}}gt._instance=new gt;class pt extends mt{constructor(t){super(),this.Et=t}get seconds(){return this.Et}}class ft extends mt{constructor(t){super(),this.Ot=t}get predicate(){return this.Ot}}class yt extends mt{constructor(t){super(),this.Ot=t}get predicate(){return this.Ot}}class wt{constructor(t){this.h=t,this.Wt=[],this.Ft=0}addCoroutine(t){this.Wt.push(t),this.Ft+=1}removeCoroutine(t){const i=this.Wt.indexOf(t);i>=0&&(this.Wt[i]=null,this.Ft-=1)}tryCompact(){if(wt._needToCompactCount<=this.Wt.length-this.Ft){let t=0;for(let i=0;i<this.Wt.length;i++){const e=this.Wt[i];null!==e&&(this.Wt[t]=e,t+=1)}this.Wt.length=this.Ft}}updateAfterProcess(){const t=this.Wt;for(let i=0;i<t.length;i++){const e=t[i];null!=e&&(e.currentYieldInstructionExist?this.Pt(e):(t[i]=null,this.Ft-=1))}}Pt(t){const i=t.currentYieldInstruction;i instanceof pt?(t.elapsedTime+=this.h.deltaTime,t.elapsedTime>=i.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):i instanceof ft?i.predicate()&&t.fatchNextInstruction():i instanceof yt?i.predicate()||t.fatchNextInstruction():null===i&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this.Wt;for(let i=0;i<t.length;i++){const e=t[i];null!=e&&(e.currentYieldInstructionExist?this.Ct(e):(t[i]=null,this.Ft-=1))}}Ct(t){t.currentYieldInstruction instanceof gt&&t.fatchNextInstruction()}}wt._needToCompactCount=16;class Ct{constructor(){this.Xe=[],this.Ye=new Set,this.cr=new Set}dr(){const t=this.Ye;this.Ye=this.cr,this.cr=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this.Xe.push(t))}enqueueRenderObject(t){this.cr.add(t)}dequeueRenderObject(t){this.cr.delete(t)}flush(){this.Ye.clear()}update(){const t=this.Xe;for(let i=0;i<t.length;i++){const e=t[i];e.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),e.isRegisteredToProcessor=!1}return this.Xe.length=0,this.dr(),this.Ye}}const xt=new p,vt=new g,bt=new p,Mt=new w,At=new w;class Et{constructor(){this.$i=0,this._e=0,this.Me=0,this.ze=0,this.Te={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this.We=document.createElement("div"),this.We.style.transformStyle="preserve-3d",this.We.style.pointerEvents="none",this.domElement.appendChild(this.We)}getSize(){return{width:this.$i,height:this._e}}render(t,i,e){const s=e.projectionMatrix.elements[5]*this.ze;let h,r;this.Te.camera.fov!==s&&(this.domElement.style.perspective=e.isPerspectiveCamera?s+"px":"",this.Te.camera.fov=s),!0===i.autoUpdate&&i.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.isOrthographicCamera?(h=-(e.right+e.left)/2,r=(e.top+e.bottom)/2):(h=1,r=1);const n=(e.isOrthographicCamera?"scale("+s+")translate("+this.Ze(h)+"px,"+this.Ze(r)+"px)"+this.Ae(e.matrixWorldInverse):"translateZ("+s+"px)"+this.Ae(e.matrixWorldInverse))+"translate("+this.Me+"px,"+this.ze+"px)";this.Te.camera.style!==n&&(this.We.style.transform=n,this.Te.camera.style=n);for(const s of t)this.Be(s,i,e)}setSize(t,i){this.$i=t,this._e=i,this.Me=this.$i/2,this.ze=this._e/2,this.domElement.style.width=t+"px",this.domElement.style.height=i+"px",this.We.style.width=t+"px",this.We.style.height=i+"px"}Ze(t){return Math.abs(t)<1e-10?0:t}Ae(t){const i=t.elements,e=this.Ze;return"matrix3d("+e(i[0])+","+e(-i[1])+","+e(i[2])+","+e(i[3])+","+e(i[4])+","+e(-i[5])+","+e(i[6])+","+e(i[7])+","+e(i[8])+","+e(-i[9])+","+e(i[10])+","+e(i[11])+","+e(i[12])+","+e(-i[13])+","+e(i[14])+","+e(i[15])+")"}Ge(t){const i=t.elements,e=this.Ze;return"translate(-50%,-50%)matrix3d("+e(i[0])+","+e(i[1])+","+e(i[2])+","+e(i[3])+","+e(-i[4])+","+e(-i[5])+","+e(-i[6])+","+e(-i[7])+","+e(i[8])+","+e(i[9])+","+e(i[10])+","+e(i[11])+","+e(i[12])+","+e(i[13])+","+e(i[14])+","+e(i[15])+")"}Be(t,i,e){if(t.isCSS3DObject){let s;t.onBeforeRender(this,i,e),t.isCSS3DSprite?(Mt.copy(e.matrixWorldInverse),Mt.transpose(),0!==t.rotation2D&&Mt.multiply(At.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(xt,vt,bt),Mt.setPosition(xt),Mt.scale(bt),Mt.elements[3]=0,Mt.elements[7]=0,Mt.elements[11]=0,Mt.elements[15]=1,s=this.Ge(Mt)):s=this.Ge(t.matrixWorld);const h=t.element;h.style.transform=s,h.style.display=t.visible?"":"none",h.parentNode!==this.We&&this.We.appendChild(h),t.onAfterRender(this,i,e)}}}class Ot{constructor(t=0,i=0){this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,e=this.y,s=t.elements;return this.x=s[0]*i+s[3]*e+s[6],this.y=s[1]*i+s[4]*e+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(i,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,e=this.y-t.y;return i*i+e*e}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,e){return this.x=t.x+(i.x-t.x)*e,this.y=t.y+(i.y-t.y)*e,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i,e){return void 0!==e&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const e=Math.cos(i),s=Math.sin(i),h=this.x-t.x,r=this.y-t.y;return this.x=h*e-r*s+t.x,this.y=h*s+r*e+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Ot.prototype.isVector2=!0;class _t{constructor(){this.yi=null,this.Pi=8,this.pi=3,this.Si=!0,this.Ti=null,this.Ii=null,this.xi=new Map,this.Ni=null,this.Bi=null,this.reuseCollisionCallbacks=!0,this.Oi=null,this.Li=null}applyPhysicsSettings(t){var i;if(!t.loader)return;this.Ni=t.loader,this.Ii=new this.Ni.World(new this.Ni.Vec2(0,-9.81));const e=class extends this.Ni.ContactListener{constructor(t){super(),this.Mi=t,this.Ri=new this.Mi.Ni.Collision2DPool,this.Vi=new this.Mi.Ni.TriggerEventPool,this.ji=new this.Mi.Ni.CollisionEventPool}BeginContact(t){const i=t.GetFixtureA().GetUserData(),e=t.GetFixtureB().GetUserData();if(i.isTrigger||e.isTrigger)this.Vi.insert(0,i,e);else if(this.Mi.reuseCollisionCallbacks){const s=this.Ri.getInstance();s.setData(t),this.ji.insert(0,i,e,s,this.Ri)}else{const s=new this.Mi.Ni.Collision2D;s.setData(t),this.ji.insert(0,i,e,s)}}EndContact(t){const i=t.GetFixtureA().GetUserData(),e=t.GetFixtureB().GetUserData();if(i.isTrigger||e.isTrigger)this.Vi.insert(2,i,e);else if(this.Mi.reuseCollisionCallbacks){const s=this.Ri.getInstance();s.setData(t),this.ji.insert(2,i,e,s,this.Ri)}else{const s=new this.Mi.Ni.Collision2D;s.setData(t),this.ji.insert(2,i,e,s)}}PreSolve(t,i){const e=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(e.isTrigger||s.isTrigger)this.Vi.insert(1,e,s);else if(this.Mi.reuseCollisionCallbacks){const i=this.Ri.getInstance();i.setData(t),this.ji.insert(1,e,s,i,this.Ri)}else{const i=new this.Mi.Ni.Collision2D;i.setData(t),this.ji.insert(1,e,s,i)}}onTriggerInvoke(){this.Vi.invoke()}onCollisionInvoke(){this.ji.invoke()}},s=new e(this);this.Bi=s,this.Ii.SetContactListener(s),t.gravity&&(null===(i=this.Ii)||void 0===i||i.SetGravity(t.gravity)),t.defaultMaterial&&(this.yi=t.defaultMaterial.clone()),t.velocityIterations&&(this.Pi=t.velocityIterations),t.positionIterations&&(this.pi=t.positionIterations),t.queriesHitTriggers&&(this.Si=t.queriesHitTriggers),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix?this.Ti=new this.Ni.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix):this.Ti=new this.Ni.CollisionLayerMaskConverter({default:{default:!0}}),this.Oi=new this.Ni.RayCastOneCallback(this),this.Li=new this.Ni.RayCastFilterCallback}update(t){if(this.Ii){{let t=this.Ii.GetBodyList();for(;t;){const i=t;t=t.GetNext();const e=i.GetUserData().gameObject.transform,s=e.position,h=e.eulerAngles,r=i.GetPosition(),n=i.GetAngle();s.x===r.x&&s.y===r.y||(i.SetPosition(s),i.SetAwake(!0)),h.z!==n&&(i.SetAngle(h.z),i.SetAwake(!0))}}this.Ii.Step(t,this.Pi,this.pi);{let t=this.Ii.GetBodyList();for(;t;){const i=t;t=t.GetNext();const e=i.GetUserData().gameObject.transform;e.position.x=i.GetPosition().x,e.position.y=i.GetPosition().y,e.eulerAngles.z=i.GetAngle()}}this.Bi.onTriggerInvoke(),this.Bi.onCollisionInvoke()}}addRigidBody(t,i,e){if(!this.Ii)throw new Error("Physics2D is not loaded.");let s=this.xi.get(t);if(s){const t=s.addRigidBody(i),h=t.body;return h.SetType(e.type),h.SetPosition(e.position),h.SetAngle(e.angle),h.SetLinearVelocity(e.linearVelocity),h.SetAngularVelocity(e.angularVelocity),h.SetLinearDamping(e.linearDamping),h.SetAngularDamping(e.angularDamping),h.SetSleepingAllowed(e.allowSleep),h.SetAwake(e.awake),h.SetFixedRotation(e.fixedRotation),h.SetBullet(e.bullet),h.SetEnabled(e.enabled),h.SetUserData(e.userData),h.SetGravityScale(e.gravityScale),t}return s=new this.Ni.PhysicsObject2D(t,this.Ii.CreateBody(e),(()=>this.xi.delete(t))),this.xi.set(t,s),s.addRigidBody(i)}removeRigidBody(t){const i=this.xi.get(t);if(!i)throw new Error("PhysicsObject2D not found");i.removeRigidBody()}qi(t){const i=new this.Ni.BodyDef;return i.type=this.Ni.BodyType.b2_kinematicBody,i.position.x=t.transform.position.x,i.position.y=t.transform.position.y,i.angle=t.transform.eulerAngles.z,i}addCollider(t,i){if(!this.Ii)throw new Error("Physics2D is not loaded.");let e=this.xi.get(t);return e||(e=new this.Ni.PhysicsObject2D(t,this.Ii.CreateBody(this.qi(t)),(()=>this.xi.delete(t)))),this.xi.set(t,e),e.addCollider(i)}removeCollider(t,i,e){const s=this.xi.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(i,e)}get physicsLoader(){return this.Ni}get gravity(){if(!this.Ii)throw new Error("Physics2D is not loaded.");const t=this.Ii.GetGravity();return new Ot(t.x,t.y)}set gravity(t){if(!this.Ii)throw new Error("Physics2D is not loaded.");this.Ii.SetGravity(new this.Ni.Vec2(t.x,t.y))}get defaultMaterial(){return this.yi}get velocityIterations(){return this.Pi}set velocityIterations(t){this.Pi=t}get positionIterations(){return this.pi}set positionIterations(t){this.pi=t}get maxLinearCorrection(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.maxLinearCorrection}get maxAngularCorrection(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.maxAngularCorrection}get maxTranslationSpeed(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.maxTranslation}get maxRotationSpeed(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.maxRotation}get baumgarteScale(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.baumgarte}get baumgarteTimeOfImpactScale(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.toiBaumgarte}get timeToSleep(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.timeToSleep}get linearSleepTolerance(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.linearSleepTolerance}get angularSleepTolerance(){if(!this.Ni)throw new Error("Physics2D is not loaded.");return this.Ni.angularSleepTolerance}get queriesHitTriggers(){return this.Si}set queriesHitTriggers(t){this.Si=t}get collisionLayerMask(){return this.Ti}raycastOne(t,i,e,s=Number.POSITIVE_INFINITY,h=4294967295,r=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY){if(!this.Ii)throw new Error("Physics2D is not loaded.");e||(e=new this.Ni.RaycastHit2D);const o=_t._raycastEndPoint.copy(i).multiplyScalar(s===Number.POSITIVE_INFINITY?1e7:s).add(t);return this.Oi.setRaycastData(e,t,h,r,n),this.Ii.RayCast(this.Oi,t,o),this.Oi.hit?e:null}raycast(t,i,e,s,h=Number.POSITIVE_INFINITY){if(!this.Ii)throw new Error("Physics2D is not loaded.");const r=_t._raycastEndPoint.copy(i).multiplyScalar(h===Number.POSITIVE_INFINITY?1e7:h).add(t);return this.Li.setRaycastData(s,t,e),this.Ii.RayCast(this.Li,t,r),this.Li.hitCount}}_t._raycastEndPoint=new Ot;class Dt{constructor(t,i=!0){this.S=null,this.G=new lt,this.C=new dt(t.clientWidth,t.clientHeight),this.D=t,this.O=new Et,this.O.setSize(t.clientWidth,t.clientHeight),this.O.domElement.style.width="100%",this.O.domElement.style.height="100%",this.O.domElement.onscroll=()=>{this.O.domElement.scrollLeft=0,this.O.domElement.scrollTop=0},this.i=new r((t=>{this.O.domElement.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")"})),this.h=new ut,this.o=new at(0),this.g=new ct,this.p=new wt(this.h),this.m=new Ct,this.l=new _t,this.T=new ot(this.G,this.i,this.h,this.o,this.C,this.g,this.p,this.m,this.l,this.O.domElement),this.F=null,this.j=!1,this.v=i,this.A=this.resizeFramebuffer.bind(this),i&&window.addEventListener("resize",this.A),this.M=this.R.bind(this)}resizeFramebuffer(){const t=this.D.clientWidth,i=this.D.clientHeight;t===this.C.width&&i===this.C.height||(this.C.resize(t,i),this.O.setSize(t,i),this.O.domElement.style.width="100%",this.O.domElement.style.height="100%")}run(t,i){if(this.j)throw new Error("Game is disposed.");if(0!==this.o.kind)throw new Error("Game is already running.");this.o.kind=1,this.h.start();const e=new t(this.T,i),s=e.run();if(this.S=e.getGameSettingObject(),this.T.applyGameSetting(this.S),this.S.render.useCss3DRenderer&&this.D.appendChild(this.O.domElement),s.build(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");if(this.o.kind=2,this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const h=this.m.update();this.S.render.useCss3DRenderer&&this.O.render(h,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess(),this.F=requestAnimationFrame(this.M)}R(){if(this.F=requestAnimationFrame(this.M),this.h.update(),this.g.startProcessNonSyncedEvent(),this.l.update(this.h.deltaTime),this.p.tryCompact(),this.p.updateAfterProcess(),!this.i.camera)throw new Error("Camera is not exist or not active in the scene.");this.g.processRemoveObject();const t=this.m.update();this.S.render.useCss3DRenderer&&this.O.render(t,this.G.unsafeGetThreeScene(),this.i.camera.threeCamera),this.m.flush(),this.p.endFrameAfterProcess()}stop(){if(this.j)throw new Error("Game is disposed.");if(2!==this.o.kind)throw new Error("Game is not running.");this.o.kind=3,this.F&&cancelAnimationFrame(this.F),this.F=null}resume(){if(this.j)throw new Error("Game is disposed.");if(3!==this.o.kind)throw new Error("Game is not stopped.");this.o.kind=2,this.R()}dispose(){if(this.j)return;this.o.kind=4,this.F&&cancelAnimationFrame(this.F),this.T.dispose();const t=this.G.children;for(let i=0;i<t.length;i++)t[i].gameObject.destroy();this.v&&window.removeEventListener("resize",this.A),this.D.removeChild(this.O.domElement),this.j=!0,this.o.kind=5}get inputHandler(){return this.T.input}get currentGameState(){return this.o.kind}}class jt{constructor(t){this.g=t,this.V=[]}withChild(t){return this.V.push(t),this}build(){for(let t=0;t<this.V.length;t++)this.V[t].build(null);rt.processEventByGroup(this.V,this.g)}}class St{constructor(t){this.$=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this.$.useCss3DRenderer=t,this}}class kt{constructor(t){this.Z=t}static createDefaultObject(){return{}}loader(t){return this.Z.loader=t,this}gravity(t){return this.Z.gravity=t,this}defaultMaterial(t){return this.Z.defaultMaterial=t,this}velocityIterations(t){return this.Z.velocityIterations=t,this}positionIterations(t){return this.Z.positionIterations=t,this}queriesHitTriggers(t){return this.Z.queriesHitTriggers=t,this}reuseCollisionCallbacks(t){return this.Z.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){return this.Z.collisionLayerMaskMatrix=t,this}}class zt{constructor(t){this.W=t,this.X=new St(this.W.render),this.Y=new kt(this.W.physics)}static createDefaultObject(){return{render:St.createDefaultObject(),physics:kt.createDefaultObject()}}get render(){return this.X}get physics(){return this.Y}make(){return this.W}}class Tt{constructor(t=null){this.ref=t}}class Rt{constructor(t,i,e,s,h){this._instantiater=t.instantiater,this._gameObjectBuilder=new rt(t,i,e,s,h)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}class It extends H{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new w,this.projectionMatrix=new w,this.projectionMatrixInverse=new w}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}It.prototype.isCamera=!0;class Pt extends It{constructor(t=50,i=1,e=.1,s=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=e,this.far=s,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=2*d*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*u*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*d*Math.atan(Math.tan(.5*u*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,i,e,s,h,r){this.aspect=t/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=e,this.view.offsetY=s,this.view.width=h,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(.5*u*this.fov)/this.zoom,e=2*i,s=this.aspect*e,h=-.5*s;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,n=r.fullHeight;h+=r.offsetX*s/t,i-=r.offsetY*e/n,s*=r.width/t,e*=r.height/n}const n=this.filmOffset;0!==n&&(h+=t*n/this.getFilmWidth()),this.projectionMatrix.makePerspective(h,h+s,i,i-e,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,null!==this.view&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}Pt.prototype.isPerspectiveCamera=!0;class Ft extends It{constructor(t=-1,i=1,e=1,s=-1,h=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=e,this.bottom=s,this.near=h,this.far=r,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,i,e,s,h,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=e,this.view.offsetY=s,this.view.width=h,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),e=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let h=e-t,r=e+t,n=s+i,o=s-i;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,i=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=t*this.view.offsetX,r=h+t*this.view.width,n-=i*this.view.offsetY,o=n-i*this.view.height}this.projectionMatrix.makeOrthographic(h,r,n,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,null!==this.view&&(i.object.view=Object.assign({},this.view)),i}}Ft.prototype.isOrthographicCamera=!0;class Wt{constructor(t,i,e){this.gt=t,this.vt=0,this.xt=i,this.It=null,this.Tt=!1,this.Yt=e}get component(){return this.gt}get elapsedTime(){return this.vt}set elapsedTime(t){this.vt=t}get currentYieldInstruction(){return this.It}get currentYieldInstructionExist(){return this.Tt}fatchNextInstruction(){var t;const i=this.xt.next();return i.done?(this.It=null,this.Tt=!1,null===(t=this.Yt)||void 0===t||t.call(this),this.Yt=null,null):(this.It=i.value,this.Tt=!0,this.It)}}class Nt{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class Yt{constructor(t){this.Rt=null,this.qt=null,this.zt=null,this.Bt=null,this.Gt=null,this.Ht=null,this.Jt=null,this.Kt=null,this.Lt=null,this.Mt=null,this.gt=t,this.g=t.engine.sceneProcessor,this.P=t.engine.instantiater,this.Nt=new Nt,function(t){return void 0!==t.awake}(t)&&(this.Rt=tt.createAwakeEvent(this.P,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this.qt=tt.createOnDestroyEvent(this.P,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this.zt=tt.createOnCollisionEnter2DEvent(this.P,(i=>t.onCollisionEnter2D(i)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this.Bt=tt.createOnCollisionStay2DEvent(this.P,(i=>t.onCollisionStay2D(i)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this.Gt=tt.createOnCollisionExit2DEvent(this.P,(i=>t.onCollisionExit2D(i)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this.Ht=tt.createOnTriggerEnter2DEvent(this.P,(i=>t.onTriggerEnter2D(i)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this.Jt=tt.createOnTriggerStay2DEvent(this.P,(i=>t.onTriggerStay2D(i)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this.Kt=tt.createOnTriggerExit2DEvent(this.P,(i=>t.onTriggerExit2D(i)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this.Lt=tt.createStartEvent(this.P,(()=>{this.Nt.startCalled=!0,t.start(),this.Nt.startRegistered&&this.g.removeEventFromNonSyncedCollection(this.Lt)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this.Mt=tt.createUpdateEvent(this.P,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this.Nt.awakeCalled||(this.Nt.awakeCalled=!0,null===(t=this.Rt)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(!function(t){return void 0!==t.onEnable}(this.gt))return;if(this.gt._engine_internal_destroyed)return;if(this.Nt.enabled)return;this.Nt.enabled=!0;const t=tt.createOnEnableEvent(this.P,this.gt.onEnable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(!function(t){return void 0!==t.onDisable}(this.gt))return;if(this.gt._engine_internal_destroyed)return;if(!this.Nt.enabled)return;this.Nt.enabled=!1;const t=tt.createOnDisableEvent(this.P,this.gt.onDisable.bind(this.gt),this.gt.executionOrder);this.g.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this.qt&&this.g.addEventToSyncedCollection(this.qt)}tryRegisterStart(){this.Lt&&(this.gt._engine_internal_destroyed||this.Nt.startCalled||this.Nt.startRegistered||(this.Nt.startRegistered=!0,this.g.addEventToNonSyncedCollection(this.Lt)))}tryUnregisterStart(){this.Lt&&this.Nt.startRegistered&&!this.Nt.startCalled&&(this.Nt.startRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Lt))}tryRegisterUpdate(){this.Mt&&(this.gt._engine_internal_destroyed||this.Nt.updateRegistered||(this.Nt.updateRegistered=!0,this.g.addEventToNonSyncedCollection(this.Mt)))}tryUnregisterUpdate(){this.Mt&&this.Nt.updateRegistered&&(this.Nt.updateRegistered=!1,this.g.removeEventFromNonSyncedCollection(this.Mt))}get onCollisionEnter2D(){return this.zt}get onCollisionStay2D(){return this.Bt}get onCollisionExit2D(){return this.Gt}get onTriggerEnter2D(){return this.Ht}get onTriggerStay2D(){return this.Jt}get onTriggerExit2D(){return this.Kt}}class Xt{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._runningCoroutines=[],this._engine_internal_destroyed=!1,this._enabled=!0,this._gameObject=t,this._instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=new Yt(this)}engine_internal_constructAfterProcess(){Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCorutine(t){this.checkComponentIsExist();const i=new Wt(this,t,(()=>{const t=this._runningCoroutines.indexOf(i);t>=0&&this._runningCoroutines.splice(t,1)}));return this._runningCoroutines.push(i),i.fatchNextInstruction(),this.engine.coroutineProcessor.addCoroutine(i),i}stopAllCoroutines(){this.checkComponentIsExist(),this._runningCoroutines.forEach((t=>{this.stopCoroutine(t)})),this._runningCoroutines.length=0}stopCoroutine(t){if(this.checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const i=this._runningCoroutines.indexOf(t);i>=0&&this._runningCoroutines.splice(i,1)}get enabled(){return this._enabled}set enabled(t){this.checkComponentIsExist(),this._enabled!==t&&(this._enabled=t,this._gameObject.initialized&&this._gameObject.activeInHierarchy&&(this._enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._gameObject}get transform(){return this._gameObject.transform}get engine(){return this._gameObject.engine}get instanceId(){return this._instanceId}get initialized(){return this._gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class Ut{constructor(t=0,i=0,e=0,s=1){1<t?t=1:0>t&&(t=0),1<i?i=1:0>i&&(i=0),1<e?e=1:0>e&&(e=0),1<s?s=1:0>s&&(s=0),this.Ue=t,this.$e=i,this.Je=e,this.Le=s}set(t,i,e,s=1){return 1<t?t=1:0>t&&(t=0),1<i?i=1:0>i&&(i=0),1<e?e=1:0>e&&(e=0),1<s?s=1:0>s&&(s=0),this.Ue=t,this.$e=i,this.Je=e,this.Le=s,this}copy(t){return this.Ue=t.r,this.$e=t.g,this.Je=t.b,this.Le=t.a,this}clone(){return new Ut(this.Ue,this.$e,this.Je,this.Le)}get r(){return this.Ue}set r(t){1<t?t=1:0>t&&(t=0),this.Ue=t}get g(){return this.$e}set g(t){1<t?t=1:0>t&&(t=0),this.$e=t}get b(){return this.Je}set b(t){1<t?t=1:0>t&&(t=0),this.Je=t}get a(){return this.Le}set a(t){1<t?t=1:0>t&&(t=0),this.Le=t}toString(){return"rgb("+255*this.Ue+", "+255*this.$e+", "+255*this.Je+")"}toStringWithAlpha(){return"rgba("+255*this.Ue+", "+255*this.$e+", "+255*this.Je+", "+this.Le+")"}toHex(){return"#"+((Math.round(255*this.Ue)<<16)+(Math.round(255*this.$e)<<8)+(Math.round(255*this.Je)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this.Ue)<<16)+(Math.round(255*this.$e)<<8)+(Math.round(255*this.Je)<<0)).toString(16).padStart(6,"0")+Math.round(255*this.Le).toString(16).padStart(2,"0")}toArray(){return[this.Ue,this.$e,this.Je,this.Le]}static fromHex(t){const i=parseInt(t.slice(1,3),16)/255,e=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new Ut(i,e,s)}static fromArray(t){return new Ut(t[0],t[1],t[2],t[3])}static fromString(t){const i=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return i?new Ut(parseInt(i[1]),parseInt(i[2]),parseInt(i[3]),parseFloat(i[4])):Ut.fromHex(t)}hueRotate(t=0,i){t=t/180*Math.PI;const e=Math.sin(t),s=Math.cos(t);this.multiplyMatrix((null!=i?i:new S).set(.213+.787*s-.213*e,.715-.715*s-.715*e,.072-.072*s+.928*e,.213-.213*s+.143*e,.715+.285*s+.14*e,.072-.072*s-.283*e,.213-.213*s-.787*e,.715-.715*s+.715*e,.072+.928*s+.072*e))}grayscale(t=1,i){this.multiplyMatrix((null!=i?i:new S).set(.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)))}sepia(t=1,i){this.multiplyMatrix((null!=i?i:new S).set(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)))}saturate(t=1,i){this.multiplyMatrix((null!=i?i:new S).set(.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t))}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}invert(t=1){let i=t+this.Ue*(1-2*t),e=t+this.$e*(1-2*t),s=t+this.Je*(1-2*t);1<i?i=1:i<0&&(i=0),1<e?e=1:e<0&&(e=0),1<s?s=1:s<0&&(s=0),this.Ue=i,this.$e=e,this.Je=s}multiplyMatrix(t){const i=t.elements;let e=this.Ue*i[0]+this.$e*i[1]+this.Je*i[2],s=this.Ue*i[3]+this.$e*i[4]+this.Je*i[5],h=this.Ue*i[6]+this.$e*i[7]+this.Je*i[8];return 1<e?e=1:e<0&&(e=0),1<s?s=1:s<0&&(s=0),1<h?h=1:h<0&&(h=0),this.Ue=e,this.$e=s,this.Je=h,this}linear(t=1,i=0){let e=this.Ue*t+i,s=this.$e*t+i,h=this.Je*t+i;return 1<e?e=1:e<0&&(e=0),1<s?s=1:s<0&&(s=0),1<h?h=1:h<0&&(h=0),this.Ue=e,this.$e=s,this.Je=h,this}hsl(){const t=this.Ue,i=this.$e,e=this.Je,s=Math.max(t,i,e),h=Math.min(t,i,e);let r,n;const o=(s+h)/2;if(s===h)r=n=0;else{const a=s-h;switch(n=o>.5?a/(2-s-h):a/(s+h),s){case t:r=(i-e)/a+(i<e?6:0);break;case i:r=(e-t)/a+2;break;case e:r=(t-i)/a+4;break;default:throw new Error("Unreachable")}r/=6}return{h:r,s:n,l:o}}}class Bt{constructor(t,i){this.Dt=t,this.Cr=(new Ut).copy(i)}get priority(){return this.Dt}set priority(t){this.Dt=t}get backgroundColor(){return this.Cr}set backgroundColor(t){this.Cr.copy(t)}}var Ht,Qt;(Qt=Ht||(Ht={}))[Qt.Perspective=0]="Perspective",Qt[Qt.Orthographic=1]="Orthographic";class Gt extends Xt{constructor(){super(...arguments),this.mh=null,this.Ca=Ht.Orthographic,this.Ta=75,this.va=5,this.ya=.1,this.wa=1e3,this.Dt=0,this.Pa=new Ut(1,1,1,0),this.Oa=(t,i)=>{const e=t/i;if(this.mh instanceof Pt)this.mh.aspect=e,this.mh.updateProjectionMatrix();else if(this.mh instanceof Ft){const t=this.va;this.mh.left=-t*e,this.mh.right=t*e,this.mh.top=t,this.mh.bottom=-t,this.mh.updateProjectionMatrix()}}}onEnable(){this.engine.screen.onResize.addListener(this.Oa),this._a()}onWorldMatrixUpdated(){this.mh&&($.updateRawObject3DWorldMatrixRecursively(this.mh),this.mh.matrixWorldInverse.copy(this.mh.matrixWorld).invert())}_a(){const t=this.engine.screen.width/this.engine.screen.height;if(this.Ca===Ht.Perspective)this.mh?this.mh instanceof Pt?(this.mh.aspect=t,this.mh.fov=this.Ta,this.mh.near=this.ya,this.mh.far=this.wa,this.mh.updateProjectionMatrix()):(this.mh.removeFromParent(),this.mh=this.ba(),this.transform.unsafeGetObject3D().add(this.mh)):(this.mh=this.ba(),this.transform.unsafeGetObject3D().add(this.mh));else{if(this.Ca!==Ht.Orthographic)throw new Error("Camera type not supported");if(this.mh)if(this.mh instanceof Ft){const i=this.va;this.mh.left=-i*t,this.mh.right=i*t,this.mh.top=i,this.mh.bottom=-i,this.mh.near=this.ya,this.mh.far=this.wa,this.mh.updateProjectionMatrix()}else this.mh.removeFromParent(),this.mh=this.Ia(),this.transform.unsafeGetObject3D().add(this.mh);else this.mh=this.Ia(),this.transform.unsafeGetObject3D().add(this.mh)}$.updateRawObject3DWorldMatrixRecursively(this.mh),this.engine.cameraContainer.addCamera(this,new Bt(this.Dt,this.Pa))}ba(){const t=this.engine.screen.width/this.engine.screen.height;return new Pt(this.Ta,t,this.ya,this.wa)}Ia(){const t=this.engine.screen.width/this.engine.screen.height,i=this.va;return new Ft(-i*t,i*t,i,-i,this.ya,this.wa)}onDisable(){this.engine.screen.onResize.removeListener(this.Oa),this.mh&&this.engine.cameraContainer.removeCamera(this)}onDestroy(){var t;null===(t=this.mh)||void 0===t||t.removeFromParent()}get cameraType(){return this.Ca}set cameraType(t){this.Ca!==t&&(this.Ca=t,this.mh&&this._a())}get fov(){return this.Ta}set fov(t){this.Ta!==t&&(this.Ta=t,this.mh instanceof Pt&&(this.mh.fov=t,this.mh.updateProjectionMatrix()))}get viewSize(){return this.va}set viewSize(t){if(this.va!==t&&(this.va=t,this.mh instanceof Ft)){const t=this.engine.screen.width/this.engine.screen.height,i=this.va;this.mh.left=-i*t,this.mh.right=i*t,this.mh.top=i,this.mh.bottom=-i,this.mh.updateProjectionMatrix()}}get near(){return this.ya}set near(t){this.ya!==t&&(this.ya=t,this.mh instanceof Pt&&(this.mh.near=t,this.mh.updateProjectionMatrix()))}get far(){return this.wa}set far(t){this.wa!==t&&(this.wa=t,this.mh instanceof Pt&&(this.mh.far=t,this.mh.updateProjectionMatrix()))}get priority(){return this.Dt}set priority(t){this.Dt=t,this.mh&&this.engine.cameraContainer.changeCameraPriority(this,t)}get backgroundColor(){return this.Pa}set backgroundColor(t){this.Pa.copy(t),this.mh&&this.engine.cameraContainer.changeCameraBackgroundColor(this,t)}get threeCamera(){return this.mh}}class qt extends Xt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Gt],this.Tr=null,this.kr=new Ot,this.Or=20,this.Vr=1,this.Mr=!1,this.Ur=!1,this.jr=.1,this.qr=new p}start(){if(this.Tr){const t=this.qr.copy(this.Tr.transform.position);t.z+=this.Or,this.transform.position.copy(t)}}update(){const t=this.qr.copy(this.Tr.transform.position);t.z+=this.Or,t.x+=this.kr.x,t.y+=this.kr.y;const i=this.transform;this.Ur?i.position.lerp(t,.1):i.position.copy(t),this.Mr&&(i.localPosition.x=Math.round(i.localPosition.x/this.Vr)*this.Vr,i.localPosition.y=Math.round(i.localPosition.y/this.Vr)*this.Vr)}setTrackTarget(t){this.Tr=t}get targetOffset(){return this.kr}set targetOffset(t){this.kr.copy(t)}get cameraDistanceOffset(){return this.Or}set cameraDistanceOffset(t){this.Or=t}get pixelPerfectUnit(){return this.Vr}set pixelPerfectUnit(t){this.Vr=t}get pixelPerfect(){return this.Mr}set pixelPerfect(t){this.Mr=t}get lerpTrack(){return this.Ur}set lerpTrack(t){this.Ur=t}get lerpAlpha(){return this.jr}set lerpAlpha(t){this.jr=t}}class Vt extends Rt{constructor(){super(...arguments),this._trackTarget=new Tt}withTrackTarget(t){return this._trackTarget=t,this}make(){return this.gameObjectBuilder.withComponent(Gt,(t=>{t.backgroundColor=new Ut(0,0,0,1),t.viewSize=8,t.cameraType=Ht.Orthographic})).withComponent(qt,(t=>{t.setTrackTarget(this._trackTarget.ref),t.targetOffset=new Ot(0,3)}))}}const Lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA8SURBVDhP7dEhCgAxDADB+/k9Lh8rDCtq6yo6JrAhKt9s/k2JEjceNGlPiRI3HjRpT4kS7w81SpQ4PJhZxl3jEH3ZDWcAAAAASUVORK5CYII=";class Zt extends H{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof Zt&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,i){return super.copy(t,i),this.element=t.element.cloneNode(!0),this}}new p,new g,new p,new w,new w;class Jt extends Xt{}class Kt extends Jt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Za=!0}start(){this.qa(),this.runOnce&&(this.enabled=!1)}update(){this.qa()}qa(){this.gameObject.getComponentsInChildren().forEach((t=>{const i=t;i.onSortByZaxis&&"function"==typeof i.onSortByZaxis&&i.onSortByZaxis(t.transform.position.z)}))}static checkAncestorZaxisInitializer(t,i){if(!t.transform.parent)return;let e=t.transform.parent;for(;e;){if(e.gameObject.getComponent(Kt))return void i(e.position.z);if(null===e.parent)break;e=e.parent}}get runOnce(){return this.Za}set runOnce(t){this.Za=t}}class $t extends Xt{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this.fa=new Ot,this.Da=.1,this.Gr=!0,this._n=0,this.Ea=!1}start(){this.Ea=!0,this.renderInitialize(),Kt.checkAncestorZaxisInitializer(this.gameObject,this.onSortByZaxis.bind(this))}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onSortByZaxis(t){this._n=t/.1,this.css3DObject&&(this.css3DObject.element.style.zIndex=Math.floor(this._n).toString())}onWorldMatrixUpdated(){this.css3DObject&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){if(!this.htmlElement)throw new Error("htmlElement is null");let i=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new Zt(this.htmlElement),i=!0):this.css3DObject?this.css3DObject.element=this.htmlElement:(this.css3DObject=new Zt(this.htmlElement),i=!0),i&&(this.htmlElement.style.pointerEvents=this.pointerEvents?"auto":"none",this.htmlElement.style.zIndex=Math.floor(this._n).toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this.fa}set centerOffset(t){this.fa.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this.Da}set viewScale(t){this.Da=t,this.updateViewScale(!0)}get pointerEvents(){return this.Gr}set pointerEvents(t){this.Gr=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get readyToDraw(){return this.Ea}}class ti{constructor(t=0,i=0,e=0,s=new Ut,h=null){this.Yn=t,this.Zn=i,this.ll=e,this.sc=(new Ut).copy(s),this.ul=h}get onChange(){return this.ul}set onChange(t){this.ul=t}get offsetX(){return this.Yn}set offsetX(t){var i;this.Yn=t,null===(i=this.ul)||void 0===i||i.call(this)}get offsetY(){return this.Zn}set offsetY(t){var i;this.Zn=t,null===(i=this.ul)||void 0===i||i.call(this)}get blur(){return this.ll}set blur(t){var i;this.ll=t,null===(i=this.ul)||void 0===i||i.call(this)}get color(){return this.sc}set color(t){var i;this.sc.copy(t),null===(i=this.ul)||void 0===i||i.call(this)}copy(t){var i;this.Yn=t.offsetX,this.Zn=t.offsetY,this.ll=t.blur,this.sc.copy(t.color),null===(i=this.ul)||void 0===i||i.call(this)}clone(){return new ti(this.Yn,this.Zn,this.ll,this.sc.clone(),this.ul)}toString(){return"drop-shadow("+this.Yn+"px "+this.Zn+"px "+this.ll+"px "+this.sc.toString()+")"}}class ii{constructor(t=null){this.ll=0,this.eu=1,this.ru=1,this.nu=null,this.ou=0,this.uu=0,this.au=0,this.lu=1,this.du=0,this.ul=t}get blur(){return this.ll}set blur(t){var i;this.ll=t,null===(i=this.ul)||void 0===i||i.call(this)}get brightness(){return this.eu}set brightness(t){var i;this.eu=t,null===(i=this.ul)||void 0===i||i.call(this)}get contrast(){return this.ru}set contrast(t){var i;this.ru=t,null===(i=this.ul)||void 0===i||i.call(this)}get dropShadow(){return this.nu}set dropShadow(t){t?(this.nu||(this.nu=new ti(void 0,void 0,void 0,void 0,this.ul)),this.nu.copy(t)):this.nu&&(this.nu.onChange=null,this.nu=null)}get grayscale(){return this.ou}set grayscale(t){var i;this.ou=t,null===(i=this.ul)||void 0===i||i.call(this)}get hueRotate(){return this.uu}set hueRotate(t){var i;this.uu=t,null===(i=this.ul)||void 0===i||i.call(this)}get invert(){return this.au}set invert(t){var i;this.au=t,null===(i=this.ul)||void 0===i||i.call(this)}get saturate(){return this.lu}set saturate(t){var i;this.lu=t,null===(i=this.ul)||void 0===i||i.call(this)}get sepia(){return this.du}set sepia(t){var i;this.du=t,null===(i=this.ul)||void 0===i||i.call(this)}toString(){let t="";return 0!==this.ll&&(t+="blur("+this.ll+"px) "),1!==this.eu&&(t+="brightness("+this.eu+") "),1!==this.ru&&(t+="contrast("+this.ru+") "),0!==this.ou&&(t+="grayscale("+this.ou+") "),0!==this.uu&&(t+="hue-rotate("+this.uu+"deg) "),0!==this.au&&(t+="invert("+this.au+") "),1!==this.lu&&(t+="saturate("+this.lu+") "),0!==this.du&&(t+="sepia("+this.du+") "),this.nu&&(t+=this.nu.toString()),t}}var ei,si;!function(t){t[t.ObjectFit=0]="ObjectFit",t[t.ClipPath=1]="ClipPath"}(ei||(ei={}));class hi extends $t{constructor(){super(...arguments),this.Aa=ei.ObjectFit,this.Fa=0,this.ja=0,this.Ga=!1,this.Ha=!1,this.Wa=1,this.Xa=()=>{this.htmlElement&&(this.htmlElement.style.filter=this.Yi.toString())},this.Yi=new ii(this.Xa),this.Sa=1,this.da=1,this.Ya=0,this.za=0,this.$a=0,this.xa=null}renderInitialize(){this.xa?this.xa():this.asyncSetImageFromPath(Lt,1,1)}updateCenterOffset(t){if(this.css3DObject)if(this.Aa===ei.ObjectFit)this.css3DObject.position.set(this.Fa*this.centerOffset.x,this.ja*this.centerOffset.y,0),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject));else{const i=this.Ya%this.da,e=Math.floor(this.Ya/this.da),s=this.Ga?-(this.Fa*this.da/2-this.Fa/2)+i*this.Fa:this.Fa*this.da/2-this.Fa/2-i*this.Fa,h=this.Ha?this.ja*this.Sa/2-this.ja/2-e*this.ja:-(this.ja*this.Sa/2-this.ja/2)+e*this.ja;this.css3DObject.position.set(this.Fa*this.centerOffset.x+s,this.ja*this.centerOffset.y+h,0),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}updateViewScale(t){if(this.css3DObject)if(this.Aa===ei.ObjectFit){const i=this.viewScale,e=this.Ga?-1:1,s=this.Ha?-1:1;this.css3DObject.scale.set(this.Fa/this.za*i*e,this.ja/this.$a*i*s,1),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}else{const i=this.viewScale,e=this.htmlElement;e.style.width=this.Fa*this.da/i+"px",e.style.height=this.ja*this.Sa/i+"px";const s=this.Ga?-1:1,h=this.Ha?-1:1;this.css3DObject.scale.set(i*s,i*h,i),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}ka(){if(this.htmlElement)if(this.Aa===ei.ObjectFit){const t=-this.Ya%this.da*this.za,i=-Math.floor(this.Ya/this.da)*this.$a;this.htmlElement.style.objectPosition=t+"px "+i+"px"}else{const t=Math.floor(this.Ya/this.da),i=this.da-this.Ya%this.da-1;this.htmlElement.style.clipPath="inset("+100/this.Sa*t+"% "+100/this.da*i+"% "+(100-(100/this.Sa*t+100/this.Sa))+"% "+(100-(100/this.da*i+100/this.da))+"%)"}}get image(){return this.htmlElement}asyncSetImageFromPath(t,i,e,s){var h;if(!this.readyToDraw)return void(this.xa=()=>this.asyncSetImageFromPath(t,i,e,s));const r=null!==(h=this.htmlElement)&&void 0!==h?h:new Image;r.src=t;const n=t=>{this.exists&&(r.removeEventListener("load",n),this.setImage(r,i,e),null==s||s())};r.addEventListener("load",n)}setImage(t,i,e){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.Sa=i,this.da=e,this.htmlElement=t,t.alt=this.gameObject.name+"_sprite_atlas",t.style.imageRendering="pixelated",t.style.opacity=this.Wa.toString(),t.style.filter=this.Yi.toString(),this.Aa===ei.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit, for supressing this warning set viewScale to 1."),this.za=t.naturalWidth/this.da,this.$a=t.naturalHeight/this.Sa,0===this.Fa&&(this.Fa=.1*this.za),0===this.ja&&(this.ja=.1*this.$a),t.style.width=this.za+"px",t.style.height=this.$a+"px",t.style.objectFit="none"):(0===this.Fa&&(this.Fa=t.naturalWidth/this.da*.1),0===this.ja&&(this.ja=t.naturalHeight/this.Sa*.1),t.style.width=this.Fa*this.da/this.viewScale+"px",t.style.height=this.ja*this.Sa/this.viewScale+"px");const s=this.initializeBaseComponents(!1);this.ka(),$.updateRawObject3DWorldMatrixRecursively(s),this.transform.enqueueRenderAttachedObject3D(s)}get renderMode(){return this.Aa}set renderMode(t){if(this.Aa!==t&&(this.Aa=t,this.htmlElement)){const t=this.htmlElement;this.Aa===ei.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit"),t.style.clipPath="",this.za=t.naturalWidth/this.da,this.$a=t.naturalHeight/this.Sa,0===this.Fa&&(this.Fa=this.za),0===this.ja&&(this.ja=this.$a),t.style.width=this.za+"px",t.style.height=this.$a+"px",t.style.objectFit="none"):(t.style.objectFit="",t.style.objectPosition="",0===this.Fa&&(this.Fa=t.naturalWidth/this.da),0===this.ja&&(this.ja=t.naturalHeight/this.Sa),t.style.width=this.Fa*this.da/this.viewScale+"px",t.style.height=this.ja*this.Sa/this.viewScale+"px"),this.updateViewScale(!1),this.updateCenterOffset(!1),this.ka(),$.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)}}get imageIndex(){return this.Ya}set imageIndex(t){this.Ya=t,this.ka(),this.Aa===ei.ClipPath&&this.updateCenterOffset(!0)}get rowCount(){return this.Sa}get columnCount(){return this.da}get imageWidth(){return this.Fa}set imageWidth(t){this.Fa=t,this.Aa===ei.ObjectFit?this.css3DObject&&(this.css3DObject.scale.x=this.Fa/this.za*this.viewScale,this.css3DObject.scale.x*=this.Ga?-1:1):this.htmlElement&&(this.htmlElement.style.width=t*this.da/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.ja}set imageHeight(t){this.ja=t,this.Aa===ei.ObjectFit?this.css3DObject&&(this.css3DObject.scale.y=this.ja/this.$a*this.viewScale,this.css3DObject.scale.y*=this.Ha?-1:1):this.htmlElement&&(this.htmlElement.style.height=t*this.Sa/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Ga}set imageFlipX(t){this.Ga=t,this.css3DObject&&(this.Ga?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),this.Aa===ei.ObjectFit?($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.ka(),this.updateCenterOffset(!0)))}get imageFlipY(){return this.Ha}set imageFlipY(t){this.Ha=t,this.css3DObject&&(this.Ha?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),this.Aa===ei.ObjectFit?($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.ka(),this.updateCenterOffset(!0)))}get opacity(){return this.Wa}set opacity(t){this.Wa=t,this.htmlElement&&(this.htmlElement.style.opacity=this.Wa.toString())}get filter(){return this.Yi}}class ri extends Xt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[hi],this.nl=null,this.ia={},this.sa=null,this.ea=null,this.na=0,this.ra=!1,this.ha=2,this.oa=0,this.aa=null}awake(){this.nl=this.gameObject.getComponent(hi),null!==this.aa&&(this.playAnimation(this.aa),this.aa=null)}update(){null!==this.nl&&this.ra&&(this.oa+=this.engine.time.deltaTime,this.oa>=this.ha&&(this.oa=0,this.na++,this.na>=this.ea.length&&(this.na=0),this.nl.imageIndex=this.ea[this.na]))}playAnimation(t){null!==this.nl?this.sa!==t&&(this.sa=t,this.ea=this.ia[t],this.na=0,this.nl.imageIndex=this.ia[t][0],this.ra=!0):this.aa=t}stopAnimation(){this.ra=!1,this.aa=null}addAnimation(t,i){0!==i.length?this.ia[t]=i:console.warn(`Animation "${t}" has no frames.`)}get frameDuration(){return this.ha}set frameDuration(t){this.ha=t}}class ni{constructor(t,i){this.ai=t,this.ui=i,this.oh=0,this.uh=0,this.lh=0,this.nh=null,this.ah=!0}calculateFCost(){this.lh=this.oh+this.uh}equals(t){return this.ai===t.ai&&this.ui===t.ui}get x(){return this.ai}get y(){return this.ui}get gCost(){return this.oh}set gCost(t){this.oh=t}get hCost(){return this.uh}set hCost(t){this.uh=t}get fCost(){return this.lh}set fCost(t){this.lh=t}get isWalkable(){return this.ah}set isWalkable(t){this.ah=t}get previousNode(){return this.nh}set previousNode(t){this.nh=t}}class oi{constructor(t){var i;this.tn=null!==(i=null==t?void 0:t.slice())&&void 0!==i?i:[]}addCollideMap(t){this.tn.push(t)}findPath(t,i){const e=new ni(t.x,t.y),s=new ni(i.x,i.y);if(this.en(e.x,e.y))return null;if(this.en(s.x,s.y))return null;const h=[],r=[];e.gCost=0,e.hCost=this.nn(e,s),e.calculateFCost(),h.push(e);let n=0;for(;h.length>0&&n<oi._iterationLimit;){n++;const t=this.rn(h);if(t.equals(s))return this.on(t);h.splice(h.indexOf(t),1),r.push(t);const i=this.hn(t);for(let e=0;e<i.length;e++){const n=i[e];if(void 0!==r.find((t=>t.equals(n))))continue;if(n.gCost=Number.MAX_VALUE,n.calculateFCost(),n.previousNode=null,this.en(n.x,n.y)){r.push(n);continue}const o=t.gCost+this.nn(t,n);o<n.gCost&&(n.previousNode=t,n.gCost=o,n.hCost=this.nn(n,s),n.calculateFCost(),void 0===h.find((t=>t.equals(n)))&&h.push(n))}}return null}hn(t){const i=[];return i.push(new ni(t.x,t.y-1)),i.push(new ni(t.x+1,t.y)),i.push(new ni(t.x,t.y+1)),i.push(new ni(t.x-1,t.y)),i}on(t){const i=[];let e=t;for(;e.previousNode;)i.push(new Ot(e.x,e.y)),e=e.previousNode;return i.push(new Ot(e.x,e.y)),i.reverse()}nn(t,i){return Math.abs(t.x-i.x)+Math.abs(t.y-i.y)}rn(t){let i=t[0];for(let e=1;e<t.length;e++)t[e].fCost<i.fCost&&(i=t[e]);return i}en(t,i){const e=this.tn;for(let s=0;s<e.length;s++){const h=e[s];if(h.checkCollision(t*h.gridCellWidth+h.gridCenterX,i*h.gridCellHeight+h.gridCenterY,oi._checkCollisionScale,oi._checkCollisionScale))return!0}return!1}}oi._checkCollisionScale=8,oi._iterationLimit=1e3,function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(si||(si={}));class ai extends Xt{constructor(){super(...arguments),this.Do=si.Down,this.xo=!1}get direction(){return this.Do}set direction(t){this.Do=t}get isMoving(){return this.xo}set isMoving(t){this.xo=t}}class li extends ai{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Dh=8,this.Ah=1,this.Mh=1,this.gr=[],this.Ph=.5,this.Th=new Ot,this.kh=new Ot,this.Ih=new Ot,this.Wh=new Ot,this.yh=new a,this.Gh=new a,this._r=this.Ir.bind(this),this.vr=null,this.wr=null,this.Lh=!1,this.Rh=null,this.Uh=0,this.Hh=null,this.Oh=new Ot,this.Fh=new Ot,this.jh=-1,this.qh=new Ot,this.Jh=.3}start(){this.wr=new oi(this.gr);const t=this.transform,i=t.position;i.x=this.Th.x+this.Wh.x*this.Mh,i.y=this.Th.y+this.Wh.y*this.Ah,this.kh.set(t.localPosition.x,t.localPosition.y);const e=t.parent;e&&this.Oh.set(e.position.x,e.position.y)}update(){var t;null===(t=this.Hh)||void 0===t||t.call(this),this.Kh(),this.Nh(),this.Qh()}Kh(){if(this.isMoving)return void this.Xh();const t=this.engine.input.map;if(t.get("w")||t.get("W")||t.get("ArrowUp")){if(this.direction=si.Up,this.en(this.kh.x,this.kh.y+this.Ah))return;this.Ih.set(this.kh.x,this.kh.y+this.Ah),this.Yh(this.Ih),this.isMoving=!0}else if(t.get("s")||t.get("S")||t.get("ArrowDown")){if(this.direction=si.Down,this.en(this.kh.x,this.kh.y-this.Ah))return;this.Ih.set(this.kh.x,this.kh.y-this.Ah),this.Yh(this.Ih),this.isMoving=!0}else if(t.get("a")||t.get("A")||t.get("ArrowLeft")){if(this.direction=si.Left,this.en(this.kh.x-this.Mh,this.kh.y))return;this.Ih.set(this.kh.x-this.Mh,this.kh.y),this.Yh(this.Ih),this.isMoving=!0}else if(t.get("d")||t.get("D")||t.get("ArrowRight")){if(this.direction=si.Right,this.en(this.kh.x+this.Mh,this.kh.y))return;this.Ih.set(this.kh.x+this.Mh,this.kh.y),this.Yh(this.Ih),this.isMoving=!0}}Zh(t){const i=this.engine.input.map;return i.get("w")||i.get("W")||i.get("ArrowUp")?(this.direction=si.Up,!this.en(t.x,t.y+this.Ah)&&(this.Ih.set(t.x,t.y+this.Ah),this.Yh(this.Ih),!0)):i.get("s")||i.get("S")||i.get("ArrowDown")?(this.direction=si.Down,!this.en(t.x,t.y-this.Ah)&&(this.Ih.set(t.x,t.y-this.Ah),this.Yh(this.Ih),!0)):i.get("a")||i.get("A")||i.get("ArrowLeft")?(this.direction=si.Left,!this.en(t.x-this.Mh,t.y)&&(this.Ih.set(t.x-this.Mh,t.y),this.Yh(this.Ih),!0)):!!(i.get("d")||i.get("D")||i.get("ArrowRight"))&&(this.direction=si.Right,!this.en(t.x+this.Mh,t.y)&&(this.Ih.set(t.x+this.Mh,t.y),this.Yh(this.Ih),!0))}Yh(t){this.yh.invoke(Math.floor(this.Ih.x/this.Mh),Math.floor(this.Ih.y/this.Ah))}$h(t){this.Gh.invoke(Math.floor(this.kh.x/this.Mh),Math.floor(this.kh.y/this.Ah))}Xh(){const t=this.engine.input.map;(t.get("w")||t.get("W")||t.get("ArrowUp")||t.get("s")||t.get("S")||t.get("ArrowDown")||t.get("a")||t.get("A")||t.get("ArrowLeft")||t.get("d")||t.get("D")||t.get("ArrowRight"))&&(this.Lh=!1)}Nh(){if(!this.Lh)return;const t=this.transform,i=this.Fh.set(t.localPosition.x,t.localPosition.y),e=this.Rh[this.Uh];if(e.distanceTo(i)<this.Dh*this.engine.time.deltaTime){if(this.Uh++,this.Uh>=this.Rh.length)return void(this.Lh=!1);this.$h(i)}if(this.en(e.x,e.y))return void(this.Lh=!1);if(this.Ih.equals(this.Rh[this.Uh]))return;this.Ih.copy(this.Rh[this.Uh]),this.Yh(this.Ih);const s=this.Rh[this.Uh-1].x,h=this.Rh[this.Uh-1].y,r=this.Rh[this.Uh].x,n=this.Rh[this.Uh].y;h<n?this.direction=si.Up:h>n?this.direction=si.Down:s<r?this.direction=si.Right:s>r&&(this.direction=si.Left),this.isMoving=!0}Qh(){if(!this.isMoving)return;const t=this.transform,i=new Ot(t.localPosition.x,t.localPosition.y);let e=i.distanceTo(this.Ih);if(e<this.Dh*this.engine.time.deltaTime&&this.Zh(this.Ih)&&(e=i.distanceTo(this.Ih),this.$h(i)),e>.01){const s=this.Fh.copy(this.Ih).sub(i).normalize();s.multiplyScalar(Math.min(this.Dh*this.engine.time.deltaTime,e)),t.localPosition.x+=s.x,t.localPosition.y+=s.y}else this.isMoving=!1,this.kh.copy(this.Ih),t.localPosition.x=this.kh.x,t.localPosition.y=this.kh.y,this.$h(this.Ih)}en(t,i){t+=this.Oh.x,i+=this.Oh.y;for(let e=0;e<this.gr.length;e++)if(this.gr[e].checkCollision(t,i,this.Ph,this.Ph))return!0;return!1}Ir(t){if(0!==t.button)return;this.Lh=!1;const i=this.engine.time.unscaledTime;i-this.jh<this.Jh?this.qh.equals(t.gridPosition)&&(this.Dr(t),this.jh=-1):(this.jh=i,this.qh.copy(t.gridPosition))}Dr(t){if(this.Lh)return this.Lh=!1,void(this.Hh=()=>this.Ar(t.gridPosition));this.Hh=()=>this.Ar(t.gridPosition)}Ar(t){this.Lh||(this.Hh=null,this.Rh=this.wr.findPath(this.positionInGrid,t),!this.Rh||this.Rh.length<=1||(this.Rh.forEach((t=>{t.x=t.x*this.Mh+this.Th.x,t.y=t.y*this.Ah+this.Th.y})),this.Uh=1,this.isMoving=!0,this.Lh=!0))}get onMoveToTarget(){return this.yh}get onMovedToTarget(){return this.Gh}get speed(){return this.Dh}set speed(t){this.Dh=t}get gridCenter(){return this.Th}set gridCenter(t){this.Th.copy(t)}get gridCellHeight(){return this.Ah}set gridCellHeight(t){this.Ah=t}get gridCellWidth(){return this.Mh}set gridCellWidth(t){this.Mh=t}set initPosition(t){this.Wh.copy(t)}set gridPointer(t){this.vr&&this.vr.onPointerDown.removeListener(this._r),this.vr=t,this.vr&&this.vr.onPointerDown.addListener(this._r)}get gridPointer(){return this.vr}addCollideMap(t){var i;this.gr.push(t),null===(i=this.wr)||void 0===i||i.addCollideMap(t)}setGridInfoFromCollideMap(t){this.Mh=t.gridCellWidth,this.Ah=t.gridCellHeight,this.Th.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new Ot(Math.floor(this.transform.localPosition.x/this.Mh),Math.floor(this.transform.localPosition.y/this.Ah))}}class ci extends Jt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.hl=0,this.Za=!0}start(){this.update(),this.Za&&this.destroy()}update(){const t=this.transform.position;t.z=-t.y+this.hl,this.gameObject.getComponentsInChildren().forEach((i=>{const e=i;e.onSortByZaxis&&"function"==typeof e.onSortByZaxis&&e.onSortByZaxis(t.z)}))}get offset(){return this.hl}set offset(t){this.hl=t}get runOnce(){return this.Za}set runOnce(t){this.Za=t}}class ui extends Xt{constructor(){super(...arguments),this._disallowMultipleComponent=!0,this._requiredComponents=[ai,ri],this._directionable=null,this._spriteAtlasAnimator=null,this._lastDirection=si.Down,this._lastIsMoving=!1}awake(){this._directionable=this.gameObject.getComponent(ai),this._spriteAtlasAnimator=this.gameObject.getComponent(ri)}update(){const t=this._directionable.direction,i=this._directionable.isMoving;i?t===si.Up?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("up_walk"),this._lastIsMoving=i,this._lastDirection=t):t===si.Down?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("down_walk"),this._lastIsMoving=i,this._lastDirection=t):t===si.Left?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("left_walk"),this._lastIsMoving=i,this._lastDirection=t):t===si.Right&&(this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("right_walk"),this._lastIsMoving=i,this._lastDirection=t)):t===si.Up?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("up_idle"),this._lastIsMoving=i,this._lastDirection=t):t===si.Down?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("down_idle"),this._lastIsMoving=i,this._lastDirection=t):t===si.Left?this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("left_idle"),this._lastIsMoving=i,this._lastDirection=t):t===si.Right&&(this._lastIsMoving===i&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("right_idle"),this._lastIsMoving=i,this._lastDirection=t))}}class di extends Rt{constructor(){super(...arguments),this._collideMaps=[],this._gridPosition=new Tt}withCollideMap(t){return this._collideMaps.push(t),this}withGridPosition(t){return this._gridPosition=t,this}make(){return this.gameObjectBuilder.withComponent(hi,(t=>{t.asyncSetImageFromPath("data:image/png;base64,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",4,4),t.centerOffset=new Ot(0,.4),t.pointerEvents=!1,t.viewScale=1,t.imageWidth=1,t.imageHeight=2})).withComponent(ri,(t=>{t.addAnimation("down_idle",[0]),t.addAnimation("right_idle",[4]),t.addAnimation("up_idle",[8]),t.addAnimation("left_idle",[12]),t.addAnimation("down_walk",[0,1,2,3]),t.addAnimation("right_walk",[4,5,6,7]),t.addAnimation("up_walk",[8,9,10,11]),t.addAnimation("left_walk",[12,13,14,15]),t.frameDuration=.2})).withComponent(li,(t=>{1<=this._collideMaps.length&&this._collideMaps[0].ref&&t.setGridInfoFromCollideMap(this._collideMaps[0].ref);for(let i=0;i<this._collideMaps.length;i++)this._collideMaps[i].ref&&t.addCollideMap(this._collideMaps[i].ref);this._gridPosition.ref&&(t.initPosition=this._gridPosition.ref),t.speed=5})).withComponent(ui).withComponent(ci,(t=>{t.runOnce=!1,t.offset=.1}))}}class mi extends Jt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.hl=-100}update(){this.transform.localPosition.z=this.engine.cameraContainer.camera.transform.position.z+this.hl,this.gameObject.getComponentsInChildren().forEach((t=>{const i=t;i.onSortByZaxis&&"function"==typeof i.onSortByZaxis&&i.onSortByZaxis(this.transform.localPosition.z)}))}get offset(){return this.hl}set offset(t){this.hl=t}}class gi{constructor(t,i,e){this.rc=t,this.Sa=e||1,this.da=i||1}get htmlImageElement(){return this.rc}get columnCount(){return this.da}get rowCount(){return this.Sa}}class pi extends $t{constructor(){super(...arguments),this.da=10,this.Sa=10,this.Yr=1,this.Kr=1,this.Wr=16,this.Nr=16,this.Br=null,this.Rr=[]}renderInitialize(){this.nc(),this.Rr.forEach((t=>t())),this.Rr=[]}updateCenterOffset(t){if(!this.css3DObject)return;const i=this.da*this.Yr,e=this.Sa*this.Kr;this.css3DObject.position.set(i*this.centerOffset.x,e*this.centerOffset.y,0),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const i=this.viewScale,e=this.htmlElement,s=this.da*this.Yr,h=this.Sa*this.Kr;e.style.width=s/i+"px",e.style.height=h/i+"px",this.css3DObject.scale.set(i,i,i),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}nc(){const t=this.da*this.Yr,i=this.Sa*this.Kr,e=this.da*this.Wr,s=this.Sa*this.Nr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=e,this.htmlElement.height=s,this.htmlElement.style.imageRendering="pixelated",this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=i/this.viewScale+"px";const h=this.initializeBaseComponents(!1);$.updateRawObject3DWorldMatrixRecursively(h),this.transform.enqueueRenderAttachedObject3D(h)}drawTile(t,i,e,s){if(!this.readyToDraw)return void this.Rr.push((()=>this.drawTile(t,i,e,s)));const h=this.htmlElement.getContext("2d"),r=this.Br[e];if(1===r.rowCount&&1===r.columnCount)h.drawImage(r.htmlImageElement,0,0,this.Wr,this.Nr,t*this.Wr,i*this.Nr,this.Wr,this.Nr);else{if(void 0===s)throw new Error("Atlas index is required.");{const e=Math.floor(s/r.columnCount),n=s%r.columnCount,o=r.htmlImageElement.width/r.columnCount,a=r.htmlImageElement.height/r.rowCount;h.drawImage(r.htmlImageElement,n*o,e*a,o,a,t*this.Wr,i*this.Nr,this.Wr,this.Nr)}}}drawTileFromTwoDimensionalArray(t,i,e){if(!this.readyToDraw)return void this.Rr.push((()=>this.drawTileFromTwoDimensionalArray(t,i,e)));const s=this.htmlElement.getContext("2d");for(let h=0;h<t.length;h++){const r=t[h];for(let t=0;t<r.length;t++){const n=r[t];if(null===n)continue;const o=this.Br[n.i];if(1===o.rowCount&&1===o.columnCount)s.drawImage(o.htmlImageElement,0,0,this.Wr,this.Nr,t*this.Wr+i*this.Wr,h*this.Nr+e*this.Nr,this.Wr,this.Nr);else{if(void 0===n.a)throw new Error("Atlas index is required.");{const r=n.a%o.columnCount,a=Math.floor(n.a/o.columnCount),l=o.htmlImageElement.width/o.columnCount,c=o.htmlImageElement.height/o.rowCount;s.drawImage(o.htmlImageElement,r*l,a*c,l,c,t*this.Wr+i*this.Wr,h*this.Nr+e*this.Nr,this.Wr,this.Nr)}}}}}clearTile(t,i){this.readyToDraw?this.htmlElement.getContext("2d").clearRect(t*this.Wr,i*this.Nr,this.Wr,this.Nr):this.Rr.push((()=>this.clearTile(t,i)))}set imageSources(t){if(this.readyToDraw){this.Br=t;for(let i=0;i<t.length;i++)if(!t[i].htmlImageElement.complete)throw new Error(`Image ${t[i].htmlImageElement.src} is not loaded.`)}else this.Rr.push((()=>this.imageSources=t))}get columnCount(){return this.da}set columnCount(t){if(this.da=t,this.htmlElement){const t=this.da*this.Yr,i=this.da*this.Wr;this.htmlElement.width=i,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Sa}set rowCount(t){if(this.Sa=t,this.htmlElement){const t=this.Sa*this.Kr,i=this.Sa*this.Nr;this.htmlElement.height=i,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Yr}set gridCellWidth(t){if(this.Yr=t,this.htmlElement){const t=this.da*this.Yr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Kr}set gridCellHeight(t){if(this.Kr=t,this.htmlElement){const t=this.Sa*this.Kr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Wr}set tileResolutionX(t){if(this.Wr=t,this.htmlElement){const t=this.da*this.Wr;this.htmlElement.width=t}}get tileResolutionY(){return this.Nr}set tileResolutionY(t){if(this.Nr=t,this.htmlElement){const t=this.Sa*this.Nr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Yr/2,i=this.rowCount%2==1?0:this.Kr/2;return new Ot(this.transform.position.x+t,this.transform.position.y+i)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Yr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Kr/2)}}class fi extends Xt{constructor(){super(...arguments),this.Fr=new Map,this.Xr=16,this.Yr=1,this.Kr=1,this.Wr=16,this.Nr=16,this.Br=null,this.Gr=!0,this.Rr=[],this.Sr=!1}start(){this.Sr=!0,this.Rr.forEach((t=>t())),this.Rr=[]}Lr(){this.Fr.forEach(((t,i)=>{const e=this.Qr(i)*this.Xr*this.Yr,s=this.sn(i)*this.Xr*this.Kr;t.gameObject.transform.localPosition.set(e,s,0)}))}Qr(t){return parseInt(t.substring(0,t.indexOf("_")))}sn(t){return parseInt(t.substring(t.indexOf("_")+1))}ln(t,i){return`${t}_${i}`}cn(t,i,e,s){const h=e-t*this.Xr+this.Xr/2,r=s-i*this.Xr+this.Xr/2;return new Ot(h,r)}un(t,i){const e=this.ln(t,i);let s=this.Fr.get(e);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+i,new p(t*this.Xr*this.Yr,i*this.Xr*this.Kr,0)).withComponent(pi,(t=>{s=t,this.Br&&(t.imageSources=this.Br),t.gridCellWidth=this.Yr,t.gridCellHeight=this.Kr,t.tileResolutionX=this.Wr,t.tileResolutionY=this.Nr,t.rowCount=this.Xr,t.columnCount=this.Xr,t.pointerEvents=this.Gr}))),this.Fr.set(e,s)),s}an(t,i){const e=this.ln(t,i),s=this.Fr.get(e);return void 0===s?null:s}drawTile(t,i,e,s){if(!this.Sr)return void this.Rr.push((()=>{this.drawTile(t,i,e,s)}));const h=Math.floor((t+this.Xr/2)/this.Xr),r=Math.floor((i+this.Xr/2)/this.Xr),n=this.un(h,r),o=this.cn(h,r,t,i),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;n.drawTile(o.x+a,this.Xr-o.y-1+l,e,s)}drawTileFromTwoDimensionalArray(t,i,e){if(this.Sr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)null!==t[s][h]&&this.drawTile(h+i,t.length-s+e-1,t[s][h].i,t[s][h].a);else this.Rr.push((()=>{this.drawTileFromTwoDimensionalArray(t,i,e)}))}clearTile(t,i){if(!this.Sr)return void this.Rr.push((()=>{this.clearTile(t,i)}));const e=Math.floor((t+this.Xr/2)/this.Xr),s=Math.floor((i+this.Xr/2)/this.Xr),h=this.an(e,s);if(null===h)return;const r=this.cn(e,s,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Xr-r.y-1+o)}get chunkSize(){return this.Xr}set chunkSize(t){this.Xr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.rowCount=this.Xr,t.columnCount=this.Xr}))}set imageSources(t){this.Sr?(this.Br=t,this.Fr.forEach(((i,e)=>{i.imageSources=t}))):this.Rr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.Gr}set pointerEvents(t){this.Gr=t,this.Fr.forEach(((i,e)=>{i.pointerEvents=t}))}get gridCellWidth(){return this.Yr}set gridCellWidth(t){this.Yr!==t&&(this.Yr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.gridCellWidth=this.Yr})))}get gridCellHeight(){return this.Kr}set gridCellHeight(t){this.Kr!==t&&(this.Kr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.gridCellHeight=this.Kr})))}get tileResolutionX(){return this.Wr}set tileResolutionX(t){this.Wr!==t&&(this.Wr=t,this.Fr.forEach(((t,i)=>{t.tileResolutionX=this.Wr})))}get tileResolutionY(){return this.Nr}set tileResolutionY(t){this.Nr!==t&&(this.Nr=t,this.Fr.forEach(((t,i)=>{t.tileResolutionY=this.Nr})))}get gridCenter(){const t=this.Xr%2==1?0:this.Yr/2,i=this.Xr%2==1?0:this.Kr/2;return new Ot(this.transform.localPosition.x+t,this.transform.localPosition.y+i)}get gridCenterX(){const t=this.Xr%2==1?0:this.Yr/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this.Xr%2==1?0:this.Kr/2;return this.transform.localPosition.y+t}}class yi extends pi{constructor(){super(...arguments),this.fn=new Map,this.Jr=!1}onEnable(){super.onEnable(),this.Jr=!0}onDisable(){super.onDisable(),this.Jr=!1}drawTile(t,i,e,s){super.drawTile(t,i,e,s);const h=Math.ceil(t-this.columnCount/2),r=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.fn.set(`${h}_${r}`,!0)}drawTileFromTwoDimensionalArray(t,i,e){super.drawTileFromTwoDimensionalArray(t,i,e);for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)if(null!==t[s][h]){const t=Math.ceil(this.transform.localPosition.x/this.gridCellWidth+(h+i)-this.columnCount/2),r=Math.ceil(this.transform.localPosition.y/this.gridCellHeight+(this.rowCount-(s+e))-this.rowCount/2)-1;this.fn.set(`${t}_${r}`,!0)}}clearTile(t,i){super.clearTile(t,i);const e=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.fn.delete(`${e}_${s}`)}addCollider(t,i){const e=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-i-this.rowCount/2)-1;this.fn.set(`${e}_${s}`,!0)}checkCollision(t,i,e,s){if(!this.Jr)return!1;const h=this.transform.position;t-=h.x,i-=h.y,this.columnCount%2==0&&(t-=this.gridCellWidth),this.rowCount%2==0&&(i-=this.gridCellHeight),this.rowCount%2==0&&(i+=this.gridCellHeight/2),this.columnCount%2==0&&(t+=this.gridCellWidth/2);const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+e)/this.gridCellWidth),o=Math.floor(i/this.gridCellHeight),a=Math.floor((i+s)/this.gridCellHeight);for(let t=o;t<=a;t++)for(let i=r;i<=n;i++)if(!0===this.fn.get(`${i}_${t}`))return!0;return!1}}class wi extends Xt{constructor(){super(...arguments),this.Fr=new Map,this.Xr=16,this.Yr=1,this.Kr=1,this.Wr=16,this.Nr=16,this.Br=null,this.Gr=!0,this.Jr=!1,this.Rr=[],this.Sr=!1}start(){this.Sr=!0,this.Rr.forEach((t=>t())),this.Rr=[]}onEnable(){this.Jr=!0}onDisable(){this.Jr=!1}Lr(){this.Fr.forEach(((t,i)=>{const e=this.Qr(i)*this.Xr*this.Yr,s=this.sn(i)*this.Xr*this.Kr;t.gameObject.transform.localPosition.set(e,s,0)}))}Qr(t){return parseInt(t.substring(0,t.indexOf("_")))}sn(t){return parseInt(t.substring(t.indexOf("_")+1))}ln(t,i){return`${t}_${i}`}cn(t,i,e,s){const h=e-t*this.Xr+this.Xr/2,r=s-i*this.Xr+this.Xr/2;return new Ot(h,r)}un(t,i){const e=this.ln(t,i);let s=this.Fr.get(e);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject(`css_tilemap_renderer_${t}_${i}`,new p(t*this.Xr*this.Yr,i*this.Xr*this.Kr,0)).withComponent(yi,(t=>{s=t,this.Br&&(t.imageSources=this.Br),t.gridCellWidth=this.Yr,t.gridCellHeight=this.Kr,t.tileResolutionX=this.Wr,t.tileResolutionY=this.Nr,t.rowCount=this.Xr,t.columnCount=this.Xr,t.pointerEvents=this.Gr}))),this.Fr.set(e,s)),s}an(t,i){const e=this.ln(t,i),s=this.Fr.get(e);return void 0===s?null:s}drawTile(t,i,e,s){if(!this.Sr)return void this.Rr.push((()=>{this.drawTile(t,i,e,s)}));const h=Math.floor((t+this.Xr/2)/this.Xr),r=Math.floor((i+this.Xr/2)/this.Xr),n=this.un(h,r),o=this.cn(h,r,t,i),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;n.drawTile(o.x+a,this.Xr-o.y-1+l,e,s)}drawTileFromTwoDimensionalArray(t,i,e){if(this.Sr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)null!==t[s][h]&&this.drawTile(h+i,t.length-s+e-1,t[s][h].i,t[s][h].a);else this.Rr.push((()=>{this.drawTileFromTwoDimensionalArray(t,i,e)}))}clearTile(t,i){if(!this.Sr)return void this.Rr.push((()=>{this.clearTile(t,i)}));const e=Math.floor((t+this.Xr/2)/this.Xr),s=Math.floor((i+this.Xr/2)/this.Xr),h=this.an(e,s);if(null===h)return;const r=this.cn(e,s,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.clearTile(r.x+n,this.Xr-r.y-1+o)}addCollider(t,i){if(!this.Sr)return void this.Rr.push((()=>{this.addCollider(t,i)}));const e=Math.floor((t+this.Xr/2)/this.Xr),s=Math.floor((i+this.Xr/2)/this.Xr),h=this.un(e,s),r=this.cn(e,s,t,i),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5;h.addCollider(r.x+n,this.Xr-r.y-1+o)}checkCollision(t,i,e,s){if(!this.Jr)return!1;const h=this.transform.position,r=Math.floor(((t-h.x)/this.Yr+this.Xr/2)/this.Xr),n=Math.floor(((i-h.y)/this.Kr+this.Xr/2)/this.Xr),o=this.ln(r,n),a=this.Fr.get(o);return void 0!==a&&a.checkCollision(t,i,e,s)}get chunkSize(){return this.Xr}set chunkSize(t){this.Xr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.rowCount=this.Xr,t.columnCount=this.Xr}))}set imageSources(t){this.Sr?this.Br=t:this.Rr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.Gr}set pointerEvents(t){this.Gr=t,this.Fr.forEach(((i,e)=>{i.pointerEvents=t}))}get gridCellWidth(){return this.Yr}set gridCellWidth(t){this.Yr!==t&&(this.Yr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.gridCellWidth=this.Yr})))}get gridCellHeight(){return this.Kr}set gridCellHeight(t){this.Kr!==t&&(this.Kr=t,this.Lr(),this.Fr.forEach(((t,i)=>{t.gridCellHeight=this.Kr})))}get tileResolutionX(){return this.Wr}set tileResolutionX(t){this.Wr!==t&&(this.Wr=t,this.Fr.forEach(((t,i)=>{t.tileResolutionX=this.Wr})))}get tileResolutionY(){return this.Nr}set tileResolutionY(t){this.Nr!==t&&(this.Nr=t,this.Fr.forEach(((t,i)=>{t.tileResolutionY=this.Nr})))}get gridCenter(){const t=this.transform.position,i=this.Xr%2==1?0:this.Yr/2,e=this.Xr%2==1?0:this.Kr/2;return new Ot(t.x+i,t.y+e)}get gridCenterX(){const t=this.transform.position,i=this.Xr%2==1?0:this.Yr/2;return t.x+i}get gridCenterY(){const t=this.transform.position,i=this.Xr%2==1?0:this.Kr/2;return t.y+i}}class Ci extends $t{constructor(){super(...arguments),this.Fa=0,this.ja=0,this.Ga=!1,this.Ha=!1,this.Wa=1,this.Xa=()=>{this.htmlElement&&(this.htmlElement.style.filter=this.Yi.toString())},this.Yi=new ii(this.Xa),this.xa=null}renderInitialize(){this.xa?this.xa():this.asyncSetImageFromPath(Lt)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this.Fa*this.centerOffset.x,this.ja*this.centerOffset.y,0),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const i=this.viewScale,e=this.htmlElement;e.style.width=this.Fa/this.viewScale+"px",e.style.height=this.ja/this.viewScale+"px";const s=this.Ga?-1:1,h=this.Ha?-1:1;this.css3DObject.scale.set(i*s,i*h,i),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get image(){return this.htmlElement}asyncSetImageFromPath(t,i){var e;if(!this.readyToDraw)return void(this.xa=()=>this.asyncSetImageFromPath(t,i));const s=null!==(e=this.htmlElement)&&void 0!==e?e:new Image;s.src=t;const h=t=>{this.exists&&(s.removeEventListener("load",h),this.setImage(s),null==i||i())};s.addEventListener("load",h)}setImage(t){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);if(this.htmlElement=t,!this.readyToDraw)return void(this.xa=()=>this.setImage(t));t.alt=this.gameObject.name+"_sprite",t.style.imageRendering="pixelated",0===this.Fa&&(this.Fa=.1*t.naturalWidth),0===this.ja&&(this.ja=.1*t.naturalHeight),t.style.width=this.Fa/this.viewScale+"px",t.style.height=this.ja/this.viewScale+"px",t.style.opacity=this.Wa.toString(),t.style.filter=this.Yi.toString();const i=this.initializeBaseComponents(!1);$.updateRawObject3DWorldMatrixRecursively(i),this.transform.enqueueRenderAttachedObject3D(i)}get imageWidth(){return this.Fa}set imageWidth(t){this.Fa=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.ja}set imageHeight(t){this.ja=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Ga}set imageFlipX(t){this.Ga=t,this.css3DObject&&(this.Ga?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),$.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imageFlipY(){return this.Ha}set imageFlipY(t){this.Ha=t,this.css3DObject&&(this.Ha?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),$.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get opacity(){return this.Wa}set opacity(t){this.Wa=t,this.htmlElement&&(this.htmlElement.style.opacity=this.Wa.toString())}get filter(){return this.Yi}}class xi extends Xt{constructor(){super(...arguments),this.fn=new Map,this.Mh=1,this.Ah=1,this.$r=!1,this.lo=!1,this.ao=new Map,this.Jr=!1,this.Rr=[],this.Sr=!1}start(){this.Sr=!0,this.Rr.forEach((t=>t())),this.Rr=[]}onEnable(){this.$r&&!this.lo&&(this.fo(),this.lo=!0),this.Jr=!0}onDisable(){this.do(),this.lo=!1,this.Jr=!1}addCollider(t,i){if(!this.Sr)return void this.Rr.push((()=>{this.addCollider(t,i)}));const e=this.fn.get(`${t}_${i}`);this.fn.set(`${t}_${i}`,void 0===e?1:e+1),this.$r&&this.br(t*this.gridCellWidth,i*this.gridCellHeight)}addColliderFromTwoDimensionalArray(t,i,e){if(this.Sr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)1===t[s][h]&&this.addCollider(h+i,t.length-(s+e));else this.Rr.push((()=>{this.addColliderFromTwoDimensionalArray(t,i,e)}))}removeCollider(t,i){const e=this.fn.get(`${t}_${i}`);void 0!==e&&(1===e?this.fn.delete(`${t}_${i}`):this.fn.set(`${t}_${i}`,e-1),this.$r&&this.uo(t*this.gridCellWidth,i*this.gridCellHeight))}fo(){this.fn.forEach(((t,i)=>{const[e,s]=i.split("_").map(Number);this.br(e*this.gridCellWidth,s*this.gridCellHeight)}))}do(){this.ao.forEach((t=>{t.destroy()})),this.ao.clear()}br(t,i){const e=new Tt;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debugImage",new p(t,i,41e4)).withComponent(Kt).withComponent(Ci,(t=>{t.opacity=.5,t.pointerEvents=!1})).getGameObject(e)),this.ao.set(`${t}_${i}`,e.ref)}uo(t,i){const e=this.ao.get(`${t}_${i}`);e&&(e.destroy(),this.ao.delete(`${t}_${i}`))}checkCollision(t,i,e,s){if(!this.Jr)return!1;const h=this.transform.position;t-=h.x,i-=h.y;const r=Math.floor(t/this.gridCellWidth),n=Math.floor((t+e)/this.gridCellWidth),o=Math.floor(i/this.gridCellHeight),a=Math.floor((i+s)/this.gridCellHeight);for(let t=o;t<=a;t++)for(let i=r;i<=n;i++){const e=this.fn.get(`${i}_${t}`);if(void 0!==e&&e>0)return!0}return!1}get gridCellWidth(){return this.Mh}set gridCellWidth(t){this.Mh=t}get gridCellHeight(){return this.Ah}set gridCellHeight(t){this.Ah=t}get showCollider(){return this.$r}set showCollider(t){this.$r!==t&&(this.$r=t,this.$r&&!this.lo?(this.fo(),this.lo=!0):(this.do(),this.lo=!1))}get gridCenter(){const t=this.transform.position;return new Ot(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}class vi extends $t{constructor(){super(...arguments),this.$i=4,this._e=4,this.tf=""}renderInitialize(){this.htmlElement=document.createElement("iframe"),this.htmlElement.title=this.gameObject.name+"_iframe",this.htmlElement.width=(this.$i/this.viewScale).toString(),this.htmlElement.height=(this._e/this.viewScale).toString(),this.htmlElement.src=this.tf,this.htmlElement.style.border="none";const t=this.initializeBaseComponents(!1);t.scale.set(this.viewScale,this.viewScale,this.viewScale),$.updateRawObject3DWorldMatrixRecursively(t),this.transform.enqueueRenderAttachedObject3D(t)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this.$i*this.centerOffset.x,this._e*this.centerOffset.y,0),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const i=this.viewScale;this.htmlElement.width=(this.$i/this.viewScale).toString(),this.htmlElement.height=(this._e/this.viewScale).toString(),this.css3DObject.scale.set(i,i,i),t&&($.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get width(){return this.$i}set width(t){this.$i=t,this.htmlElement&&(this.htmlElement.width=(t/this.viewScale).toString()),this.updateCenterOffset(!0)}get height(){return this._e}set height(t){this._e=t,this.htmlElement&&(this.htmlElement.height=(t/this.viewScale).toString()),this.updateCenterOffset(!0)}get iframeSource(){return this.tf}set iframeSource(t){this.tf=t,this.htmlElement&&(this.htmlElement.src=t)}get element(){return this.htmlElement}}class bi extends Xt{constructor(){super(...arguments),this.fn=new Map,this.co=!1,this.po=!1,this.ao=new Map,this.mo=null,this._o=!1,this.Rr=[],this.Sr=!1}start(){if(this.Sr=!0,this.Rr.forEach((t=>t())),this.Rr=[],!this.mo)throw new Error("GridCollider: gridObjectCollideMap must be set")}onEnable(){this.co&&!this.po&&(this.fo(),this.po=!0),this.Co()}onDisable(){this.co&&(this.do(),this.po=!1),this._o&&this.Mo()}onDestroy(){this.do(),this.Mo()}addCollider(t,i){this.Sr?this.fn.has(`${t}_${i}`)||(this.fn.set(`${t}_${i}`,!0),this.co&&this.br(t,i),this.gridObjectCollideMap&&this.bo(t,i)):this.Rr.push((()=>{this.addCollider(t,i)}))}addColliderFromTwoDimensionalArray(t,i,e){if(this.Sr)for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++)1===t[s][h]&&this.addCollider(h+i,t.length-(s+e));else this.Rr.push((()=>{this.addColliderFromTwoDimensionalArray(t,i,e)}))}removeCollider(t,i){this.Sr?(this.fn.delete(`${t}_${i}`),this.co&&this.uo(t,i),this.gridObjectCollideMap&&this.vo(t,i)):this.Rr.push((()=>{this.removeCollider(t,i)}))}fo(){this.fn.forEach(((t,i)=>{const[e,s]=i.split("_").map(Number);this.br(e,s)}))}do(){this.ao.forEach((t=>{t.destroy()})),this.ao.clear()}br(t,i){if(!this.mo)return;const e=t*this.mo.gridCellWidth,s=i*this.mo.gridCellHeight,h={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debugImage",new p(e,s,41e4)).withComponent(Kt).withComponent(Ci,(t=>t.opacity=.5)).getGameObject(h)),this.ao.set(`${t}_${i}`,h.ref)}uo(t,i){const e=this.ao.get(`${t}_${i}`);e&&(e.destroy(),this.ao.delete(`${t}_${i}`))}bo(t,i){if(!this.mo)return;const e=this.transform.position,s=this.mo.gridCellWidth,h=this.mo.gridCellHeight,r=this.mo.gridCenter,n=Math.floor(t+(e.x+r.x)/s),o=Math.floor(i+(e.y+r.y)/h);this.mo.addCollider(n,o)}Co(){if(!this.mo)return;const t=this.transform.position,i=this.mo.gridCellWidth,e=this.mo.gridCellHeight,s=this.mo.gridCenter;this.fn.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),a=Math.floor(n+t.x/i+s.x),l=Math.floor(o+t.y/e+s.y);this.mo.addCollider(a,l)}))}vo(t,i){if(!this.mo)return;const e=this.transform.position,s=this.mo.gridCellWidth,h=this.mo.gridCellHeight,r=this.mo.gridCenter,n=Math.floor(t+(e.x+r.x)/s),o=Math.floor(i+(e.y+r.y)/h);this.mo.removeCollider(n,o)}Mo(){if(!this.mo)return;const t=this.transform.position,i=this.mo.gridCellWidth,e=this.mo.gridCellHeight,s=this.mo.gridCenter;this.fn.forEach(((h,r)=>{const[n,o]=r.split("_").map(Number),a=Math.floor(n+(t.x+s.x)/i),l=Math.floor(o+(t.y+s.y)/e);this.mo.removeCollider(a,l)}))}get gridObjectCollideMap(){return this.mo}set gridObjectCollideMap(t){this._o&&this.Mo(),this.mo=t,this.Co(),this._o=!0,this.mo&&this.co&&(this.do(),this.fo())}get showCollideSpot(){return this.co}set showCollideSpot(t){this.co!==t&&(this.co=t,this.co&&!this.po?(this.fo(),this.po=!0):(this.do(),this.po=!1))}}class Mi extends Xt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Yn=1.5,this.Zn=1.5,this.$n=!0,this.tc=new Ot,this.Gn=new p,this.Fh=new Ot}start(){this.$n&&this.tc.set(this.transform.localPosition.x,this.transform.localPosition.y)}update(){const t=this.Gn.copy(this.engine.cameraContainer.camera.transform.position),i=this.transform.parent,e=i?i.inverseTransformPoint(t):t,s=this.Fh.set(e.x,e.y),h=s.x-this.tc.x,r=s.y-this.tc.y,n=this.Yn*h,o=this.Zn*r;this.transform.localPosition.x=this.tc.x+n,this.transform.localPosition.y=this.tc.y+o}get offsetX(){return this.Yn}set offsetX(t){this.Yn=t}get offsetY(){return this.Zn}set offsetY(t){this.Zn=t}get initializeCenterFromPosition(){return this.$n}set initializeCenterFromPosition(t){this.$n=t}get center(){return this.tc}set center(t){this.tc.copy(t)}}const Ai="data:image/png;base64,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",Ei="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAADICAYAAACzvVxoAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARaSURBVHhe7dBRshs3DETRt7csOQt0RgxBXTZ7/BWVB0pX+VggBuQj++fvv35+vfz8vH+r5rfu3HuqXn0O1O82MNffQN9U9epzoH45wF5n7j1Vrz4HXF3r7vQ9trZNs7k7fY+tbVPqb3H3vlXbptTf4u59q7ZN1LXuTt9zU783xPWvkrnjN/bi3kVjqsbtAA77Fvad9bUKOzQ3v6f60rfRmqrCDTm143f9qj9J/ybd9e+sHVW4ofKe6su9q6yp9/h9IPtUb8fb+JWLY/Dq1m93fA9tU9viosPq3PFc7v507Dgak918fanfp3N3r/57JWzzooeNQ64v9ft07u7Vf6+EbU56IPkdf4a7351zN9jm5A578dPP4O5L5w6wzWkdcK3qt5t6w3qLnZpsc1oHXKv67abesN5ipybbnNYB16p+u+H9R31MgG1ODKB7GKvevgrbnPSgjoEkDEgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAj4Wxf+0hYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDAgYUDCgIQBCWN63TlhTAkDEgYkDEgYkDAgYUDCgIQBCQMShkgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDDgI2F0lTAgYUDCgIQBCQMSBnwkjK7BJAxIGJAwIGHAx8LoGkhJGJAwIGFAwoCEAQkDEgb8p2HsX/v534dxvGH7KmxzShiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwQA/qFojeedTbhLDNSQ/iugO986i3CWGbkx7EdQd651FvE8I2Jz2I6w70zqPeJoRtTnoQ1x3onUe9TQjbnPQgrjvQO496mxC2OelBXHegdx71NiFsc9KDuO5A7zzqbULY5qQHcd2B3nnU24SwzUkP4roDvfOotwlhm5MexHUHeudRbxPCNic9iOsO9M6j3iaEbU56ENcd6J1HvU0I25x4GA/tQu8/6mMKbHPSw86JZ9P7j/qYAtuc9LBz4tn0/qM+psA2pzqA/OTzuLu/nJNgm5M9zE4+i7t3OafBNid32IuffgZ3Xzp3gG1O7rDid/wZ7n53zt1gm5exca7WQbN+Tz0X78s7j3qthG1e9IBas/9kvC/vPOq1EtqozXfOHc/l7k/HDi7chrJP9uPe9LJNceGGX/apnty7XrapKtxgwXhb7l1lTVXhhpza8bt+1Z+kf5Pu+nfWjirs0DzwPdUX36PWVBV2aH39Hvad9fX1nxugOqgz9y4aUzUcl5XMtXB1rbvT99jaNqX+FnfvW7VtSv0t7t63attEXevu9D22tk2zuTt9j621ebe5O/eeqlefA/W7Dcz1N9A3Vb36HKhfDrDXmXtP1f/2f379Azj92RPlw6PoAAAAAElFTkSuQmCC";class Oi extends Rt{constructor(){super(...arguments),this._colideTilemapChunkRenderer=new Tt,this._gridObjectCollideMap=new Tt}getColideTilemapChunkRendererRef(t){return this._colideTilemapChunkRenderer=t,this}getGridObjectCollideMapRef(t){return this._gridObjectCollideMap=t,this}make(){const t=this.instantiater;return this.gameObjectBuilder.withChild(t.buildGameObject("tilemap").withComponent(mi,(t=>t.offset=-50)).withChild(t.buildGameObject("floor",new p(0,0,-1)).withComponent(fi,(t=>{const i=new Image;i.src=Ai,t.imageSources=[new gi(i,3,20)],t.pointerEvents=!1,i.onload=()=>{i.onload=null;const e={i:0,a:57},s={i:0,a:58},h={i:0,a:48},r={i:0,a:49},n={i:0,a:52},o={i:0,a:53};t.drawTileFromTwoDimensionalArray([[s,e,s,e,s,e,s,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,s,e,s,e,s,e,s,e],[e,s,e,s,e,s,e,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,e,s,e,s,e,s,e,s],[s,e,s,e,s,e,s,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,o,n,o,h,r,h,s,e,s,e,s,e,s,e],[e,s,e,s,e,s,e,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,n,o,n,r,h,r,e,s,e,s,e,s,e,s]],-2,-2)}}))).withChild(t.buildGameObject("wall").withComponent(wi,(t=>{const i=new Image;i.src=Ai,t.imageSources=[new gi(i,3,20)],t.pointerEvents=!1,i.onload=()=>{i.onload=null;const e={i:0,a:56},s={i:0,a:50},h={i:0,a:59},r={i:0,a:40},n={i:0,a:51},o=null;t.drawTileFromTwoDimensionalArray([[e,e,e,e,e,e,e,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,s,s,s,o,o,o,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,e,e,e,e,e,e,e,e],[h,h,h,h,h,h,h,h,r,r,n,n,n,r,r,r,n,n,n,r,r,r,n,n,n,r,r,r,n,n,n,r,r,r,n,n,n,r,r,r,n,n,n,r,r,r,n,n,n,r,r,r,e,e,e,e,e,e,e,e]],-2,2);const a={i:0,a:44},l={i:0,a:42};t.drawTileFromTwoDimensionalArray([[o,o,o,o,o,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l,o,a,o,o,o,l]],-2,7),t.addCollider(-3,1),t.addCollider(-3,0),t.addCollider(-3,-1),t.addCollider(-3,-2);for(let i=-4;i<58;i++)t.addCollider(i,-3);t.addCollider(58,1),t.addCollider(58,0),t.addCollider(58,-1),t.addCollider(58,-2),[{x:5,y:1},{x:11,y:1},{x:17,y:1},{x:23,y:1},{x:29,y:1},{x:35,y:1},{x:41,y:1},{x:47,y:1}].forEach((i=>{t.drawTileFromTwoDimensionalArray([[{i:0,a:0},{i:0,a:1},{i:0,a:2}],[{i:0,a:3},{i:0,a:4},{i:0,a:5}],[{i:0,a:6},{i:0,a:7},{i:0,a:8}],[{i:0,a:9},{i:0,a:10},{i:0,a:11}],[{i:0,a:12},{i:0,a:13},{i:0,a:14}],[{i:0,a:15},{i:0,a:16},{i:0,a:17}]],i.x,i.y)})),[{x:8,y:3},{x:14,y:3},{x:20,y:3},{x:26,y:3},{x:32,y:3},{x:38,y:3},{x:44,y:3}].forEach((i=>{t.drawTileFromTwoDimensionalArray([[{i:0,a:24},{i:0,a:25},{i:0,a:26}],[{i:0,a:27},{i:0,a:28},{i:0,a:29}],[{i:0,a:30},{i:0,a:31},{i:0,a:32}],[{i:0,a:33},{i:0,a:34},{i:0,a:35}],[{i:0,a:36},{i:0,a:37},{i:0,a:38}]],i.x,i.y)}))}})).getComponent(wi,this._colideTilemapChunkRenderer))).withChild(t.buildGameObject("object_collide_map",new p(.5,.5,0)).withComponent(xi,(t=>{t.gridCellHeight=this._colideTilemapChunkRenderer.ref.gridCellHeight,t.gridCellWidth=this._colideTilemapChunkRenderer.ref.gridCellWidth})).getComponent(xi,this._gridObjectCollideMap)).withChild(t.buildGameObject("objects").withChild(t.buildGameObject("iframe",new p(51.5,.5,0)).withComponent(vi,(t=>{t.iframeSource="https://www.youtube.com/embed/p9wmCeqB0eA",t.width=12,t.height=6.75,t.viewScale=.01,t.centerOffset=new Ot(0,.5)})).withComponent(ci)).withChild(t.buildGameObject("sans",new p(39,-1,0)).withComponent(hi,(t=>{t.asyncSetImageFromPath("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAACBCAYAAADQQtQhAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADq0lEQVR4nO2d23LrIAxFcab//8s+Dyee8VBuBgkW7l4v7STxRrEshIkwx3meQazlJ4QQjuMofabFS0WBCn9a/zzP/04YEI8/++TLSP/Lx6CBnuOkfyPnBDGRlBNGM3XteOlHKBIAyAkA5AQAKSeMjJlbjpd+hBIzQF/dEQA5AYByAkBfOQGgHzvBal47pyP9hM4n94Z1Q9LP6ysxA7ic4PXz2hn9lX5CX5EAQE4AcDlhdOyb44j+Sj+h/4lfsG5A+nX9uDuyaiinI/2EjnICgNl3zCH4zu1saX9PJHglqVng7H+aE1pHCyNftHbsyFVqYX8t2h5/93juyDKcRybBepw4y/4SLXb/0i2VQa4G1218Mbfr7oQj5L2favh67ckxpddHmWV/qy3NxJHQ0zDpit3Sft0nAGjJCej6/jfoa30CQF/rEwD6ygkAVPIC0FckAJATAMgJAFSLCtD3iATvRwS8Tl/dEYCcE7wntaR/wyMStjoBBH3raYtWpH/D4465hvQjLH/efF03MUvf8j6h9QqRfoSGqACUEwD6lpHw2j7bW1/dEQCPCbwa0o/QtAVAf6fuyLLWdAVZ+0tOeOLt5VVsCbaxvxYJxJP7hC3sb+mOjjDvy9Ta6q01RdvfmhM8ykBSBpUqpD1LFZfavzoxt5TPk7sUE/tbZ1FjodjjHrX8licfbX/vVDb56mwBZf/q7kgErU9A6Gt9AkBf6xMA+soJALQ+AaCvSAAgJwCQEwBofQJAX4kZoK/uCICcAEA5AaCvnADQ1/4JAH3tnwDQV2IGoP0TAPqKBAByAgDtnwDQ1/4JAP3Z+ydY4V0wNlVfOQHA7Dtm7wjxtt8Ck+cdbbUUaQf92fsnWFxhI+sXRu1vObbGr3PwU3rToKHUCMP77tZSyyNqTLojcyMa37tYuYCwte1Ho6t4/4R7Y7WDr9d6av29rzBv+5/aUyRXEExe+Wjt5J7PmkYidTsX1CKOBH92Mflr0SIRgL4WiQD0tUgEoK+cAEB1RwB9RQIAOQGAnABABcEAfT0XFaCv7giAtRNwPx3uoK/nogL0rSNhu/6YoK/dpQD6pScEe4a19G+UIqH3img1TvpfNEQFoJwA0Ld6VnYP0v+i7giAdhwE6GvaAqC/qvhrVS2pFab2W+6fQKya28J+q+6I6IAnLLV/1Am9t++18vhZJwVhf80JnuUfJWNTuj0nawv7CfcJR+b/3GdoDNtfGx2lljfNWEJkuVADb/9xnruPFvfnHx3FMF10noX+AAAAAElFTkSuQmCCY3VtZW50SUQ9InhtcC5kaWQ6ZTUwZmNkYmItOWQ0Ny1kYzQ3LWJhNzgtZjg1ZjNiYTc0MWJlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplNTBmY2RiYi05ZDQ3LWRjNDctYmE3OC1mODVmM2JhNzQxYmUiIHN0RXZ0OndoZW49IjIwMjEtMTItMDlUMDc6NTU6MTMrMDk6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMi41IChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YmIzNWRlYTUtYTdjYy0wMTQ5LWIyYWMtMWIzMGYyOTQyYjdkIiBzdEV2dDp3aGVuPSIyMDIxLTEyLTA5VDA4OjU2OjA5KzA5OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuNSAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjhkYjBjZTAxLTZlYzgtMzQ0YS1iYjBiLWZhMGQzNzQxMWEyMyIgc3RFdnQ6d2hlbj0iMjAyMS0xMi0wOVQwOTowNzo1NyswOTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjUgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pt44XeAAAAhSSURB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",4,4),t.centerOffset=new Ot(.5,.7),t.pointerEvents=!0,t.imageIndex=12,t.imageWidth=1,t.imageHeight=1.375,t.viewScale=1,t.renderMode=ei.ObjectFit})).withComponent(bi,(t=>{t.addCollider(0,0),t.gridObjectCollideMap=this._gridObjectCollideMap.ref})).withComponent(ci)).withChild(t.buildGameObject("pillar",new p(5.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(11.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(17.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(23.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(29.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(35.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(41.5,-2,0)).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new p(47.5,-2,0)).active(!1).withComponent(Ci,(t=>{t.asyncSetImageFromPath(Ei),t.centerOffset=new Ot(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(Mi,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(mi,(t=>t.offset=-6))))}}class _i extends class{constructor(t,i){this.P=t.instantiater,this.L=i||null,this.U=new jt(t.sceneProcessor),this.S=new zt(zt.createDefaultObject())}getGameSettingObject(){return Object.freeze(this.S),this.S.make()}get instantiater(){return this.P}get interopObject(){return this.L}get sceneBuilder(){return this.U}get setting(){return this.S}}{run(){const t=this.instantiater,i=new Tt,e=new Tt,s=new Tt;return this.sceneBuilder.withChild(t.buildPrefab("sans_fight_room",Oi).getColideTilemapChunkRendererRef(i).getGridObjectCollideMapRef(e).make()).withChild(t.buildPrefab("player",di).withCollideMap(e).withCollideMap(i).withGridPosition(new Tt(new Ot(0,-1))).make().getGameObject(s)).withChild(t.buildPrefab("camera",Vt).withTrackTarget(s).make())}}!function(t){const i=new Dt(t);i.run(_i),i.inputHandler.startHandleEvents()}(document.getElementById("game_view"))})();