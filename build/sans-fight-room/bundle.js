(()=>{"use strict";var t={459:t=>{t.exports="data:image/png;base64,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"},152:t=>{t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAACBCAYAAADQQtQhAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADq0lEQVR4nO2d23LrIAxFcab//8s+Dyee8VBuBgkW7l4v7STxRrEshIkwx3meQazlJ4QQjuMofabFS0WBCn9a/zzP/04YEI8/++TLSP/Lx6CBnuOkfyPnBDGRlBNGM3XteOlHKBIAyAkA5AQAKSeMjJlbjpd+hBIzQF/dEQA5AYByAkBfOQGgHzvBal47pyP9hM4n94Z1Q9LP6ysxA7ic4PXz2hn9lX5CX5EAQE4AcDlhdOyb44j+Sj+h/4lfsG5A+nX9uDuyaiinI/2EjnICgNl3zCH4zu1saX9PJHglqVng7H+aE1pHCyNftHbsyFVqYX8t2h5/93juyDKcRybBepw4y/4SLXb/0i2VQa4G1218Mbfr7oQj5L2favh67ckxpddHmWV/qy3NxJHQ0zDpit3Sft0nAGjJCej6/jfoa30CQF/rEwD6ygkAVPIC0FckAJATAMgJAFSLCtD3iATvRwS8Tl/dEYCcE7wntaR/wyMStjoBBH3raYtWpH/D4465hvQjLH/efF03MUvf8j6h9QqRfoSGqACUEwD6lpHw2j7bW1/dEQCPCbwa0o/QtAVAf6fuyLLWdAVZ+0tOeOLt5VVsCbaxvxYJxJP7hC3sb+mOjjDvy9Ta6q01RdvfmhM8ykBSBpUqpD1LFZfavzoxt5TPk7sUE/tbZ1FjodjjHrX8licfbX/vVDb56mwBZf/q7kgErU9A6Gt9AkBf6xMA+soJALQ+AaCvSAAgJwCQEwBofQJAX4kZoK/uCICcAEA5AaCvnADQ1/4JAH3tnwDQV2IGoP0TAPqKBAByAgDtnwDQ1/4JAP3Z+ydY4V0wNlVfOQHA7Dtm7wjxtt8Ck+cdbbUUaQf92fsnWFxhI+sXRu1vObbGr3PwU3rToKHUCMP77tZSyyNqTLojcyMa37tYuYCwte1Ho6t4/4R7Y7WDr9d6av29rzBv+5/aUyRXEExe+Wjt5J7PmkYidTsX1CKOBH92Mflr0SIRgL4WiQD0tUgEoK+cAEB1RwB9RQIAOQGAnABABcEAfT0XFaCv7giAtRNwPx3uoK/nogL0rSNhu/6YoK/dpQD6pScEe4a19G+UIqH3img1TvpfNEQFoJwA0Ld6VnYP0v+i7giAdhwE6GvaAqC/qvhrVS2pFab2W+6fQKya28J+q+6I6IAnLLV/1Am9t++18vhZJwVhf80JnuUfJWNTuj0nawv7CfcJR+b/3GdoDNtfGx2lljfNWEJkuVADb/9xnruPFvfnHx3FMF10noX+AAAAAElFTkSuQmCCY3VtZW50SUQ9InhtcC5kaWQ6ZTUwZmNkYmItOWQ0Ny1kYzQ3LWJhNzgtZjg1ZjNiYTc0MWJlIj4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDplNTBmY2RiYi05ZDQ3LWRjNDctYmE3OC1mODVmM2JhNzQxYmUiIHN0RXZ0OndoZW49IjIwMjEtMTItMDlUMDc6NTU6MTMrMDk6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCAyMi41IChXaW5kb3dzKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YmIzNWRlYTUtYTdjYy0wMTQ5LWIyYWMtMWIzMGYyOTQyYjdkIiBzdEV2dDp3aGVuPSIyMDIxLTEyLTA5VDA4OjU2OjA5KzA5OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuNSAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjhkYjBjZTAxLTZlYzgtMzQ0YS1iYjBiLWZhMGQzNzQxMWEyMyIgc3RFdnQ6d2hlbj0iMjAyMS0xMi0wOVQwOTowNzo1NyswOTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjUgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pt44XeAAAAhSSURB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"},794:t=>{t.exports="data:image/png;base64,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"},13:t=>{t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAADICAYAAACzvVxoAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARaSURBVHhe7dBRshs3DETRt7csOQt0RgxBXTZ7/BWVB0pX+VggBuQj++fvv35+vfz8vH+r5rfu3HuqXn0O1O82MNffQN9U9epzoH45wF5n7j1Vrz4HXF3r7vQ9trZNs7k7fY+tbVPqb3H3vlXbptTf4u59q7ZN1LXuTt9zU783xPWvkrnjN/bi3kVjqsbtAA77Fvad9bUKOzQ3v6f60rfRmqrCDTm143f9qj9J/ybd9e+sHVW4ofKe6su9q6yp9/h9IPtUb8fb+JWLY/Dq1m93fA9tU9viosPq3PFc7v507Dgak918fanfp3N3r/57JWzzooeNQ64v9ft07u7Vf6+EbU56IPkdf4a7351zN9jm5A578dPP4O5L5w6wzWkdcK3qt5t6w3qLnZpsc1oHXKv67abesN5ipybbnNYB16p+u+H9R31MgG1ODKB7GKvevgrbnPSgjoEkDEgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAj4Wxf+0hYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDAgYUDCgIQBCWN63TlhTAkDEgYkDEgYkDAgYUDCgIQBCQMShkgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDDgI2F0lTAgYUDCgIQBCQMSBnwkjK7BJAxIGJAwIGHAx8LoGkhJGJAwIGFAwoCEAQkDEgb8p2HsX/v534dxvGH7KmxzShiQMCBhQMKAhAEJAxIGJAxIGJAwIGFAwoCEAQkDEgYkDEgYkDAgYUDCgIQBCQMSBiQMSBiQMCBhQMKAhAEJAxIGJAxIGJAwQA/qFojeedTbhLDNSQ/iugO986i3CWGbkx7EdQd651FvE8I2Jz2I6w70zqPeJoRtTnoQ1x3onUe9TQjbnPQgrjvQO496mxC2OelBXHegdx71NiFsc9KDuO5A7zzqbULY5qQHcd2B3nnU24SwzUkP4roDvfOotwlhm5MexHUHeudRbxPCNic9iOsO9M6j3iaEbU56ENcd6J1HvU0I25x4GA/tQu8/6mMKbHPSw86JZ9P7j/qYAtuc9LBz4tn0/qM+psA2pzqA/OTzuLu/nJNgm5M9zE4+i7t3OafBNid32IuffgZ3Xzp3gG1O7rDid/wZ7n53zt1gm5exca7WQbN+Tz0X78s7j3qthG1e9IBas/9kvC/vPOq1EtqozXfOHc/l7k/HDi7chrJP9uPe9LJNceGGX/apnty7XrapKtxgwXhb7l1lTVXhhpza8bt+1Z+kf5Pu+nfWjirs0DzwPdUX36PWVBV2aH39Hvad9fX1nxugOqgz9y4aUzUcl5XMtXB1rbvT99jaNqX+FnfvW7VtSv0t7t63attEXevu9D22tk2zuTt9j621ebe5O/eeqlefA/W7Dcz1N9A3Vb36HKhfDrDXmXtP1f/2f379Azj92RPlw6PoAAAAAElFTkSuQmCC"}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(()=>{var t=function(){function t(t,e){this.color=!0,this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0,this.leftChild=void 0,this.rightChild=void 0,this.key=t,this.value=e}return t.prototype.rotateLeft=function(){var t=this.parent,e=this.brother,i=this.leftChild,s=this.rightChild;if(!s)throw new Error("unknown error");var n=s.leftChild,r=s.rightChild;return t&&(t.leftChild===this?t.leftChild=s:t.rightChild===this&&(t.rightChild=s)),s.parent=t,s.brother=e,s.leftChild=this,s.rightChild=r,e&&(e.brother=s),this.parent=s,this.brother=r,this.leftChild=i,this.rightChild=n,r&&(r.parent=s,r.brother=this),i&&(i.parent=this,i.brother=n),n&&(n.parent=this,n.brother=i),s},t.prototype.rotateRight=function(){var t=this.parent,e=this.brother,i=this.leftChild;if(!i)throw new Error("unknown error");var s=this.rightChild,n=i.leftChild,r=i.rightChild;return t&&(t.leftChild===this?t.leftChild=i:t.rightChild===this&&(t.rightChild=i)),i.parent=t,i.brother=e,i.leftChild=n,i.rightChild=this,e&&(e.brother=i),n&&(n.parent=i,n.brother=this),this.parent=i,this.brother=n,this.leftChild=r,this.rightChild=s,r&&(r.parent=this,r.brother=s),s&&(s.parent=this,s.brother=r),i},t.prototype.remove=function(){if(this.leftChild||this.rightChild)throw new Error("can only remove leaf node");this.parent&&(this===this.parent.leftChild?this.parent.leftChild=void 0:this===this.parent.rightChild&&(this.parent.rightChild=void 0)),this.brother&&(this.brother.brother=void 0),this.key=void 0,this.value=void 0,this.parent=void 0,this.brother=void 0},t.TreeNodeColorType={red:!0,black:!1},t}();Object.freeze(t);const e=t;var s=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function n(t,i){var n=this;void 0===t&&(t=[]),i=i||function(t,e){return t<e?-1:t>e?1:0};var r=0,o=new e;o.color=e.TreeNodeColorType.black,this.size=function(){return r},this.empty=function(){return 0===r},this.clear=function(){r=0,o.key=void 0,o.leftChild=o.rightChild=o.brother=o.parent=void 0,o.color=e.TreeNodeColorType.black};var h=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.leftChild?h(t.leftChild):t},a=function(t){if(!t||void 0===t.key)throw new Error("unknown error");return t.rightChild?a(t.rightChild):t};this.front=function(){if(!this.empty())return h(o).key},this.back=function(){if(!this.empty())return a(o).key},this.forEach=function(t){var e,i,n=0;try{for(var r=s(this),o=r.next();!o.done;o=r.next())t(o.value,n++)}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},this.getElementByPos=function(t){var e,i;if(t<0||t>=this.size())throw new Error("pos must more than 0 and less than set's size");var n=0;try{for(var r=s(this),o=r.next();!o.done;o=r.next()){var h=o.value;if(n===t)return h;++n}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}throw new Error("unknown error")};var l=function(t){var i=t.parent;if(!i){if(t===o)return;throw new Error("unknown error")}if(t.color!==e.TreeNodeColorType.red){var s=t.brother;if(!s)throw new Error("unknown error");if(t===i.leftChild)if(s.color===e.TreeNodeColorType.red){s.color=e.TreeNodeColorType.black,i.color=e.TreeNodeColorType.red;var n=i.rotateLeft();o===i&&(o=n),l(t)}else s.color===e.TreeNodeColorType.black&&(s.rightChild&&s.rightChild.color===e.TreeNodeColorType.red?(s.color=i.color,i.color=e.TreeNodeColorType.black,s.rightChild&&(s.rightChild.color=e.TreeNodeColorType.black),n=i.rotateLeft(),o===i&&(o=n),t.color=e.TreeNodeColorType.black):s.rightChild&&s.rightChild.color!==e.TreeNodeColorType.black||!s.leftChild||s.leftChild.color!==e.TreeNodeColorType.red?s.leftChild&&s.leftChild.color!==e.TreeNodeColorType.black||s.rightChild&&s.rightChild.color!==e.TreeNodeColorType.black||(s.color=e.TreeNodeColorType.red,l(i)):(s.color=e.TreeNodeColorType.red,s.leftChild&&(s.leftChild.color=e.TreeNodeColorType.black),n=s.rotateRight(),o===s&&(o=n),l(t)));else t===i.rightChild&&(s.color===e.TreeNodeColorType.red?(s.color=e.TreeNodeColorType.black,i.color=e.TreeNodeColorType.red,n=i.rotateRight(),o===i&&(o=n),l(t)):s.color===e.TreeNodeColorType.black&&(s.leftChild&&s.leftChild.color===e.TreeNodeColorType.red?(s.color=i.color,i.color=e.TreeNodeColorType.black,s.leftChild&&(s.leftChild.color=e.TreeNodeColorType.black),n=i.rotateRight(),o===i&&(o=n),t.color=e.TreeNodeColorType.black):s.leftChild&&s.leftChild.color!==e.TreeNodeColorType.black||!s.rightChild||s.rightChild.color!==e.TreeNodeColorType.red?s.leftChild&&s.leftChild.color!==e.TreeNodeColorType.black||s.rightChild&&s.rightChild.color!==e.TreeNodeColorType.black||(s.color=e.TreeNodeColorType.red,l(i)):(s.color=e.TreeNodeColorType.red,s.rightChild&&(s.rightChild.color=e.TreeNodeColorType.black),n=s.rotateLeft(),o===s&&(o=n),l(t))))}else t.color=e.TreeNodeColorType.black},c=function(t){for(var i=t;i.leftChild||i.rightChild;){if(i.rightChild){i=h(i.rightChild);var s=t.key;t.key=i.key,i.key=s,t=i}i.leftChild&&(i=a(i.leftChild),s=t.key,t.key=i.key,i.key=s,t=i)}l(i),i&&i.remove(),--r,o.color=e.TreeNodeColorType.black},d=function(t,e){return!(!t||void 0===t.key)&&(!!d(t.leftChild,e)||!!e(t)||d(t.rightChild,e))};this.eraseElementByPos=function(t){if(t<0||t>=r)throw new Error("pos must more than 0 and less than set's size");var e=0;d(o,(function(i){return t===e?(c(i),!0):(++e,!1)}))},this.eraseElementByValue=function(t){if(!this.empty()){var e=m(o,t);void 0!==e&&void 0!==e.key&&0===i(e.key,t)&&c(e)}};var _=function(t,s){if(!t||void 0===t.key)throw new Error("unknown error");var n=i(s,t.key);return n<0?t.leftChild?_(t.leftChild,s):(t.leftChild=new e,t.leftChild.parent=t,t.leftChild.brother=t.rightChild,t.rightChild&&(t.rightChild.brother=t.leftChild),t.leftChild):n>0?t.rightChild?_(t.rightChild,s):(t.rightChild=new e,t.rightChild.parent=t,t.rightChild.brother=t.leftChild,t.leftChild&&(t.leftChild.brother=t.rightChild),t.rightChild):t},u=function(t){var i=t.parent;if(!i){if(t===o)return;throw new Error("unknown error")}if(i.color!==e.TreeNodeColorType.black&&i.color===e.TreeNodeColorType.red){var s=i.brother,n=i.parent;if(!n)throw new Error("unknown error");if(s&&s.color===e.TreeNodeColorType.red)s.color=i.color=e.TreeNodeColorType.black,n.color=e.TreeNodeColorType.red,u(n);else if(!s||s.color===e.TreeNodeColorType.black)if(i===n.leftChild)if(t===i.leftChild){i.color=e.TreeNodeColorType.black,n.color=e.TreeNodeColorType.red;var r=n.rotateRight();n===o&&(o=r)}else t===i.rightChild&&(r=i.rotateLeft(),n===o&&(o=r),u(i));else i===n.rightChild&&(t===i.leftChild?(r=i.rotateRight(),n===o&&(o=r),u(i)):t===i.rightChild&&(i.color=e.TreeNodeColorType.black,n.color=e.TreeNodeColorType.red,r=n.rotateLeft(),n===o&&(o=r)))}};this.insert=function(t){if(null==t)throw new Error("to avoid some unnecessary errors, we don't suggest you insert null or undefined here");if(this.empty())return++r,o.key=t,void(o.color=e.TreeNodeColorType.black);var s=_(o,t);void 0!==s.key&&0===i(s.key,t)||(++r,s.key=t,u(s),o.color=e.TreeNodeColorType.black)};var m=function(t,e){if(t&&void 0!==t.key){var s=i(e,t.key);return s<0?m(t.leftChild,e):s>0?m(t.rightChild,e):t}};this.find=function(t){var e=m(o,t);return void 0!==e&&void 0!==e.key&&0===i(e.key,t)};var g=function(t,e){if(t&&void 0!==t.key){var s=i(t.key,e);if(0===s)return t.key;if(s<0)return g(t.rightChild,e);var n=g(t.leftChild,e);return void 0!==n?n:t.key}};this.lowerBound=function(t){return g(o,t)};var p=function(t,e){if(t&&void 0!==t.key){if(i(t.key,e)<=0)return p(t.rightChild,e);var s=p(t.leftChild,e);return void 0!==s?s:t.key}};this.upperBound=function(t){return p(o,t)};var f=function(t,e){if(t&&void 0!==t.key){var s=i(t.key,e);if(0===s)return t.key;if(s>0)return f(t.leftChild,e);var n=f(t.rightChild,e);return void 0!==n?n:t.key}};this.reverseLowerBound=function(t){return f(o,t)};var C=function(t,e){if(t&&void 0!==t.key){if(i(t.key,e)>=0)return C(t.leftChild,e);var s=C(t.rightChild,e);return void 0!==s?s:t.key}};this.reverseUpperBound=function(t){return C(o,t)},this.union=function(t){var e=this;t.forEach((function(t){return e.insert(t)}))},this.getHeight=function(){if(this.empty())return 0;var t=function(e){return e?Math.max(t(e.leftChild),t(e.rightChild))+1:1};return t(o)};var y=function(t){return function(t,e){var i,s,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function h(r){return function(h){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(n=2&r[0]?s.return:r[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,r[1])).done)return n;switch(s=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,h])}}}(this,(function(e){switch(e.label){case 0:return t&&void 0!==t.key?[5,s(y(t.leftChild))]:[2];case 1:return e.sent(),[4,t.key];case 2:return e.sent(),[5,s(y(t.rightChild))];case 3:return e.sent(),[2]}}))};this[Symbol.iterator]=function(){return y(o)},t.forEach((function(t){return n.insert(t)})),Object.freeze(this)}Object.freeze(n);const r=n;class o{constructor(t){this._currentCameraInfo=null,this._cameraInfoMap=new Map,this._cameraQueue=new r(void 0,((t,e)=>t.info.priority===e.info.priority?t.camera.id-e.camera.id:t.info.priority-e.info.priority)),this._onChangeBackgroundColor=t}get camera(){var t,e;return null!==(e=null===(t=this._currentCameraInfo)||void 0===t?void 0:t.camera)&&void 0!==e?e:null}get currentCameraPriority(){var t,e;return null!==(e=null===(t=this._currentCameraInfo)||void 0===t?void 0:t.info.priority)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}addCamera(t,e){this._cameraInfoMap.set(t,e),this._cameraQueue.insert({camera:t,info:e}),this.setCamera()}removeCamera(t){const e=this._cameraInfoMap.get(t);e&&(this._cameraQueue.eraseElementByValue({camera:t,info:e}),this._cameraInfoMap.delete(t),this.setCamera())}changeCameraPriority(t,e){const i=this._cameraInfoMap.get(t);i&&(this._cameraQueue.eraseElementByValue({camera:t,info:i}),i.priority=e,this._cameraQueue.insert({camera:t,info:i}),this.setCamera())}changeCameraBackgroundColor(t,e){var i;const s=this._cameraInfoMap.get(t);s&&(s.backgroundColor=e,(null===(i=this._currentCameraInfo)||void 0===i?void 0:i.camera)===t&&this._onChangeBackgroundColor(e))}setCamera(){if(0===this._cameraQueue.size())return void(this._currentCameraInfo=null);const t=this._cameraQueue.front();t?(this._currentCameraInfo=t,this._onChangeBackgroundColor(this._currentCameraInfo.info.backgroundColor)):this._currentCameraInfo=null}}class h{constructor(t){this._onKeyDownDelegates=[],this._onKeyUpDelegates=[],this._onWheelDelegates=[],this._onPointerDownDelegates=[],this._onPointerUpDelegates=[],this._onPointerEnterDelegates=[],this._onPointerLeaveDelegates=[],this._onPointerMoveDelegates=[],this._touchMoveOccured=!1,this._onTouchStartFunc=null,this._lastMouseDownEvent=null,this._lastMouseEnterEvent=null,this._handleKeyDownBind=this.handleKeyDown.bind(this),this._handleKeyUpBind=this.handleKeyUp.bind(this),this._handleWheelBind=this.handleWheel.bind(this),this._handleMouseDownBind=this.handleMouseDown.bind(this),this._handleMouseUpBind=this.handleMouseUp.bind(this),this._handleMouseEnterBind=this.handleMouseEnter.bind(this),this._handleMouseLeaveBind=this.handleMouseLeave.bind(this),this._handleMouseMoveBind=this.handleMouseMove.bind(this),this._handleTouchStartBind=this.handleTouchStart.bind(this),this._handleTouchEndBind=this.handleTouchEnd.bind(this),this._handleTouchMoveBind=this.handleTouchMove.bind(this),this._handleTouchCancelBind=this.handleTouchCancel.bind(this),this._map=new Map,this._isDisposed=!1,this._renderTargetDom=t}get map(){return this._map}dispose(){this.stopHandleEvents(),this._isDisposed=!0}startHandleEvents(){if(this._isDisposed)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this._handleKeyDownBind),window.addEventListener("keyup",this._handleKeyUpBind),window.addEventListener("wheel",this._handleWheelBind),this._renderTargetDom.addEventListener("mousedown",this._handleMouseDownBind),this._renderTargetDom.addEventListener("mouseup",this._handleMouseUpBind),this._renderTargetDom.addEventListener("mouseenter",this._handleMouseEnterBind),this._renderTargetDom.addEventListener("mouseleave",this._handleMouseLeaveBind),this._renderTargetDom.addEventListener("mousemove",this._handleMouseMoveBind),this._renderTargetDom.addEventListener("touchstart",this._handleTouchStartBind),this._renderTargetDom.addEventListener("touchend",this._handleTouchEndBind),this._renderTargetDom.addEventListener("touchmove",this._handleTouchMoveBind),this._renderTargetDom.addEventListener("touchcancel",this._handleTouchCancelBind)}stopHandleEvents(){this._lastMouseDownEvent&&this.handleMouseUp(this._lastMouseDownEvent),this._lastMouseEnterEvent&&this.handleMouseLeave(this._lastMouseEnterEvent),this._map.clear(),window.removeEventListener("keydown",this._handleKeyDownBind),window.removeEventListener("keyup",this._handleKeyUpBind),window.removeEventListener("wheel",this._handleWheelBind),this._renderTargetDom.removeEventListener("mousedown",this._handleMouseDownBind),this._renderTargetDom.removeEventListener("mouseup",this._handleMouseUpBind),this._renderTargetDom.removeEventListener("mouseenter",this._handleMouseEnterBind),this._renderTargetDom.removeEventListener("mouseleave",this._handleMouseLeaveBind),this._renderTargetDom.removeEventListener("mousemove",this._handleMouseMoveBind),this._renderTargetDom.removeEventListener("touchstart",this._handleTouchStartBind),this._renderTargetDom.removeEventListener("touchend",this._handleTouchEndBind),this._renderTargetDom.removeEventListener("touchmove",this._handleTouchMoveBind),this._renderTargetDom.removeEventListener("touchcancel",this._handleTouchCancelBind)}simulateMouseEvent(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}handleKeyDown(t){this._map.set(t.key,!0),this._onKeyDownDelegates.forEach((e=>e(t)))}handleKeyUp(t){this._map.set(t.key,!1),this._onKeyUpDelegates.forEach((e=>e(t)))}handleWheel(t){this._onWheelDelegates.forEach((e=>e(t)))}handleMouseDown(t){this._lastMouseDownEvent=t,this._onPointerDownDelegates.forEach((e=>e(t)))}handleMouseUp(t){this._lastMouseDownEvent=null,this._onPointerUpDelegates.forEach((e=>e(t)))}handleMouseEnter(t){this._lastMouseEnterEvent=t,this._onPointerEnterDelegates.forEach((e=>e(t)))}handleMouseLeave(t){this._lastMouseEnterEvent=null,this._onPointerLeaveDelegates.forEach((e=>e(t)))}handleMouseMove(t){this._lastMouseDownEvent=t,this._onPointerMoveDelegates.forEach((e=>e(t)))}handleTouchStart(t){this._onTouchStartFunc=()=>{this.simulateMouseEvent("mouseenter",t.touches[0]),this.simulateMouseEvent("mousedown",t.touches[0])}}handleTouchEnd(t){this._touchMoveOccured&&(this._touchMoveOccured=!1,this.simulateMouseEvent("mouseup",t.changedTouches[0]),this.simulateMouseEvent("mouseleave",t.changedTouches[0]))}handleTouchMove(t){this._onTouchStartFunc&&(this._onTouchStartFunc(),this._onTouchStartFunc=null),this.simulateMouseEvent("mousemove",t.touches[0]),this._touchMoveOccured=!0}handleTouchCancel(t){this._touchMoveOccured&&(this._touchMoveOccured=!1,this.simulateMouseEvent("mouseleave",t.changedTouches[0]))}addOnKeyDownEventListener(t){this._onKeyDownDelegates.push(t)}addOnKeyUpEventListener(t){this._onKeyUpDelegates.push(t)}addOnWheelEventListener(t){this._onWheelDelegates.push(t)}addOnPointerDownEventListener(t){this._onPointerDownDelegates.push(t)}addOnPointerUpEventListener(t){this._onPointerUpDelegates.push(t)}addOnPointerEnterEventListener(t){this._onPointerEnterDelegates.push(t)}addOnPointerLeaveEventListener(t){this._onPointerLeaveDelegates.push(t)}addOnPointerMoveEventListener(t){this._onPointerMoveDelegates.push(t)}removeOnKeyDownEventListener(t){const e=this._onKeyDownDelegates.indexOf(t);-1!==e&&this._onKeyDownDelegates.splice(e,1)}removeOnKeyUpEventListener(t){const e=this._onKeyUpDelegates.indexOf(t);-1!==e&&this._onKeyUpDelegates.splice(e,1)}removeOnWheelEventListener(t){const e=this._onWheelDelegates.indexOf(t);-1!==e&&this._onWheelDelegates.splice(e,1)}removeOnPointerDownEventListener(t){const e=this._onPointerDownDelegates.indexOf(t);-1!==e&&this._onPointerDownDelegates.splice(e,1)}removeOnPointerUpEventListener(t){const e=this._onPointerUpDelegates.indexOf(t);-1!==e&&this._onPointerUpDelegates.splice(e,1)}removeOnPointerEnterEventListener(t){const e=this._onPointerEnterDelegates.indexOf(t);-1!==e&&this._onPointerEnterDelegates.splice(e,1)}removeOnPointerLeaveEventListener(t){const e=this._onPointerLeaveDelegates.indexOf(t);-1!==e&&this._onPointerLeaveDelegates.splice(e,1)}removeOnPointerMoveEventListener(t){const e=this._onPointerMoveDelegates.indexOf(t);-1!==e&&this._onPointerMoveDelegates.splice(e,1)}}const a=[];for(let t=0;t<256;t++)a[t]=(t<16?"0":"")+t.toString(16);const l=Math.PI/180,c=180/Math.PI;function d(t,e,i){return Math.max(e,Math.min(i,t))}class _{constructor(t=0,e=0,i=0,s=1){this._x=t,this._y=e,this._z=i,this._w=s}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,n,r,o){let h=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const d=n[r+0],_=n[r+1],u=n[r+2],m=n[r+3];if(0===o)return t[e+0]=h,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=d,t[e+1]=_,t[e+2]=u,void(t[e+3]=m);if(c!==m||h!==d||a!==_||l!==u){let t=1-o;const e=h*d+a*_+l*u+c*m,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const n=Math.sqrt(s),r=Math.atan2(n,e*i);t=Math.sin(t*r)/n,o=Math.sin(o*r)/n}const n=o*i;if(h=h*t+d*n,a=a*t+_*n,l=l*t+u*n,c=c*t+m*n,t===1-o){const t=1/Math.sqrt(h*h+a*a+l*l+c*c);h*=t,a*=t,l*=t,c*=t}}t[e]=h,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,r){const o=i[s],h=i[s+1],a=i[s+2],l=i[s+3],c=n[r],d=n[r+1],_=n[r+2],u=n[r+3];return t[e]=o*u+l*c+h*_-a*d,t[e+1]=h*u+l*d+a*c-o*_,t[e+2]=a*u+l*_+o*d-h*c,t[e+3]=l*u-o*c-h*d-a*_,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,n=t._z,r=t._order,o=Math.cos,h=Math.sin,a=o(i/2),l=o(s/2),c=o(n/2),d=h(i/2),_=h(s/2),u=h(n/2);switch(r){case"XYZ":this._x=d*l*c+a*_*u,this._y=a*_*c-d*l*u,this._z=a*l*u+d*_*c,this._w=a*l*c-d*_*u;break;case"YXZ":this._x=d*l*c+a*_*u,this._y=a*_*c-d*l*u,this._z=a*l*u-d*_*c,this._w=a*l*c+d*_*u;break;case"ZXY":this._x=d*l*c-a*_*u,this._y=a*_*c+d*l*u,this._z=a*l*u+d*_*c,this._w=a*l*c-d*_*u;break;case"ZYX":this._x=d*l*c-a*_*u,this._y=a*_*c+d*l*u,this._z=a*l*u-d*_*c,this._w=a*l*c+d*_*u;break;case"YZX":this._x=d*l*c+a*_*u,this._y=a*_*c+d*l*u,this._z=a*l*u-d*_*c,this._w=a*l*c-d*_*u;break;case"XZY":this._x=d*l*c-a*_*u,this._y=a*_*c-d*l*u,this._z=a*l*u+d*_*c,this._w=a*l*c+d*_*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],r=e[1],o=e[5],h=e[9],a=e[2],l=e[6],c=e[10],d=i+o+c;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(l-h)*t,this._y=(n-a)*t,this._z=(r-s)*t}else if(i>o&&i>c){const t=2*Math.sqrt(1+i-o-c);this._w=(l-h)/t,this._x=.25*t,this._y=(s+r)/t,this._z=(n+a)/t}else if(o>c){const t=2*Math.sqrt(1+o-i-c);this._w=(n-a)/t,this._x=(s+r)/t,this._y=.25*t,this._z=(h+l)/t}else{const t=2*Math.sqrt(1+c-i-o);this._w=(r-s)/t,this._x=(n+a)/t,this._y=(h+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(d(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,r=t._w,o=e._x,h=e._y,a=e._z,l=e._w;return this._x=i*l+r*o+s*a-n*h,this._y=s*l+r*h+n*o-i*a,this._z=n*l+r*a+i*h-s*o,this._w=r*l-i*o-s*h-n*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,n=this._z,r=this._w;let o=r*t._w+i*t._x+s*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=i,this._y=s,this._z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*n+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(h),l=Math.atan2(a,o),c=Math.sin((1-e)*l)/a,d=Math.sin(e*l)/a;return this._w=r*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(n),i*Math.cos(n),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}_.prototype.isQuaternion=!0;class u{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(g.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(g.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*s,this.y=n[1]*e+n[4]*i+n[7]*s,this.z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=t.elements,r=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*s+n[12])*r,this.y=(n[1]*e+n[5]*i+n[9]*s+n[13])*r,this.z=(n[2]*e+n[6]*i+n[10]*s+n[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,n=t.x,r=t.y,o=t.z,h=t.w,a=h*e+r*s-o*i,l=h*i+o*e-n*s,c=h*s+n*i-r*e,d=-n*e-r*i-o*s;return this.x=a*h+d*-n+l*-o-c*-r,this.y=l*h+d*-r+c*-n-a*-o,this.z=c*h+d*-o+a*-r-l*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s,this.y=n[1]*e+n[5]*i+n[9]*s,this.z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,r=e.x,o=e.y,h=e.z;return this.x=s*h-n*o,this.y=n*r-i*h,this.z=i*o-s*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return m.copy(this).projectOnVector(t),this.sub(m)}reflect(t){return this.sub(m.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(d(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}u.prototype.isVector3=!0;const m=new u,g=new _;class p{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,n,r,o,h,a,l,c,d,_,u,m,g){const p=this.elements;return p[0]=t,p[4]=e,p[8]=i,p[12]=s,p[1]=n,p[5]=r,p[9]=o,p[13]=h,p[2]=a,p[6]=l,p[10]=c,p[14]=d,p[3]=_,p[7]=u,p[11]=m,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new p).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/f.setFromMatrixColumn(t,0).length(),n=1/f.setFromMatrixColumn(t,1).length(),r=1/f.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,s=t.y,n=t.z,r=Math.cos(i),o=Math.sin(i),h=Math.cos(s),a=Math.sin(s),l=Math.cos(n),c=Math.sin(n);if("XYZ"===t.order){const t=r*l,i=r*c,s=o*l,n=o*c;e[0]=h*l,e[4]=-h*c,e[8]=a,e[1]=i+s*a,e[5]=t-n*a,e[9]=-o*h,e[2]=n-t*a,e[6]=s+i*a,e[10]=r*h}else if("YXZ"===t.order){const t=h*l,i=h*c,s=a*l,n=a*c;e[0]=t+n*o,e[4]=s*o-i,e[8]=r*a,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=i*o-s,e[6]=n+t*o,e[10]=r*h}else if("ZXY"===t.order){const t=h*l,i=h*c,s=a*l,n=a*c;e[0]=t-n*o,e[4]=-r*c,e[8]=s+i*o,e[1]=i+s*o,e[5]=r*l,e[9]=n-t*o,e[2]=-r*a,e[6]=o,e[10]=r*h}else if("ZYX"===t.order){const t=r*l,i=r*c,s=o*l,n=o*c;e[0]=h*l,e[4]=s*a-i,e[8]=t*a+n,e[1]=h*c,e[5]=n*a+t,e[9]=i*a-s,e[2]=-a,e[6]=o*h,e[10]=r*h}else if("YZX"===t.order){const t=r*h,i=r*a,s=o*h,n=o*a;e[0]=h*l,e[4]=n-t*c,e[8]=s*c+i,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-a*l,e[6]=i*c+s,e[10]=t-n*c}else if("XZY"===t.order){const t=r*h,i=r*a,s=o*h,n=o*a;e[0]=h*l,e[4]=-c,e[8]=a*l,e[1]=t*c+n,e[5]=r*l,e[9]=i*c-s,e[2]=s*c-i,e[6]=o*l,e[10]=n*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(y,t,x)}lookAt(t,e,i){const s=this.elements;return v.subVectors(t,e),0===v.lengthSq()&&(v.z=1),v.normalize(),b.crossVectors(i,v),0===b.lengthSq()&&(1===Math.abs(i.z)?v.x+=1e-4:v.z+=1e-4,v.normalize(),b.crossVectors(i,v)),b.normalize(),w.crossVectors(v,b),s[0]=b.x,s[4]=w.x,s[8]=v.x,s[1]=b.y,s[5]=w.y,s[9]=v.y,s[2]=b.z,s[6]=w.z,s[10]=v.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,r=i[0],o=i[4],h=i[8],a=i[12],l=i[1],c=i[5],d=i[9],_=i[13],u=i[2],m=i[6],g=i[10],p=i[14],f=i[3],C=i[7],y=i[11],x=i[15],b=s[0],w=s[4],v=s[8],M=s[12],E=s[1],D=s[5],O=s[9],S=s[13],j=s[2],z=s[6],k=s[10],A=s[14],P=s[3],R=s[7],T=s[11],I=s[15];return n[0]=r*b+o*E+h*j+a*P,n[4]=r*w+o*D+h*z+a*R,n[8]=r*v+o*O+h*k+a*T,n[12]=r*M+o*S+h*A+a*I,n[1]=l*b+c*E+d*j+_*P,n[5]=l*w+c*D+d*z+_*R,n[9]=l*v+c*O+d*k+_*T,n[13]=l*M+c*S+d*A+_*I,n[2]=u*b+m*E+g*j+p*P,n[6]=u*w+m*D+g*z+p*R,n[10]=u*v+m*O+g*k+p*T,n[14]=u*M+m*S+g*A+p*I,n[3]=f*b+C*E+y*j+x*P,n[7]=f*w+C*D+y*z+x*R,n[11]=f*v+C*O+y*k+x*T,n[15]=f*M+C*S+y*A+x*I,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],r=t[1],o=t[5],h=t[9],a=t[13],l=t[2],c=t[6],d=t[10],_=t[14];return t[3]*(+n*h*c-s*a*c-n*o*d+i*a*d+s*o*_-i*h*_)+t[7]*(+e*h*_-e*a*d+n*r*d-s*r*_+s*a*l-n*h*l)+t[11]*(+e*a*c-e*o*_-n*r*c+i*r*_+n*o*l-i*a*l)+t[15]*(-s*o*l-e*h*c+e*o*d+s*r*c-i*r*d+i*h*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],h=t[6],a=t[7],l=t[8],c=t[9],d=t[10],_=t[11],u=t[12],m=t[13],g=t[14],p=t[15],f=c*g*a-m*d*a+m*h*_-o*g*_-c*h*p+o*d*p,C=u*d*a-l*g*a-u*h*_+r*g*_+l*h*p-r*d*p,y=l*m*a-u*c*a+u*o*_-r*m*_-l*o*p+r*c*p,x=u*c*h-l*m*h-u*o*d+r*m*d+l*o*g-r*c*g,b=e*f+i*C+s*y+n*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=f*w,t[1]=(m*d*n-c*g*n-m*s*_+i*g*_+c*s*p-i*d*p)*w,t[2]=(o*g*n-m*h*n+m*s*a-i*g*a-o*s*p+i*h*p)*w,t[3]=(c*h*n-o*d*n-c*s*a+i*d*a+o*s*_-i*h*_)*w,t[4]=C*w,t[5]=(l*g*n-u*d*n+u*s*_-e*g*_-l*s*p+e*d*p)*w,t[6]=(u*h*n-r*g*n-u*s*a+e*g*a+r*s*p-e*h*p)*w,t[7]=(r*d*n-l*h*n+l*s*a-e*d*a-r*s*_+e*h*_)*w,t[8]=y*w,t[9]=(u*c*n-l*m*n-u*i*_+e*m*_+l*i*p-e*c*p)*w,t[10]=(r*m*n-u*o*n+u*i*a-e*m*a-r*i*p+e*o*p)*w,t[11]=(l*o*n-r*c*n-l*i*a+e*c*a+r*i*_-e*o*_)*w,t[12]=x*w,t[13]=(l*m*s-u*c*s+u*i*d-e*m*d-l*i*g+e*c*g)*w,t[14]=(u*o*s-r*m*s-u*i*h+e*m*h+r*i*g-e*o*g)*w,t[15]=(r*c*s-l*o*s+l*i*h-e*c*h-r*i*d+e*o*d)*w,this}scale(t){const e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),n=1-i,r=t.x,o=t.y,h=t.z,a=n*r,l=n*o;return this.set(a*r+i,a*o-s*h,a*h+s*o,0,a*o+s*h,l*o+i,l*h-s*r,0,a*h-s*o,l*h+s*r,n*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,n,r){return this.set(1,i,n,0,t,1,r,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,n=e._x,r=e._y,o=e._z,h=e._w,a=n+n,l=r+r,c=o+o,d=n*a,_=n*l,u=n*c,m=r*l,g=r*c,p=o*c,f=h*a,C=h*l,y=h*c,x=i.x,b=i.y,w=i.z;return s[0]=(1-(m+p))*x,s[1]=(_+y)*x,s[2]=(u-C)*x,s[3]=0,s[4]=(_-y)*b,s[5]=(1-(d+p))*b,s[6]=(g+f)*b,s[7]=0,s[8]=(u+C)*w,s[9]=(g-f)*w,s[10]=(1-(d+m))*w,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let n=f.set(s[0],s[1],s[2]).length();const r=f.set(s[4],s[5],s[6]).length(),o=f.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],C.copy(this);const h=1/n,a=1/r,l=1/o;return C.elements[0]*=h,C.elements[1]*=h,C.elements[2]*=h,C.elements[4]*=a,C.elements[5]*=a,C.elements[6]*=a,C.elements[8]*=l,C.elements[9]*=l,C.elements[10]*=l,e.setFromRotationMatrix(C),i.x=n,i.y=r,i.z=o,this}makePerspective(t,e,i,s,n,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,h=2*n/(e-t),a=2*n/(i-s),l=(e+t)/(e-t),c=(i+s)/(i-s),d=-(r+n)/(r-n),_=-2*r*n/(r-n);return o[0]=h,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=a,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=_,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,s,n,r){const o=this.elements,h=1/(e-t),a=1/(i-s),l=1/(r-n),c=(e+t)*h,d=(i+s)*a,_=(r+n)*l;return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*a,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-_,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}p.prototype.isMatrix4=!0;const f=new u,C=new p,y=new u(0,0,0),x=new u(1,1,1),b=new u,w=new u,v=new u,M=new p,E=new _;class D{constructor(t=0,e=0,i=0,s=D.DefaultOrder){this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],r=s[4],o=s[8],h=s[1],a=s[5],l=s[9],c=s[2],_=s[6],u=s[10];switch(e){case"XYZ":this._y=Math.asin(d(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(_,a),this._z=0);break;case"YXZ":this._x=Math.asin(-d(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(h,a)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(d(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-c,u),this._z=Math.atan2(-r,a)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-d(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(_,u),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-r,a));break;case"YZX":this._z=Math.asin(d(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-d(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(_,a),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return M.makeRotationFromQuaternion(t),this.setFromRotationMatrix(M,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return E.setFromEuler(this),this.setFromQuaternion(E,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}D.prototype.isEuler=!0,D.DefaultOrder="XYZ",D.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class O{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class S{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,s,n,r,o,h,a){const l=this.elements;return l[0]=t,l[1]=s,l[2]=o,l[3]=e,l[4]=n,l[5]=h,l[6]=i,l[7]=r,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,r=i[0],o=i[3],h=i[6],a=i[1],l=i[4],c=i[7],d=i[2],_=i[5],u=i[8],m=s[0],g=s[3],p=s[6],f=s[1],C=s[4],y=s[7],x=s[2],b=s[5],w=s[8];return n[0]=r*m+o*f+h*x,n[3]=r*g+o*C+h*b,n[6]=r*p+o*y+h*w,n[1]=a*m+l*f+c*x,n[4]=a*g+l*C+c*b,n[7]=a*p+l*y+c*w,n[2]=d*m+_*f+u*x,n[5]=d*g+_*C+u*b,n[8]=d*p+_*y+u*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],h=t[6],a=t[7],l=t[8];return e*r*l-e*o*a-i*n*l+i*o*h+s*n*a-s*r*h}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],r=t[4],o=t[5],h=t[6],a=t[7],l=t[8],c=l*r-o*a,d=o*h-l*n,_=a*n-r*h,u=e*c+i*d+s*_;if(0===u)return this.set(0,0,0,0,0,0,0,0,0);const m=1/u;return t[0]=c*m,t[1]=(s*a-l*i)*m,t[2]=(o*i-s*r)*m,t[3]=d*m,t[4]=(l*e-s*h)*m,t[5]=(s*n-o*e)*m,t[6]=_*m,t[7]=(i*h-a*e)*m,t[8]=(r*e-i*n)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,n,r,o){const h=Math.cos(n),a=Math.sin(n);return this.set(i*h,i*a,-i*(h*r+a*o)+r+t,-s*a,s*h,-s*(-a*r+h*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,n=s[0],r=s[3],o=s[6],h=s[1],a=s[4],l=s[7];return s[0]=e*n+i*h,s[3]=e*r+i*a,s[6]=e*o+i*l,s[1]=-i*n+e*h,s[4]=-i*r+e*a,s[7]=-i*o+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}S.prototype.isMatrix3=!0;let j=0;const z=new u,k=new _,A=new p,P=new u,R=new u,T=new u,I=new _,B=new u(1,0,0),W=new u(0,1,0),F=new u(0,0,1),G={type:"added"},U={type:"removed"};class H extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t);t.target=null}}}{constructor(){super(),Object.defineProperty(this,"id",{value:j++}),this.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(a[255&t]+a[t>>8&255]+a[t>>16&255]+a[t>>24&255]+"-"+a[255&e]+a[e>>8&255]+"-"+a[e>>16&15|64]+a[e>>24&255]+"-"+a[63&i|128]+a[i>>8&255]+"-"+a[i>>16&255]+a[i>>24&255]+a[255&s]+a[s>>8&255]+a[s>>16&255]+a[s>>24&255]).toUpperCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=H.DefaultUp.clone();const t=new u,e=new D,i=new _,s=new u(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new p},normalMatrix:{value:new S}}),this.matrix=new p,this.matrixWorld=new p,this.matrixAutoUpdate=H.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new O,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return k.setFromAxisAngle(t,e),this.quaternion.multiply(k),this}rotateOnWorldAxis(t,e){return k.setFromAxisAngle(t,e),this.quaternion.premultiply(k),this}rotateX(t){return this.rotateOnAxis(B,t)}rotateY(t){return this.rotateOnAxis(W,t)}rotateZ(t){return this.rotateOnAxis(F,t)}translateOnAxis(t,e){return z.copy(t).applyQuaternion(this.quaternion),this.position.add(z.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(B,t)}translateY(t){return this.translateOnAxis(W,t)}translateZ(t){return this.translateOnAxis(F,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(A.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?P.copy(t):P.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),R.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?A.lookAt(R,P,this.up):A.lookAt(P,R,this.up),this.quaternion.setFromRotationMatrix(A),s&&(A.extractRotation(s.matrixWorld),k.setFromRotationMatrix(A),this.quaternion.premultiply(k.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(G)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(U)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(U)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),A.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),A.multiply(t.parent.matrixWorld)),t.applyMatrix4(A),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R,t,T),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R,I,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function n(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];n(t.shapes,s)}else n(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(n(t.materials,this.material[i]));s.material=e}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(n(t.animations,i))}}if(e){const e=r(t.geometries),s=r(t.materials),n=r(t.textures),o=r(t.images),h=r(t.shapes),a=r(t.skeletons),l=r(t.animations),c=r(t.nodes);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),n.length>0&&(i.textures=n),o.length>0&&(i.images=o),h.length>0&&(i.shapes=h),a.length>0&&(i.skeletons=a),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=s,i;function r(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}H.DefaultUp=new u(0,1,0),H.DefaultMatrixAutoUpdate=!0,H.prototype.isObject3D=!0;class N extends H{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}N.prototype.isScene=!0;class Y extends N{constructor(){super(),this.matrixAutoUpdate=!1,this.autoUpdate=!1}addChildFromBuilder(t){const e=t.build(null);return t.processEvent(),e}}class L{constructor(t=0,e=0,i=0){this.isVector3=!0,this._x=t,this._y=e,this._z=i,this._onBeforeChangeCallback=()=>{},this._onBeforeGetComponentCallback=()=>{}}onBeforeChange(t){this._onBeforeChangeCallback=t}onBeforeGetComponent(t){this._onBeforeGetComponentCallback=t}get x(){return this._onBeforeGetComponentCallback(),this._x}set x(t){this._x!==t&&(this._onBeforeChangeCallback(),this._x=t)}get y(){return this._onBeforeGetComponentCallback(),this._y}set y(t){this._y!==t&&(this._onBeforeChangeCallback(),this._y=t)}get z(){return this._onBeforeGetComponentCallback(),this._z}set z(t){this._z!==t&&(this._onBeforeChangeCallback(),this._z=t)}set(t,e,i){return void 0===i&&(this._onBeforeGetComponentCallback(),i=this._z),this._x===t&&this._y===e&&this._z===i||(this._onBeforeChangeCallback(),this._x=t,this._y=e,this._z=i),this}setScalar(t){return this._x===t&&this._y===t&&this._z===t||(this._onBeforeChangeCallback(),this._x=t,this._y=t,this._z=t),this}setX(t){return this._x===t||(this._onBeforeChangeCallback(),this._x=t),this}setY(t){return this._y===t||(this._onBeforeChangeCallback(),this._y=t),this}setZ(t){return this._z===t||(this._onBeforeChangeCallback(),this._z=t),this}setComponent(t,e){switch(t){case 0:if(this._x===e)return this;this._onBeforeChangeCallback(),this._x=e;break;case 1:if(this._y===e)return this;this._onBeforeChangeCallback(),this._y=e;break;case 2:if(this._z===e)return this;this._onBeforeChangeCallback(),this._z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this._onBeforeGetComponentCallback(),t){case 0:return this._x;case 1:return this._y;case 2:return this._z;default:throw new Error("index is out of range: "+t)}}clone(){return this._onBeforeGetComponentCallback(),new u(this._x,this._y,this._z)}copy(t){return this._x===t.x&&this._y===t.y&&this._z===t.z||(this._onBeforeChangeCallback(),this._x=t.x,this._y=t.y,this._z=t.z),this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x+=t.x,this._y+=t.y,this._z+=t.z),this)}addScalar(t){return 0===t||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x+=t,this._y+=t,this._z+=t),this}addVectors(t,e){return this._onBeforeChangeCallback(),this._x=t.x+e.x,this._y=t.y+e.y,this._z=t.z+e.z,this}addScaledVector(t,e){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x+=t.x*e,this._y+=t.y*e,this._z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x-=t.x,this._y-=t.y,this._z-=t.z),this)}subScalar(t){return 0===t||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x-=t,this._y-=t,this._z-=t),this}subVectors(t,e){return this._onBeforeChangeCallback(),this._x=t.x-e.x,this._y=t.y-e.y,this._z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(1===t.x&&1===t.y&&1===t.z||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x*=t.x,this._y*=t.y,this._z*=t.z),this)}multiplyScalar(t){return 1===t||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x*=t,this._y*=t,this._z*=t),this}multiplyVectors(t,e){return this._onBeforeChangeCallback(),this._x=t.x*e.x,this._y=t.y*e.y,this._z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Q.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Q.setFromAxisAngle(t,e))}applyMatrix3(t){this._onBeforeGetComponentCallback();const e=this._x,i=this._y,s=this._z,n=t.elements;return this._onBeforeChangeCallback(),this._x=n[0]*e+n[3]*i+n[6]*s,this._y=n[1]*e+n[4]*i+n[7]*s,this._z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this._onBeforeGetComponentCallback();const e=this._x,i=this._y,s=this._z,n=t.elements,r=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this._onBeforeChangeCallback(),this._x=(n[0]*e+n[4]*i+n[8]*s+n[12])*r,this._y=(n[1]*e+n[5]*i+n[9]*s+n[13])*r,this._z=(n[2]*e+n[6]*i+n[10]*s+n[14])*r,this}applyQuaternion(t){this._onBeforeGetComponentCallback();const e=this._x,i=this._y,s=this._z,n=t.x,r=t.y,o=t.z,h=t.w,a=h*e+r*s-o*i,l=h*i+o*e-n*s,c=h*s+n*i-r*e,d=-n*e-r*i-o*s;return this._onBeforeChangeCallback(),this._x=a*h+d*-n+l*-o-c*-r,this._y=l*h+d*-r+c*-n-a*-o,this._z=c*h+d*-o+a*-r-l*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this._onBeforeGetComponentCallback();const e=this._x,i=this._y,s=this._z,n=t.elements;return this._onBeforeChangeCallback(),this._x=n[0]*e+n[4]*i+n[8]*s,this._y=n[1]*e+n[5]*i+n[9]*s,this._z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x/=t.x,this._y/=t.y,this._z/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.min(this._x,t.x),this._y=Math.min(this._y,t.y),this._z=Math.min(this._z,t.z),this}max(t){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.max(this._x,t.x),this._y=Math.max(this._y,t.y),this._z=Math.max(this._z,t.z),this}clamp(t,e){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.max(t.x,Math.min(e.x,this._x)),this._y=Math.max(t.y,Math.min(e.y,this._y)),this._z=Math.max(t.z,Math.min(e.z,this._z)),this}clampScalar(t,e){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.max(t,Math.min(e,this._x)),this._y=Math.max(t,Math.min(e,this._y)),this._z=Math.max(t,Math.min(e,this._z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this}ceil(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this}round(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this}roundToZero(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this}negate(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x=-this._x,this._y=-this._y,this._z=-this._z,this}dot(t){return this._onBeforeGetComponentCallback(),this._x*t.x+this._y*t.y+this._z*t.z}lengthSq(){return this._onBeforeGetComponentCallback(),this._x*this._x+this._y*this._y+this._z*this._z}length(){return this._onBeforeGetComponentCallback(),Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}manhattanLength(){return this._onBeforeGetComponentCallback(),Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._x+=(t.x-this._x)*e,this._y+=(t.y-this._y)*e,this._z+=(t.z-this._z)*e,this}lerpVectors(t,e,i){return this._onBeforeChangeCallback(),this._x=t.x+(e.x-t.x)*i,this._y=t.y+(e.y-t.y)*i,this._z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,r=e.x,o=e.y,h=e.z;return this._onBeforeChangeCallback(),this._x=s*h-n*o,this._y=n*r-i*h,this._z=i*o-s*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return X.copy(this).projectOnVector(t),this.sub(X)}reflect(t){return this.sub(X.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(d(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this._onBeforeGetComponentCallback();const e=this._x-t.x,i=this._y-t.y,s=this._z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return this._onBeforeGetComponentCallback(),Math.abs(this._x-t.x)+Math.abs(this._y-t.y)+Math.abs(this._z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this._onBeforeChangeCallback(),this._x=s*Math.sin(i),this._y=Math.cos(e)*t,this._z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this._onBeforeChangeCallback(),this._x=t*Math.sin(e),this._y=i,this._z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this._onBeforeChangeCallback(),this._x=e[12],this._y=e[13],this._z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this._onBeforeChangeCallback(),this._x=e,this._y=i,this._z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this._onBeforeGetComponentCallback(),t.x===this._x&&t.y===this._y&&t.z===this._z}fromArray(t,e=0){return this._x===t[e]&&this._y===t[e+1]&&this._z===t[e+2]||(this._onBeforeChangeCallback(),this._x=t[e],this._y=t[e+1],this._z=t[e+2]),this}toArray(t=[],e=0){return this._onBeforeGetComponentCallback(),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this._onBeforeChangeCallback(),this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this}random(){return this._onBeforeChangeCallback(),this._x=Math.random(),this._y=Math.random(),this._z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this._onBeforeChangeCallback(),this._x=i*Math.cos(e),this._y=i*Math.sin(e),this._z=t,this}*[Symbol.iterator](){this._onBeforeGetComponentCallback(),yield this._x,this._onBeforeGetComponentCallback(),yield this._y,this._onBeforeGetComponentCallback(),yield this._z}lengthManhattan(){throw new Error("deprecated")}distanceToManhattan(t){throw new Error("deprecated")}}const X=new L,Q=new _;class q{constructor(t=0,e=0,i=0,s=q.DefaultOrder){this.isEuler=!0,this._internal_x=t,this._internal_y=e,this._internal_z=i,this._internal_order=s,this._onChangeCallback=()=>{},this._onBeforeChangeCallback=()=>{},this._onBeforeGetComponentCallback=()=>{}}onBeforeGetComponent(t){this._onBeforeGetComponentCallback=t}onBeforeChange(t){this._onBeforeChangeCallback=t}get _x(){return this._onBeforeGetComponentCallback(),this._internal_x}set _x(t){this._internal_x=t}get _y(){return this._onBeforeGetComponentCallback(),this._internal_y}set _y(t){this._internal_y=t}get _z(){return this._onBeforeGetComponentCallback(),this._internal_z}set _z(t){this._internal_z=t}get _order(){return this._onBeforeGetComponentCallback(),this._internal_order}set _order(t){this._internal_order=t}get x(){return this._onBeforeGetComponentCallback(),this._internal_x}set x(t){this._internal_x!==t&&(this._onBeforeChangeCallback(),this._internal_x=t,this._onChangeCallback())}get y(){return this._onBeforeGetComponentCallback(),this._internal_y}set y(t){this._internal_y!==t&&(this._onBeforeChangeCallback(),this._internal_y=t,this._onChangeCallback())}get z(){return this._onBeforeGetComponentCallback(),this._internal_z}set z(t){this._internal_z!==t&&(this._onBeforeChangeCallback(),this._internal_z=t,this._onChangeCallback())}get order(){return this._onBeforeGetComponentCallback(),this._internal_order}set order(t){this._internal_order!==t&&(this._onBeforeChangeCallback(),this._internal_order=t,this._onChangeCallback())}set(t,e,i,s){return t===this._internal_x&&e===this._internal_y&&i===this._internal_z&&s===this._internal_order||(this._onBeforeChangeCallback(),this._internal_x=t,this._internal_y=e,this._internal_z=i,s&&(this._internal_order=s),this._onChangeCallback()),this}clone(){return this._onBeforeGetComponentCallback(),new D(this._internal_x,this._internal_y,this._internal_z,this._internal_order)}copy(t){return this._internal_x===t._internal_x&&this._internal_y===t._internal_y&&this._internal_z===t._internal_z&&this._internal_order===t._internal_order||(this._onBeforeChangeCallback(),this._internal_x=t._x,this._internal_y=t._y,this._internal_z=t._z,this._internal_order=t._order,this._onChangeCallback()),this}setFromRotationMatrix(t,e,i=!0){this._onBeforeGetComponentCallback();const s=t.elements,n=s[0],r=s[4],o=s[8],h=s[1],a=s[5],l=s[9],c=s[2],_=s[6],u=s[10];switch(e||(e=this._internal_order),this._onBeforeChangeCallback(),e){case"XYZ":this._internal_y=Math.asin(d(o,-1,1)),Math.abs(o)<.9999999?(this._internal_x=Math.atan2(-l,u),this._internal_z=Math.atan2(-r,n)):(this._internal_x=Math.atan2(_,a),this._internal_z=0);break;case"YXZ":this._internal_x=Math.asin(-d(l,-1,1)),Math.abs(l)<.9999999?(this._internal_y=Math.atan2(o,u),this._internal_z=Math.atan2(h,a)):(this._internal_y=Math.atan2(-c,n),this._internal_z=0);break;case"ZXY":this._internal_x=Math.asin(d(_,-1,1)),Math.abs(_)<.9999999?(this._internal_y=Math.atan2(-c,u),this._internal_z=Math.atan2(-r,a)):(this._internal_y=0,this._internal_z=Math.atan2(h,n));break;case"ZYX":this._internal_y=Math.asin(-d(c,-1,1)),Math.abs(c)<.9999999?(this._internal_x=Math.atan2(_,u),this._internal_z=Math.atan2(h,n)):(this._internal_x=0,this._internal_z=Math.atan2(-r,a));break;case"YZX":this._internal_z=Math.asin(d(h,-1,1)),Math.abs(h)<.9999999?(this._internal_x=Math.atan2(-l,a),this._internal_y=Math.atan2(-c,n)):(this._internal_x=0,this._internal_y=Math.atan2(o,u));break;case"XZY":this._internal_z=Math.asin(-d(r,-1,1)),Math.abs(r)<.9999999?(this._internal_x=Math.atan2(_,a),this._internal_y=Math.atan2(o,n)):(this._internal_x=Math.atan2(-l,u),this._internal_y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._internal_order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return V.makeRotationFromQuaternion(t),this.setFromRotationMatrix(V,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e)}reorder(t){return Z.setFromEuler(this),this.setFromQuaternion(Z,t)}equals(t){return this._onBeforeGetComponentCallback(),t._x===this._internal_x&&t._y===this._internal_y&&t._z===this._internal_z&&t._order===this._internal_order}fromArray(t){return this._internal_x===t[0]&&this._internal_y===t[1]&&this._internal_z===t[2]&&this._internal_order===t[3]||(this._onBeforeChangeCallback(),this._internal_x=t[0],this._internal_y=t[1],this._internal_z=t[2],void 0!==t[3]&&(this._internal_order=t[3]),this._onChangeCallback()),this}toArray(t=[],e=0){return this._onBeforeGetComponentCallback(),t[e]=this._internal_x,t[e+1]=this._internal_y,t[e+2]=this._internal_z,t[e+3]=this._internal_order,t}_onChange(t){return this._onChangeCallback=t,this}}q.DefaultOrder="XYZ",q.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const V=new p,Z=new _;class K{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._internal_x=t,this._internal_y=e,this._internal_z=i,this._internal_w=s,this._onChangeCallback=()=>{},this._onBeforeChangeCallback=()=>{},this._onBeforeGetComponentCallback=()=>{}}onBeforeGetComponent(t){this._onBeforeGetComponentCallback=t}onBeforeChange(t){this._onBeforeChangeCallback=t}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,n,r,o){let h=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const d=n[r+0],_=n[r+1],u=n[r+2],m=n[r+3];if(0===o)return t[e+0]=h,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=d,t[e+1]=_,t[e+2]=u,void(t[e+3]=m);if(c!==m||h!==d||a!==_||l!==u){let t=1-o;const e=h*d+a*_+l*u+c*m,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const n=Math.sqrt(s),r=Math.atan2(n,e*i);t=Math.sin(t*r)/n,o=Math.sin(o*r)/n}const n=o*i;if(h=h*t+d*n,a=a*t+_*n,l=l*t+u*n,c=c*t+m*n,t===1-o){const t=1/Math.sqrt(h*h+a*a+l*l+c*c);h*=t,a*=t,l*=t,c*=t}}t[e]=h,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,r){const o=i[s],h=i[s+1],a=i[s+2],l=i[s+3],c=n[r],d=n[r+1],_=n[r+2],u=n[r+3];return t[e]=o*u+l*c+h*_-a*d,t[e+1]=h*u+l*d+a*c-o*_,t[e+2]=a*u+l*_+o*d-h*c,t[e+3]=l*u-o*c-h*d-a*_,t}get _x(){return this._onBeforeGetComponentCallback(),this._internal_x}set _x(t){this._internal_x!==t&&(this._internal_x=t)}get _y(){return this._onBeforeGetComponentCallback(),this._internal_y}set _y(t){this._internal_y!==t&&(this._internal_y=t)}get _z(){return this._onBeforeGetComponentCallback(),this._internal_z}set _z(t){this._internal_z!==t&&(this._internal_z=t)}get _w(){return this._onBeforeGetComponentCallback(),this._internal_w}set _w(t){this._internal_w!==t&&(this._internal_w=t)}get x(){return this._onBeforeGetComponentCallback(),this._internal_x}set x(t){this._internal_x!==t&&(this._onBeforeChangeCallback(),this._internal_x=t,this._onChangeCallback())}get y(){return this._onBeforeGetComponentCallback(),this._internal_y}set y(t){this._internal_y!==t&&(this._onBeforeChangeCallback(),this._internal_y=t,this._onChangeCallback())}get z(){return this._onBeforeGetComponentCallback(),this._internal_z}set z(t){this._internal_z!==t&&(this._onBeforeChangeCallback(),this._internal_z=t,this._onChangeCallback())}get w(){return this._onBeforeGetComponentCallback(),this._internal_w}set w(t){this._internal_w!==t&&(this._onBeforeChangeCallback(),this._internal_w=t,this._onChangeCallback())}set(t,e,i,s){return this._internal_x===t&&this._internal_y===e&&this._internal_z===i&&this._internal_w===s||(this._onBeforeChangeCallback(),this._internal_x=t,this._internal_y=e,this._internal_z=i,this._internal_w=s,this._onChangeCallback()),this}clone(){return this._onBeforeGetComponentCallback(),new _(this._internal_x,this._internal_y,this._internal_z,this._internal_w)}copy(t){return this._internal_x===t.x&&this._internal_y===t.y&&this._internal_z===t.z&&this._internal_w===t.w||(this._onBeforeChangeCallback(),this._internal_x=t.x,this._internal_y=t.y,this._internal_z=t.z,this._internal_w=t.w,this._onChangeCallback()),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,n=t._z,r=t._order,o=Math.cos,h=Math.sin,a=o(i/2),l=o(s/2),c=o(n/2),d=h(i/2),_=h(s/2),u=h(n/2);switch(this._onBeforeChangeCallback(),r){case"XYZ":this._internal_x=d*l*c+a*_*u,this._internal_y=a*_*c-d*l*u,this._internal_z=a*l*u+d*_*c,this._internal_w=a*l*c-d*_*u;break;case"YXZ":this._internal_x=d*l*c+a*_*u,this._internal_y=a*_*c-d*l*u,this._internal_z=a*l*u-d*_*c,this._internal_w=a*l*c+d*_*u;break;case"ZXY":this._internal_x=d*l*c-a*_*u,this._internal_y=a*_*c+d*l*u,this._internal_z=a*l*u+d*_*c,this._internal_w=a*l*c-d*_*u;break;case"ZYX":this._internal_x=d*l*c-a*_*u,this._internal_y=a*_*c+d*l*u,this._internal_z=a*l*u-d*_*c,this._internal_w=a*l*c+d*_*u;break;case"YZX":this._internal_x=d*l*c+a*_*u,this._internal_y=a*_*c+d*l*u,this._internal_z=a*l*u-d*_*c,this._internal_w=a*l*c-d*_*u;break;case"XZY":this._internal_x=d*l*c-a*_*u,this._internal_y=a*_*c-d*l*u,this._internal_z=a*l*u+d*_*c,this._internal_w=a*l*c+d*_*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._onBeforeChangeCallback(),this._internal_x=t.x*s,this._internal_y=t.y*s,this._internal_z=t.z*s,this._internal_w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],r=e[1],o=e[5],h=e[9],a=e[2],l=e[6],c=e[10],d=i+o+c;if(this._onBeforeChangeCallback(),d>0){const t=.5/Math.sqrt(d+1);this._internal_w=.25/t,this._internal_x=(l-h)*t,this._internal_y=(n-a)*t,this._internal_z=(r-s)*t}else if(i>o&&i>c){const t=2*Math.sqrt(1+i-o-c);this._internal_w=(l-h)/t,this._internal_x=.25*t,this._internal_y=(s+r)/t,this._internal_z=(n+a)/t}else if(o>c){const t=2*Math.sqrt(1+o-i-c);this._internal_w=(n-a)/t,this._internal_x=(s+r)/t,this._internal_y=.25*t,this._internal_z=(h+l)/t}else{const t=2*Math.sqrt(1+c-i-o);this._internal_w=(r-s)/t,this._internal_x=(n+a)/t,this._internal_y=(h+l)/t,this._internal_z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return this._onBeforeChangeCallback(),i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._internal_x=-t.y,this._internal_y=t.x,this._internal_z=0,this._internal_w=i):(this._internal_x=0,this._internal_y=-t.z,this._internal_z=t.y,this._internal_w=i)):(this._internal_x=t.y*e.z-t.z*e.y,this._internal_y=t.z*e.x-t.x*e.z,this._internal_z=t.x*e.y-t.y*e.x,this._internal_w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(d(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._internal_x*=-1,this._internal_y*=-1,this._internal_z*=-1,this._onChangeCallback(),this}dot(t){return this._onBeforeGetComponentCallback(),this._internal_x*t._x+this._internal_y*t._y+this._internal_z*t._z+this._internal_w*t._w}lengthSq(){return this._onBeforeGetComponentCallback(),this._internal_x*this._internal_x+this._internal_y*this._internal_y+this._internal_z*this._internal_z+this._internal_w*this._internal_w}length(){return this._onBeforeGetComponentCallback(),Math.sqrt(this._internal_x*this._internal_x+this._internal_y*this._internal_y+this._internal_z*this._internal_z+this._internal_w*this._internal_w)}normalize(){let t=this.length();return 0===t?(this._onBeforeChangeCallback(),this._internal_x=0,this._internal_y=0,this._internal_z=0,this._internal_w=1):(t=1/t,this._onBeforeGetComponentCallback(),this._onBeforeChangeCallback(),this._internal_x=this._internal_x*t,this._internal_y=this._internal_y*t,this._internal_z=this._internal_z*t,this._internal_w=this._internal_w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,r=t._w,o=e._x,h=e._y,a=e._z,l=e._w;return this._onBeforeChangeCallback(),this._internal_x=i*l+r*o+s*a-n*h,this._internal_y=s*l+r*h+n*o-i*a,this._internal_z=n*l+r*a+i*h-s*o,this._internal_w=r*l-i*o-s*h-n*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);this._onBeforeGetComponentCallback();const i=this._internal_x,s=this._internal_y,n=this._internal_z,r=this._internal_w;let o=r*t._w+i*t._x+s*t._y+n*t._z;if(this._onBeforeChangeCallback(),o<0?(this._internal_w=-t._w,this._internal_x=-t._x,this._internal_y=-t._y,this._internal_z=-t._z,o=-o):this.copy(t),o>=1)return this._internal_w=r,this._internal_x=i,this._internal_y=s,this._internal_z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const t=1-e;return this._internal_w=t*r+e*this._internal_w,this._internal_x=t*i+e*this._internal_x,this._internal_y=t*s+e*this._internal_y,this._internal_z=t*n+e*this._internal_z,this.normalize(),this}const a=Math.sqrt(h),l=Math.atan2(a,o),c=Math.sin((1-e)*l)/a,d=Math.sin(e*l)/a;return this._internal_w=r*c+this._internal_w*d,this._internal_x=i*c+this._internal_x*d,this._internal_y=s*c+this._internal_y*d,this._internal_z=n*c+this._internal_z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(n),i*Math.cos(n),e*Math.sin(s))}equals(t){return this._onBeforeGetComponentCallback(),t._x===this._internal_x&&t._y===this._internal_y&&t._z===this._internal_z&&t._w===this._internal_w}fromArray(t,e=0){return this._internal_x===t[e]&&this._internal_y===t[e+1]&&this._internal_z===t[e+2]&&this._internal_w===t[e+3]||(this._onBeforeChangeCallback(),this._internal_x=t[e],this._internal_y=t[e+1],this._internal_z=t[e+2],this._internal_w=t[e+3],this._onChangeCallback()),this}toArray(t=[],e=0){return this._onBeforeGetComponentCallback(),t[e]=this._internal_x,t[e+1]=this._internal_y,t[e+2]=this._internal_z,t[e+3]=this._internal_w,t}fromBufferAttribute(t,e){return this._internal_x=t.getX(e),this._internal_y=t.getY(e),this._internal_z=t.getZ(e),this._internal_w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}multiplyVector3(t){throw new Error("deprecated")}inverse(){throw new Error("deprecated")}}class J{constructor(t,e,i){this._hasChanged=!1,this._localMatrixNeedUpdate=!1,this._worldMatrixNeedUpdate=!1,this._worldPositionRotationScaleNeedUpdate=!1,this._localPositionRotationScaleNeedUpdate=!1,this._onBeforeGetLocalBind=this.onBeforeGetLocal.bind(this),this._onBeforeLocalChangeBind=this.onBeforeLocalChange.bind(this),this._onLocalEulerRotationChangedBind=this.onLocalEulerRotationChanged.bind(this),this._onLocalRotationChangedBind=this.onLocalRotationChanged.bind(this),this._onBeforeGetWorldBind=this.onBeforeGetWorld.bind(this),this._onBeforeWorldChangeBind=this.onBeforeWorldChange.bind(this),this._onWorldEulerRotationChangedBind=this.onWorldEulerRotationChanged.bind(this),this._onWorldRotationChangedBind=this.onWorldRotationChanged.bind(this),this._ignoreObservableEvent=!1,this.isRegisteredToProcessor=!1,this._engineGlobalObject=e,this._onParentChanged=i,this._object3D=new J.TransformObject3D,this._object3D.matrixAutoUpdate=!0,this._object3D.userData=this,e.scene.add(this._object3D),Object.defineProperties(this._object3D,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this._onBeforeGetLocalBind,n=this._onBeforeLocalChangeBind,r=new L;r.onBeforeGetComponent(s),r.onBeforeChange(n),this._object3D.position=r;const o=new q;o.onBeforeGetComponent(s),o.onBeforeChange(n),o._onChange(this._onLocalEulerRotationChangedBind),this._object3D.rotation=o;const h=new K;h.onBeforeGetComponent(s),h.onBeforeChange(n),h._onChange(this._onLocalRotationChangedBind),this._object3D.quaternion=h;const a=new L(1,1,1);a.onBeforeGetComponent(s),a.onBeforeChange(n),this._object3D.scale=a,this._gameObject=t;const l=this._onBeforeGetWorldBind,c=this._onBeforeWorldChangeBind,d=new L;d.onBeforeGetComponent(l),d.onBeforeChange(c),this._worldPosition=d;const _=new q;_.onBeforeGetComponent(l),_.onBeforeChange(c),_._onChange(this._onWorldEulerRotationChangedBind),this._worldRotationEuler=_;const u=new K;u.onBeforeGetComponent(l),u.onBeforeChange(c),u._onChange(this._onWorldRotationChangedBind),this._worldRotation=u;const m=new L(1,1,1);m.onBeforeGetComponent(l),m.onBeforeChange(c),this._worldScale=m,this.setWorldMatrixNeedUpdateRecursively()}onBeforeGetLocal(){this._ignoreObservableEvent||this.updateLocalPositionRotationScaleFromOthers()}onBeforeLocalChange(){this._ignoreObservableEvent||(this.updateChildrenLocalPositionRotationScaleFromOthersRecursively(),this._localPositionRotationScaleNeedUpdate=!1,this._localMatrixNeedUpdate=!0,this.setWorldMatrixNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),this.setHasChangedRecursively())}onLocalEulerRotationChanged(){this._ignoreObservableEvent||this._object3D.quaternion.setFromEuler(this._object3D.rotation,!1)}onLocalRotationChanged(){this._ignoreObservableEvent||this._object3D.rotation.setFromQuaternion(this._object3D.quaternion,void 0,!1)}onBeforeGetWorld(){this._ignoreObservableEvent||this.updateWorldPositionRotationScaleFromOthers()}onBeforeWorldChange(){this._ignoreObservableEvent||(this.updateChildrenLocalPositionRotationScaleFromOthersRecursively(),this._worldPositionRotationScaleNeedUpdate=!1,this._localPositionRotationScaleNeedUpdate=!0,this._localMatrixNeedUpdate=!0,this.setWorldMatrixNeedUpdateRecursively(),this.setChildrenWorldPositionRotationScaleNeedUpdateRecursively(),this.setHasChangedRecursively())}onWorldEulerRotationChanged(){this._ignoreObservableEvent||this._worldRotation.setFromEuler(this._worldRotationEuler,!1)}onWorldRotationChanged(){this._ignoreObservableEvent||this._worldRotationEuler.setFromQuaternion(this._worldRotation,void 0,!1)}setWorldPositionRotationScaleNeedUpdateRecursively(){this._worldPositionRotationScaleNeedUpdate=!0;const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.setWorldPositionRotationScaleNeedUpdateRecursively()}}setChildrenWorldPositionRotationScaleNeedUpdateRecursively(){const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.setWorldPositionRotationScaleNeedUpdateRecursively()}}setWorldMatrixNeedUpdateRecursively(){this._engineGlobalObject.transformMatrixProcessor.enqueueTransformToUpdate(this),this.setWorldMatrixNeedUpdateRecursivelyInternal()}setWorldMatrixNeedUpdateRecursivelyInternal(){this._worldMatrixNeedUpdate=!0;const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.setWorldMatrixNeedUpdateRecursivelyInternal()}}setHasChangedRecursively(){this._hasChanged=!0;const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.setHasChangedRecursively()}}updateLocalPositionRotationScaleFromOthers(){if(this._localPositionRotationScaleNeedUpdate){if(this._localMatrixNeedUpdate){this._worldMatrixNeedUpdate&&(this._ignoreObservableEvent=!0,this._object3D.matrixWorld.compose(this._worldPosition,this._worldRotation,this._worldScale),this._ignoreObservableEvent=!1,this._worldMatrixNeedUpdate=!1,this._gameObject.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=J._matrix4Buffer.copy(t._object3D.matrixWorld).invert();this._object3D.matrix.multiplyMatrices(this._object3D.matrixWorld,e)}else this._object3D.matrix.copy(this._object3D.matrixWorld);this._localMatrixNeedUpdate=!1}this._ignoreObservableEvent=!0,this._object3D.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this._ignoreObservableEvent=!1,this._localPositionRotationScaleNeedUpdate=!1}}updateWorldPositionRotationScaleFromOthers(){this._worldPositionRotationScaleNeedUpdate&&(this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this._ignoreObservableEvent=!0,this._object3D.matrixWorld.decompose(this._worldPosition,this._worldRotation,this._worldScale),this._worldRotationEuler.setFromQuaternion(this._worldRotation,void 0,!1),this._ignoreObservableEvent=!1,this._worldPositionRotationScaleNeedUpdate=!1)}updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(){if(!this._worldMatrixNeedUpdate)return;const t=this._object3D.matrix;if(this._localMatrixNeedUpdate)if(this._localPositionRotationScaleNeedUpdate)this._ignoreObservableEvent=!0,this._object3D.matrixWorld.compose(this._worldPosition,this._worldRotation,this._worldScale),this._ignoreObservableEvent=!1;else{this._localMatrixNeedUpdate&&(this._ignoreObservableEvent=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this._ignoreObservableEvent=!1,this._localMatrixNeedUpdate=!1);const e=this.parent;e?(e.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this._object3D.matrixWorld.multiplyMatrices(e._object3D.matrixWorld,t)):this._object3D.matrixWorld.copy(t)}else{const e=this.parent;e?(e.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this._object3D.matrixWorld.multiplyMatrices(e._object3D.matrixWorld,t)):this._object3D.matrixWorld.copy(t)}this._worldMatrixNeedUpdate=!1,this._gameObject.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}updateLocalMatrixFromOthers(){if(!this._localMatrixNeedUpdate)return;const t=this._object3D.matrix;if(this._worldMatrixNeedUpdate)if(this._worldPositionRotationScaleNeedUpdate)this._ignoreObservableEvent=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this._ignoreObservableEvent=!1;else{this._worldMatrixNeedUpdate&&(this._ignoreObservableEvent=!0,this._object3D.matrixWorld.compose(this._worldPosition,this._worldRotation,this._worldScale),this._ignoreObservableEvent=!1,this._worldMatrixNeedUpdate=!1,this._gameObject.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=J._matrix4Buffer.copy(t._object3D.matrixWorld).invert();this._object3D.matrix.multiplyMatrices(this._object3D.matrixWorld,e)}else this._object3D.matrix.copy(this._object3D.matrixWorld)}else{const t=this.parent;if(t){t.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=J._matrix4Buffer.copy(t._object3D.matrixWorld).invert();this._object3D.matrix.multiplyMatrices(this._object3D.matrixWorld,e)}else this._object3D.matrix.copy(this._object3D.matrixWorld)}this._localMatrixNeedUpdate=!1}updateLocalPositionRotationScaleFromOthersRecursively(){this.updateLocalPositionRotationScaleFromOthers();const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.updateLocalPositionRotationScaleFromOthersRecursively()}}updateChildrenLocalPositionRotationScaleFromOthersRecursively(){const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&(i.userData.updateLocalPositionRotationScaleFromOthers(),i.userData.updateChildrenLocalPositionRotationScaleFromOthersRecursively())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this._gameObject.exists&&this.tryUpdateWorldMatrixRecursivelyFromThisToChildrenInternal()}tryUpdateWorldMatrixRecursivelyFromThisToChildrenInternal(){this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const t=this._object3D.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.userData instanceof J&&i.userData.tryUpdateWorldMatrixRecursivelyFromThisToChildrenInternal()}return!0}foreachChild(t){const e=this._object3D.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];s.userData instanceof J&&t(s.userData)}}iterateChild(t){const e=this._object3D.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.userData instanceof J&&!t(s.userData))break}}get parent(){return this._object3D.parent instanceof Y?null:this._object3D.parent.userData}set parent(t){this.setParent(t)}setParent(t,e=!0){if(t){const i=this.parent;this.updateLocalPositionRotationScaleFromOthersRecursively(),this.setWorldMatrixNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),e&&t.getWorldToLocalMatrix(this._object3D.matrix).multiply(this._object3D.matrixWorld),this._object3D.removeFromParent(),t._object3D.add(this._object3D),this._onParentChanged(i,t)}else{const t=this.parent;this.updateLocalPositionRotationScaleFromOthersRecursively(),this.setWorldMatrixNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),e&&this._object3D.matrix.copy(this._object3D.matrixWorld),this._object3D.removeFromParent(),this._engineGlobalObject.scene.add(this._object3D),this._onParentChanged(t,null)}}get children(){return this._object3D.children.filter((t=>t.userData instanceof J)).map((t=>t.userData))}get gameObject(){return this._gameObject}getForward(t){this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=this._object3D.matrixWorld.elements;return t?t.set(e[8],e[9],e[10]):new u(e[8],e[9],e[10])}setForward(t){this._engineGlobalObject.transformMatrixProcessor.enqueueTransformToUpdate(this),this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this.updateChildrenLocalPositionRotationScaleFromOthersRecursively(),this._localMatrixNeedUpdate=!0,this._localPositionRotationScaleNeedUpdate=!0,this.setChildrenWorldPositionRotationScaleNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),this._worldPositionRotationScaleNeedUpdate=!0;const e=this._object3D.matrixWorld.elements,i=J._vector3Buffer.copy(t).normalize();e[8]=i.x,e[9]=i.y,e[10]=i.z}getRight(t){this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=this._object3D.matrixWorld.elements;return t?t.set(e[0],e[1],e[2]):new u(e[0],e[1],e[2])}setRight(t){this._engineGlobalObject.transformMatrixProcessor.enqueueTransformToUpdate(this),this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this.updateChildrenLocalPositionRotationScaleFromOthersRecursively(),this._localMatrixNeedUpdate=!0,this._localPositionRotationScaleNeedUpdate=!0,this.setChildrenWorldPositionRotationScaleNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),this._worldPositionRotationScaleNeedUpdate=!0;const e=this._object3D.matrixWorld.elements,i=J._vector3Buffer.copy(t).normalize();e[0]=i.x,e[1]=i.y,e[2]=i.z}getUp(t){this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix();const e=this._object3D.matrixWorld.elements;return t?t.set(e[4],e[5],e[6]):new u(e[4],e[5],e[6])}setUp(t){this._engineGlobalObject.transformMatrixProcessor.enqueueTransformToUpdate(this),this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this.updateChildrenLocalPositionRotationScaleFromOthersRecursively(),this._localMatrixNeedUpdate=!0,this._localPositionRotationScaleNeedUpdate=!0,this.setChildrenWorldPositionRotationScaleNeedUpdateRecursively(),this.setWorldPositionRotationScaleNeedUpdateRecursively(),this._worldPositionRotationScaleNeedUpdate=!0;const e=this._object3D.matrixWorld.elements,i=J._vector3Buffer.copy(t).normalize();e[4]=i.x,e[5]=i.y,e[6]=i.z}get localPosition(){return this._object3D.position}get localEulerAngles(){return this._object3D.rotation}get localRotation(){return this._object3D.quaternion}get localScale(){return this._object3D.scale}get position(){return this._worldPosition}get eulerAngles(){return this._worldRotationEuler}get rotation(){return this._worldRotation}get lossyScale(){return this._worldScale}get hasChanged(){return this._hasChanged}set hasChanged(t){this._hasChanged=t}getWorldToLocalMatrix(t){return this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),t?t.copy(this._object3D.matrixWorld).invert():this._object3D.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),t?t.copy(this._object3D.matrixWorld):this._object3D.matrixWorld.clone()}transformPoint(t){return this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this._object3D.localToWorld(t)}inverseTransformPoint(t){return this.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),this._object3D.worldToLocal(t)}transformDirection(t){const e=J._matrix4Buffer.copy(this._object3D.matrixWorld).makeScale(1,1,1);return t.transformDirection(e)}inverseTransformDirection(t){const e=J._matrix4Buffer.copy(this._object3D.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(e)}transformVector(t){return t.transformDirection(this._object3D.matrixWorld)}inverseTransformVector(t){return t.transformDirection(J._matrix4Buffer.copy(this._object3D.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const e=this.parent;return!!e&&e.isChildOf(t)}lookAt(t){const e=this.parent;J._vector3Buffer.setFromMatrixPosition(this._object3D.matrixWorld);const i=J._matrix4Buffer.lookAt(J._vector3Buffer,t,this._object3D.up);if(this._object3D.quaternion.setFromRotationMatrix(i),e){i.extractRotation(e._object3D.matrixWorld);const t=J._quaternionBuffer.setFromRotationMatrix(i);this._object3D.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,e){this._object3D.setRotationFromAxisAngle(t,e)}setRotationFromEuler(t){this._object3D.setRotationFromEuler(t)}setRotationFromMatrix(t){this._object3D.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this._object3D.setRotationFromQuaternion(t)}rotateOnAxis(t,e){return this._object3D.rotateOnAxis(t,e),this}rotateOnWorldAxis(t,e){return this._object3D.rotateOnWorldAxis(t,e),this}rotateX(t){return this._object3D.rotateX(t),this}rotateY(t){return this._object3D.rotateY(t),this}rotateZ(t){return this._object3D.rotateZ(t),this}translateOnAxis(t,e){return this._object3D.translateOnAxis(t,e),this}translateX(t){return this._object3D.translateX(t),this}translateY(t){return this._object3D.translateY(t),this}translateZ(t){return this._object3D.translateZ(t),this}unsafeGetObject3D(){return this._object3D}enqueueRenderAttachedObject3D(t){this._engineGlobalObject.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this._engineGlobalObject.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)J.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;t++)J.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}toJSON(){return{}}}var $,tt;J.TransformObject3D=class extends H{updateMatrix(){this.userData.updateLocalMatrixFromOthers()}updateMatrixWorld(t){this.userData.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix()}updateWorldMatrix(t,e){if(this.userData.updateWorldMatrixFromLocalMatrixAndParentWorldMatrix(),e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}}},J._matrix4Buffer=new p,J._vector3Buffer=new u,J._quaternionBuffer=new _,function(t){t[t.start=2]="start",t[t.update=3]="update",t[t.awake=0]="awake",t[t.onEnable=1]="onEnable",t[t.onDisable=1]="onDisable",t[t.onDestroy=4]="onDestroy",t[t.onCollisionEnter2D=1]="onCollisionEnter2D",t[t.onCollisionStay2D=1]="onCollisionStay2D",t[t.onCollisionExit2D=1]="onCollisionExit2D",t[t.onTriggerEnter2D=1]="onTriggerEnter2D",t[t.onTriggerStay2D=1]="onTriggerStay2D",t[t.onTriggerExit2D=1]="onTriggerExit2D"}($||($={}));class et{constructor(t,e,i,s){this.isRemoved=!1,this._priority=i,this._eventId=t.generateEventId(),this._componentExecutionOrder=s,this._eventFunc=e}static createAwakeEvent(t,e){return new et(t,e,$.awake,0)}static createStartEvent(t,e,i){return new et(t,e,$.start,i)}static createUpdateEvent(t,e,i){return new et(t,e,$.update,i)}static createOnEnableEvent(t,e,i){return new et(t,e,$.onEnable,i)}static createOnDisableEvent(t,e,i){return new et(t,e,$.onDisable,i)}static createOnDestroyEvent(t,e,i){return new et(t,e,$.onDestroy,i)}static createOnCollisionEnter2DEvent(t,e,i){return new et(t,e,$.onCollisionEnter2D,i)}static createOnCollisionStay2DEvent(t,e,i){return new et(t,e,$.onCollisionStay2D,i)}static createOnCollisionExit2DEvent(t,e,i){return new et(t,e,$.onCollisionExit2D,i)}static createOnTriggerEnter2DEvent(t,e,i){return new et(t,e,$.onTriggerEnter2D,i)}static createOnTriggerStay2DEvent(t,e,i){return new et(t,e,$.onTriggerStay2D,i)}static createOnTriggerExit2DEvent(t,e,i){return new et(t,e,$.onTriggerExit2D,i)}get invoke(){return this._eventFunc}static comparator(t,e){return t._priority===e._priority?t._componentExecutionOrder===e._componentExecutionOrder?t._eventId-e._eventId:t._componentExecutionOrder-e._componentExecutionOrder:t._priority-e._priority}}class it{constructor(t){this._iterateCollection=null,this._collection=new r(void 0,t),this._insertBuffer=new r(void 0,t),this._insertBufferSwap=new r(void 0,t),this._deleteBuffer=new r(void 0,t)}get size(){return this._collection.size()}insert(t){null!==this._iterateCollection?this._insertBuffer.insert(t):this._collection.insert(t)}delete(t){null!==this._iterateCollection?(t.isRemoved=!0,this._deleteBuffer.insert(t)):this._collection.eraseElementByValue(t)}clear(){this._collection.clear(),this._insertBuffer.clear(),this._deleteBuffer.clear()}forEach(t){this._iterateCollection=this._collection,this._iterateCollection.forEach((e=>{e.isRemoved||t(e)}));do{this._iterateCollection=this.flushBuffer(),this._iterateCollection.forEach((e=>{e.isRemoved||t(e)}))}while(0<this._insertBuffer.size()||0<this._deleteBuffer.size());this._iterateCollection=null}flushBuffer(){this._iterateCollection=null,this._deleteBuffer.forEach((t=>this.delete(t))),this._insertBuffer.forEach((t=>this.insert(t)));const t=this._insertBuffer;return this._insertBuffer=this._insertBufferSwap,this._insertBufferSwap=t,this._insertBuffer.clear(),this._deleteBuffer.clear(),t}}function st(t){return void 0!==t.onWorldMatrixUpdated}class nt{constructor(){this._matrixUpdateComponents=new Set,this._collisionEnter2DComponentEvents=new it(et.comparator),this._collisionStay2DComponentEvents=new it(et.comparator),this._collisionExit2DComponentEvents=new it(et.comparator),this._triggerEnter2DComponentEvents=new it(et.comparator),this._triggerStay2DComponentEvents=new it(et.comparator),this._triggerExit2DComponentEvents=new it(et.comparator)}registerComponent(t){st(t)&&this._matrixUpdateComponents.add(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this._collisionEnter2DComponentEvents.insert(e.onCollisionEnter2D),e.onCollisionStay2D&&this._collisionStay2DComponentEvents.insert(e.onCollisionStay2D),e.onCollisionExit2D&&this._collisionExit2DComponentEvents.insert(e.onCollisionExit2D),e.onTriggerEnter2D&&this._triggerEnter2DComponentEvents.insert(e.onTriggerEnter2D),e.onTriggerStay2D&&this._triggerStay2DComponentEvents.insert(e.onTriggerStay2D),e.onTriggerExit2D&&this._triggerExit2DComponentEvents.insert(e.onTriggerExit2D)}unregisterComponent(t){st(t)&&this._matrixUpdateComponents.delete(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this._collisionEnter2DComponentEvents.delete(e.onCollisionEnter2D),e.onCollisionStay2D&&this._collisionStay2DComponentEvents.delete(e.onCollisionStay2D),e.onCollisionExit2D&&this._collisionExit2DComponentEvents.delete(e.onCollisionExit2D),e.onTriggerEnter2D&&this._triggerEnter2DComponentEvents.delete(e.onTriggerEnter2D),e.onTriggerStay2D&&this._triggerStay2DComponentEvents.delete(e.onTriggerStay2D),e.onTriggerExit2D&&this._triggerExit2DComponentEvents.delete(e.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this._matrixUpdateComponents)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){this._collisionEnter2DComponentEvents.forEach((e=>e.invoke(t)))}invokeOnCollisionStay2D(t){this._collisionStay2DComponentEvents.forEach((e=>e.invoke(t)))}invokeOnCollisionExit2D(t){this._collisionExit2DComponentEvents.forEach((e=>e.invoke(t)))}invokeOnTriggerEnter2D(t){this._triggerEnter2DComponentEvents.forEach((e=>e.invoke(t)))}invokeOnTriggerStay2D(t){this._triggerStay2DComponentEvents.forEach((e=>e.invoke(t)))}invokeOnTriggerExit2D(t){this._triggerExit2DComponentEvents.forEach((e=>e.invoke(t)))}}class rt{constructor(t,e){this._destroyed=!1,this._engineGlobalObject=t,this._instanceId=t.instantiater.generateId(),this._activeInHierarchy=!0,this._activeSelf=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new nt,this._transform=new J(this,t,this.onChangeParent.bind(this)),this._transform.unsafeGetObject3D().name=e}addChildFromBuilder(t){this.checkGameObjectIsExist();const e=t.build(this.transform);return t.processEvent(),e}onChangeParent(t,e){if(e&&this._engineGlobalObject!==e.gameObject._engineGlobalObject)throw new Error("can't change parent to another engine instance");const i=this.transform.gameObject;e?i._activeSelf&&i.setActiveInHierarchyWithEvent(e.gameObject._activeInHierarchy):i.setActiveInHierarchyWithEvent(i._activeSelf)}addComponent(t){this.checkGameObjectIsExist();const e=new t(this);if(e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const i=e.requiredComponents;for(let e=0;e<i.length;e++){const s=i[e];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(e),this.gameObjectEventContainer.registerComponent(e),this._activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate(),this._engineGlobalObject.sceneProcessor.tryStartProcessSyncedEvent()),e}getComponent(t){this.checkGameObjectIsExist();const e=this.components;for(let i=0;i<e.length;i++){const s=e[i];if(s instanceof t)return s}return null}getComponents(t){if(this.checkGameObjectIsExist(),!t)return this.components.slice();const e=this.components,i=[];for(let s=0;s<e.length;s++){const n=e[s];n instanceof t&&i.push(n)}return i}getComponentInChildren(t){this.checkGameObjectIsExist();const e=this.getComponent(t);if(e)return e;let i=null;return this._transform.iterateChild((e=>{const s=e.gameObject.getComponentInChildren(t);return!s||(i=s,!1)})),i}getComponentsInChildren(t){if(this.checkGameObjectIsExist(),t){const e=this.getComponents(t);return this._transform.foreachChild((i=>{const s=i.gameObject.getComponentsInChildren(t);e.push(...s)})),e}{const t=this.getComponents();return this._transform.foreachChild((e=>{t.push(...e.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,e){this.checkGameObjectIsExist();const i=this.components;if(e)for(let s=0;s<i.length;s++){const n=i[s];n instanceof e&&t(n)}else for(let e=0;e<i.length;e++)t(i[e])}foreachComponentInChildren(t,e){this.checkGameObjectIsExist(),e?(this.foreachComponent(t,e),this._transform.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t,e)}))):(this.foreachComponent(t),this._transform.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t)})))}destroy(){this._destroyed||(this._destroyed=!0,this.destroyEventProcess(),this._engineGlobalObject.sceneProcessor.tryStartProcessSyncedEvent(),this._engineGlobalObject.sceneProcessor.addRemoveGameObject(this))}destroyEventProcess(){const t=this.components;for(let e=0;e<t.length;e++){const i=t[e];i._engine_internal_destroyed||(i.enabled&&this._activeInHierarchy&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterStart(),i._engine_internal_componentEventContainer.tryUnregisterUpdate()),i.stopAllCoroutines(),i._engine_internal_componentEventContainer.tryRegisterOnDestroy(),i._engine_internal_destroyed=!0)}this._transform.children.forEach((t=>{t instanceof J&&t.gameObject.destroyEventProcess()}))}removeFromParent(){this._transform.unsafeGetObject3D().removeFromParent()}removeComponent(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this._engineGlobalObject}get activeInHierarchy(){return this._activeInHierarchy}set activeInHierarchy(t){if(this._activeInHierarchy!==t){if(this._activeInHierarchy=t,this._initialized){const t=this.components;if(this._activeInHierarchy)for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let e=0;e<t.length;e++){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterUpdate(),i.stopAllCoroutines())}}this._transform.foreachChild((t=>{const e=t.gameObject;this._activeInHierarchy?e.activeInHierarchy=e._activeSelf:e.activeInHierarchy=!1}))}}setActiveInHierarchyWithEvent(t){this._activeInHierarchy!==t&&(this.activeInHierarchy=t,this._initialized&&this._engineGlobalObject.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this._activeSelf}set activeSelf(t){this.checkGameObjectIsExist(),this._activeSelf!==t&&(this._activeSelf=t,this._transform.parent instanceof J?this._transform.parent.gameObject._activeInHierarchy?this.setActiveInHierarchyWithEvent(this._activeSelf):this.setActiveInHierarchyWithEvent(!1):this.setActiveInHierarchyWithEvent(this._activeSelf))}get transform(){return this._transform}get name(){return this._transform.unsafeGetObject3D().name}set name(t){this.checkGameObjectIsExist(),this._transform.unsafeGetObject3D().name=t}get instanceId(){return this._instanceId}get initialized(){return this._initialized}get exists(){return!this._destroyed}checkGameObjectIsExist(){if(this._destroyed)throw new Error("GameObject "+this.name+" is destroyed")}}class ot{constructor(t,e,i,s,n){this._gameObject=new rt(t,e);const r=this._gameObject.transform;i&&r.localPosition.copy(i),s&&r.localRotation.copy(s),n&&r.localScale.copy(n),this._children=[],this._componentInitializeFuncList=[]}active(t){return this._gameObject.activeSelf=t,this}getGameObject(t){return t.ref=this._gameObject,this}getComponent(t,e){return e.ref=this._gameObject.getComponent(t),this}getComponents(t,e){return t.ref=e?this._gameObject.getComponents(e):this._gameObject.getComponents(),this}getComponentInChildren(t,e){return e.ref=this._gameObject.getComponentInChildren(t),this}getComponentsInChildren(t,e){return t.ref=e?this._gameObject.getComponentsInChildren(e):this._gameObject.getComponentsInChildren(),this}withComponent(t,e){const i=new t(this._gameObject);return i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this._gameObject.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this._gameObject.name}`),this):(this._gameObject.components.push(i),this._gameObject.gameObjectEventContainer.registerComponent(i),e&&this._componentInitializeFuncList.push((()=>e(i))),this)}withChild(t){return this._children.push(t),this}checkComponentRequirements(t){let e=!1;const i=t.components;for(let s=0;s<i.length;s++){const n=i[s],r=n.requiredComponents;for(let i=0;i<r.length;i++){const s=r[i];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${n.constructor.name} on GameObject ${t.name}`),t.removeComponent(n),e=!0)}}e&&this.checkComponentRequirements(t)}build(t){return this.registerTransform(t),this.chackComponentRequirementsRecursive(),this.componentInitialize(),this._gameObject}registerTransform(t){this._gameObject.transform.setParent(t,!1);const e=this._children;for(let t=0;t<e.length;t++)e[t].registerTransform(this._gameObject.transform)}chackComponentRequirementsRecursive(){this.checkComponentRequirements(this._gameObject);const t=this._children;for(let e=0;e<t.length;e++)t[e].chackComponentRequirementsRecursive()}componentInitialize(){const t=this._componentInitializeFuncList;for(let e=0;e<t.length;e++)t[e]();const e=this._children;for(let t=0;t<e.length;t++)e[t].componentInitialize();this._gameObject._initialized=!0}processEvent(){ot.processEventByGroup([this],this._gameObject.engine.sceneProcessor)}static processEventByGroup(t,e){const i=[];for(let e=0;e<t.length;e++)i.push(...t[e]._gameObject.getComponentsInChildren());for(let t=0;t<i.length;t++){const e=i[t];e.gameObject.activeInHierarchy&&e.enabled&&e._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<i.length;t++){const e=i[t];e._engine_internal_destroyed||e.gameObject.activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}e.tryStartProcessSyncedEvent()}}class ht{constructor(t){this._instanceNextId=0,this._eventInstanceNextId=0,this._engineGlobalObject=t}generateId(){const t=this._instanceNextId;return this._instanceNextId+=1,t}generateEventId(){const t=this._eventInstanceNextId;return this._eventInstanceNextId+=1,t}buildGameObject(t,e,i,s){return new ot(this._engineGlobalObject,t,e,i,s)}buildPrefab(t,e,i,s,n){return new e(this._engineGlobalObject,t,i,s,n)}}class at{constructor(t,e,i,s,n,r,o,a,l,c){this._scene=t,this._cameraContainer=e,this._time=i,this._gameState=s,this._screen=n,this._sceneProcessor=r,this._coroutineProcessor=o,this._transformMatrixProcessor=a,this._physics2DProcessor=l,this._inputHandler=new h(c),this._instantiater=new ht(this)}applyGameSetting(t){this._physics2DProcessor.applyPhysicsSettings(t.physics)}dispose(){this._inputHandler.dispose()}get scene(){return this._scene}get cameraContainer(){return this._cameraContainer}get screen(){return this._screen}get input(){return this._inputHandler}get time(){return this._time}get physics(){return this._physics2DProcessor}get gameState(){return this._gameState}get instantiater(){return this._instantiater}get sceneProcessor(){return this._sceneProcessor}get coroutineProcessor(){return this._coroutineProcessor}get transformMatrixProcessor(){return this._transformMatrixProcessor}get physics2DProcessor(){return this._physics2DProcessor}}class lt{constructor(t){this._gameStateKind=t}get kind(){return this._gameStateKind}set kind(t){this._gameStateKind=t}}!function(t){t[t.WaitingForStart=0]="WaitingForStart",t[t.Initializing=1]="Initializing",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finalizing=4]="Finalizing",t[t.Finalized=5]="Finalized"}(tt||(tt={}));class ct{constructor(){this._nonSyncedEvents=new it(et.comparator),this._syncedEvents=new it(et.comparator),this._processingSyncedEvent=!1,this._removeGameObjects=[],this._removeComponents=[]}addEventToNonSyncedCollection(t){this._nonSyncedEvents.insert(t)}removeEventFromNonSyncedCollection(t){this._nonSyncedEvents.delete(t)}addEventToSyncedCollection(t){this._syncedEvents.insert(t)}startProcessNonSyncedEvent(){this._nonSyncedEvents.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this._processingSyncedEvent||(this._processingSyncedEvent=!0,this._syncedEvents.forEach((t=>t.invoke())),this._syncedEvents.clear(),this._processingSyncedEvent=!1)}addRemoveGameObject(t){this._removeGameObjects.push(t)}addRemoveComponent(t){this._removeComponents.push(t)}processRemoveObject(){const t=this._removeComponents;for(let e=0;e<t.length;e++)t[e].gameObject.removeComponent(t[e]);const e=this._removeGameObjects;for(let t=0;t<e.length;t++)e[t].removeFromParent()}}class dt{constructor(){this._maximumDeltaTime=1/3,this._oldTime=0,this._time=0,this._unscaledTime=0,this._deltaTime=0,this._unscaledDeltaTime=0,this._timeScale=1}start(){this._oldTime=performance.now()}update(){const t=performance.now();let e=(t-this._oldTime)/1e3;this._maximumDeltaTime<e&&(e=this._maximumDeltaTime),this._unscaledDeltaTime=e,this._unscaledTime+=e,this._deltaTime=e*this._timeScale,this._time+=this._deltaTime,this._oldTime=t}get time(){return this._time}get unscaledTime(){return this._unscaledTime}get deltaTime(){return this._deltaTime}get unscaledDeltaTime(){return this._unscaledDeltaTime}get timeScale(){return this._timeScale}set timeScale(t){this._timeScale=t}get maximumDeltaTime(){return this._maximumDeltaTime}set maximumDeltaTime(t){this._maximumDeltaTime=t}}class _t{constructor(t,e){this._width=t,this._height=e,this._onResizeDelegates=[]}get width(){return this._width}get height(){return this._height}resize(t,e){this._width=t,this._height=e,this._onResizeDelegates.forEach((i=>i(t,e)))}addOnResizeEventListener(t){this._onResizeDelegates.push(t)}removeOnResizeEventListener(t){const e=this._onResizeDelegates.indexOf(t);e>=0&&this._onResizeDelegates.splice(e,1)}}class ut{}class mt extends ut{get instance(){return mt._instance}}mt._instance=new mt;class gt extends ut{constructor(t){super(),this._seconds=t}get seconds(){return this._seconds}}class pt extends ut{constructor(t){super(),this._predicate=t}get predicate(){return this._predicate}}class ft extends ut{constructor(t){super(),this._predicate=t}get predicate(){return this._predicate}}class Ct{constructor(t){this._time=t,this._coroutines=[],this._coroutineCount=0}addCoroutine(t){this._coroutines.push(t),this._coroutineCount+=1}removeCoroutine(t){const e=this._coroutines.indexOf(t);e>=0&&(this._coroutines[e]=null,this._coroutineCount-=1)}tryCompact(){if(Ct._needToCompactCount<=this._coroutines.length-this._coroutineCount){let t=0;for(let e=0;e<this._coroutines.length;e++){const i=this._coroutines[e];null!==i&&(this._coroutines[t]=i,t+=1)}this._coroutines.length=this._coroutineCount}}updateAfterProcess(){const t=this._coroutines;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.updateAfterProcessSingleInstruction(i):(t[e]=null,this._coroutineCount-=1))}}updateAfterProcessSingleInstruction(t){const e=t.currentYieldInstruction;e instanceof gt?(t.elapsedTime+=this._time.deltaTime,t.elapsedTime>=e.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):e instanceof pt?e.predicate()&&t.fatchNextInstruction():e instanceof ft?e.predicate()||t.fatchNextInstruction():null===e&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this._coroutines;for(let e=0;e<t.length;e++){const i=t[e];null!=i&&(i.currentYieldInstructionExist?this.endFrameAfterProcessSingleInstruction(i):(t[e]=null,this._coroutineCount-=1))}}endFrameAfterProcessSingleInstruction(t){t.currentYieldInstruction instanceof mt&&t.fatchNextInstruction()}}Ct._needToCompactCount=16;class yt{constructor(){this._transformsNeedToUpdate=[],this._rerenderObjectsReadBuffer=new Set,this._rerenderObjectsWriteBuffer=new Set}switchBuffer(){const t=this._rerenderObjectsReadBuffer;this._rerenderObjectsReadBuffer=this._rerenderObjectsWriteBuffer,this._rerenderObjectsWriteBuffer=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this._transformsNeedToUpdate.push(t))}enqueueRenderObject(t){this._rerenderObjectsWriteBuffer.add(t)}dequeueRenderObject(t){this._rerenderObjectsWriteBuffer.delete(t)}flush(){this._rerenderObjectsReadBuffer.clear()}update(){const t=this._transformsNeedToUpdate;for(let e=0;e<t.length;e++){const i=t[e];i.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),i.isRegisteredToProcessor=!1}return this._transformsNeedToUpdate.length=0,this.switchBuffer(),this._rerenderObjectsReadBuffer}}const xt=new u,bt=new _,wt=new u,vt=new p,Mt=new p;class Et{constructor(){this._width=0,this._height=0,this._widthHalf=0,this._heightHalf=0,this._cache={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this._cameraElement=document.createElement("div"),this._cameraElement.style.transformStyle="preserve-3d",this._cameraElement.style.pointerEvents="none",this.domElement.appendChild(this._cameraElement)}getSize(){return{width:this._width,height:this._height}}render(t,e,i){const s=i.projectionMatrix.elements[5]*this._heightHalf;let n,r;this._cache.camera.fov!==s&&(this.domElement.style.perspective=i.isPerspectiveCamera?s+"px":"",this._cache.camera.fov=s),!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.isOrthographicCamera?(n=-(i.right+i.left)/2,r=(i.top+i.bottom)/2):(n=1,r=1);const o=(i.isOrthographicCamera?"scale("+s+")translate("+this.epsilon(n)+"px,"+this.epsilon(r)+"px)"+this.getCameraCSSMatrix(i.matrixWorldInverse):"translateZ("+s+"px)"+this.getCameraCSSMatrix(i.matrixWorldInverse))+"translate("+this._widthHalf+"px,"+this._heightHalf+"px)";this._cache.camera.style!==o&&(this._cameraElement.style.transform=o,this._cache.camera.style=o);for(const s of t)this.renderObject(s,e,i)}setSize(t,e){this._width=t,this._height=e,this._widthHalf=this._width/2,this._heightHalf=this._height/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this._cameraElement.style.width=t+"px",this._cameraElement.style.height=e+"px"}epsilon(t){return Math.abs(t)<1e-10?0:t}getCameraCSSMatrix(t){const e=t.elements,i=this.epsilon;return"matrix3d("+i(e[0])+","+i(-e[1])+","+i(e[2])+","+i(e[3])+","+i(e[4])+","+i(-e[5])+","+i(e[6])+","+i(e[7])+","+i(e[8])+","+i(-e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(-e[13])+","+i(e[14])+","+i(e[15])+")"}getObjectCSSMatrix(t){const e=t.elements,i=this.epsilon;return"translate(-50%,-50%)matrix3d("+i(e[0])+","+i(e[1])+","+i(e[2])+","+i(e[3])+","+i(-e[4])+","+i(-e[5])+","+i(-e[6])+","+i(-e[7])+","+i(e[8])+","+i(e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(e[13])+","+i(e[14])+","+i(e[15])+")"}renderObject(t,e,i){if(t.isCSS3DObject){let s;t.onBeforeRender(this,e,i),t.isCSS3DSprite?(vt.copy(i.matrixWorldInverse),vt.transpose(),0!==t.rotation2D&&vt.multiply(Mt.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(xt,bt,wt),vt.setPosition(xt),vt.scale(wt),vt.elements[3]=0,vt.elements[7]=0,vt.elements[11]=0,vt.elements[15]=1,s=this.getObjectCSSMatrix(vt)):s=this.getObjectCSSMatrix(t.matrixWorld);const n=t.element;n.style.transform=s,n.style.display=t.visible?"":"none",n.parentNode!==this._cameraElement&&this._cameraElement.appendChild(n),t.onAfterRender(this,e,i)}}}class Dt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*i-r*s+t.x,this.y=n*s+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Dt.prototype.isVector2=!0;class Ot{constructor(){this._defaultMaterial=null,this._velocityIterations=8,this._positionIterations=3,this._collisionLayerMaskConverter=null,this._world=null,this._gameObjectToBodyMap=new Map,this._loader=null,this.reuseCollisionCallbacks=!0}applyPhysicsSettings(t){var e;if(!t.loader)return;this._loader=t.loader,this._world=new this._loader.World(new this._loader.Vec2(0,-9.81));const i=class extends this._loader.ContactListener{constructor(t){super(),this._physicsProcessor=t,this._collision2DPool=new this._physicsProcessor._loader.Collision2DPool}BeginContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)e.gameObject.gameObjectEventContainer.invokeOnTriggerEnter2D(i),i.gameObject.gameObjectEventContainer.invokeOnTriggerEnter2D(e);else if(this._physicsProcessor.reuseCollisionCallbacks){const s=this._collision2DPool.getInstance();s.setData(t),e.gameObject.gameObjectEventContainer.invokeOnCollisionEnter2D(s),i.gameObject.gameObjectEventContainer.invokeOnCollisionEnter2D(s),this._collision2DPool.release(s)}else{const s=new this._physicsProcessor._loader.Collision2D;s.setData(t),e.gameObject.gameObjectEventContainer.invokeOnCollisionEnter2D(s),i.gameObject.gameObjectEventContainer.invokeOnCollisionEnter2D(s)}}EndContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)e.gameObject.gameObjectEventContainer.invokeOnTriggerExit2D(i),i.gameObject.gameObjectEventContainer.invokeOnTriggerExit2D(e);else if(this._physicsProcessor.reuseCollisionCallbacks){const s=this._collision2DPool.getInstance();s.setData(t),e.gameObject.gameObjectEventContainer.invokeOnCollisionExit2D(s),i.gameObject.gameObjectEventContainer.invokeOnCollisionExit2D(s),this._collision2DPool.release(s)}else{const s=new this._physicsProcessor._loader.Collision2D;s.setData(t),e.gameObject.gameObjectEventContainer.invokeOnCollisionExit2D(s),i.gameObject.gameObjectEventContainer.invokeOnCollisionExit2D(s)}}PreSolve(t,e){const i=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(i.isTrigger||s.isTrigger)i.gameObject.gameObjectEventContainer.invokeOnTriggerStay2D(s),s.gameObject.gameObjectEventContainer.invokeOnTriggerStay2D(i);else if(this._physicsProcessor.reuseCollisionCallbacks){const e=this._collision2DPool.getInstance();e.setData(t),i.gameObject.gameObjectEventContainer.invokeOnCollisionStay2D(e),s.gameObject.gameObjectEventContainer.invokeOnCollisionStay2D(e),this._collision2DPool.release(e)}else{const e=new this._physicsProcessor._loader.Collision2D;e.setData(t),i.gameObject.gameObjectEventContainer.invokeOnCollisionStay2D(e),s.gameObject.gameObjectEventContainer.invokeOnCollisionStay2D(e)}}};this._world.SetContactListener(new i(this)),t.gravity&&(null===(e=this._world)||void 0===e||e.SetGravity(t.gravity)),t.defaultMaterial&&(this._defaultMaterial=t.defaultMaterial.clone()),t.velocityIterations&&(this._velocityIterations=t.velocityIterations),t.positionIterations&&(this._positionIterations=t.positionIterations),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix&&(this._collisionLayerMaskConverter=new this._loader.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix))}update(t){if(this._world){{let t=this._world.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData();if(i.destroyed){this._world.DestroyBody(e);continue}const s=i.gameObject.transform,n=s.position,r=s.eulerAngles,o=e.GetPosition(),h=e.GetAngle();n.x===o.x&&n.y===o.y||(e.SetPosition(n),e.SetAwake(!0)),r.z!==h&&(e.SetAngle(r.z),e.SetAwake(!0))}}this._world.Step(t,this._velocityIterations,this._positionIterations);{let t=this._world.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData();if(i.destroyed){this._world.DestroyBody(e);continue}const s=i.gameObject.transform;s.position.x=e.GetPosition().x,s.position.y=e.GetPosition().y,s.eulerAngles.z=e.GetAngle()}}}}addRigidBody(t,e,i){if(!this._world)throw new Error("Physics2D is not loaded.");let s=this._gameObjectToBodyMap.get(t);if(s){const t=s.addRigidBody(e),n=t.body;return n.SetType(i.type),n.SetPosition(i.position),n.SetAngle(i.angle),n.SetLinearVelocity(i.linearVelocity),n.SetAngularVelocity(i.angularVelocity),n.SetLinearDamping(i.linearDamping),n.SetAngularDamping(i.angularDamping),n.SetSleepingAllowed(i.allowSleep),n.SetAwake(i.awake),n.SetFixedRotation(i.fixedRotation),n.SetBullet(i.bullet),n.SetEnabled(i.enabled),n.SetUserData(i.userData),n.SetGravityScale(i.gravityScale),t}return s=new this._loader.PhysicsObject2D(t,this._world.CreateBody(i),(()=>this._gameObjectToBodyMap.delete(t))),this._gameObjectToBodyMap.set(t,s),s.addRigidBody(e)}removeRigidBody(t){const e=this._gameObjectToBodyMap.get(t);if(!e)throw new Error("PhysicsObject2D not found");e.removeRigidBody()}createColliderDefaultBodyDef(t){const e=new this._loader.BodyDef;return e.type=this._loader.BodyType.b2_kinematicBody,e.position.x=t.transform.position.x,e.position.y=t.transform.position.y,e.angle=t.transform.eulerAngles.z,e}addCollider(t,e,i){if(!this._world)throw new Error("Physics2D is not loaded.");let s=this._gameObjectToBodyMap.get(t);return s||(s=new this._loader.PhysicsObject2D(t,this._world.CreateBody(this.createColliderDefaultBodyDef(t)),(()=>this._gameObjectToBodyMap.delete(t)))),this._gameObjectToBodyMap.set(t,s),s.addCollider(e,i)}removeCollider(t,e,i){const s=this._gameObjectToBodyMap.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(e,i)}get physicsLoader(){return this._loader}get gravity(){if(!this._world)throw new Error("Physics2D is not loaded.");const t=this._world.GetGravity();return new Dt(t.x,t.y)}set gravity(t){if(!this._world)throw new Error("Physics2D is not loaded.");this._world.SetGravity(new this._loader.Vec2(t.x,t.y))}get defaultMaterial(){return this._defaultMaterial}get velocityIterations(){return this._velocityIterations}set velocityIterations(t){this._velocityIterations=t}get positionIterations(){return this._positionIterations}set positionIterations(t){this._positionIterations=t}get maxLinearCorrection(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.maxLinearCorrection}get maxAngularCorrection(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.maxAngularCorrection}get maxTranslationSpeed(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.maxTranslation}get maxRotationSpeed(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.maxRotation}get baumgarteScale(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.baumgarte}get baumgarteTimeOfImpactScale(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.toiBaumgarte}get timeToSleep(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.timeToSleep}get linearSleepTolerance(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.linearSleepTolerance}get angularSleepTolerance(){if(!this._loader)throw new Error("Physics2D is not loaded.");return this._loader.angularSleepTolerance}get collisionLayerMask(){return this._collisionLayerMaskConverter}}class St{constructor(t,e=!0){this._gameSetting=null,this._rootScene=new Y,this._gameScreen=new _t(t.clientWidth,t.clientHeight),this._container=t,this._css3DRenderer=new Et,this._css3DRenderer.setSize(t.clientWidth,t.clientHeight),this._css3DRenderer.domElement.style.width="100%",this._css3DRenderer.domElement.style.height="100%",this._css3DRenderer.domElement.onscroll=()=>{this._css3DRenderer.domElement.scrollLeft=0,this._css3DRenderer.domElement.scrollTop=0},this._cameraContainer=new o((t=>{this._css3DRenderer.domElement.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")"})),this._time=new dt,this._gameState=new lt(tt.WaitingForStart),this._sceneProcessor=new ct,this._coroutineProcessor=new Ct(this._time),this._transformMatrixProcessor=new yt,this._physics2DProcessor=new Ot,this._engineGlobalObject=new at(this._rootScene,this._cameraContainer,this._time,this._gameState,this._gameScreen,this._sceneProcessor,this._coroutineProcessor,this._transformMatrixProcessor,this._physics2DProcessor,this._css3DRenderer.domElement),this._animationFrameId=null,this._isDisposed=!1,this._autoResize=e,this._resizeFrameBufferBind=this.resizeFramebuffer.bind(this),e&&window.addEventListener("resize",this._resizeFrameBufferBind),this._loopBind=this.loop.bind(this)}resizeFramebuffer(){const t=this._container.clientWidth,e=this._container.clientHeight;t===this._gameScreen.width&&e===this._gameScreen.height||(this._gameScreen.resize(t,e),this._css3DRenderer.setSize(t,e),this._css3DRenderer.domElement.style.width="100%",this._css3DRenderer.domElement.style.height="100%")}run(t,e){if(this._isDisposed)throw new Error("Game is disposed.");if(this._gameState.kind!==tt.WaitingForStart)throw new Error("Game is already running.");this._gameState.kind=tt.Initializing,this._time.start();const i=new t(this._engineGlobalObject,e),s=i.run();if(this._gameSetting=i.getGameSettingObject(),this._engineGlobalObject.applyGameSetting(this._gameSetting),this._gameSetting.render.useCss3DRenderer&&this._container.appendChild(this._css3DRenderer.domElement),s.build(),!this._cameraContainer.camera)throw new Error("Camera is not exist or not active in the scene.");if(this._gameState.kind=tt.Running,this._sceneProcessor.startProcessNonSyncedEvent(),this._physics2DProcessor.update(this._time.deltaTime),this._coroutineProcessor.updateAfterProcess(),!this._cameraContainer.camera)throw new Error("Camera is not exist or not active in the scene.");this._sceneProcessor.processRemoveObject();const n=this._transformMatrixProcessor.update();this._gameSetting.render.useCss3DRenderer&&this._css3DRenderer.render(n,this._rootScene,this._cameraContainer.camera),this._transformMatrixProcessor.flush(),this._coroutineProcessor.endFrameAfterProcess(),this._animationFrameId=requestAnimationFrame(this._loopBind)}loop(){if(this._animationFrameId=requestAnimationFrame(this._loopBind),this._time.update(),this._sceneProcessor.startProcessNonSyncedEvent(),this._physics2DProcessor.update(this._time.deltaTime),this._coroutineProcessor.tryCompact(),this._coroutineProcessor.updateAfterProcess(),!this._cameraContainer.camera)throw new Error("Camera is not exist or not active in the scene.");this._sceneProcessor.processRemoveObject();const t=this._transformMatrixProcessor.update();this._gameSetting.render.useCss3DRenderer&&this._css3DRenderer.render(t,this._rootScene,this._cameraContainer.camera),this._transformMatrixProcessor.flush(),this._coroutineProcessor.endFrameAfterProcess()}stop(){if(this._isDisposed)throw new Error("Game is disposed.");if(this._gameState.kind!==tt.Running)throw new Error("Game is not running.");this._gameState.kind=tt.Stopped,this._animationFrameId&&cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null}resume(){if(this._isDisposed)throw new Error("Game is disposed.");if(this._gameState.kind!==tt.Stopped)throw new Error("Game is not stopped.");this._gameState.kind=tt.Running,this.loop()}dispose(){this._isDisposed||(this._gameState.kind=tt.Finalizing,this._animationFrameId&&cancelAnimationFrame(this._animationFrameId),this._engineGlobalObject.dispose(),this._rootScene.children.slice().forEach((t=>{t instanceof J&&t.gameObject.destroy()})),this._autoResize&&window.removeEventListener("resize",this._resizeFrameBufferBind),this._container.removeChild(this._css3DRenderer.domElement),this._isDisposed=!0,this._gameState.kind=tt.Finalized)}get inputHandler(){return this._engineGlobalObject.input}get currentGameState(){return this._gameState.kind}}class jt{constructor(t){this._sceneProcessor=t,this._children=[]}withChild(t){return this._children.push(t),this}build(){for(let t=0;t<this._children.length;t++)this._children[t].build(null);ot.processEventByGroup(this._children,this._sceneProcessor)}}class zt{constructor(t){this._renderSettingObject=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this._renderSettingObject.useCss3DRenderer=t,this}}class kt{constructor(t){this._physicsSettingObject=t}static createDefaultObject(){return{}}loader(t){return this._physicsSettingObject.loader=t,this}gravity(t){return this._physicsSettingObject.gravity=t,this}defaultMaterial(t){return this._physicsSettingObject.defaultMaterial=t,this}velocityIterations(t){return this._physicsSettingObject.velocityIterations=t,this}positionIterations(t){return this._physicsSettingObject.positionIterations=t,this}reuseCollisionCallbacks(t){return this._physicsSettingObject.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){this._physicsSettingObject.collisionLayerMaskMatrix=t}}class At{constructor(t){this._gameSettingObject=t,this._renderSetting=new zt(this._gameSettingObject.render),this._physicsSetting=new kt(this._gameSettingObject.physics)}static createDefaultObject(){return{render:zt.createDefaultObject(),physics:kt.createDefaultObject()}}get render(){return this._renderSetting}get physics(){return this._physicsSetting}make(){return this._gameSettingObject}}class Pt{constructor(t=null){this.ref=t}}class Rt{constructor(t,e,i,s,n){this._instantiater=t.instantiater,this._gameObjectBuilder=new ot(t,e,i,s,n)}get instantiater(){return this._instantiater}get gameObjectBuilder(){return this._gameObjectBuilder}}class Tt extends H{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new p,this.projectionMatrix=new p,this.projectionMatrixInverse=new p}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Tt.prototype.isCamera=!0;class It extends Tt{constructor(t=50,e=1,i=.1,s=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*c*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*l*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*c*Math.atan(Math.tan(.5*l*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,n,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*l*this.fov)/this.zoom,i=2*e,s=this.aspect*i,n=-.5*s;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,o=r.fullHeight;n+=r.offsetX*s/t,e-=r.offsetY*i/o,s*=r.width/t,i*=r.height/o}const o=this.filmOffset;0!==o&&(n+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}It.prototype.isPerspectiveCamera=!0;class Bt extends Tt{constructor(t=-1,e=1,i=1,s=-1,n=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=n,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,n,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let n=i-t,r=i+t,o=s+e,h=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=t*this.view.offsetX,r=n+t*this.view.width,o-=e*this.view.offsetY,h=o-e*this.view.height}this.projectionMatrix.makeOrthographic(n,r,o,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Bt.prototype.isOrthographicCamera=!0;class Wt{constructor(t,e,i){this._component=t,this._elapsedTime=0,this._coroutineIterator=e,this._currentYieldInstruction=null,this._isCurrenYieldInstructionExist=!1,this._onFinish=i}get component(){return this._component}get elapsedTime(){return this._elapsedTime}set elapsedTime(t){this._elapsedTime=t}get currentYieldInstruction(){return this._currentYieldInstruction}get currentYieldInstructionExist(){return this._isCurrenYieldInstructionExist}fatchNextInstruction(){var t;const e=this._coroutineIterator.next();return e.done?(this._currentYieldInstruction=null,this._isCurrenYieldInstructionExist=!1,null===(t=this._onFinish)||void 0===t||t.call(this),this._onFinish=null,null):(this._currentYieldInstruction=e.value,this._isCurrenYieldInstructionExist=!0,this._currentYieldInstruction)}}class Ft{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class Gt{constructor(t){this._awake=null,this._onDestroy=null,this._onCollisionEnter2D=null,this._onCollisionStay2D=null,this._onCollisionExit2D=null,this._onTriggerEnter2D=null,this._onTriggerStay2D=null,this._onTriggerExit2D=null,this._start=null,this._update=null,this._component=t,this._sceneProcessor=t.engine.sceneProcessor,this._instantiater=t.engine.instantiater,this._eventState=new Ft,function(t){return void 0!==t.awake}(t)&&(this._awake=et.createAwakeEvent(this._instantiater,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this._onDestroy=et.createOnDestroyEvent(this._instantiater,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this._onCollisionEnter2D=et.createOnCollisionEnter2DEvent(this._instantiater,(e=>t.onCollisionEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this._onCollisionStay2D=et.createOnCollisionStay2DEvent(this._instantiater,(e=>t.onCollisionStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this._onCollisionExit2D=et.createOnCollisionExit2DEvent(this._instantiater,(e=>t.onCollisionExit2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this._onTriggerEnter2D=et.createOnTriggerEnter2DEvent(this._instantiater,(e=>t.onTriggerEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this._onTriggerStay2D=et.createOnTriggerStay2DEvent(this._instantiater,(e=>t.onTriggerStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this._onTriggerExit2D=et.createOnTriggerExit2DEvent(this._instantiater,(e=>t.onTriggerExit2D(e)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this._start=et.createStartEvent(this._instantiater,(()=>{this._eventState.startCalled=!0,t.start(),this._eventState.startRegistered&&this._sceneProcessor.removeEventFromNonSyncedCollection(this._start)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this._update=et.createUpdateEvent(this._instantiater,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this._eventState.awakeCalled||(this._eventState.awakeCalled=!0,null===(t=this._awake)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(void 0===this._component.onEnable)return;if(this._component._engine_internal_destroyed)return;if(this._eventState.enabled)return;this._eventState.enabled=!0;const t=et.createOnEnableEvent(this._instantiater,this._component.onEnable.bind(this._component),this._component.executionOrder);this._sceneProcessor.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(void 0===this._component.onDisable)return;if(this._component._engine_internal_destroyed)return;if(!this._eventState.enabled)return;this._eventState.enabled=!1;const t=et.createOnDisableEvent(this._instantiater,this._component.onDisable.bind(this._component),this._component.executionOrder);this._sceneProcessor.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this._onDestroy&&this._sceneProcessor.addEventToSyncedCollection(this._onDestroy)}tryRegisterStart(){this._start&&(this._component._engine_internal_destroyed||this._eventState.startCalled||this._eventState.startRegistered||(this._eventState.startRegistered=!0,this._sceneProcessor.addEventToNonSyncedCollection(this._start)))}tryUnregisterStart(){this._start&&this._eventState.startRegistered&&!this._eventState.startCalled&&(this._eventState.startRegistered=!1,this._sceneProcessor.removeEventFromNonSyncedCollection(this._start))}tryRegisterUpdate(){this._update&&(this._component._engine_internal_destroyed||this._eventState.updateRegistered||(this._eventState.updateRegistered=!0,this._sceneProcessor.addEventToNonSyncedCollection(this._update)))}tryUnregisterUpdate(){this._update&&this._eventState.updateRegistered&&(this._eventState.updateRegistered=!1,this._sceneProcessor.removeEventFromNonSyncedCollection(this._update))}get onCollisionEnter2D(){return this._onCollisionEnter2D}get onCollisionStay2D(){return this._onCollisionStay2D}get onCollisionExit2D(){return this._onCollisionExit2D}get onTriggerEnter2D(){return this._onTriggerEnter2D}get onTriggerStay2D(){return this._onTriggerStay2D}get onTriggerExit2D(){return this._onTriggerExit2D}}class Ut{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._runningCoroutines=[],this._engine_internal_destroyed=!1,this._enabled=!0,this._gameObject=t,this._instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=new Gt(this)}engine_internal_constructAfterProcess(){Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCorutine(t){this.checkComponentIsExist();const e=new Wt(this,t,(()=>{const t=this._runningCoroutines.indexOf(e);t>=0&&this._runningCoroutines.splice(t,1)}));return this._runningCoroutines.push(e),e.fatchNextInstruction(),this.engine.coroutineProcessor.addCoroutine(e),e}stopAllCoroutines(){this.checkComponentIsExist(),this._runningCoroutines.forEach((t=>{this.stopCoroutine(t)})),this._runningCoroutines.length=0}stopCoroutine(t){if(this.checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const e=this._runningCoroutines.indexOf(t);e>=0&&this._runningCoroutines.splice(e,1)}get enabled(){return this._enabled}set enabled(t){this.checkComponentIsExist(),this._enabled!==t&&(this._enabled=t,this._gameObject.initialized&&this._gameObject.activeInHierarchy&&(this._enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._gameObject}get transform(){return this._gameObject.transform}get engine(){return this._gameObject.engine}get instanceId(){return this._instanceId}get initialized(){return this._gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class Ht{constructor(t,e){this._priority=t,this._backgroundColor=e}get priority(){return this._priority}set priority(t){this._priority=t}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t}}class Nt{constructor(t,e,i,s=1){this._r=t,this._g=e,this._b=i,this._a=s}get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}toString(){return"rgba("+this._r+", "+this._g+", "+this._b+", "+this._a+")"}toHex(){return"#"+((Math.round(255*this._r)<<16)+(Math.round(255*this._g)<<8)+(Math.round(255*this._b)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this._r)<<16)+(Math.round(255*this._g)<<8)+(Math.round(255*this._b)<<0)).toString(16).padStart(6,"0")+Math.round(255*this._a).toString(16).padStart(2,"0")}toArray(){return[this._r,this._g,this._b,this._a]}static fromHex(t){const e=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new Nt(e,i,s)}static fromArray(t){return new Nt(t[0],t[1],t[2],t[3])}static fromString(t){const e=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return e?new Nt(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])):Nt.fromHex(t)}}var Yt;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(Yt||(Yt={}));class Lt extends Ut{constructor(){super(...arguments),this._camera=null,this._cameraType=Yt.Orthographic,this._fov=75,this._viewSize=5,this._near=.1,this._far=1e3,this._priority=0,this._backgroudColor=new Nt(1,1,1,0),this._onScreenResizeBind=this.onScreenResize.bind(this)}onEnable(){this.engine.screen.addOnResizeEventListener(this._onScreenResizeBind),this.createOrUpdateCamera()}onWorldMatrixUpdated(){this._camera&&(J.updateRawObject3DWorldMatrixRecursively(this._camera),this._camera.matrixWorldInverse.copy(this._camera.matrixWorld).invert())}createOrUpdateCamera(){const t=this.engine.screen.width/this.engine.screen.height;if(this._cameraType===Yt.Perspective)this._camera?this._camera instanceof It?(this._camera.aspect=t,this._camera.fov=this._fov,this._camera.near=this._near,this._camera.far=this._far,this._camera.updateProjectionMatrix()):(this._camera.removeFromParent(),this._camera=this.createNewPerspectiveCamera(),this.transform.unsafeGetObject3D().add(this._camera)):(this._camera=this.createNewPerspectiveCamera(),this.transform.unsafeGetObject3D().add(this._camera));else{if(this._cameraType!==Yt.Orthographic)throw new Error("Camera type not supported");if(this._camera)if(this._camera instanceof Bt){const e=this._viewSize;this._camera.left=-e*t,this._camera.right=e*t,this._camera.top=e,this._camera.bottom=-e,this._camera.near=this._near,this._camera.far=this._far,this._camera.updateProjectionMatrix()}else this._camera.removeFromParent(),this._camera=this.createNewOrthographicCamera(),this.transform.unsafeGetObject3D().add(this._camera);else this._camera=this.createNewOrthographicCamera(),this.transform.unsafeGetObject3D().add(this._camera)}J.updateRawObject3DWorldMatrixRecursively(this._camera),this.engine.cameraContainer.addCamera(this._camera,new Ht(this._priority,this._backgroudColor))}createNewPerspectiveCamera(){const t=this.engine.screen.width/this.engine.screen.height;return new It(this._fov,t,this._near,this._far)}createNewOrthographicCamera(){const t=this.engine.screen.width/this.engine.screen.height,e=this._viewSize;return new Bt(-e*t,e*t,e,-e,this._near,this._far)}onDisable(){this.engine.screen.removeOnResizeEventListener(this._onScreenResizeBind),this._camera&&this.engine.cameraContainer.removeCamera(this._camera)}onDestroy(){var t;null===(t=this._camera)||void 0===t||t.removeFromParent()}onScreenResize(t,e){const i=t/e;if(this._camera instanceof It)this._camera.aspect=i,this._camera.updateProjectionMatrix();else if(this._camera instanceof Bt){const t=this._viewSize;this._camera.left=-t*i,this._camera.right=t*i,this._camera.top=t,this._camera.bottom=-t,this._camera.updateProjectionMatrix()}}get cameraType(){return this._cameraType}set cameraType(t){this._cameraType!==t&&(this._cameraType=t,this._camera&&this.createOrUpdateCamera())}get fov(){return this._fov}set fov(t){this._fov!==t&&(this._fov=t,this._camera instanceof It&&(this._camera.fov=t,this._camera.updateProjectionMatrix()))}get viewSize(){return this._viewSize}set viewSize(t){if(this._viewSize!==t&&(this._viewSize=t,this._camera instanceof Bt)){const t=this.engine.screen.width/this.engine.screen.height,e=this._viewSize;this._camera.left=-e*t,this._camera.right=e*t,this._camera.top=e,this._camera.bottom=-e,this._camera.updateProjectionMatrix()}}get near(){return this._near}set near(t){this._near!==t&&(this._near=t,this._camera instanceof It&&(this._camera.near=t,this._camera.updateProjectionMatrix()))}get far(){return this._far}set far(t){this._far!==t&&(this._far=t,this._camera instanceof It&&(this._camera.far=t,this._camera.updateProjectionMatrix()))}get priority(){return this._priority}set priority(t){this._priority=t,this._camera&&this.engine.cameraContainer.changeCameraPriority(this._camera,t)}get backgroundColor(){return this._backgroudColor}set backgroundColor(t){this._backgroudColor=t,this._camera&&this.engine.cameraContainer.changeCameraBackgroundColor(this._camera,t)}}class Xt extends Ut{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[Lt],this._trackTarget=null,this._targetOffset=new Dt,this._cameraDistanceOffset=20,this._pixelPerfectUnit=1,this._pixelPerfect=!1,this._lerpTrack=!1,this._lerpAlpha=.1,this._tempVector=new u}start(){if(this._trackTarget){const t=this._tempVector.copy(this._trackTarget.transform.position);t.z+=this._cameraDistanceOffset,this.transform.position.copy(t)}}update(){const t=this._tempVector.copy(this._trackTarget.transform.position);t.z+=this._cameraDistanceOffset,t.x+=this._targetOffset.x,t.y+=this._targetOffset.y;const e=this.transform;this._lerpTrack?e.position.lerp(t,.1):e.position.copy(t),this._pixelPerfect&&(e.localPosition.x=Math.round(e.localPosition.x/this._pixelPerfectUnit)*this._pixelPerfectUnit,e.localPosition.y=Math.round(e.localPosition.y/this._pixelPerfectUnit)*this._pixelPerfectUnit)}setTrackTarget(t){this._trackTarget=t}get targetOffset(){return this._targetOffset}set targetOffset(t){this._targetOffset.copy(t)}get cameraDistanceOffset(){return this._cameraDistanceOffset}set cameraDistanceOffset(t){this._cameraDistanceOffset=t}get pixelPerfectUnit(){return this._pixelPerfectUnit}set pixelPerfectUnit(t){this._pixelPerfectUnit=t}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(t){this._pixelPerfect=t}get lerpTrack(){return this._lerpTrack}set lerpTrack(t){this._lerpTrack=t}get lerpAlpha(){return this._lerpAlpha}set lerpAlpha(t){this._lerpAlpha=t}}class Qt extends Rt{constructor(){super(...arguments),this._trackTarget=new Pt}withTrackTarget(t){return this._trackTarget=t,this}make(){return this.gameObjectBuilder.withComponent(Lt,(t=>{t.backgroundColor=new Nt(0,0,0,1),t.viewSize=8,t.cameraType=Yt.Orthographic})).withComponent(Xt,(t=>{t.setTrackTarget(this._trackTarget.ref),t.targetOffset=new Dt(0,3)}))}}const qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA8SURBVDhP7dEhCgAxDADB+/k9Lh8rDCtq6yo6JrAhKt9s/k2JEjceNGlPiRI3HjRpT4kS7w81SpQ4PJhZxl3jEH3ZDWcAAAAASUVORK5CYII=";class Vt extends H{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof Vt&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}new u,new _,new u,new p,new p;class Zt extends Ut{}class Kt extends Zt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this._runOnce=!0}start(){this.process(),this.runOnce&&(this.enabled=!1)}update(){this.process()}process(){this.gameObject.getComponentsInChildren().forEach((t=>{const e=t;e.onSortByZaxis&&"function"==typeof e.onSortByZaxis&&e.onSortByZaxis(t.transform.position.z)}))}static checkAncestorZaxisInitializer(t,e){if(!t.transform.parent)return;let i=t.transform.parent;for(;i;){if(i.gameObject.getComponent(Kt))return void e(i.position.z);if(null===i.parent)break;i=i.parent}}get runOnce(){return this._runOnce}set runOnce(t){this._runOnce=t}}var Jt,$t,te;!function(t){t[t.LengthUnitScalar=.1]="LengthUnitScalar"}(Jt||(Jt={}));class ee extends Ut{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this._centerOffset=new Dt,this._viewScale=Jt.LengthUnitScalar,this._pointerEvents=!0,this._zindex=0,this._readyToDraw=!1}start(){this._readyToDraw=!0,this.renderInitialize(),Kt.checkAncestorZaxisInitializer(this.gameObject,this.onSortByZaxis.bind(this))}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onSortByZaxis(t){this._zindex=t/Jt.LengthUnitScalar,this.css3DObject&&(this.css3DObject.element.style.zIndex=Math.floor(this._zindex).toString())}onWorldMatrixUpdated(){this.css3DObject&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){if(!this.htmlElement)throw new Error("htmlElement is null");let e=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new Vt(this.htmlElement),e=!0):this.css3DObject?this.css3DObject.element=this.htmlElement:(this.css3DObject=new Vt(this.htmlElement),e=!0),e&&(this.htmlElement.style.pointerEvents=this.pointerEvents?"auto":"none",this.htmlElement.style.zIndex=Math.floor(this._zindex).toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this._centerOffset}set centerOffset(t){this._centerOffset.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this._viewScale}set viewScale(t){this._viewScale=t,this.updateViewScale(!0)}get pointerEvents(){return this._pointerEvents}set pointerEvents(t){this._pointerEvents=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get readyToDraw(){return this._readyToDraw}}!function(t){t[t.ObjectFit=0]="ObjectFit",t[t.ClipPath=1]="ClipPath"}($t||($t={}));class ie extends ee{constructor(){super(...arguments),this._renderMode=$t.ObjectFit,this._imageWidth=0,this._imageHeight=0,this._imageFlipX=!1,this._imageFlipY=!1,this._opacity=1,this._rowCount=1,this._columnCount=1,this._currentImageIndex=0,this._croppedImageWidth=0,this._croppedImageHeight=0,this._initializeFunction=null}renderInitialize(){var t;null===(t=this._initializeFunction)||void 0===t||t.call(this),this.htmlElement||this.asyncSetImage(qt,1,1)}updateCenterOffset(t){if(this.css3DObject)if(this._renderMode===$t.ObjectFit)this.css3DObject.position.set(this._imageWidth*this.centerOffset.x,this._imageHeight*this.centerOffset.y,0),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject));else{const e=this._currentImageIndex%this._columnCount,i=Math.floor(this._currentImageIndex/this._columnCount),s=this._imageFlipX?-(this._imageWidth*this._columnCount/2-this._imageWidth/2)+e*this._imageWidth:this._imageWidth*this._columnCount/2-this._imageWidth/2-e*this._imageWidth,n=this._imageFlipY?this._imageHeight*this._rowCount/2-this._imageHeight/2-i*this._imageHeight:-(this._imageHeight*this._rowCount/2-this._imageHeight/2)+i*this._imageHeight;this.css3DObject.position.set(this._imageWidth*this.centerOffset.x+s,this._imageHeight*this.centerOffset.y+n,0),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}updateViewScale(t){if(this.css3DObject)if(this._renderMode===$t.ObjectFit){const e=this.viewScale,i=this._imageFlipX?-1:1,s=this._imageFlipY?-1:1;this.css3DObject.scale.set(this._imageWidth/this._croppedImageWidth*e*i,this._imageHeight/this._croppedImageHeight*e*s,1),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}else{const e=this.viewScale,i=this.htmlElement;i.style.width=this._imageWidth*this._columnCount/e+"px",i.style.height=this._imageHeight*this._rowCount/e+"px";const s=this._imageFlipX?-1:1,n=this._imageFlipY?-1:1;this.css3DObject.scale.set(e*s,e*n,e),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}}updateImageIndex(){if(this.htmlElement)if(this._renderMode===$t.ObjectFit){const t=-this._currentImageIndex%this._columnCount*this._croppedImageWidth,e=-Math.floor(this._currentImageIndex/this._columnCount)*this._croppedImageHeight;this.htmlElement.style.objectPosition=t+"px "+e+"px"}else{const t=Math.floor(this._currentImageIndex/this._columnCount),e=this._columnCount-this._currentImageIndex%this._columnCount-1;this.htmlElement.style.clipPath="inset("+100/this._rowCount*t+"% "+100/this._columnCount*e+"% "+(100-(100/this._rowCount*t+100/this._rowCount))+"% "+(100-(100/this._columnCount*e+100/this._columnCount))+"%)"}}get imagePath(){var t;return(null===(t=this.htmlElement)||void 0===t?void 0:t.src)||null}asyncSetImage(t,e,i,s){if(!this.readyToDraw)return void(this._initializeFunction=()=>this.asyncSetImage(t,e,i,s));this._rowCount=e,this._columnCount=i,this.htmlElement||(this.htmlElement=new Image),this.htmlElement.src=t;const n=t=>{const e=t.target;e.removeEventListener("load",n),e.alt=this.gameObject.name+"_sprite_atlas",e.style.imageRendering="pixelated",e.style.opacity=this._opacity.toString(),this._renderMode===$t.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit, for supressing this warning set viewScale to 1."),this._croppedImageWidth=e.naturalWidth/this._columnCount,this._croppedImageHeight=e.naturalHeight/this._rowCount,0===this._imageWidth&&(this._imageWidth=this._croppedImageWidth*Jt.LengthUnitScalar),0===this._imageHeight&&(this._imageHeight=this._croppedImageHeight*Jt.LengthUnitScalar),e.style.width=this._croppedImageWidth+"px",e.style.height=this._croppedImageHeight+"px",e.style.objectFit="none"):(0===this._imageWidth&&(this._imageWidth=e.naturalWidth/this._columnCount*Jt.LengthUnitScalar),0===this._imageHeight&&(this._imageHeight=e.naturalHeight/this._rowCount*Jt.LengthUnitScalar),e.style.width=this._imageWidth*this._columnCount/this.viewScale+"px",e.style.height=this._imageHeight*this._rowCount/this.viewScale+"px");const i=this.initializeBaseComponents(!1);this.updateImageIndex(),J.updateRawObject3DWorldMatrixRecursively(i),this.transform.enqueueRenderAttachedObject3D(i),null==s||s()};this.htmlElement.addEventListener("load",n)}get renderMode(){return this._renderMode}set renderMode(t){if(this._renderMode!==t&&(this._renderMode=t,this.htmlElement)){const t=this.htmlElement;this._renderMode===$t.ObjectFit?(1!==this.viewScale&&console.warn("CssSpriteAtlas.viewScale is not supported in CssSpriteAtlasRenderMode.ObjectFit"),t.style.clipPath="",this._croppedImageWidth=t.naturalWidth/this._columnCount,this._croppedImageHeight=t.naturalHeight/this._rowCount,0===this._imageWidth&&(this._imageWidth=this._croppedImageWidth),0===this._imageHeight&&(this._imageHeight=this._croppedImageHeight),t.style.width=this._croppedImageWidth+"px",t.style.height=this._croppedImageHeight+"px",t.style.objectFit="none"):(t.style.objectFit="",t.style.objectPosition="",0===this._imageWidth&&(this._imageWidth=t.naturalWidth/this._columnCount),0===this._imageHeight&&(this._imageHeight=t.naturalHeight/this._rowCount),t.style.width=this._imageWidth*this._columnCount/this.viewScale+"px",t.style.height=this._imageHeight*this._rowCount/this.viewScale+"px"),this.updateViewScale(!1),this.updateCenterOffset(!1),this.updateImageIndex(),J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)}}set imageIndex(t){this._currentImageIndex=t,this.updateImageIndex(),this._renderMode===$t.ClipPath&&this.updateCenterOffset(!0)}get rowCount(){return this._rowCount}get columnCount(){return this._columnCount}get imageWidth(){return this._imageWidth}set imageWidth(t){this._imageWidth=t,this._renderMode===$t.ObjectFit?this.css3DObject&&(this.css3DObject.scale.x=this._imageWidth/this._croppedImageWidth*this.viewScale,this.css3DObject.scale.x*=this._imageFlipX?-1:1):this.htmlElement&&(this.htmlElement.style.width=t*this._columnCount/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this._imageHeight}set imageHeight(t){this._imageHeight=t,this._renderMode===$t.ObjectFit?this.css3DObject&&(this.css3DObject.scale.y=this._imageHeight/this._croppedImageHeight*this.viewScale,this.css3DObject.scale.y*=this._imageFlipY?-1:1):this.htmlElement&&(this.htmlElement.style.height=t*this._rowCount/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this._imageFlipX}set imageFlipX(t){this._imageFlipX=t,this.css3DObject&&(this._imageFlipX?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),this._renderMode===$t.ObjectFit?(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.updateImageIndex(),this.updateCenterOffset(!0)))}get imageFlipY(){return this._imageFlipY}set imageFlipY(t){this._imageFlipY=t,this.css3DObject&&(this._imageFlipY?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),this._renderMode===$t.ObjectFit?(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)):(this.updateImageIndex(),this.updateCenterOffset(!0)))}get opacity(){return this._opacity}set opacity(t){this._opacity=t,this.htmlElement&&(this.htmlElement.style.opacity=this._opacity.toString())}}class se extends Ut{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[ie],this._spriteAtlasRenderer=null,this._animations={},this._playingAnimationName=null,this._playingAnimation=null,this._playingAnimationFrame=0,this._playing=!1,this._frameDuration=2,this._currentFrameDuration=0}awake(){this._spriteAtlasRenderer=this.gameObject.getComponent(ie)}update(){null!==this._spriteAtlasRenderer&&this._playing&&(this._currentFrameDuration+=this.engine.time.deltaTime,this._currentFrameDuration>=this._frameDuration&&(this._currentFrameDuration=0,this._playingAnimationFrame++,this._playingAnimationFrame>=this._playingAnimation.length&&(this._playingAnimationFrame=0),this._spriteAtlasRenderer.imageIndex=this._playingAnimation[this._playingAnimationFrame]))}playAnimation(t){null!==this._spriteAtlasRenderer&&this._playingAnimationName!==t&&(this._playingAnimationName=t,this._playingAnimation=this._animations[t],this._playingAnimationFrame=0,this._spriteAtlasRenderer.imageIndex=this._animations[t][0],this._playing=!0)}stopAnimation(){null!==this._spriteAtlasRenderer&&(this._playing=!1)}addAnimation(t,e){0!==e.length?this._animations[t]=e:console.warn(`Animation "${t}" has no frames.`)}get frameDuration(){return this._frameDuration}set frameDuration(t){this._frameDuration=t}}class ne{constructor(t,e){this._x=t,this._y=e,this._gCost=0,this._hCost=0,this._fCost=0,this._previousNode=null,this._isWalkable=!0}calculateFCost(){this._fCost=this._gCost+this._hCost}equals(t){return this._x===t._x&&this._y===t._y}get x(){return this._x}get y(){return this._y}get gCost(){return this._gCost}set gCost(t){this._gCost=t}get hCost(){return this._hCost}set hCost(t){this._hCost=t}get fCost(){return this._fCost}set fCost(t){this._fCost=t}get isWalkable(){return this._isWalkable}set isWalkable(t){this._isWalkable=t}get previousNode(){return this._previousNode}set previousNode(t){this._previousNode=t}}class re{constructor(t){var e;this.collideMaps=null!==(e=null==t?void 0:t.slice())&&void 0!==e?e:[]}addCollideMap(t){this.collideMaps.push(t)}findPath(t,e){const i=new ne(t.x,t.y),s=new ne(e.x,e.y);if(this.checkCollision(i.x,i.y))return null;if(this.checkCollision(s.x,s.y))return null;const n=[],r=[];i.gCost=0,i.hCost=this.calculateDistanceCost(i,s),i.calculateFCost(),n.push(i);let o=0;for(;n.length>0&&o<re._iterationLimit;){o++;const t=this.getLowestFcostNode(n);if(t.equals(s))return this.calculatePath(t);n.splice(n.indexOf(t),1),r.push(t);const e=this.getNeighbors(t);for(let i=0;i<e.length;i++){const o=e[i];if(void 0!==r.find((t=>t.equals(o))))continue;if(o.gCost=Number.MAX_VALUE,o.calculateFCost(),o.previousNode=null,this.checkCollision(o.x,o.y)){r.push(o);continue}const h=t.gCost+this.calculateDistanceCost(t,o);h<o.gCost&&(o.previousNode=t,o.gCost=h,o.hCost=this.calculateDistanceCost(o,s),o.calculateFCost(),void 0===n.find((t=>t.equals(o)))&&n.push(o))}}return null}getNeighbors(t){const e=[];return e.push(new ne(t.x,t.y-1)),e.push(new ne(t.x+1,t.y)),e.push(new ne(t.x,t.y+1)),e.push(new ne(t.x-1,t.y)),e}calculatePath(t){const e=[];let i=t;for(;i.previousNode;)e.push(new Dt(i.x,i.y)),i=i.previousNode;return e.push(new Dt(i.x,i.y)),e.reverse()}calculateDistanceCost(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}getLowestFcostNode(t){let e=t[0];for(let i=1;i<t.length;i++)t[i].fCost<e.fCost&&(e=t[i]);return e}checkCollision(t,e){const i=this.collideMaps;for(let s=0;s<i.length;s++){const n=i[s];if(n.checkCollision(t*n.gridCellWidth+n.gridCenterX,e*n.gridCellHeight+n.gridCenterY,re._checkCollisionScale,re._checkCollisionScale))return!0}return!1}}re._checkCollisionScale=8,re._iterationLimit=1e3,function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(te||(te={}));class oe extends Ut{constructor(){super(...arguments),this._direction=te.Down,this._isMoving=!1}get direction(){return this._direction}set direction(t){this._direction=t}get isMoving(){return this._isMoving}set isMoving(t){this._isMoving=t}}class he extends oe{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this._speed=8,this._gridCellHeight=1,this._gridCellWidth=1,this._collideMaps=[],this._collideSize=.5,this._gridCenter=new Dt,this._currentGridPosition=new Dt,this._targetGridPosition=new Dt,this._initPosition=new Dt,this._onMoveToTargetDelegates=[],this._onMovedToTargetDelegates=[],this._onPointerDownBind=this.onPointerDown.bind(this),this._gridPointer=null,this._pathfinder=null,this._movingByPathfinder=!1,this._findedPath=null,this._currentPathIndex=0,this._pathfindStartFunction=null,this._tempVector2=new Dt,this._lastPointerDownTime=-1,this._lastPointerDownPosition=new Dt,this._doubleClickTime=.3}start(){this._pathfinder=new re(this._collideMaps);const t=this.transform,e=t.position;e.x=this._gridCenter.x+this._initPosition.x*this._gridCellWidth,e.y=this._gridCenter.y+this._initPosition.y*this._gridCellHeight,this._currentGridPosition.set(t.localPosition.x,t.localPosition.y)}update(){var t;null===(t=this._pathfindStartFunction)||void 0===t||t.call(this),this.processInput(),this.processPathfinderInput(),this.processMovement()}processInput(){if(this.isMoving)return void this.tryCancelPathfinder();const t=this.engine.input.map;if(t.get("w")||t.get("W")||t.get("ArrowUp")){if(this.direction=te.Up,this.checkCollision(this._currentGridPosition.x,this._currentGridPosition.y+this._gridCellHeight))return;this._targetGridPosition.set(this._currentGridPosition.x,this._currentGridPosition.y+this._gridCellHeight),this.invokeOnMoveToTarget(this._targetGridPosition),this.isMoving=!0}else if(t.get("s")||t.get("S")||t.get("ArrowDown")){if(this.direction=te.Down,this.checkCollision(this._currentGridPosition.x,this._currentGridPosition.y-this._gridCellHeight))return;this._targetGridPosition.set(this._currentGridPosition.x,this._currentGridPosition.y-this._gridCellHeight),this.invokeOnMoveToTarget(this._targetGridPosition),this.isMoving=!0}else if(t.get("a")||t.get("A")||t.get("ArrowLeft")){if(this.direction=te.Left,this.checkCollision(this._currentGridPosition.x-this._gridCellWidth,this._currentGridPosition.y))return;this._targetGridPosition.set(this._currentGridPosition.x-this._gridCellWidth,this._currentGridPosition.y),this.invokeOnMoveToTarget(this._targetGridPosition),this.isMoving=!0}else if(t.get("d")||t.get("D")||t.get("ArrowRight")){if(this.direction=te.Right,this.checkCollision(this._currentGridPosition.x+this._gridCellWidth,this._currentGridPosition.y))return;this._targetGridPosition.set(this._currentGridPosition.x+this._gridCellWidth,this._currentGridPosition.y),this.invokeOnMoveToTarget(this._targetGridPosition),this.isMoving=!0}}noncheckProcessInput(t){const e=this.engine.input.map;return e.get("w")||e.get("W")||e.get("ArrowUp")?(this.direction=te.Up,!this.checkCollision(t.x,t.y+this._gridCellHeight)&&(this._targetGridPosition.set(t.x,t.y+this._gridCellHeight),this.invokeOnMoveToTarget(this._targetGridPosition),!0)):e.get("s")||e.get("S")||e.get("ArrowDown")?(this.direction=te.Down,!this.checkCollision(t.x,t.y-this._gridCellHeight)&&(this._targetGridPosition.set(t.x,t.y-this._gridCellHeight),this.invokeOnMoveToTarget(this._targetGridPosition),!0)):e.get("a")||e.get("A")||e.get("ArrowLeft")?(this.direction=te.Left,!this.checkCollision(t.x-this._gridCellWidth,t.y)&&(this._targetGridPosition.set(t.x-this._gridCellWidth,t.y),this.invokeOnMoveToTarget(this._targetGridPosition),!0)):!!(e.get("d")||e.get("D")||e.get("ArrowRight"))&&(this.direction=te.Right,!this.checkCollision(t.x+this._gridCellWidth,t.y)&&(this._targetGridPosition.set(t.x+this._gridCellWidth,t.y),this.invokeOnMoveToTarget(this._targetGridPosition),!0))}invokeOnMoveToTarget(t){this._onMoveToTargetDelegates.forEach((t=>t(Math.floor(this._targetGridPosition.x/this._gridCellWidth),Math.floor(this._targetGridPosition.y/this._gridCellHeight))))}invokeOnMovedToTarget(t){this._onMovedToTargetDelegates.forEach((t=>t(Math.floor(this._currentGridPosition.x/this._gridCellWidth),Math.floor(this._currentGridPosition.y/this._gridCellHeight))))}tryCancelPathfinder(){const t=this.engine.input.map;(t.get("w")||t.get("W")||t.get("ArrowUp")||t.get("s")||t.get("S")||t.get("ArrowDown")||t.get("a")||t.get("A")||t.get("ArrowLeft")||t.get("d")||t.get("D")||t.get("ArrowRight"))&&(this._movingByPathfinder=!1)}processPathfinderInput(){if(!this._movingByPathfinder)return;const t=this.transform,e=this._tempVector2.set(t.localPosition.x,t.localPosition.y),i=this._findedPath[this._currentPathIndex];if(i.distanceTo(e)<this._speed*this.engine.time.deltaTime){if(this._currentPathIndex++,this._currentPathIndex>=this._findedPath.length)return void(this._movingByPathfinder=!1);this.invokeOnMovedToTarget(e)}if(this.checkCollision(i.x,i.y))return void(this._movingByPathfinder=!1);if(this._targetGridPosition.equals(this._findedPath[this._currentPathIndex]))return;this._targetGridPosition.copy(this._findedPath[this._currentPathIndex]),this.invokeOnMoveToTarget(this._targetGridPosition);const s=this._findedPath[this._currentPathIndex-1].x,n=this._findedPath[this._currentPathIndex-1].y,r=this._findedPath[this._currentPathIndex].x,o=this._findedPath[this._currentPathIndex].y;n<o?this.direction=te.Up:n>o?this.direction=te.Down:s<r?this.direction=te.Right:s>r&&(this.direction=te.Left),this.isMoving=!0}processMovement(){if(!this.isMoving)return;const t=this.transform,e=new Dt(t.localPosition.x,t.localPosition.y);let i=e.distanceTo(this._targetGridPosition);if(i<this._speed*this.engine.time.deltaTime&&this.noncheckProcessInput(this._targetGridPosition)&&(i=e.distanceTo(this._targetGridPosition),this.invokeOnMovedToTarget(e)),i>.01){const s=this._tempVector2.copy(this._targetGridPosition).sub(e).normalize();s.multiplyScalar(Math.min(this._speed*this.engine.time.deltaTime,i)),t.localPosition.x+=s.x,t.localPosition.y+=s.y}else this.isMoving=!1,this._currentGridPosition.copy(this._targetGridPosition),t.localPosition.x=this._currentGridPosition.x,t.localPosition.y=this._currentGridPosition.y,this.invokeOnMovedToTarget(this._targetGridPosition)}checkCollision(t,e){for(let i=0;i<this._collideMaps.length;i++)if(this._collideMaps[i].checkCollision(t,e,this._collideSize,this._collideSize))return!0;return!1}onPointerDown(t){if(0!==t.button)return;this._movingByPathfinder=!1;const e=this.engine.time.unscaledTime;e-this._lastPointerDownTime<this._doubleClickTime?this._lastPointerDownPosition.equals(t.gridPosition)&&(this.onDoubleClick(t),this._lastPointerDownTime=-1):(this._lastPointerDownTime=e,this._lastPointerDownPosition.copy(t.gridPosition))}onDoubleClick(t){if(this._movingByPathfinder)return this._movingByPathfinder=!1,void(this._pathfindStartFunction=()=>this.tryStartPathfind(t.gridPosition));this._pathfindStartFunction=()=>this.tryStartPathfind(t.gridPosition)}tryStartPathfind(t){this._movingByPathfinder||(this._pathfindStartFunction=null,this._findedPath=this._pathfinder.findPath(this.positionInGrid,t),!this._findedPath||this._findedPath.length<=1||(this._findedPath.forEach((t=>{t.x=t.x*this._gridCellWidth+this._gridCenter.x,t.y=t.y*this._gridCellHeight+this._gridCenter.y})),this._currentPathIndex=1,this.isMoving=!0,this._movingByPathfinder=!0))}addOnMoveToTargetEventListener(t){this._onMoveToTargetDelegates.push(t)}removeOnMoveToTargetEventListener(t){const e=this._onMoveToTargetDelegates.indexOf(t);e>=0&&this._onMoveToTargetDelegates.splice(e,1)}addOnMovedToTargetEventListener(t){this._onMovedToTargetDelegates.push(t)}removeOnMovedToTargetEventListener(t){const e=this._onMovedToTargetDelegates.indexOf(t);e>=0&&this._onMovedToTargetDelegates.splice(e,1)}get speed(){return this._speed}set speed(t){this._speed=t}get gridCenter(){return this._gridCenter}set gridCenter(t){this._gridCenter.copy(t)}get gridCellHeight(){return this._gridCellHeight}set gridCellHeight(t){this._gridCellHeight=t}get gridCellWidth(){return this._gridCellWidth}set gridCellWidth(t){this._gridCellWidth=t}set initPosition(t){this._initPosition.copy(t)}set gridPointer(t){this._gridPointer&&this._gridPointer.removeOnPointerDownEventListener(this._onPointerDownBind),this._gridPointer=t,this._gridPointer&&this._gridPointer.addOnPointerDownEventListener(this._onPointerDownBind)}get gridPointer(){return this._gridPointer}addCollideMap(t){var e;this._collideMaps.push(t),null===(e=this._pathfinder)||void 0===e||e.addCollideMap(t)}setGridInfoFromCollideMap(t){this._gridCellWidth=t.gridCellWidth,this._gridCellHeight=t.gridCellHeight,this._gridCenter.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new Dt(Math.floor(this.transform.localPosition.x/this._gridCellWidth),Math.floor(this.transform.localPosition.y/this._gridCellHeight))}}class ae extends Zt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this._offset=0,this._runOnce=!0}start(){this.update(),this._runOnce&&this.destroy()}update(){const t=this.transform.position;t.z=-t.y+this._offset,this.gameObject.getComponentsInChildren().forEach((e=>{const i=e;i.onSortByZaxis&&"function"==typeof i.onSortByZaxis&&i.onSortByZaxis(t.z)}))}get offset(){return this._offset}set offset(t){this._offset=t}get runOnce(){return this._runOnce}set runOnce(t){this._runOnce=t}}class le extends Ut{constructor(){super(...arguments),this._disallowMultipleComponent=!0,this._requiredComponents=[oe,se],this._directionable=null,this._spriteAtlasAnimator=null,this._lastDirection=te.Down,this._lastIsMoving=!1}awake(){this._directionable=this.gameObject.getComponent(oe),this._spriteAtlasAnimator=this.gameObject.getComponent(se)}update(){const t=this._directionable.direction,e=this._directionable.isMoving;e?t===te.Up?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("up_walk"),this._lastIsMoving=e,this._lastDirection=t):t===te.Down?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("down_walk"),this._lastIsMoving=e,this._lastDirection=t):t===te.Left?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("left_walk"),this._lastIsMoving=e,this._lastDirection=t):t===te.Right&&(this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("right_walk"),this._lastIsMoving=e,this._lastDirection=t)):t===te.Up?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("up_idle"),this._lastIsMoving=e,this._lastDirection=t):t===te.Down?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("down_idle"),this._lastIsMoving=e,this._lastDirection=t):t===te.Left?this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("left_idle"),this._lastIsMoving=e,this._lastDirection=t):t===te.Right&&(this._lastIsMoving===e&&this._lastDirection===t||(this._spriteAtlasAnimator.playAnimation("right_idle"),this._lastIsMoving=e,this._lastDirection=t))}}var ce=i(459);class de extends Rt{constructor(){super(...arguments),this._collideMaps=[],this._gridPosition=new Pt}withCollideMap(t){return this._collideMaps.push(t),this}withGridPosition(t){return this._gridPosition=t,this}make(){return this.gameObjectBuilder.withComponent(ie,(t=>{t.asyncSetImage(ce,4,4),t.centerOffset=new Dt(0,.4),t.pointerEvents=!1,t.viewScale=1,t.imageWidth=1,t.imageHeight=2})).withComponent(se,(t=>{t.addAnimation("down_idle",[0]),t.addAnimation("right_idle",[4]),t.addAnimation("up_idle",[8]),t.addAnimation("left_idle",[12]),t.addAnimation("down_walk",[0,1,2,3]),t.addAnimation("right_walk",[4,5,6,7]),t.addAnimation("up_walk",[8,9,10,11]),t.addAnimation("left_walk",[12,13,14,15]),t.frameDuration=.2})).withComponent(he,(t=>{1<=this._collideMaps.length&&this._collideMaps[0].ref&&t.setGridInfoFromCollideMap(this._collideMaps[0].ref);for(let e=0;e<this._collideMaps.length;e++)this._collideMaps[e].ref&&t.addCollideMap(this._collideMaps[e].ref);this._gridPosition.ref&&(t.initPosition=this._gridPosition.ref),t.speed=5})).withComponent(le).withComponent(ae,(t=>{t.runOnce=!1,t.offset=.1}))}}class _e extends Zt{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this._offset=-100,this._tempVector3=new u}update(){this.transform.localPosition.z=this.engine.cameraContainer.camera.getWorldPosition(this._tempVector3).z+this._offset,this.gameObject.getComponentsInChildren().forEach((t=>{const e=t;e.onSortByZaxis&&"function"==typeof e.onSortByZaxis&&e.onSortByZaxis(this.transform.localPosition.z)}))}get offset(){return this._offset}set offset(t){this._offset=t}}class ue{constructor(t,e,i){this._htmlImageElement=t,this._rowCount=i||1,this._columnCount=e||1}get htmlImageElement(){return this._htmlImageElement}get columnCount(){return this._columnCount}get rowCount(){return this._rowCount}}class me extends ee{constructor(){super(...arguments),this._columnCount=10,this._rowCount=10,this._tileWidth=1,this._tileHeight=1,this._tileResolutionX=16,this._tileResolutionY=16,this._imageSources=null,this._initializeFunctions=[]}renderInitialize(){this.drawTileMap(),this._initializeFunctions.forEach((t=>t())),this._initializeFunctions=[]}updateCenterOffset(t){if(!this.css3DObject)return;const e=this._columnCount*this._tileWidth,i=this._rowCount*this._tileHeight;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement,s=this._columnCount*this._tileWidth,n=this._rowCount*this._tileHeight;i.style.width=s/e+"px",i.style.height=n/e+"px",this.css3DObject.scale.set(e,e,e),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}drawTileMap(){const t=this._columnCount*this._tileWidth,e=this._rowCount*this._tileHeight,i=this._columnCount*this._tileResolutionX,s=this._rowCount*this._tileResolutionY;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=i,this.htmlElement.height=s,this.htmlElement.style.imageRendering="pixelated",this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=e/this.viewScale+"px";const n=this.initializeBaseComponents(!1);J.updateRawObject3DWorldMatrixRecursively(n),this.transform.enqueueRenderAttachedObject3D(n)}drawTile(t,e,i,s){if(!this.readyToDraw)return void this._initializeFunctions.push((()=>this.drawTile(t,e,i,s)));const n=this.htmlElement.getContext("2d"),r=this._imageSources[i];if(1===r.rowCount&&1===r.columnCount)n.drawImage(r.htmlImageElement,0,0,this._tileResolutionX,this._tileResolutionY,t*this._tileResolutionX,e*this._tileResolutionY,this._tileResolutionX,this._tileResolutionY);else{if(void 0===s)throw new Error("Atlas index is required.");{const i=Math.floor(s/r.columnCount),o=s%r.columnCount,h=r.htmlImageElement.width/r.columnCount,a=r.htmlImageElement.height/r.rowCount;n.drawImage(r.htmlImageElement,o*h,i*a,h,a,t*this._tileResolutionX,e*this._tileResolutionY,this._tileResolutionX,this._tileResolutionY)}}}drawTileFromTwoDimensionalArray(t,e,i){if(!this.readyToDraw)return void this._initializeFunctions.push((()=>this.drawTileFromTwoDimensionalArray(t,e,i)));const s=this.htmlElement.getContext("2d");for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++){const o=r[t];if(null===o)continue;const h=this._imageSources[o.i];if(1===h.rowCount&&1===h.columnCount)s.drawImage(h.htmlImageElement,0,0,this._tileResolutionX,this._tileResolutionY,t*this._tileResolutionX+e*this._tileResolutionX,n*this._tileResolutionY+i*this._tileResolutionY,this._tileResolutionX,this._tileResolutionY);else{if(void 0===o.a)throw new Error("Atlas index is required.");{const r=o.a%h.columnCount,a=Math.floor(o.a/h.columnCount),l=h.htmlImageElement.width/h.columnCount,c=h.htmlImageElement.height/h.rowCount;s.drawImage(h.htmlImageElement,r*l,a*c,l,c,t*this._tileResolutionX+e*this._tileResolutionX,n*this._tileResolutionY+i*this._tileResolutionY,this._tileResolutionX,this._tileResolutionY)}}}}}clearTile(t,e){this.readyToDraw?this.htmlElement.getContext("2d").clearRect(t*this._tileResolutionX,e*this._tileResolutionY,this._tileResolutionX,this._tileResolutionY):this._initializeFunctions.push((()=>this.clearTile(t,e)))}set imageSources(t){this.readyToDraw?this._imageSources=t:this._initializeFunctions.push((()=>this.imageSources=t))}get columnCount(){return this._columnCount}set columnCount(t){if(this._columnCount=t,this.htmlElement){const t=this._columnCount*this._tileWidth,e=this._columnCount*this._tileResolutionX;this.htmlElement.width=e,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this._rowCount}set rowCount(t){if(this._rowCount=t,this.htmlElement){const t=this._rowCount*this._tileHeight,e=this._rowCount*this._tileResolutionY;this.htmlElement.height=e,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this._tileWidth}set gridCellWidth(t){if(this._tileWidth=t,this.htmlElement){const t=this._columnCount*this._tileWidth;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this._tileHeight}set gridCellHeight(t){if(this._tileHeight=t,this.htmlElement){const t=this._rowCount*this._tileHeight;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this._tileResolutionX}set tileResolutionX(t){if(this._tileResolutionX=t,this.htmlElement){const t=this._columnCount*this._tileResolutionX;this.htmlElement.width=t}}get tileResolutionY(){return this._tileResolutionY}set tileResolutionY(t){if(this._tileResolutionY=t,this.htmlElement){const t=this._rowCount*this._tileResolutionY;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this._tileWidth/2,e=this.rowCount%2==1?0:this._tileHeight/2;return new Dt(this.transform.position.x+t,this.transform.position.y+e)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this._tileWidth/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this._tileHeight/2)}}class ge extends Ut{constructor(){super(...arguments),this._cssTilemapRendererMap=new Map,this._chunkSize=16,this._tileWidth=1,this._tileHeight=1,this._tileResolutionX=16,this._tileResolutionY=16,this._imageSources=null,this._pointerEvents=!0,this._initializeFunctions=[],this._started=!1}start(){this._started=!0,this._initializeFunctions.forEach((t=>t())),this._initializeFunctions=[]}updateTilemapPosition(){this._cssTilemapRendererMap.forEach(((t,e)=>{const i=this.getIndexXFromKey(e)*this._chunkSize*this._tileWidth,s=this.getIndexYFromKey(e)*this._chunkSize*this._tileHeight;t.gameObject.transform.localPosition.set(i,s,0)}))}getIndexXFromKey(t){return parseInt(t.substring(0,t.indexOf("_")))}getIndexYFromKey(t){return parseInt(t.substring(t.indexOf("_")+1))}getKeyFromIndex(t,e){return`${t}_${e}`}computeDrawPosition(t,e,i,s){const n=i-t*this._chunkSize+this._chunkSize/2,r=s-e*this._chunkSize+this._chunkSize/2;return new Dt(n,r)}getTilemapRenedererOrCreate(t,e){const i=this.getKeyFromIndex(t,e);let s=this._cssTilemapRendererMap.get(i);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+e,new u(t*this._chunkSize*this._tileWidth,e*this._chunkSize*this._tileHeight,0)).withComponent(me,(t=>{s=t,this._imageSources&&(t.imageSources=this._imageSources),t.gridCellWidth=this._tileWidth,t.gridCellHeight=this._tileHeight,t.tileResolutionX=this._tileResolutionX,t.tileResolutionY=this._tileResolutionY,t.rowCount=this._chunkSize,t.columnCount=this._chunkSize,t.pointerEvents=this._pointerEvents}))),this._cssTilemapRendererMap.set(i,s)),s}getTilemapRenedererOrNull(t,e){const i=this.getKeyFromIndex(t,e),s=this._cssTilemapRendererMap.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this._started)return void this._initializeFunctions.push((()=>{this.drawTile(t,e,i,s)}));const n=Math.floor((t+this._chunkSize/2)/this._chunkSize),r=Math.floor((e+this._chunkSize/2)/this._chunkSize),o=this.getTilemapRenedererOrCreate(n,r),h=this.computeDrawPosition(n,r,t,e),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;o.drawTile(h.x+a,this._chunkSize-h.y-1+l,i,s)}drawTileFromTwoDimensionalArray(t,e,i){if(this._started)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)null!==t[s][n]&&this.drawTile(n+e,t.length-s+i-1,t[s][n].i,t[s][n].a);else this._initializeFunctions.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this._started)return void this._initializeFunctions.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this._chunkSize/2)/this._chunkSize),s=Math.floor((e+this._chunkSize/2)/this._chunkSize),n=this.getTilemapRenedererOrNull(i,s);if(null===n)return;const r=this.computeDrawPosition(i,s,t,e),o=this.chunkSize%2==0?0:-.5,h=this.chunkSize%2==0?0:.5;n.clearTile(r.x+o,this._chunkSize-r.y-1+h)}get chunkSize(){return this._chunkSize}set chunkSize(t){this._chunkSize=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.rowCount=this._chunkSize,t.columnCount=this._chunkSize}))}set imageSources(t){this._started?(this._imageSources=t,this._cssTilemapRendererMap.forEach(((e,i)=>{e.imageSources=t}))):this._initializeFunctions.push((()=>{this.imageSources=t}))}get pointerEvents(){return this._pointerEvents}set pointerEvents(t){this._pointerEvents=t,this._cssTilemapRendererMap.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this._tileWidth}set gridCellWidth(t){this._tileWidth!==t&&(this._tileWidth=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.gridCellWidth=this._tileWidth})))}get gridCellHeight(){return this._tileHeight}set gridCellHeight(t){this._tileHeight!==t&&(this._tileHeight=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.gridCellHeight=this._tileHeight})))}get tileResolutionX(){return this._tileResolutionX}set tileResolutionX(t){this._tileResolutionX!==t&&(this._tileResolutionX=t,this._cssTilemapRendererMap.forEach(((t,e)=>{t.tileResolutionX=this._tileResolutionX})))}get tileResolutionY(){return this._tileResolutionY}set tileResolutionY(t){this._tileResolutionY!==t&&(this._tileResolutionY=t,this._cssTilemapRendererMap.forEach(((t,e)=>{t.tileResolutionY=this._tileResolutionY})))}get gridCenter(){const t=this._chunkSize%2==1?0:this._tileWidth/2,e=this._chunkSize%2==1?0:this._tileHeight/2;return new Dt(this.transform.localPosition.x+t,this.transform.localPosition.y+e)}get gridCenterX(){const t=this._chunkSize%2==1?0:this._tileWidth/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this._chunkSize%2==1?0:this._tileHeight/2;return this.transform.localPosition.y+t}}class pe extends me{constructor(){super(...arguments),this._collideMap=new Map,this._collideEnabled=!1}onEnable(){super.onEnable(),this._collideEnabled=!0}onDisable(){super.onDisable(),this._collideEnabled=!1}drawTile(t,e,i,s){super.drawTile(t,e,i,s);const n=Math.ceil(t-this.columnCount/2),r=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this._collideMap.set(`${n}_${r}`,!0)}drawTileFromTwoDimensionalArray(t,e,i){super.drawTileFromTwoDimensionalArray(t,e,i);for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)if(null!==t[s][n]){const t=Math.ceil(this.transform.localPosition.x/this.gridCellWidth+(n+e)-this.columnCount/2),r=Math.ceil(this.transform.localPosition.y/this.gridCellHeight+(this.rowCount-(s+i))-this.rowCount/2)-1;this._collideMap.set(`${t}_${r}`,!0)}}clearTile(t,e){super.clearTile(t,e);const i=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this._collideMap.delete(`${i}_${s}`)}addCollider(t,e){const i=Math.ceil(t-this.columnCount/2),s=Math.ceil(this.rowCount-e-this.rowCount/2)-1;this._collideMap.set(`${i}_${s}`,!0)}checkCollision(t,e,i,s){if(!this._collideEnabled)return!1;const n=this.transform.position;t-=n.x,e-=n.y,this.columnCount%2==0&&(t-=this.gridCellWidth),this.rowCount%2==0&&(e-=this.gridCellHeight),this.rowCount%2==0&&(e+=this.gridCellHeight/2),this.columnCount%2==0&&(t+=this.gridCellWidth/2);const r=Math.floor(t/this.gridCellWidth),o=Math.floor((t+i)/this.gridCellWidth),h=Math.floor(e/this.gridCellHeight),a=Math.floor((e+s)/this.gridCellHeight);for(let t=h;t<=a;t++)for(let e=r;e<=o;e++)if(!0===this._collideMap.get(`${e}_${t}`))return!0;return!1}}class fe extends Ut{constructor(){super(...arguments),this._cssTilemapRendererMap=new Map,this._chunkSize=16,this._tileWidth=1,this._tileHeight=1,this._tileResolutionX=16,this._tileResolutionY=16,this._imageSources=null,this._pointerEvents=!0,this._collideEnabled=!1,this._initializeFunctions=[],this._started=!1}start(){this._started=!0,this._initializeFunctions.forEach((t=>t())),this._initializeFunctions=[]}onEnable(){this._collideEnabled=!0}onDisable(){this._collideEnabled=!1}updateTilemapPosition(){this._cssTilemapRendererMap.forEach(((t,e)=>{const i=this.getIndexXFromKey(e)*this._chunkSize*this._tileWidth,s=this.getIndexYFromKey(e)*this._chunkSize*this._tileHeight;t.gameObject.transform.localPosition.set(i,s,0)}))}getIndexXFromKey(t){return parseInt(t.substring(0,t.indexOf("_")))}getIndexYFromKey(t){return parseInt(t.substring(t.indexOf("_")+1))}getKeyFromIndex(t,e){return`${t}_${e}`}computeDrawPosition(t,e,i,s){const n=i-t*this._chunkSize+this._chunkSize/2,r=s-e*this._chunkSize+this._chunkSize/2;return new Dt(n,r)}getTilemapRenedererOrCreate(t,e){const i=this.getKeyFromIndex(t,e);let s=this._cssTilemapRendererMap.get(i);return void 0===s&&(this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject(`css_tilemap_renderer_${t}_${e}`,new u(t*this._chunkSize*this._tileWidth,e*this._chunkSize*this._tileHeight,0)).withComponent(pe,(t=>{s=t,this._imageSources&&(t.imageSources=this._imageSources),t.gridCellWidth=this._tileWidth,t.gridCellHeight=this._tileHeight,t.tileResolutionX=this._tileResolutionX,t.tileResolutionY=this._tileResolutionY,t.rowCount=this._chunkSize,t.columnCount=this._chunkSize,t.pointerEvents=this._pointerEvents}))),this._cssTilemapRendererMap.set(i,s)),s}getTilemapRenedererOrNull(t,e){const i=this.getKeyFromIndex(t,e),s=this._cssTilemapRendererMap.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this._started)return void this._initializeFunctions.push((()=>{this.drawTile(t,e,i,s)}));const n=Math.floor((t+this._chunkSize/2)/this._chunkSize),r=Math.floor((e+this._chunkSize/2)/this._chunkSize),o=this.getTilemapRenedererOrCreate(n,r),h=this.computeDrawPosition(n,r,t,e),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5;o.drawTile(h.x+a,this._chunkSize-h.y-1+l,i,s)}drawTileFromTwoDimensionalArray(t,e,i){if(this._started)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)null!==t[s][n]&&this.drawTile(n+e,t.length-s+i-1,t[s][n].i,t[s][n].a);else this._initializeFunctions.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this._started)return void this._initializeFunctions.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this._chunkSize/2)/this._chunkSize),s=Math.floor((e+this._chunkSize/2)/this._chunkSize),n=this.getTilemapRenedererOrNull(i,s);if(null===n)return;const r=this.computeDrawPosition(i,s,t,e),o=this.chunkSize%2==0?0:-.5,h=this.chunkSize%2==0?0:.5;n.clearTile(r.x+o,this._chunkSize-r.y-1+h)}addCollider(t,e){if(!this._started)return void this._initializeFunctions.push((()=>{this.addCollider(t,e)}));const i=Math.floor((t+this._chunkSize/2)/this._chunkSize),s=Math.floor((e+this._chunkSize/2)/this._chunkSize),n=this.getTilemapRenedererOrCreate(i,s),r=this.computeDrawPosition(i,s,t,e),o=this.chunkSize%2==0?0:-.5,h=this.chunkSize%2==0?0:.5;n.addCollider(r.x+o,this._chunkSize-r.y-1+h)}checkCollision(t,e,i,s){if(!this._collideEnabled)return!1;const n=this.transform.position,r=Math.floor(((t-n.x)/this._tileWidth+this._chunkSize/2)/this._chunkSize),o=Math.floor(((e-n.y)/this._tileHeight+this._chunkSize/2)/this._chunkSize),h=this.getKeyFromIndex(r,o),a=this._cssTilemapRendererMap.get(h);return void 0!==a&&a.checkCollision(t,e,i,s)}get chunkSize(){return this._chunkSize}set chunkSize(t){this._chunkSize=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.rowCount=this._chunkSize,t.columnCount=this._chunkSize}))}set imageSources(t){this._started?this._imageSources=t:this._initializeFunctions.push((()=>{this.imageSources=t}))}get pointerEvents(){return this._pointerEvents}set pointerEvents(t){this._pointerEvents=t,this._cssTilemapRendererMap.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this._tileWidth}set gridCellWidth(t){this._tileWidth!==t&&(this._tileWidth=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.gridCellWidth=this._tileWidth})))}get gridCellHeight(){return this._tileHeight}set gridCellHeight(t){this._tileHeight!==t&&(this._tileHeight=t,this.updateTilemapPosition(),this._cssTilemapRendererMap.forEach(((t,e)=>{t.gridCellHeight=this._tileHeight})))}get tileResolutionX(){return this._tileResolutionX}set tileResolutionX(t){this._tileResolutionX!==t&&(this._tileResolutionX=t,this._cssTilemapRendererMap.forEach(((t,e)=>{t.tileResolutionX=this._tileResolutionX})))}get tileResolutionY(){return this._tileResolutionY}set tileResolutionY(t){this._tileResolutionY!==t&&(this._tileResolutionY=t,this._cssTilemapRendererMap.forEach(((t,e)=>{t.tileResolutionY=this._tileResolutionY})))}get gridCenter(){const t=this.transform.position,e=this._chunkSize%2==1?0:this._tileWidth/2,i=this._chunkSize%2==1?0:this._tileHeight/2;return new Dt(t.x+e,t.y+i)}get gridCenterX(){const t=this.transform.position,e=this._chunkSize%2==1?0:this._tileWidth/2;return t.x+e}get gridCenterY(){const t=this.transform.position,e=this._chunkSize%2==1?0:this._tileHeight/2;return t.y+e}}class Ce extends ee{constructor(){super(...arguments),this._imageWidth=0,this._imageHeight=0,this._imageFlipX=!1,this._imageFlipY=!1,this._opacity=1,this._initializeFunction=null}renderInitialize(){var t;null===(t=this._initializeFunction)||void 0===t||t.call(this),this.htmlElement||this.asyncSetImagePath(qt)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this._imageWidth*this.centerOffset.x,this._imageHeight*this.centerOffset.y,0),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement;i.style.width=this._imageWidth/this.viewScale+"px",i.style.height=this._imageHeight/this.viewScale+"px";const s=this._imageFlipX?-1:1,n=this._imageFlipY?-1:1;this.css3DObject.scale.set(e*s,e*n,e),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imagePath(){var t;return(null===(t=this.htmlElement)||void 0===t?void 0:t.src)||null}asyncSetImagePath(t,e){if(!this.readyToDraw)return void(this._initializeFunction=()=>this.asyncSetImagePath(t,e));this.htmlElement||(this.htmlElement=new Image),this.htmlElement.src=t;const i=t=>{const s=t.target;s.removeEventListener("load",i),s.alt=this.gameObject.name+"_sprite_atlas",s.style.imageRendering="pixelated",0===this._imageWidth&&(this._imageWidth=s.naturalWidth*Jt.LengthUnitScalar),0===this._imageHeight&&(this._imageHeight=s.naturalHeight*Jt.LengthUnitScalar),s.style.width=this._imageWidth/this.viewScale+"px",s.style.height=this._imageHeight/this.viewScale+"px",s.style.opacity=this._opacity.toString();const n=this.initializeBaseComponents(!1);J.updateRawObject3DWorldMatrixRecursively(n),this.transform.enqueueRenderAttachedObject3D(n),null==e||e()};this.htmlElement.addEventListener("load",i)}get imageWidth(){return this._imageWidth}set imageWidth(t){this._imageWidth=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this._imageHeight}set imageHeight(t){this._imageHeight=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this._imageFlipX}set imageFlipX(t){this._imageFlipX=t,this.css3DObject&&(this._imageFlipX?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imageFlipY(){return this._imageFlipY}set imageFlipY(t){this._imageFlipY=t,this.css3DObject&&(this._imageFlipY?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get opacity(){return this._opacity}set opacity(t){this._opacity=t,this.htmlElement&&(this.htmlElement.style.opacity=this._opacity.toString())}}class ye extends Ut{constructor(){super(...arguments),this._collideMap=new Map,this._gridCellWidth=1,this._gridCellHeight=1,this._showCollider=!1,this._colliderIsShowing=!1,this._colliderImages=new Map,this._collideEnabled=!1,this._initializeFunctions=[],this._started=!1}start(){this._started=!0,this._initializeFunctions.forEach((t=>t())),this._initializeFunctions=[]}onEnable(){this._showCollider&&!this._colliderIsShowing&&(this.addColliderImages(),this._colliderIsShowing=!0),this._collideEnabled=!0}onDisable(){this.removeColliderImages(),this._colliderIsShowing=!1,this._collideEnabled=!1}addCollider(t,e){if(!this._started)return void this._initializeFunctions.push((()=>{this.addCollider(t,e)}));const i=this._collideMap.get(`${t}_${e}`);this._collideMap.set(`${t}_${e}`,void 0===i?1:i+1),this._showCollider&&this.addDebugImage(t*this.gridCellWidth,e*this.gridCellHeight)}addColliderFromTwoDimensionalArray(t,e,i){if(this._started)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)1===t[s][n]&&this.addCollider(n+e,t.length-(s+i));else this._initializeFunctions.push((()=>{this.addColliderFromTwoDimensionalArray(t,e,i)}))}removeCollider(t,e){const i=this._collideMap.get(`${t}_${e}`);void 0!==i&&(1===i?this._collideMap.delete(`${t}_${e}`):this._collideMap.set(`${t}_${e}`,i-1),this._showCollider&&this.removeDebugImage(t*this.gridCellWidth,e*this.gridCellHeight))}addColliderImages(){this._collideMap.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.addDebugImage(i*this.gridCellWidth,s*this.gridCellHeight)}))}removeColliderImages(){this._colliderImages.forEach((t=>{t.destroy()})),this._colliderImages.clear()}addDebugImage(t,e){const i=new Pt;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debugImage",new u(t,e,41e4)).withComponent(Kt).withComponent(Ce,(t=>{t.opacity=.5,t.pointerEvents=!1})).getGameObject(i)),this._colliderImages.set(`${t}_${e}`,i.ref)}removeDebugImage(t,e){const i=this._colliderImages.get(`${t}_${e}`);i&&(i.destroy(),this._colliderImages.delete(`${t}_${e}`))}checkCollision(t,e,i,s){if(!this._collideEnabled)return!1;const n=this.transform.position;t-=n.x,e-=n.y;const r=Math.floor(t/this.gridCellWidth),o=Math.floor((t+i)/this.gridCellWidth),h=Math.floor(e/this.gridCellHeight),a=Math.floor((e+s)/this.gridCellHeight);for(let t=h;t<=a;t++)for(let e=r;e<=o;e++){const i=this._collideMap.get(`${e}_${t}`);if(void 0!==i&&i>0)return!0}return!1}get gridCellWidth(){return this._gridCellWidth}set gridCellWidth(t){this._gridCellWidth=t}get gridCellHeight(){return this._gridCellHeight}set gridCellHeight(t){this._gridCellHeight=t}get showCollider(){return this._showCollider}set showCollider(t){this._showCollider!==t&&(this._showCollider=t,this._showCollider&&!this._colliderIsShowing?(this.addColliderImages(),this._colliderIsShowing=!0):(this.removeColliderImages(),this._colliderIsShowing=!1))}get gridCenter(){const t=this.transform.position;return new Dt(t.x,t.y)}get gridCenterX(){return this.transform.position.x}get gridCenterY(){return this.transform.position.y}}class xe extends ee{constructor(){super(...arguments),this._width=4,this._height=4,this._iframeSource=""}renderInitialize(){this.htmlElement=document.createElement("iframe"),this.htmlElement.title=this.gameObject.name+"_iframe",this.htmlElement.width=(this._width/this.viewScale).toString(),this.htmlElement.height=(this._height/this.viewScale).toString(),this.htmlElement.src=this._iframeSource,this.htmlElement.style.border="none";const t=this.initializeBaseComponents(!1);t.scale.set(this.viewScale,this.viewScale,this.viewScale),J.updateRawObject3DWorldMatrixRecursively(t),this.transform.enqueueRenderAttachedObject3D(t)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this._width*this.centerOffset.x,this._height*this.centerOffset.y,0),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale;this.htmlElement.width=(this._width/this.viewScale).toString(),this.htmlElement.height=(this._height/this.viewScale).toString(),this.css3DObject.scale.set(e,e,e),t&&(J.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get width(){return this._width}set width(t){this._width=t,this.htmlElement&&(this.htmlElement.width=(t/this.viewScale).toString()),this.updateCenterOffset(!0)}get height(){return this._height}set height(t){this._height=t,this.htmlElement&&(this.htmlElement.height=(t/this.viewScale).toString()),this.updateCenterOffset(!0)}get iframeSource(){return this._iframeSource}set iframeSource(t){this._iframeSource=t,this.htmlElement&&(this.htmlElement.src=t)}get element(){return this.htmlElement}}class be extends Ut{constructor(){super(...arguments),this._collideMap=new Map,this._showCollideSpot=!1,this._collideSpotIsShowing=!1,this._colliderImages=new Map,this._gridObjectCollideMap=null,this._collideInfoAddedToMap=!1,this._initializeFunctions=[],this._started=!1}start(){if(this._started=!0,this._initializeFunctions.forEach((t=>t())),this._initializeFunctions=[],!this._gridObjectCollideMap)throw new Error("GridCollider: gridObjectCollideMap must be set")}onEnable(){this._showCollideSpot&&!this._collideSpotIsShowing&&(this.addColliderImages(),this._collideSpotIsShowing=!0),this.addAllCollideInfoToMap()}onDisable(){this._showCollideSpot&&(this.removeColliderImages(),this._collideSpotIsShowing=!1),this._collideInfoAddedToMap&&this.removeAllCollideInfoFromMap()}onDestroy(){this.removeColliderImages(),this.removeAllCollideInfoFromMap()}addCollider(t,e){this._started?this._collideMap.has(`${t}_${e}`)||(this._collideMap.set(`${t}_${e}`,!0),this._showCollideSpot&&this.addDebugImage(t,e),this.gridObjectCollideMap&&this.addCollideInfoToMap(t,e)):this._initializeFunctions.push((()=>{this.addCollider(t,e)}))}addColliderFromTwoDimensionalArray(t,e,i){if(this._started)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)1===t[s][n]&&this.addCollider(n+e,t.length-(s+i));else this._initializeFunctions.push((()=>{this.addColliderFromTwoDimensionalArray(t,e,i)}))}removeCollider(t,e){this._started?(this._collideMap.delete(`${t}_${e}`),this._showCollideSpot&&this.removeDebugImage(t,e),this.gridObjectCollideMap&&this.removeCollideInfoFromMap(t,e)):this._initializeFunctions.push((()=>{this.removeCollider(t,e)}))}addColliderImages(){this._collideMap.forEach(((t,e)=>{const[i,s]=e.split("_").map(Number);this.addDebugImage(i,s)}))}removeColliderImages(){this._colliderImages.forEach((t=>{t.destroy()})),this._colliderImages.clear()}addDebugImage(t,e){if(!this._gridObjectCollideMap)return;const i=t*this._gridObjectCollideMap.gridCellWidth,s=e*this._gridObjectCollideMap.gridCellHeight,n={ref:null};this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("debugImage",new u(i,s,41e4)).withComponent(Kt).withComponent(Ce,(t=>t.opacity=.5)).getGameObject(n)),this._colliderImages.set(`${t}_${e}`,n.ref)}removeDebugImage(t,e){const i=this._colliderImages.get(`${t}_${e}`);i&&(i.destroy(),this._colliderImages.delete(`${t}_${e}`))}addCollideInfoToMap(t,e){if(!this._gridObjectCollideMap)return;const i=this.transform.position,s=this._gridObjectCollideMap.gridCellWidth,n=this._gridObjectCollideMap.gridCellHeight,r=this._gridObjectCollideMap.gridCenter,o=Math.floor(t+(i.x+r.x)/s),h=Math.floor(e+(i.y+r.y)/n);this._gridObjectCollideMap.addCollider(o,h)}addAllCollideInfoToMap(){if(!this._gridObjectCollideMap)return;const t=this.transform.position,e=this._gridObjectCollideMap.gridCellWidth,i=this._gridObjectCollideMap.gridCellHeight,s=this._gridObjectCollideMap.gridCenter;this._collideMap.forEach(((n,r)=>{const[o,h]=r.split("_").map(Number),a=Math.floor(o+t.x/e+s.x),l=Math.floor(h+t.y/i+s.y);this._gridObjectCollideMap.addCollider(a,l)}))}removeCollideInfoFromMap(t,e){if(!this._gridObjectCollideMap)return;const i=this.transform.position,s=this._gridObjectCollideMap.gridCellWidth,n=this._gridObjectCollideMap.gridCellHeight,r=this._gridObjectCollideMap.gridCenter,o=Math.floor(t+(i.x+r.x)/s),h=Math.floor(e+(i.y+r.y)/n);this._gridObjectCollideMap.removeCollider(o,h)}removeAllCollideInfoFromMap(){if(!this._gridObjectCollideMap)return;const t=this.transform.position,e=this._gridObjectCollideMap.gridCellWidth,i=this._gridObjectCollideMap.gridCellHeight,s=this._gridObjectCollideMap.gridCenter;this._collideMap.forEach(((n,r)=>{const[o,h]=r.split("_").map(Number),a=Math.floor(o+(t.x+s.x)/e),l=Math.floor(h+(t.y+s.y)/i);this._gridObjectCollideMap.removeCollider(a,l)}))}get gridObjectCollideMap(){return this._gridObjectCollideMap}set gridObjectCollideMap(t){this._collideInfoAddedToMap&&this.removeAllCollideInfoFromMap(),this._gridObjectCollideMap=t,this.addAllCollideInfoToMap(),this._collideInfoAddedToMap=!0,this._gridObjectCollideMap&&this._showCollideSpot&&(this.removeColliderImages(),this.addColliderImages())}get showCollideSpot(){return this._showCollideSpot}set showCollideSpot(t){this._showCollideSpot!==t&&(this._showCollideSpot=t,this._showCollideSpot&&!this._collideSpotIsShowing?(this.addColliderImages(),this._collideSpotIsShowing=!0):(this.removeColliderImages(),this._collideSpotIsShowing=!1))}}class we extends Ut{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this._offsetX=1.5,this._offsetY=1.5,this._initializeCenterFromPosition=!0,this._center=new Dt,this._tempVector3=new u,this._tempVector2=new Dt}start(){this._initializeCenterFromPosition&&this._center.set(this.transform.localPosition.x,this.transform.localPosition.y)}update(){const t=this.engine.cameraContainer.camera.getWorldPosition(this._tempVector3),e=this.transform.parent,i=e?e.inverseTransformPoint(t):t,s=this._tempVector2.set(i.x,i.y),n=s.x-this._center.x,r=s.y-this._center.y,o=this._offsetX*n,h=this._offsetY*r;this.transform.localPosition.x=this._center.x+o,this.transform.localPosition.y=this._center.y+h}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t}get initializeCenterFromPosition(){return this._initializeCenterFromPosition}set initializeCenterFromPosition(t){this._initializeCenterFromPosition=t}get center(){return this._center}set center(t){this._center.copy(t)}}var ve=i(794),Me=i(152),Ee=i(13);class De extends Rt{constructor(){super(...arguments),this._colideTilemapChunkRenderer=new Pt,this._gridObjectCollideMap=new Pt}getColideTilemapChunkRendererRef(t){return this._colideTilemapChunkRenderer=t,this}getGridObjectCollideMapRef(t){return this._gridObjectCollideMap=t,this}make(){const t=this.instantiater;return this.gameObjectBuilder.withChild(t.buildGameObject("tilemap").withComponent(_e,(t=>t.offset=-50)).withChild(t.buildGameObject("floor",new u(0,0,-1)).withComponent(ge,(t=>{const e=new Image;e.src=ve,t.imageSources=[new ue(e,3,20)],t.pointerEvents=!1,e.onload=()=>{e.onload=null;const i={i:0,a:57},s={i:0,a:58},n={i:0,a:48},r={i:0,a:49},o={i:0,a:52},h={i:0,a:53};t.drawTileFromTwoDimensionalArray([[s,i,s,i,s,i,s,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,s,i,s,i,s,i,s,i],[i,s,i,s,i,s,i,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,i,s,i,s,i,s,i,s],[s,i,s,i,s,i,s,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,h,o,h,n,r,n,s,i,s,i,s,i,s,i],[i,s,i,s,i,s,i,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,o,h,o,r,n,r,i,s,i,s,i,s,i,s]],-2,-2)}}))).withChild(t.buildGameObject("wall").withComponent(fe,(t=>{const e=new Image;e.src=ve,t.imageSources=[new ue(e,3,20)],t.pointerEvents=!1,e.onload=()=>{e.onload=null;const i={i:0,a:56},s={i:0,a:50},n={i:0,a:59},r={i:0,a:40},o={i:0,a:51},h=null;t.drawTileFromTwoDimensionalArray([[i,i,i,i,i,i,i,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,s,s,s,h,h,h,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,i,i,i,i,i,i,i,i],[i,i,i,i,i,i,i,i,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,i,i,i,i,i,i,i,i],[n,n,n,n,n,n,n,n,r,r,o,o,o,r,r,r,o,o,o,r,r,r,o,o,o,r,r,r,o,o,o,r,r,r,o,o,o,r,r,r,o,o,o,r,r,r,o,o,o,r,r,r,i,i,i,i,i,i,i,i]],-2,2);const a={i:0,a:44},l={i:0,a:42};t.drawTileFromTwoDimensionalArray([[h,h,h,h,h,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l,h,a,h,h,h,l]],-2,7),t.addCollider(-3,1),t.addCollider(-3,0),t.addCollider(-3,-1),t.addCollider(-3,-2);for(let e=-4;e<58;e++)t.addCollider(e,-3);t.addCollider(58,1),t.addCollider(58,0),t.addCollider(58,-1),t.addCollider(58,-2),[{x:5,y:1},{x:11,y:1},{x:17,y:1},{x:23,y:1},{x:29,y:1},{x:35,y:1},{x:41,y:1},{x:47,y:1}].forEach((e=>{t.drawTileFromTwoDimensionalArray([[{i:0,a:0},{i:0,a:1},{i:0,a:2}],[{i:0,a:3},{i:0,a:4},{i:0,a:5}],[{i:0,a:6},{i:0,a:7},{i:0,a:8}],[{i:0,a:9},{i:0,a:10},{i:0,a:11}],[{i:0,a:12},{i:0,a:13},{i:0,a:14}],[{i:0,a:15},{i:0,a:16},{i:0,a:17}]],e.x,e.y)})),[{x:8,y:3},{x:14,y:3},{x:20,y:3},{x:26,y:3},{x:32,y:3},{x:38,y:3},{x:44,y:3}].forEach((e=>{t.drawTileFromTwoDimensionalArray([[{i:0,a:24},{i:0,a:25},{i:0,a:26}],[{i:0,a:27},{i:0,a:28},{i:0,a:29}],[{i:0,a:30},{i:0,a:31},{i:0,a:32}],[{i:0,a:33},{i:0,a:34},{i:0,a:35}],[{i:0,a:36},{i:0,a:37},{i:0,a:38}]],e.x,e.y)}))}})).getComponent(fe,this._colideTilemapChunkRenderer))).withChild(t.buildGameObject("object_collide_map",new u(.5,.5,0)).withComponent(ye,(t=>{t.gridCellHeight=this._colideTilemapChunkRenderer.ref.gridCellHeight,t.gridCellWidth=this._colideTilemapChunkRenderer.ref.gridCellWidth})).getComponent(ye,this._gridObjectCollideMap)).withChild(t.buildGameObject("objects").withChild(t.buildGameObject("iframe",new u(51.5,.5,0)).withComponent(xe,(t=>{t.iframeSource="https://www.youtube.com/embed/p9wmCeqB0eA",t.width=12,t.height=6.75,t.viewScale=.01,t.centerOffset=new Dt(0,.5)})).withComponent(ae)).withChild(t.buildGameObject("sans",new u(39,-1,0)).withComponent(ie,(t=>{t.asyncSetImage(Me,4,4),t.centerOffset=new Dt(.5,.7),t.pointerEvents=!0,t.imageIndex=12,t.imageWidth=1,t.imageHeight=1.375,t.viewScale=1,t.renderMode=$t.ObjectFit})).withComponent(be,(t=>{t.addCollider(0,0),t.gridObjectCollideMap=this._gridObjectCollideMap.ref})).withComponent(ae)).withChild(t.buildGameObject("pillar",new u(5.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(11.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(17.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(23.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(29.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(35.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(41.5,-2,0)).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))).withChild(t.buildGameObject("pillar",new u(47.5,-2,0)).active(!1).withComponent(Ce,(t=>{t.asyncSetImagePath(Ee),t.centerOffset=new Dt(0,.5),t.pointerEvents=!1,t.imageWidth=3.5,t.imageHeight=10})).withComponent(we,(t=>{t.offsetX=-.7,t.offsetY=0})).withComponent(_e,(t=>t.offset=-6))))}}class Oe extends class{constructor(t,e){this._instantiater=t.instantiater,this._interopObject=e||null,this._sceneBuilder=new jt(t.sceneProcessor),this._gameSetting=new At(At.createDefaultObject())}getGameSettingObject(){return Object.freeze(this._gameSetting),this._gameSetting.make()}get instantiater(){return this._instantiater}get interopObject(){return this._interopObject}get sceneBuilder(){return this._sceneBuilder}get setting(){return this._gameSetting}}{run(){const t=this.instantiater,e=new Pt,i=new Pt,s=new Pt;return this.sceneBuilder.withChild(t.buildPrefab("sans_fight_room",De).getColideTilemapChunkRendererRef(e).getGridObjectCollideMapRef(i).make()).withChild(t.buildPrefab("player",de).withCollideMap(i).withCollideMap(e).withGridPosition(new Pt(new Dt(0,-1))).make().getGameObject(s)).withChild(t.buildPrefab("camera",Qt).withTrackTarget(s).make())}}!function(t){const e=new St(t);e.run(Oe),e.inputHandler.startHandleEvents()}(document.getElementById("game_view"))})()})();